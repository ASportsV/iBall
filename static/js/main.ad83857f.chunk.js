(this.webpackJsonpiball=this.webpackJsonpiball||[]).push([[0],{28:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return c}));var a=n(9),r=n(10),i=n(4),o=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"game1",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unit0";Object(a.a)(this,t),this.GAME_ID=n,this.UNIT_ID=r,console.log(e.location.search),console.debug("%cParams:\n    GAME_ID: ".concat(n,",\n    UNIT_ID: ").concat(r,",\n    "),"background: #444; color: #bada55; padding: 2px; border-radius:2px")}return Object(r.a)(t,[{key:"VIDEO_IDS",get:function(){return i.i["".concat(this.GAME_ID,"_").concat(this.UNIT_ID)]}}]),t}();var c=function(){var t=new URLSearchParams(e.location.search),n="game1";null!==t.get("g")&&(n="game".concat(t.get("g"))),["game1","game2"].includes(n)||alert("GameId must be game1 or game2");var a="unit0";null!==t.get("u")&&(a="unit".concat(t.get("u"))),["unit0","unit1","unit2"].includes(a)||alert("UnitId must be unit0, unit1, or unit2");var r="FULL";return null!==t.get("m")&&(r=t.get("m").toUpperCase()),["AUG","FULL","RAW"].includes(r)||alert("Mode must be RAW, AUG, or FULL"),null!==t.get("gf")&&t.get("gf"),null!==t.get("gi")&&t.get("gi"),new o(n,a)}()}).call(this,n(75))},4:function(e,t,n){"use strict";n.d(t,"h",(function(){return r})),n.d(t,"d",(function(){return i})),n.d(t,"g",(function(){return o})),n.d(t,"e",(function(){return c})),n.d(t,"b",(function(){return s})),n.d(t,"f",(function(){return l})),n.d(t,"c",(function(){return d})),n.d(t,"j",(function(){return u})),n.d(t,"a",(function(){return f})),n.d(t,"i",(function(){return v}));var a=n(8),r={2760:{fn:"Anderson",ln:"Varejao",offSpeed:4.07,team:"GSW",star:!1},2738:{fn:"Andre",ln:"Iguodala",offSpeed:3.78,team:"GSW",star:!1},101106:{fn:"Andrew",ln:"Bogut",offSpeed:3.5,team:"GSW",star:!1},201575:{fn:"Brandon",ln:"Rush",offSpeed:4.09,team:"GSW",star:!1},203110:{fn:"Draymond",ln:"Green",offSpeed:3.49,team:"GSW",star:"defender"},203105:{fn:"Festus",ln:"Ezeli",offSpeed:3.97,team:"GSW",star:!1},203084:{fn:"Harrison",ln:"Barnes",offSpeed:4.02,team:"GSW",star:!1},203546:{fn:"Ian",ln:"Clark",offSpeed:4.07,team:"GSW",star:!1},203949:{fn:"James Michael",ln:"McAdoo",offSpeed:4.27,team:"GSW",star:!1},1626172:{fn:"Kevon",ln:"Looney",offSpeed:4.05,team:"GSW",star:!1},202691:{fn:"Klay",ln:"Thompson",offSpeed:3.85,team:"GSW",star:"shooter"},2571:{fn:"Leandro",ln:"Barbosa",offSpeed:3.88,team:"GSW",star:!1},201578:{fn:"Marreese",ln:"Speights",offSpeed:3.67,team:"GSW",star:!1},2733:{fn:"Shaun",ln:"Livingston",offSpeed:3.85,team:"GSW",star:!1},201939:{fn:"Stephen",ln:"Curry",offSpeed:3.68,team:"GSW",star:"shooter"},201574:{fn:"Jason",ln:"Thompson",offSpeed:3.68,team:"GSW",star:!1},101112:{fn:"Channing",ln:"Frye",offSpeed:3.61,team:"CLE",star:!1},2563:{fn:"Dahntay",ln:"Jones",offSpeed:4.31,team:"CLE",star:!1},202697:{fn:"Iman",ln:"Shumpert",offSpeed:4.08,team:"CLE",star:!1},2747:{fn:"JR",ln:"Smith",offSpeed:3.92,team:"CLE",star:!1},2592:{fn:"James",ln:"Jones",offSpeed:3.84,team:"CLE",star:!1},203099:{fn:"Jared",ln:"Cunningham",offSpeed:4.24,team:"CLE",star:!1},203925:{fn:"Joe",ln:"Harris",offSpeed:4.6,team:"CLE",star:!1},203895:{fn:"Jordan",ln:"McRae",offSpeed:3.6,team:"CLE",star:!1},201567:{fn:"Kevin",ln:"Love",offSpeed:3.86,team:"CLE",star:!1},202681:{fn:"Kyrie",ln:"Irving",offSpeed:3.78,team:"CLE",star:!1},2544:{fn:"LeBron",ln:"James",offSpeed:3.72,team:"CLE",star:"star"},203521:{fn:"Matthew",ln:"Dellavedova",offSpeed:3.9,team:"CLE",star:!1},2590:{fn:"Mo",ln:"Williams",offSpeed:3.92,team:"CLE",star:!1},2210:{fn:"Richard",ln:"Jefferson",offSpeed:3.96,team:"CLE",star:!1},201619:{fn:"Sasha",ln:"Kaun",offSpeed:4.12,team:"CLE",star:!1},202389:{fn:"Timofey",ln:"Mozgov",offSpeed:4.12,team:"CLE",star:!1},202684:{fn:"Tristan",ln:"Thompson",offSpeed:4.1,team:"CLE",star:!1},201566:{fn:"Russell",ln:"Westbrook",offSpeed:3.71,team:"OKC",star:"shooter"},201627:{fn:"Anthony",ln:"Morrow",offSpeed:3.8,team:"OKC",star:!1},203079:{fn:"Dion",ln:"Waiters",offSpeed:3.74,team:"OKC",star:!1},2555:{fn:"Nick",ln:"Collison",offSpeed:3.9,team:"OKC",star:!1},202713:{fn:"Kyle",ln:"Singler",offSpeed:4.21,team:"OKC",star:!1},200779:{fn:"Steve",ln:"Novak",offSpeed:3.87,team:"OKC",star:!1},201586:{fn:"Serge",ln:"Ibaka",offSpeed:3.67,team:"OKC",star:!1},202683:{fn:"Enes",ln:"Kanter",offSpeed:3.89,team:"OKC",star:!1},203500:{fn:"Steven",ln:"Adams",offSpeed:3.79,team:"OKC",star:!1},201571:{fn:"D.J.",ln:"Augustin",offSpeed:3.84,team:"OKC",star:!1},203460:{fn:"Andre",ln:"Roberson",offSpeed:4.36,team:"OKC",star:!1},1626166:{fn:"Cameron",ln:"Payne",offSpeed:4.11,team:"OKC",star:!1},201142:{fn:"Kevin",ln:"Durant",offSpeed:3.47,team:"OKC",star:"shooter"},202362:{fn:"Lance",ln:"Stephenson",offSpeed:3.98,team:"LAC",star:!1},101108:{fn:"Chris",ln:"Paul",offSpeed:3.67,team:"LAC",star:"star"},200755:{fn:"Redick",ln:"JJ",offSpeed:4.11,team:"LAC",star:!1},2746:{fn:"Josh",ln:"Smith",offSpeed:3.72,team:"LAC",star:!1},201599:{fn:"DeAndre",ln:"Jordan",offSpeed:3.68,team:"LAC",star:!1},203143:{fn:"Pablo",ln:"Prigioni",offSpeed:4.46,team:"LAC",star:!1},2037:{fn:"Jamal",ln:"Crawford",offSpeed:3.72,team:"LAC",star:!1},201601:{fn:"Luc",ln:"Mbah a Moute",offSpeed:4.08,team:"LAC",star:!1},203085:{fn:"Austin",ln:"Rivers",offSpeed:4.13,team:"LAC",star:!1},201933:{fn:"Blake",ln:"Griffin",offSpeed:3.56,team:"LAC",star:!1},202325:{fn:"Wesley",ln:"Johnson",offSpeed:4.06,team:"LAC",star:!1},1718:{fn:"Paul",ln:"Pierce",offSpeed:3.54,team:"LAC",star:!1},202332:{fn:"Cole",ln:"Aldrich",offSpeed:3.96,team:"LAC",star:!1}},i=(Object.entries(r).reduce((function(e,t){var n=Object(a.a)(t,2),r=n[0];n[1];return e[+r]=.6*Math.random(),e}),{}),20),o=1.8,c={off:.03,on:.6},s=8,l=4,d={min:10,max:630,mina:.2,maxa:.35},u=[360,18e3/94],f={offense_inner_border:"#f5f5f5",offense_bg_fill:"#f5f5f577",offense_outer_border:"rgba(220, 220, 220, 0.1)",defense_bg_fill:"rgba(255, 255, 255, 0.15)",defense_fg_fill:"#f5f5f5",player_name:"#f5f5f5",BG_MASK_ALPHA:.3,FG_MASK_ALPHA:.2,off_df_link:"255, 255, 255",star_name:"rgb(255, 243, 194)",star_star:"rgb(255, 243, 194)"},v={game2_unit0:[],game1_unit0:["4_,","5_c,t","6_,"],game1_unit1:["4_,","5_c,t","6_,","7_c,t","8_c,","9_c,t","10_,","11_c,t","12_,","13_c,t","14_c,","15_c,t"],game1_unit2:["16_,","17_c,t","18_,l","19_c,t","20_,","21_c,t","22_,","23_c,t","24_,l","25_c,t","26_,l","27_,l","28_,l","30_,"],game2_unit1:["0_,","1_c,t","2_,t","3_c,","4_c,t","5_c,","6_c,t","7_c,l","8_c,t","9_c,","10_c,t"],game2_unit2:["11_,t","12_c,l","13_c,","14_c,t","15_c,","16_c,t","17_,l","18_c,t","19_,t","20_c,","21_c,t","22_c,l","23_c,t","24_,l","25_c,t","26_,","27_c,t","28_,","29_c,t","30_,t","31_c,","32_c,t","33_,t","34_c,","35_c,t"]}},42:function(e,t,n){"use strict";var a,r;!function(e){e.MIDDLE="MIDDLE",e.LEFT="LEFT",e.RIGHT="RIGHT"}(a||(a={})),function(e){e.N="NORTH",e.S="SOUTH",e.E="EAST",e.W="WEST",e.NE="NORTH_EAST",e.NW="NORTH_WEST",e.SE="SOUTH_EAST",e.SW="SOUTH_WEST"}(r||(r={}))},43:function(e,t){},44:function(e,t){},45:function(e,t){},46:function(e,t){},63:function(e,t,n){},73:function(e,t,n){},74:function(e,t,n){"use strict";var a;n(42),n(43),n(44),n(45),n(46);!function(e){e[e.Far=1]="Far",e[e.Near=0]="Near",e[e.Both=-1]="Both"}(a||(a={}))},77:function(e,t,n){},78:function(e,t,n){},79:function(e,t,n){},80:function(e,t,n){"use strict";n.r(t);var a=n(5),r=n.n(a),i=n(47),o=n.n(i),c=n(8),s=n(13),l=n(23),d=n(7),u=n(2),f=n.n(u),v=n(6),h=n(9),p=n(10),b=n(11),m=n(14),O=n(15),g=n(3),j=n(12),y=(n(63),n(64),n(65),n(48)),x=n.n(y),_=n(37),S=n(40),k=n(51),E=n(4),A={OVERLAY:!1,COURT:!0,GAZE:!1,BBOX:!1,LINE:!1,ATTENTIONS:!1,TIMELINE:!0,MOUSE_GAZE:!0,DEBUG_MEM:!1},w=.25,I=n(16),T=function(e){return[Math.min.apply(Math,Object(s.a)(e)),Math.max.apply(Math,Object(s.a)(e))]};function C(e,t){return e.reduce((function(e,n){return e[n[t]]=n,e}),{})}function P(e,t){var n,a=new Set(e),r=Object(I.a)(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;a.add(i)}}catch(o){r.e(o)}finally{r.f()}return a}function M(e){return L.apply(this,arguments)}function L(){return(L=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){setTimeout(e,t)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return N.apply(this,arguments)}function N(){return(N=Object(v.a)(f.a.mark((function e(t){var n,a=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:70,e.abrupt("return",new Promise((function(e){setInterval((function(){t()&&e(null)}),n)})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e){return(e/1024/1024).toFixed(2)}function G(){var e=performance.memory;console.debug("Used / Total: ".concat(R(e.usedJSHeapSize),"mb / ").concat(R(e.totalJSHeapSize),"mb"))}var B=0;function H(){return++B}function D(e){return W.apply(this,arguments)}function W(){return(W=Object(v.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new Image).src=t,e.next=4,new Promise((function(e){n.onload=function(n){URL.revokeObjectURL(t),e(void 0)}}));case 4:return e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e,t){var n=0,a=0;for(a=0;a<t.length;++a){var r=t[a];if(e>=n&&e<n+r.maxFrame)break;n+=r.maxFrame}return{videoIdx:a,frameIdx:e-n}}function V(e,t,n){for(var a=0,r=0;r<e;++r)a+=n[r].maxFrame;return a+t}var z=function(e,t){var n=e.x-t.x,a=e.y-t.y;return Math.sqrt(n*n+a*a)};function U(e,t,n,a){var r=n-e,i=a-t,o=r||i?Math.atan2(i,r):0;return o<0&&(o+=2*Math.PI),o*(180/Math.PI)}function Y(e,t,n){var a=new e;return Object(v.a)(f.a.mark((function e(){var r,i,o,c=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=c.length,i=new Array(r),o=0;o<r;o++)i[o]=c[o];return a.postMessage([t].concat(i)),e.next=4,new Promise((function(e){a.addEventListener("message",(function r(i){i.data[0]===t?(a.removeEventListener("message",r),e(i.data[1])):null===n||void 0===n||n(i.data)}))}));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})))}var J,K,X;n(73),n(74);function q(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,a=e.canvas,r=a.width,i=a.height;e.ctx.drawImage(t,0,0,r,i),0!==n&&Q(e,n)}function Q(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w,n=e.ctx,a=e.canvas,r=a.width,i=a.height;n.save(),n.fillStyle="rgba(0, 0, 0, ".concat(t,")"),n.fillRect(0,0,r,i),n.restore()}!function(e){e.offensive="in_offensive",e.defensive="in_defensive",e.other="in_other"}(J||(J={})),function(e){e[e.BALL_HOLDER=0]="BALL_HOLDER",e[e.NEXT_BALL_HOLDER=1]="NEXT_BALL_HOLDER",e[e.EMPTY_PLAYER=2]="EMPTY_PLAYER",e[e.STAR=3]="STAR"}(K||(K={})),function(e){e[e.Interest=1]="Interest",e[e.Normal=2]="Normal",e[e.Normal_Interest=3]="Normal_Interest"}(X||(X={}));var $=document.createElement("canvas");$.getContext("2d");function ee(e){return Object.entries(e)}function te(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(ee(t).forEach((function(t){"lineWidth"===(null===t||void 0===t?void 0:t[0])&&void 0!==t[1]&&(e.lineWidth=t[1]),"strokeStyle"===(null===t||void 0===t?void 0:t[0])&&void 0!==t[1]&&(e.strokeStyle=t[1]),"font"===(null===t||void 0===t?void 0:t[0])&&t[1]&&(e.font=t[1]),"textBaseline"===(null===t||void 0===t?void 0:t[0])&&t[1]&&(e.textBaseline=t[1]),"lineCap"===(null===t||void 0===t?void 0:t[0])&&t[1]&&(e.lineCap=t[1]),"lineJoin"===(null===t||void 0===t?void 0:t[0])&&t[1]&&(e.lineJoin=t[1])})),t.fillStyle){var n=t.fillStyle;"object"===typeof n&&"pattern"in n&&"opacity"in n?(e.fillStyle=n.pattern,e.globalAlpha=n.opacity):e.fillStyle=n}}var ne=function(e){return(e+2)%2};function ae(e,t,n,a){!function(e,t){e.save();var n=1.7525735,a=.0598341402,r=-.891780472,i=.249200452;e.setTransform(n,a,r,i,0,0);var o=t.map((function(e){var t=e.cx,o=e.cy,c=(t-r/i*o-0-0)/(n-r/i*a);return{tx:c,ty:(t-0-n*c)/r}}));t.filter((function(e){return e.inOffsensiveCourt})).forEach((function(t,n){var a=o[n],r=a.tx,i=a.ty;e.fillStyle=E.a.offense_outer_border,e.beginPath(),e.arc(r,i,32,0,2*Math.PI),e.fill()})),t.forEach((function(t,n){var a=t.size,r=t.fill,i=o[n],c=i.tx,s=i.ty,l=10+22*a;e.fillStyle=r,e.beginPath(),e.arc(c,s,l,0,2*Math.PI),e.fill()})),e.globalCompositeOperation="destination-out",t.forEach((function(t,n){t.fill;var a=o[n],r=a.tx,i=a.ty;e.beginPath(),e.arc(r,i,10,0,2*Math.PI),e.fill()})),e.globalCompositeOperation="source-over",e.lineWidth=1,e.strokeStyle=E.a.offense_bg_fill,t.filter((function(e){return e.inOffsensiveCourt})).forEach((function(t,n){var a=o[n],r=a.tx,i=a.ty;e.beginPath(),e.arc(r,i,32,0,2*Math.PI),e.stroke()})),e.strokeStyle=E.a.offense_inner_border,t.forEach((function(t,n){var a=t.inOffsensiveCourt,r=o[n],i=r.tx,c=r.ty;e.lineWidth=a?1:3,e.beginPath(),e.arc(i,c,10,0,2*Math.PI),e.stroke()})),e.restore()}(e,t),function(e,t,n){e.save();var a=1.7525735,r=1e-7,i=.549200452;e.setTransform(a,1e-7,r,i,0,0);var o=function(e,t){var n=(e-r/i*t+0-0)/(a-r/i*1e-7);return{x:n,y:(e-0-a*n)/r}},s=function(e,t){var n=ne(e-.02-.13*Math.max(0,Math.min(1,1-(t-d)/l))),a=ne(e+.02+.13*Math.max(0,Math.min(1,1-(t-d)/l)));if(a<n&&!(n>1.5&&a<.5)||n<.5&&a>1.5){var r=[n,a];a=r[0],n=r[1]}return[n,a]},l=12,d=3.5;e.save();var u,f=Object(I.a)(t);try{for(f.s();!(u=f.n()).done;){var v=u.value,h=v.cx,p=v.cy,b=v.dx,m=v.dy,O=v.tdist;if(!(O>=l||O<=d)){var g=U(h,p,b,m)/180;e.beginPath(),e.lineWidth=2;var j=o(h+40*Math.cos(g*Math.PI),p+40*Math.sin(g*Math.PI)),y=j.x,x=j.y,_=o(b-50*Math.cos(g*Math.PI),m-50*Math.sin(g*Math.PI)),S=_.x,k=_.y,A=e.createLinearGradient(y,x,S,k);A.addColorStop(0,"rgba(".concat(E.a.off_df_link,", 0.1)")),A.addColorStop(.1,"rgba(".concat(E.a.off_df_link,", ").concat(.3+(l-O)/l*.5,")")),A.addColorStop(.9,"rgba(".concat(E.a.off_df_link,", ").concat(.3+(l-O)/l*.5,")")),A.addColorStop(1,"rgba(".concat(E.a.off_df_link,", 0.1)")),e.strokeStyle=A,e.shadowColor="rgb(".concat(E.a.off_df_link,")"),e.shadowBlur=5,e.moveTo(y,x),e.lineTo(S,k),e.stroke()}}}catch(te){f.e(te)}finally{f.f()}e.restore();var w,T=100,C=Object(I.a)(t);try{for(C.s();!(w=C.n()).done;){var P=w.value,M=P.cx,L=P.cy,F=P.dx,N=P.dy,R=P.tdist,G=P.smoothDFdiff,B=104+15*Math.max(0,G);e.lineWidth=B-T;var H=U(M,L,F,N)/180,D=Math.max(0,T*Math.sqrt(1/(Math.pow(Math.cos(H*Math.PI)/a,2)+Math.pow(Math.sin(H*Math.PI)/i,2)))-30),W=o(M-=D*Math.cos(H*Math.PI),L-=D*Math.sin(H*Math.PI)),Z=W.x,V=W.y,z=Math.atan(a*Math.tan(H*Math.PI)/i)/Math.PI;H>.5&&H<=1.5&&(z=(z+1)%2);var Y=s(z,R),J=Object(c.a)(Y,2),K=J[0],X=J[1],q=s(z,d),Q=Object(c.a)(q,2),$=Q[0],ee=Q[1];e.strokeStyle=E.a.defense_bg_fill,e.beginPath(),e.arc(Z,V,T+(B-T)/2,$*Math.PI,ee*Math.PI),e.stroke(),e.strokeStyle=E.a.defense_fg_fill,e.beginPath(),e.arc(Z,V,T+(B-T)/2,K*Math.PI,X*Math.PI),e.stroke()}}catch(te){C.e(te)}finally{C.f()}e.restore()}(e,n)}function re(e,t,n){e.save(),e.shadowColor="rgba(255, 255, 255, 0.5)",t.forEach((function(t){var a,r=t.bbox,i=r.x,o=r.y,c=r.w,s=r.h;e.shadowBlur=t.on?10:40*(null!==(a=t.att)&&void 0!==a?a:0-E.e.off),e.drawImage(n.canvas,i,o,c,s,i,o,c,s)})),e.restore()}function ie(e,t,n){null===t||void 0===t||t.forEach((function(t){var a=t.last.progress,r=t.bbox,i=r.x,o=r.y,s=r.w,l=r.h,d=t.type===K.EMPTY_PLAYER||t.type===K.STAR?30:20;e.drawImage(n.canvas,i,o,s,l,i,o,s,l),function(e,t){var n=t.x,a=t.y,r=t.r,i=t.h,o=t.r1,s=void 0===o?0:o,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e.save(),te(e,l);for(var d=.1,u=[],f=[],v=[],h=0,p=0;h<=2*Math.PI+d;++p){var b=r*Math.cos(h),m=r*Math.sin(h);u[p]=[b,0,m],h+=d,b=s*Math.cos(h),m=s*Math.sin(h),f[p]=[b,-(1-s/r)*i,m]}for(var O=0,g=0;g<u.length-1;g++){var j=[f[O],u[O],u[O+1],f[O+1]];v[g]=j,O+=1}function y(e){for(var t=Math.sin(-e),n=Math.cos(-e),a=0;a<u.length;a++){var r=u[a],i=r[1],o=r[2];r[1]=i*n-o*t,r[2]=o*n+i*t,i=(r=f[a])[1],o=r[2],r[1]=i*n-o*t,r[2]=o*n+i*t}}y(20*Math.PI/180),e.translate(n,a);for(var x=0;x<v.length;x++){var _=Object(c.a)(v[x],4),S=_[0],k=_[1],E=_[2],A=_[3];e.beginPath(),e.moveTo(S[0],S[1]),e.lineTo(k[0],k[1]),e.lineTo(E[0],E[1]),e.lineTo(A[0],A[1]),e.lineTo(S[0],S[1]),e.fill(),e.closePath()}e.restore()}(e,{x:i+.5*s,y:o+l,r:a/6*50,r1:d*(a/6),h:t.type===K.EMPTY_PLAYER||t.type===K.STAR?800:1e3},{lineWidth:1,strokeStyle:"rgba(220, 220, 220, 0.05)",fillStyle:t.type===K.EMPTY_PLAYER?"rgba(50, 220, 128, 0.1)":t.type===K.STAR?"rgba(255,215,120, 0.08)":"rgba(220, 220, 220, 0.1)",lineCap:"round",lineJoin:"round"})}))}var oe=document.createElement("canvas"),ce=oe.getContext("2d");function se(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],o=arguments.length>6?arguments[6]:void 0,c=arguments.length>7?arguments[7]:void 0,s=arguments.length>8?arguments[8]:void 0,l=e.canvas,d=l.width,u=l.height;if(oe.width=d,oe.height=u,ce.save(),ce.drawImage(n,0,0),ce.globalCompositeOperation="source-in",ce.drawImage(t,0,0),ce.restore(),e.drawImage(oe,0,0),s){var f=s.pos;e.save();var v=e.createRadialGradient(f.x,f.y,E.c.min,f.x,f.y,E.c.max);v.addColorStop(0,"rgba(0, 0, 0, ".concat(E.c.mina,")")),v.addColorStop(1,"rgba(0, 0, 0, ".concat(E.c.maxa,")")),e.fillStyle=v,e.globalCompositeOperation="source-atop",e.fillRect(0,0,d,u),e.restore();var h=a.filter((function(e){return!i.find((function(t){return t.id===e.id}))&&!r.find((function(t){return t.id===e.id}))}));e.save(),h.forEach((function(t){var n=t.bbox,a=n.x,r=n.y,i=n.w,o=n.h;e.drawImage(ce.canvas,a,r,i,o,a,r,i,o)})),e.restore()}var p=i.filter((function(e){var t;return e.id!==c&&e.type.has(X.Interest)&&e.looked&&(null!==(t=e.att)&&void 0!==t?t:0)>E.e.off})),b=i.filter((function(e){return!p.find((function(t){return t.id===e.id}))}));b.forEach((function(t){var n=t.bbox,a=n.x,r=n.y,i=n.w,o=n.h;e.drawImage(ce.canvas,a,r,i,o,a,r,i,o)})),re(e,p,ce),o.vis_key_player&&ie(e,r,ce)}var le=new Image;le.src="".concat("/iBall","/shooter.png");var de=new Image;de.src="".concat("/iBall","/defender.png");var ue=new Image;ue.src="".concat("/iBall","/star.png");var fe={shooter:le,defender:de,star:ue};function ve(e,t,n,a){if("star"===a)ve(e,t,[n[0]-t,n[1]],"shooter"),ve(e,t,n,"defender");else{var r=t*fe[a].width/fe[a].height;oe.width=r,oe.height=t,ce.save(),ce.drawImage(fe[a],0,0,fe[a].width,fe[a].height,0,0,r,t),ce.globalCompositeOperation="source-in",ce.fillStyle=E.a.star_star,ce.fillRect(0,0,r,t),ce.restore(),e.drawImage(oe,n[0]-.5*r,n[1]-.5*t)}}function he(e,t){if(t){var n=t.id,a=t.namePos,r=E.h[n].ln;e.save(),e.fillStyle=E.h[n].star?E.a.star_name:E.a.player_name,e.font="bold ".concat(18,"px Arial"),e.textAlign="center";var i=e.measureText(r).width,o="star"===E.h[n].star?a.x+9:a.x;if(e.fillText(r,o,a.y),e.restore(),E.h[n].star){ve(e,18,[o-.5*(i+(Math.floor(9)-1))-5,a.y-9+2],E.h[n].star)}}}var pe=n(53),be=n(52),me=n(96),Oe=n(49),ge=n(86),je=n(89),ye=n(90),xe=n(28);var _e=function(e){return function(e){var t;return null===(t=e.match(/\((\w+)\)/))||void 0===t?void 0:t[1]}(e.AREA)+"_"+e.RANGE},Se=function(e){return e&&(e.endsWith("24+ ft.")||e.endsWith("Back Court Shot"))?3:2},ke=Object(pe.a)().x((function(e){return e.LOC_X})).y((function(e){return e.LOC_Y})).radius(7);[{GRID_TYPE:"League Averages",SHOT_ZONE_BASIC:"Above the Break 3",SHOT_ZONE_AREA:"Back Court(BC)",SHOT_ZONE_RANGE:"Back Court Shot",FGA:59,FGM:4,FG_PCT:.068},{GRID_TYPE:"League Averages",SHOT_ZONE_BASIC:"Above the Break 3",SHOT_ZONE_AREA:"Center(C)",SHOT_ZONE_RANGE:"24+ ft.",FGA:10885,FGM:3746,FG_PCT:.344},{GRID_TYPE:"League Averages",SHOT_ZONE_BASIC:"Above the Break 3",SHOT_ZONE_AREA:"Left Side Center(LC)",SHOT_ZONE_RANGE:"24+ ft.",FGA:16648,FGM:5802,FG_PCT:.349},{GRID_TYPE:"League Averages",SHOT_ZONE_BASIC:"Above the Break 3",SHOT_ZONE_AREA:"Right Side Center(RC)",SHOT_ZONE_RANGE:"24+ ft.",FGA:15837,FGM:5597,FG_PCT:.353},{GRID_TYPE:"League Averages",SHOT_ZONE_BASIC:"Backcourt",SHOT_ZONE_AREA:"Back Court(BC)",SHOT_ZONE_RANGE:"Back Court Shot",FGA:440,FGM:17,FG_PCT:.039},{GRID_TYPE:"League Averages",SHOT_ZONE_BASIC:"In The Paint (Non-RA)",SHOT_ZONE_AREA:"Center(C)",SHOT_ZONE_RANGE:"Less Than 8 ft.",FGA:19352,FGM:7561,FG_PCT:.391},{GRID_TYPE:"League Averages",SHOT_ZONE_BASIC:"In The Paint (Non-RA)",SHOT_ZONE_AREA:"Center(C)",SHOT_ZONE_RANGE:"8-16 ft.",FGA:6851,FGM:2889,FG_PCT:.422},{GRID_TYPE:"League Averages",SHOT_ZONE_BASIC:"In The Paint (Non-RA)",SHOT_ZONE_AREA:"Left Side(L)",SHOT_ZONE_RANGE:"8-16 ft.",FGA:2089,FGM:842,FG_PCT:.403},{GRID_TYPE:"League Averages",SHOT_ZONE_BASIC:"In The Paint (Non-RA)",SHOT_ZONE_AREA:"Right Side(R)",SHOT_ZONE_RANGE:"8-16 ft.",FGA:1932,FGM:799,FG_PCT:.414},{GRID_TYPE:"League Averages",SHOT_ZONE_BASIC:"Left Corner 3",SHOT_ZONE_AREA:"Left Side(L)",SHOT_ZONE_RANGE:"24+ ft.",FGA:7864,FGM:2939,FG_PCT:.374},{GRID_TYPE:"League Averages",SHOT_ZONE_BASIC:"Mid-Range",SHOT_ZONE_AREA:"Center(C)",SHOT_ZONE_RANGE:"16-24 ft.",FGA:7324,FGM:2897,FG_PCT:.396},{GRID_TYPE:"League Averages",SHOT_ZONE_BASIC:"Mid-Range",SHOT_ZONE_AREA:"Center(C)",SHOT_ZONE_RANGE:"8-16 ft.",FGA:2265,FGM:987,FG_PCT:.436},{GRID_TYPE:"League Averages",SHOT_ZONE_BASIC:"Mid-Range",SHOT_ZONE_AREA:"Left Side Center(LC)",SHOT_ZONE_RANGE:"16-24 ft.",FGA:7754,FGM:3066,FG_PCT:.395},{GRID_TYPE:"League Averages",SHOT_ZONE_BASIC:"Mid-Range",SHOT_ZONE_AREA:"Left Side(L)",SHOT_ZONE_RANGE:"8-16 ft.",FGA:7639,FGM:3005,FG_PCT:.393},{GRID_TYPE:"League Averages",SHOT_ZONE_BASIC:"Mid-Range",SHOT_ZONE_AREA:"Left Side(L)",SHOT_ZONE_RANGE:"16-24 ft.",FGA:5452,FGM:2173,FG_PCT:.399},{GRID_TYPE:"League Averages",SHOT_ZONE_BASIC:"Mid-Range",SHOT_ZONE_AREA:"Right Side Center(RC)",SHOT_ZONE_RANGE:"16-24 ft.",FGA:8145,FGM:3249,FG_PCT:.399},{GRID_TYPE:"League Averages",SHOT_ZONE_BASIC:"Mid-Range",SHOT_ZONE_AREA:"Right Side(R)",SHOT_ZONE_RANGE:"8-16 ft.",FGA:7630,FGM:3011,FG_PCT:.395},{GRID_TYPE:"League Averages",SHOT_ZONE_BASIC:"Mid-Range",SHOT_ZONE_AREA:"Right Side(R)",SHOT_ZONE_RANGE:"16-24 ft.",FGA:4924,FGM:1996,FG_PCT:.405},{GRID_TYPE:"League Averages",SHOT_ZONE_BASIC:"Restricted Area",SHOT_ZONE_AREA:"Center(C)",SHOT_ZONE_RANGE:"Less Than 8 ft.",FGA:67443,FGM:40634,FG_PCT:.602},{GRID_TYPE:"League Averages",SHOT_ZONE_BASIC:"Right Corner 3",SHOT_ZONE_AREA:"Right Side(R)",SHOT_ZONE_RANGE:"24+ ft.",FGA:7360,FGM:2803,FG_PCT:.381}].reduce((function(e,t){var n=_e({AREA:t.SHOT_ZONE_AREA,BASIC:t.SHOT_ZONE_BASIC,RANGE:t.SHOT_ZONE_RANGE});return e[n]={FGA:t.FGA,FGM:t.FGM,rate:t.FG_PCT,exp:Se(n)*t.FG_PCT},e}),{});function Ee(){var e=document.getElementById("canvasWrapper");if(!e)return{x:0,y:0};var t=null===e||void 0===e?void 0:e.getBoundingClientRect(),n=t.x,a=t.y,r=t.width,i=t.height;return{x:n,y:a+window.outerHeight/50,wScale:1280/r,hScale:720/i}}var Ae={regionScale:Object(be.a)(ge.a),twoPTColor:Object(me.a)(je.a).domain([.2,.8]),twoPT:Object(me.a)().domain([0,.4]).range([0,1]),threePTColor:Object(me.a)(je.a).domain([.2,.8]),threePT:Object(me.a)().domain([0,.27]).range([0,1]),radiusScale:Object(Oe.b)().domain([0,1]).range([1,7]),regionExp:Object(me.a)(ye.a).domain([.1,"game1"===xe.a.GAME_ID?2:2.5])},we=n(1),Ie=["0_bg","1_vis","2_fg","3_annot","4_debug"],Te=function(e){Object(m.a)(n,e);var t=Object(O.a)(n);function n(){var e;Object(h.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).layers=Ie.reduce((function(e,t){return e[t]=null,e}),{}),e.isOnLv2Player=function(e,t){return e.id in t&&(t[e.id].type.has(X.Interest)&&t[e.id].on||t[e.id].type.has(X.Normal))},e}return Object(p.a)(n,[{key:"get2DPos",value:function(e,t){var n=null===t||void 0===t?void 0:t.find((function(t){return t.id===e})),a=n.bbox,r=n.keypoints,i=E.h[e].team,o=a.y,c=a.h,s=r.left_hip,l=r.right_hip,d=r.left_ankle,u=r.right_ankle;return{cx:(s.x+l.x)/2,cy:(o+c+Math.max(d.y,u.y))/2,team:i}}},{key:"componentDidUpdate",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n,a,r,i,o,c,s,l,u,v,h,p,b,m,O,g,j,y,x,_=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.currentFrameIdx===this.props.currentFrameIdx){e.next=24;break}if(o=this.props,c=o.currentFrameIdx,s=o.currentFrame,l=o.features,u=o.playerFlags,s){e.next=4;break}return e.abrupt("return");case 4:if(this.cleanAllExcept("0_bg"),q(this.layers["0_bg"],s),Q(this.layers["1_vis"],.18),v=null===(n=Et.frames)||void 0===n?void 0:n[c]){e.next=10;break}return e.abrupt("return");case 10:if(h=v.players,p=v.ball,h){e.next=13;break}return e.abrupt("return");case 13:if(b=l.gaze_filter?Et.fetchFocus():void 0,m=Et.pickPlayers(c,l,u,b),O=m.lv1Players,g=m.lv2Players,O||g){e.next=17;break}return e.abrupt("return");case 17:j=h.filter((function(e){return _.isOnLv2Player(e,g)})),y=j.filter((function(e){var t;return(null===(t=e.dataPkg)||void 0===t?void 0:t.mode)===J.offensive&&l.vis_off_ring})).map((function(e){var t=e.dataPkg,n=e.id,a=t,r=a.smoothRegionExp,i=a.inOffsensiveCourt,o=_.get2DPos(n,h);return{cx:o.cx,cy:o.cy,fill:Ae.regionExp(r),size:Math.min(1,r/2),inOffsensiveCourt:i}})),x=j.filter((function(e){var t;return(null===(t=e.dataPkg)||void 0===t?void 0:t.mode)===J.defensive&&l.vis_def_sheild})).map((function(e){var t=e.dataPkg,n=e.id,a=t,r=a.diff,i=a.speed,o=a.tangle,c=a.tdist,s=a.defendingPlayer,l=a.smoothDFdiff,d=_.get2DPos(n,h),u=d.cx,f=d.cy,v=_.get2DPos(s,h);return{cx:u,cy:f,dx:v.cx,dy:v.cy,diff:r,tangle:o,tdist:c,smoothDFdiff:l,speed:i}})),ae(this.layers["1_vis"].ctx,y,x,null===(a=this.layers["4_debug"])||void 0===a||a.ctx),se(null===(r=this.layers["3_annot"])||void 0===r?void 0:r.ctx,this.layers["0_bg"].canvas,v.mask,h,null===h||void 0===h?void 0:h.filter((function(e){return e.id in O})).map((function(e){return Object(d.a)(Object(d.a)({},e),O[e.id])})),h.filter((function(e){return e.id in g})).map((function(e){return Object(d.a)(Object(d.a)({},e),g[e.id])})),l,null===p||void 0===p?void 0:p.playerId,b),he(null===(i=this.layers["3_annot"])||void 0===i?void 0:i.ctx,h.find((function(e){return e.id===(null===p||void 0===p?void 0:p.playerId)}))),Object.values(g).filter((function(e){return e.type.has(X.Interest)&&e.on})).forEach((function(e){var t;he(null===(t=_.layers["3_annot"])||void 0===t?void 0:t.ctx,h.find((function(t){return t.id===e.id})))}));case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props.currentVideo,n=null!==t&&void 0!==t?t:{},a=n.width,r=void 0===a?0:a,i=n.height,o=void 0===i?0:i;return Object(we.jsx)("div",{className:"visualizationContainer",style:{marginLeft:"20px"},children:Object(we.jsxs)("div",{id:"canvasWrapper",className:"canvasWrapper",children:[Object(we.jsx)("img",{alt:"www",src:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",style:{height:"".concat(r/o*100,"%")}}),Ie.map((function(t,n){return Object(we.jsx)("canvas",{id:t,width:r,height:o,ref:function(n){n&&(e.layers[t]={canvas:n,ctx:n.getContext("2d")})}},n)})),this.props.children]})})}},{key:"cleanAllExcept",value:function(e){var t=this;Object.keys(this.layers).filter((function(t){return t!==e})).forEach((function(e){var n=t.layers[e];null===n||void 0===n||n.ctx.clearRect(0,0,n.canvas.width,n.canvas.height)}))}}]),n}(r.a.Component),Ce=n(97),Pe=n(98),Me=n(27),Le=n(92),Fe=n(94),Ne=n(91);function Re(e){var t=e.scale,n=e.transform,r=Object(a.useRef)(null);return Object(a.useEffect)((function(){r.current&&Object(Le.a)(r.current).call(Object(Ce.a)(t))}),[t]),Object(we.jsx)("g",{ref:r,transform:n})}function Ge(e){var t=e.scale,n=Object(a.useRef)(null);return Object(a.useEffect)((function(){n.current&&Object(Le.a)(n.current).call(Object(Ce.b)(t))}),[t]),Object(we.jsx)("g",{ref:n})}function Be(e){var t=e.fixY,n=void 0!==t&&t,a=e.maxY,r=void 0===a?1:a,i=e.data,o=void 0===i?[]:i,c=e.width,l=void 0===c?400:c,d=e.height,u=10,f=10,v=20,h=50,p=l-h-f,b=(void 0===d?200:d)-u-v,m=Object(Pe.a)().domain(new Set(o.map((function(e){return e.id})))).range([0,p]),O=Object(Me.a)().domain([0,n?r:Math.max.apply(Math,Object(s.a)(o.map((function(e){return e.value}))))]).range([b,0]);return Object(we.jsx)("svg",{width:p+h+f,height:b+u+v,children:Object(we.jsxs)("g",{transform:"translate(".concat(h,", ").concat(u,")"),children:[Object(we.jsx)(Re,{scale:m,transform:"translate(0, ".concat(b,")")}),Object(we.jsx)(Ge,{scale:O}),o.map((function(e,t){var n=e.id,a=e.value,r=e.fill;return Object(we.jsx)("rect",{x:m(n),y:O(a),width:m.bandwidth(),height:b-O(a),fill:r},"".concat(n,"_").concat(t))}))]})})}function He(e){var t,n=e.data,a=e.width,r=void 0===a?400:a,i=e.height,o=10,s=10,l=20,d=50,u=r-d-s,f=(void 0===i?200:i)-o-l,v=T(n.map((function(e){return e.fIdx}))),h=Object(c.a)(v,2),p=h[0],b=h[1],m=Object.entries(n.reduce((function(e,t){return t.videoIdx in e||(e[t.videoIdx]=[]),e[t.videoIdx].push(t.fIdx),e}),{})).sort((function(e,t){return+e[0]-+t[0]})).map((function(e){var t=Object(c.a)(e,2),n=(t[0],t[1]),a=T(n),r=Object(c.a)(a,2),i=r[0];return{x:i,w:r[1]-i}})),O=Object.values(n.reduce((function(e,t){var n="".concat(t.fIdx,"_").concat(t.value);return n in e||(e[n]=t),e}),{})),g=Object(Me.a)().domain([p,b]).range([0,u]),j=Object(Me.a)().domain([0,.6]).range([f,0]),y=Object(Fe.a)().x((function(e){return g(e.fIdx)})).y((function(e){return j(e.value)})).curve(Ne.a);return Object(we.jsx)("svg",{width:u+d+s,height:f+o+l,children:Object(we.jsxs)("g",{transform:"translate(".concat(d,", ").concat(o,")"),children:[Object(we.jsx)(Re,{scale:g,transform:"translate(0, ".concat(f,")")}),Object(we.jsx)(Ge,{scale:j}),m.map((function(e,t){var n=e.x,a=e.w;return Object(we.jsx)("rect",{x:g(n),y:j(.6),width:g(a),height:f-j(.6),fill:"rgba(30, 30, 30, 0.1)"},"".concat(t))})),Object(we.jsx)("path",{stroke:"black",strokeWidth:2,fill:"none",d:null!==(t=y(O))&&void 0!==t?t:""})]})})}n(77);var De=E.j[0]/94,We=Object(a.memo)((function(e){var t=e.isIn,n=e.d;return Object(we.jsx)("path",{className:"court_bin",fill:Ae.regionExp(n.regionExp),strokeWidth:t?2:0,d:"M".concat(n.x,",").concat(n.y).concat(ke.hexagon())})})),Ze=Object(a.memo)((function(e){var t=e.playerBins,n=e.currentBin;return Object(we.jsx)("svg",{width:E.j[0],height:"".concat(50*De,"px"),style:{position:"absolute",overflow:"visible"},children:Object(we.jsx)("g",{transform:"scale(".concat(E.j[0]/940,")"),children:null===t||void 0===t?void 0:t.map((function(e){var t=e.x===(null===n||void 0===n?void 0:n.x)&&e.y===(null===n||void 0===n?void 0:n.y);return Object(we.jsx)(We,{d:e,isIn:t},"".concat(e.x,"_").concat(e.y))}))})})})),Ve=Object(a.memo)((function(e){var t=e.currentFrameData;if(!t)return Object(we.jsx)(we.Fragment,{});var n=t.players,a=t.ball,r=null===n||void 0===n?void 0:n.filter((function(e){var t=e.tracking;return void 0!==t.x&&void 0!==t.y})).map((function(e,t){var n,r=e.tracking,i=e.id,o=r.x,c=r.y,s=E.h[i].team;return Object(we.jsx)("div",{className:"marker",style:{top:c*De,left:o*De,backgroundColor:["GSW","LAC"].includes(s)?"steelblue":"#ff6347",color:(null===a||void 0===a?void 0:a.playerId)===i?"red":"#000",fontSize:(null===a||void 0===a?void 0:a.playerId)===i?"15px":"12px"},children:null===(n=E.h[i])||void 0===n?void 0:n.ln},i)}));a&&(null===r||void 0===r||r.push(Object(we.jsx)("div",{className:"marker",style:{top:a.tracking.y*De,left:a.tracking.x*De,backgroundColor:"orange"}},"ball")));var i=null===a||void 0===a?void 0:a.playerId,o=null===n||void 0===n?void 0:n.find((function(e){return e.id===i})),c=Et.getCurrentBin(o),s=Et.getPlayerBins(null===o||void 0===o?void 0:o.id);return Object(we.jsxs)("div",{className:"court",children:[i&&Object(we.jsx)(Ze,{currentBin:c,playerBins:s}),r,Object(we.jsx)("img",{className:"court-img",style:{width:E.j[0]},src:"".concat("/iBall","/court.png")})]})}));Ve.displayName="Court";var ze=n(54),Ue=(n(78),n(39)),Ye=function(e){Object(m.a)(n,e);var t=Object(O.a)(n);function n(){var e;Object(h.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={isMoving:null,isAdjusting:null,cursorStatus:null},e.onResizeStart=function(t,n){if(0===t.button){t.stopPropagation();var a=e.props,r=a.x,i=a.w,o=t.clientX;e.setState({isAdjusting:{direction:n,oBBox:{x:r,w:i},ox:o},cursorStatus:"resizable"}),document.body.classList.add("adjusting",n)}},e.onResizing=function(t){var n,a,r=e.state.isAdjusting;if(null!==r&&0===t.button){t.preventDefault(),t.stopImmediatePropagation();var i=e.props,o=i.x,c=i.w,s=i.id,l=r.direction,d=r.oBBox,u=r.ox,f=t.clientX-u,v=e.props.getEW(s),h=v.wx,p=v.ex;switch(l){case"w":o=Math.min(d.x+d.w,d.x+f),o=Math.max(h,o),c=Math.min(d.x+d.w-h,d.w-f),c=Math.max(0,c);break;case"e":c=Math.max(0,d.w+f),c=Math.min(p-o,c)}null===(n=(a=e.props).onAdjusting)||void 0===n||n.call(a,e.props.id,{x:o,w:c})}},e.onResizeEnd=function(t){var n,a;if(null!==e.state.isAdjusting&&0===t.button){t.preventDefault(),t.stopImmediatePropagation();var r=e.props,i=r.x,o=r.w,c=r.id;null===(n=(a=e.props).onAdjustingEnd)||void 0===n||n.call(a,c,{x:i,w:o},!0),e.setState({isAdjusting:null}),document.body.classList.remove("adjusting","w","e","s","n")}},e.onMoveStart=function(t){if(0===t.button){t.stopPropagation(),t.preventDefault();var n=e.props.x,a=t.clientX;e.setState({isMoving:{ox:a-n},cursorStatus:"movable"})}},e.onMoving=function(t){var n,a,r=e.state.isMoving;if(null!==r){t.preventDefault(),t.stopImmediatePropagation();var i=t.clientX,o=e.props,c=o.w,s=o.id,l=e.props.getEW(s),d=l.wx,u=l.ex,f=Math.max(d,i-r.ox);f=Math.min(f,u-c),null===(n=(a=e.props).onMoving)||void 0===n||n.call(a,e.props.id,{x:f,w:c})}},e.onMoveEnd=function(t){null!==e.state.isMoving&&0===t.button&&(t.preventDefault(),t.stopImmediatePropagation(),e.setState({isMoving:null}))},e}return Object(p.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("mousemove",this.onMoving),window.addEventListener("mouseup",this.onMoveEnd),window.addEventListener("mousemove",this.onResizing),window.addEventListener("mouseup",this.onResizeEnd)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("mousemove",this.onMoving),window.removeEventListener("mouseup",this.onMoveEnd),window.removeEventListener("mousemove",this.onResizing),window.removeEventListener("mouseup",this.onResizeEnd)}},{key:"render",value:function(){var e=this,t=this.props,n=t.x,a=t.w,r=t.focused,i=(t.initializing,t.style),o=void 0===i?{}:i,c=this.state,s=c.isAdjusting,l=c.isMoving,u=c.cursorStatus;return Object(we.jsx)("div",{className:Object(Ue.a)("interval-container",{focused:r}),style:{left:n},children:Object(we.jsx)("div",{className:Object(Ue.a)("interval",u),style:Object(d.a)({width:a},o),onMouseDown:function(t){var n=t.currentTarget.parentElement.getBoundingClientRect(),r=t.clientX-n.x;Math.abs(r)<3?e.onResizeStart(t,"w"):Math.abs(r-a)<3?e.onResizeStart(t,"e"):e.onMoveStart(t)},onMouseMove:function(t){if(!s&&!l){var n=e.props.w,a=t.currentTarget.parentElement.getBoundingClientRect(),r=t.clientX-a.x;Math.abs(r)<3||Math.abs(r-n)<3?e.setState({cursorStatus:"resizable"}):e.setState({cursorStatus:"movable"})}},onClick:function(t){return e.props.onClickInterval(e.props.id)}})})}}]),n}(r.a.Component);function Je(e){return("0"+e).slice(-2)}function Ke(e){var t=Math.floor(1e3*e);e=Math.floor(t/1e3);var n=Math.floor(e/60);return e%=60,"".concat(Je(n%=60),":").concat(Je(e))}var Xe=Object(j.a)("pointer"),qe=function(e){Object(m.a)(n,e);var t=Object(O.a)(n);function n(){var e;Object(h.a)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),Object.defineProperty(Object(b.a)(e),Xe,{writable:!0,value:r.a.createRef()}),e.imgWidth=1920*e.intervalSelectorHeight/1080,e.parentOffsetx=0,e.state={isDrawing:null},e.canvas=void 0,e.ctx=void 0,e.onDrawStart=function(t){if(0===t.button){var n=t.currentTarget.parentElement.getBoundingClientRect();e.parentOffsetx=-n.x+t.currentTarget.scrollLeft;var a=t.clientX,r=a+e.parentOffsetx;if(!(t.clientY>=n.bottom-8))if(e.props.enableClips){var i=e.props.clips;if(i.find((function(t){return e.frame2pos(t.interval.start)<=r&&r<=e.frame2pos(t.interval.end)}))){var o,c,s=e.pos2frame(r);null===(o=(c=e.props).onClickInterval)||void 0===o||o.call(c,-1,s)}else{for(var l,d,u=H(),f=0;f<i.length&&!(e.frame2pos(i[f].interval.start)>r);f++);var v={start:e.pos2frame(r),end:e.pos2frame(r+0)};null===(l=(d=e.props).onUpsertClip)||void 0===l||l.call(d,u,v),e.setState({isDrawing:{intervalId:u,omx:a,ox:r}})}}else{var h,p,b=e.pos2frame(r);null===(h=(p=e.props).onClickInterval)||void 0===h||h.call(p,-1,b)}}},e.onDrawing=function(t){var n,a,r=e.state.isDrawing;if(0===t.button&&null!==r&&e.props.enableClips){var i=e.props.clips,o=t.clientX,c=i.find((function(e){return e.id===r.intervalId}));if(c){var s=o-r.omx,l=e.getEW(c.id),d=l.wx,u=l.ex-r.ox,f=d-r.ox;s<f?s=f:s>u&&(s=u);var v=s>0?c.interval.start:e.pos2frame(Math.max(r.ox+s,0)),h=Math.abs(s),p=v+e.pos2frame(h);null===(n=(a=e.props).onUpsertClip)||void 0===n||n.call(a,c.id,{start:v,end:p})}}},e.onDrawEnd=function(t){var n,a,r=e.state.isDrawing;if(0===t.button&&null!==r&&e.props.enableClips){var i=e.props.clips,o=i.findIndex((function(e){return e.id===r.intervalId}));if(-1!==o){var c=i[o];e.setState({isDrawing:null});var s,l,d=c.interval,u=d.start;if(d.end-u<=2)null===(s=(l=e.props).onUpsertClip)||void 0===s||s.call(l,c.id,null);null===(n=(a=e.props).onClickInterval)||void 0===n||n.call(a,c.id,u)}}},e.updateInterval=function(t,n){var a,r,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.props.enableClips){var o=e.props.clips,c=o.findIndex((function(e){return e.id===t})),s=o[c].interval,l=n.x?e.pos2frame(n.x):s.start,d=n.w?e.pos2frame(n.w)+l:s.end;null===(a=(r=e.props).onUpsertClip)||void 0===a||a.call(r,t,d-l<=2&&i?null:{start:l,end:d})}},e.getEW=function(t){if(e.props.enableClips){var n=e.props.clips,a=Object(b.a)(e).numberOfImg,r=n.findIndex((function(e){return e.id===t}));return{wx:0===r?e.parentOffsetx:e.frame2pos(n[r-1].interval.end)+1,ex:r===n.length-1?1920*e.intervalSelectorHeight/1080*a+e.parentOffsetx:e.frame2pos(n[r+1].interval.start)-1}}},e.pos2frame=function(t){var n=Object(b.a)(e),a=n.totalTrackWidth,r=n.globalMaxFrames;return Math.round(Math.min(t,a)/a*r)},e.frame2pos=function(t){var n=Object(b.a)(e),a=n.totalTrackWidth;return t/n.globalMaxFrames*a},e}return Object(p.a)(n,[{key:"globalMaxFrames",get:function(){return this.props.videos.reduce((function(e,t){return e+t.maxFrame}),-1)}},{key:"trackWidthFactor",get:function(){return this.globalMaxFrames<500?4:1}},{key:"totalTrackWidth",get:function(){return this.globalMaxFrames*this.trackWidthFactor}},{key:"globalCurFrameIdx",get:function(){var e=this.props,t=e.currentFrameIdx;return V(e.currentVideoIdx,t,e.videos)}},{key:"maxTime",get:function(){return this.props.videos.reduce((function(e,t){return e+t.maxFrame/t.frameRate}),0)}},{key:"numberOfImg",get:function(){return 2*Math.ceil(this.maxTime)}},{key:"intervalSelectorHeight",get:function(){var e=this.props.mode,t=void 0===e?"M":e;return"M"===t?60:"S"===t?30:90}},{key:"containerHeight",get:function(){var e=this.props.containerHeightPadding,t=void 0===e?60:e;return this.intervalSelectorHeight+t}},{key:"componentDidMount",value:function(){this.props.enableClips&&(window.addEventListener("mousemove",this.onDrawing),window.addEventListener("mouseup",this.onDrawEnd))}},{key:"componentDidUpdate",value:function(e){if(e.currentFrameIdx!==this.props.currentFrameIdx&&Object(g.a)(this,Xe)[Xe].current){var t,n=Object(g.a)(this,Xe)[Xe].current.getBoundingClientRect();if(n.left>(window.innerWidth||document.documentElement.clientWidth)||n.right<0)console.log(n,window.innerWidth,document.documentElement.clientWidth),null===(t=Object(g.a)(this,Xe)[Xe].current.parentElement)||void 0===t||t.scrollTo({behavior:"smooth",left:n.left+400})}}},{key:"componentWillUnmount",value:function(){window.removeEventListener("mousemove",this.onDrawing),window.removeEventListener("mouseup",this.onDrawEnd)}},{key:"renderClips",value:function(){var e=this;if(this.props.enableClips){var t=this.props,n=t.clips,a=t.focusedClipId,r=this.state.isDrawing;return n.map((function(t,n){var i=t.id,o=t.interval;return Object(we.jsx)(Ye,Object(d.a)({id:i,x:e.frame2pos(o.start),w:e.frame2pos(o.end-o.start),style:{height:"".concat(e.intervalSelectorHeight+10,"px")},focused:a===i,onMoving:e.updateInterval,onAdjusting:e.updateInterval,onAdjustingEnd:e.updateInterval,getEW:e.getEW,initializing:(null===r||void 0===r?void 0:r.intervalId)===i,onClickInterval:function(t){var n,a;null===(n=(a=e.props).onClickInterval)||void 0===n||n.call(a,i,o.start)}},o),i)}))}}},{key:"render",value:function(){var e,t,n=this,a=this.props,r=a.currentFrameIdx,i=a.videos,o=this.maxTime,c=this.globalMaxFrames,s=this.intervalSelectorHeight,l=this.globalCurFrameIdx,d=this.containerHeight,u=r/(null!==(e=null===(t=i[0])||void 0===t?void 0:t.frameRate)&&void 0!==e?e:30);return Object(we.jsx)("div",{className:"timeline-container",style:{flex:"0 0 ".concat(d,"px")},children:Object(we.jsxs)("div",{className:"timeline",onMouseDown:this.onDrawStart,children:[Object(we.jsx)("div",{className:"time-info",children:Object(we.jsxs)("span",{children:[" ",Ke(u)," (",r,") / ",Ke(o)," (",c,")"]})}),Object(we.jsx)("div",{className:"pointer",ref:Object(g.a)(this,Xe)[Xe],style:{left:"calc(12px + ".concat(this.frame2pos(l),"px)")}}),Object(we.jsxs)("div",{id:"timeline-progress",className:"track-container",children:[i.map((function(e){var t,a;return Object(we.jsxs)("div",{className:"track",style:{width:"".concat(e.maxFrame*n.trackWidthFactor,"px"),height:s,backgroundColor:e.isTransit?"#515151":"rgb(116 99 57)",opacity:!e.isTransit&&1!==e.loadedData||1!==e.loadedVideo?.5:1},children:[Object(we.jsx)("span",{className:"video-name",children:e.id}),null===(t=(a=n.props).children)||void 0===t?void 0:t.call(a,n.totalTrackWidth,n.globalMaxFrames)]},e.id)})),this.renderClips()]})]})})}}]),n}(r.a.Component);n(79);var Qe=function(e){Object(m.a)(n,e);var t=Object(O.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n,[{key:"render",value:function(){var e,t,n=this,a=this.props,r=a.currentVideo,i=a.currentFrameData,o=a.activeBBoxes,c=null!==r&&void 0!==r?r:{},s=c.height,l=void 0===s?0:s,d=c.width,u=void 0===d?0:d,f=null!==(e=null===i||void 0===i?void 0:i.players)&&void 0!==e?e:[],v=null!==(t=null===i||void 0===i?void 0:i.ball)&&void 0!==t?t:null;return Object(we.jsxs)("svg",{className:"overlay",height:l,width:u,viewBox:"0 0 ".concat(u," ").concat(l),preserveAspectRatio:"xMinYMin meet",onClick:function(e){var t,a;e.target===e.currentTarget&&(null===(t=(a=n.props).onClickBG)||void 0===t||t.call(a))},onContextMenu:this.props.onContextMenu,onDoubleClick:function(e){var t,a;e.target===e.currentTarget&&(null===(t=(a=n.props).onDBClick)||void 0===t||t.call(a))},children:[Object(we.jsx)("defs",{children:Object(we.jsxs)("filter",{x:"0",y:"0",width:"1",height:"1",id:"solid",children:[Object(we.jsx)("feFlood",{floodColor:"yellow",result:"bg"}),Object(we.jsxs)("feMerge",{children:[Object(we.jsx)("feMergeNode",{in:"bg"}),Object(we.jsx)("feMergeNode",{in:"SourceGraphic"})]})]})}),f.map((function(e,t){return Object(we.jsx)("rect",{className:"bbox ".concat((null===o||void 0===o?void 0:o.includes(e.id))?"active":""),x:e.bbox.x,y:e.bbox.y,width:e.bbox.w,height:e.bbox.h,onContextMenu:function(e){e.preventDefault(),e.stopPropagation()},onClick:function(a){var r,i;a.stopPropagation(),null===(r=(i=n.props).onClickPlayer)||void 0===r||r.call(i,e,t)}},t)})),v&&Object(we.jsx)("circle",{className:"ball ".concat((null===o||void 0===o?void 0:o.includes("ball"))?"active":""),cx:v.screenPos.x,cy:v.screenPos.y,r:5,onClick:function(e){var t,a;e.stopPropagation(),null===(t=(a=n.props).onClickBall)||void 0===t||t.call(a,v)}}),this.props.children]})}}]),n}(r.a.Component),$e=function(e){Object(m.a)(n,e);var t=Object(O.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n,[{key:"render",value:function(){var e,t=this.props,n=t.gaze,a=t.gazePlayers,r=t.bbox,i=void 0===r||r,o=t.currentFrameData,c=Object(ze.a)(t,["gaze","gazePlayers","bbox","currentFrameData"]),s=null!==o&&void 0!==o?o:{},l=s.teamWithBall,u=s.ball,f=s.players,v=(null!==(e=c.currentVideo)&&void 0!==e?e:{}).isTransit;return Object(we.jsxs)(Qe,Object(d.a)(Object(d.a)({},c),{},{children:[n&&Object(we.jsxs)("g",{transform:"translate(".concat(n.x,", ").concat(n.y,")"),children:[Object(we.jsx)("circle",{r:E.d,stroke:"red",fill:"rgba(255, 0, 0, 0.1)"}),Object(we.jsxs)("text",{textAnchor:"middle",fill:"#fff",alignmentBaseline:"middle",children:[n.x.toFixed(0),", ",n.y.toFixed(0),"fIdx: ",n.fIdx]})]}),!v&&Object(we.jsxs)("text",{x:10,y:20,fill:"#fff",children:["Team w/ ball: ",l]}),!v&&Object(we.jsxs)("text",{x:150,y:20,fill:"#fff",children:["Ballholder: ",(null===u||void 0===u?void 0:u.playerId)?E.h[u.playerId].ln:null]}),!v&&i&&(null===f||void 0===f?void 0:f.filter((function(e){return e.dataPkg})).map((function(e){var t=e.bbox,n=e.id,r=e.dataPkg;return Object(we.jsxs)("g",{className:"bbox ".concat((null===a||void 0===a?void 0:a.some((function(e){return e.id===n})))?"active":""),transform:"translate(".concat(t.x,", ").concat(t.y,")"),children:[Object(we.jsx)("rect",{width:t.w,height:t.h}),r&&Object(we.jsx)("text",{fill:"#fff",alignmentBaseline:"middle",children:"".concat(r.mode,", v: ").concat(((null===r||void 0===r?void 0:r.mode)===J.defensive?r.diff:r.regionExp).toFixed(1))})]},n)})))]}))}}]),n}(r.a.Component),et=n(20),tt=n(17);function nt(){return new Worker(n.p+"static/js/loadFrames.worker.204ea63a.js")}var at=Object(j.a)("Loading"),rt=Object(j.a)("getFrames"),it=Object(j.a)("pre_load_batch_size"),ot=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nt;Object(h.a)(this,e),this.worker=n,Object.defineProperty(this,at,{writable:!0,value:{}}),this.memVideoData={},this.onLoad=void 0,this.onUnload=void 0,Object.defineProperty(this,rt,{writable:!0,value:void 0}),Object.defineProperty(this,it,{writable:!0,value:50}),Object(g.a)(this,rt)[rt]=Y(n,"Frames",(function(e){if("Progress"===e[0]){var n,a=Object(c.a)(e,3),r=(a[0],a[1]),i=a[2];null===(n=t.onLoad)||void 0===n||n.call(t,r,i)}}))}return Object(p.a)(e,[{key:"isLoaded",value:function(e){return e.isTransit||e.id in this.memVideoData}},{key:"getVideoData",value:function(e){return this.memVideoData[e]}},{key:"fetch",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n,a,r,i,o,c,l,u,h,p=this,b=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=b.length>1&&void 0!==b[1]&&b[1],!Object(g.a)(this,at)[at][t.id]){e.next=5;break}return e.next=4,F((function(){return!Object(g.a)(p,at)[at][t.id]}));case 4:return e.abrupt("return");case 5:if(Object(g.a)(this,at)[at][t.id]=!0,console.debug("preload===>",t),this.isLoaded(t)){e.next=43;break}return e.next=10,Object(g.a)(this,rt)[rt](t);case 10:if(i=e.sent){e.next=14;break}return Object(g.a)(this,at)[at][t.id]=!1,e.abrupt("return");case 14:o=.6,null===(a=this.onLoad)||void 0===a||a.call(this,t.id,o),console.log("%cMain thread processing ".concat(t.id," to mem =====>"),"color:#f5f5f5;background: #00695c; padding: 2px; border-radius:2px"),c=[],console.debug("===>parsing blob to img..."),l=0;case 20:if(!(l<Object.keys(i).length)){e.next=37;break}return h=i.slice(l,l+Object(g.a)(this,it)[it]),e.t0=[],e.t1=Object(s.a)(c),e.t2=s.a,e.next=27,Promise.all(h.map(function(){var e=Object(v.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D(URL.createObjectURL(t.mask));case 2:return n=e.sent,e.abrupt("return",Object(d.a)(Object(d.a)({},t),{},{mask:n}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 27:if(e.t3=e.sent,e.t4=(0,e.t2)(e.t3),c=e.t0.concat.call(e.t0,e.t1,e.t4),null===(u=this.onLoad)||void 0===u||u.call(this,t.id,o+(.95-o)*l/Object.keys(i).length),!n){e.next=34;break}return e.next=34,M(30);case 34:l+=Object(g.a)(this,it)[it],e.next=20;break;case 37:c.sort((function(e,t){return e.idx-t.idx})),console.debug("<=====".concat(t.id," Done!"),c[0]),this.memVideoData[t.id]=C(c,"idx"),null===(r=this.onLoad)||void 0===r||r.call(this,t.id,1),A.DEBUG_MEM&&G(),console.log("%cMain thread done processing ".concat(t.id," to mem<======"),"color:#f5f5f5;background: #00695c; padding: 2px; border-radius:2px");case 43:Object(g.a)(this,at)[at][t.id]=!1;case 44:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"unloadFromMem",value:function(e){var t;void 0===e||e.isTransit||(delete this.memVideoData[e.id],null===(t=this.onUnload)||void 0===t||t.call(this,e.id),A.DEBUG_MEM&&G())}}]),e}();n(50).a;var ct=Object(j.a)("Loading"),st=function(){function e(){Object(h.a)(this,e),Object.defineProperty(this,ct,{writable:!0,value:{}}),this.onLoad=void 0,this.onUnload=void 0,this.memVideos={}}return Object(p.a)(e,[{key:"getVideo",value:function(e){return this.memVideos[e]}},{key:"isLoaded",value:function(e){return e.id in this.memVideos}},{key:"fetch",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n,a,r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(g.a)(this,ct)[ct][t.id]){e.next=4;break}return e.next=3,F((function(){return!Object(g.a)(r,ct)[ct][t.id]}));case 3:return e.abrupt("return");case 4:if(Object(g.a)(this,ct)[ct][t.id]=!0,this.isLoaded(t)){e.next=17;break}return console.debug("VideoLoader.preLoadToMem",t),(a=document.createElement("video")).src="".concat("/iBall","/assets/").concat(t.gameId,"/").concat(t.id,"/").concat(t.id,".mp4"),a.id=t.id,a.load(),e.next=13,new Promise((function(e){a.onloadeddata=e}));case 13:console.debug("VideoLoader.preLoadToMem ==> Done",t),this.memVideos[t.id]=a,null===(n=this.onLoad)||void 0===n||n.call(this,t.id),A.DEBUG_MEM&&G();case 17:Object(g.a)(this,ct)[ct][t.id]=!1;case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),lt=Object(j.a)("videoMeta"),dt=Object(j.a)("video"),ut=function(){function e(t,n){var a=this;Object(h.a)(this,e),this.name=t,this.videoPlayer=n,Object.defineProperty(this,lt,{writable:!0,value:void 0}),Object.defineProperty(this,dt,{writable:!0,value:void 0}),this.CallBackHandle=null,this.onPlay=null,this.onPause=null,this.invokeFrameHandlers=function(e,t){if(Object(g.a)(a,dt)[dt]===a.videoPlayer.currentTrack)for(var n=Math.round(t.mediaTime*Object(g.a)(a,lt)[lt].frameRate)-a.frameOffset,r=a.videoPlayer.currentTrack.id,i=0,o=a.videoPlayer.onFrameHandlers.length;i<o;++i)a.videoPlayer.onFrameHandlers[i].call(a,r,n,Date.now(),a.videoPlayer.currentTrack);var c;Object(g.a)(a,dt)[dt]&&(a.CallBackHandle=null===(c=Object(g.a)(a,dt)[dt])||void 0===c?void 0:c.requestVideoFrameCallback(a.invokeFrameHandlers))}}return Object(p.a)(e,[{key:"frameOffset",get:function(){var e;return 50===(null===(e=Object(g.a)(this,lt)[lt])||void 0===e?void 0:e.frameRate)?0:1}},{key:"video",get:function(){return Object(g.a)(this,dt)[dt]}},{key:"id",get:function(){var e;return null===(e=Object(g.a)(this,dt)[dt])||void 0===e?void 0:e.id}},{key:"setVideo",value:function(e,t){var n;Object(g.a)(this,dt)[dt]=t,null===(n=Object(g.a)(this,dt)[dt])||void 0===n||n.requestVideoFrameCallback(this.invokeFrameHandlers),Object(g.a)(this,lt)[lt]=e}},{key:"load",value:function(e,t){var n,a;this.onPlay=e,this.onPause=t,null===(n=Object(g.a)(this,dt)[dt])||void 0===n||n.addEventListener("play",e),null===(a=Object(g.a)(this,dt)[dt])||void 0===a||a.addEventListener("pause",t)}},{key:"unLoad",value:function(){var e,t,n,a;this.onPlay&&(null===(e=Object(g.a)(this,dt)[dt])||void 0===e||e.removeEventListener("play",this.onPlay)),this.onPause&&(null===(t=Object(g.a)(this,dt)[dt])||void 0===t||t.removeEventListener("pause",this.onPause)),null!==this.CallBackHandle&&(null===(n=Object(g.a)(this,dt)[dt])||void 0===n||n.cancelVideoFrameCallback(this.CallBackHandle)),null===(a=Object(g.a)(this,dt)[dt])||void 0===a||a.load(),Object(g.a)(this,dt)[dt]=void 0,Object(g.a)(this,lt)[lt]=void 0}},{key:"play",value:function(){var e;null===(e=Object(g.a)(this,dt)[dt])||void 0===e||e.play()}}]),e}(),ft=Object(j.a)("currentVideo"),vt=function(){function e(){var t=this;Object(h.a)(this,e),this._currentTrack=void 0,Object.defineProperty(this,ft,{writable:!0,value:null}),this.videoSources=new st,this.ATrack=new ut("A",this),this.BTrack=new ut("B",this),this.onFrameHandlers=[],this.onPlay=void 0,this.onPause=void 0,this.onLoad=void 0,this.onUnload=void 0,this.videos=[],this.whichOnPause=function(e){var n,a,r=e.target;r.id===(null===(n=t.currentTrack)||void 0===n?void 0:n.id)&&(null===(a=t.onPause)||void 0===a||a.call(t,r.id))},this.whichOnPlay=function(e){var n,a,r=e.target;r.id===(null===(n=t.currentTrack)||void 0===n?void 0:n.id)&&(null===(a=t.onPlay)||void 0===a||a.call(t,r.id))},this.addOnFrameListener(function(){var e=Object(v.a)(f.a.mark((function e(n,a,r,i){var o,c,s,l,d;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!==(s=t.videos.findIndex((function(e){return e.id===n})))){e.next=4;break}return console.warn("There must be something wrong since it cannot find the video from the videoList in the videoPlayer",n,t.videos),e.abrupt("return");case 4:if(a+5===(null===(o=t.currentVideo)||void 0===o?void 0:o.maxFrame)&&(l=s+1,void 0!==t.videos[l]&&t.preloadToAnotherTrack(t.videos[l],!0)),a+1!==(null===(c=t.currentVideo)||void 0===c?void 0:c.maxFrame)){e.next=12;break}if(d=s+1,void 0!==t.videos[d]){e.next=10;break}return t.pause(),e.abrupt("return");case 10:return e.next=12,t.loadVideo(t.videos[d],!0);case 12:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}()),this.videoSources.onLoad=function(e){var n;null===(n=t.onLoad)||void 0===n||n.call(t,e,"Video")},this.videoSources.onUnload=function(e){var n;null===(n=t.onUnload)||void 0===n||n.call(t,e,"Video")}}return Object(p.a)(e,[{key:"currentTrack",get:function(){return this._currentTrack}},{key:"currentVideo",get:function(){return Object(g.a)(this,ft)[ft]},set:function(e){Object(g.a)(this,ft)[ft]=e}},{key:"addOnFrameListener",value:function(e){this.onFrameHandlers.splice(this.onFrameHandlers.length-2,0,e)}},{key:"fetchVideos",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,n,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(I.a)(this.videos),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return a=n.value,e.next=7,this.videoSources.fetch(a);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])})));return function(){return e.apply(this,arguments)}}()},{key:"isLoaded",value:function(e){return this.videoSources.isLoaded(e)}},{key:"loadVideo",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n,a,r,i,o,s,l,d=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=d.length>1&&void 0!==d[1]&&d[1],(null===(n=this.currentTrack)||void 0===n?void 0:n.id)!==t.id){e.next=3;break}return e.abrupt("return");case 3:if(this.currentVideo=t,this.ATrack.id===t.id||this.BTrack.id===t.id){e.next=7;break}return e.next=7,this.preloadToAnotherTrack(t,r);case 7:i=this.ATrack.id===t.id?[this.ATrack,this.BTrack]:[this.BTrack,this.ATrack],o=Object(c.a)(i,2),s=o[0],l=o[1],console.debug("TrackToLoad: ".concat(s.name,"_").concat(s.id," ").concat(null===(a=s.video)||void 0===a?void 0:a.currentTime,", TrackToUnload: ").concat(l.name,"_").concat(l.id)),l.unLoad(),s.load(this.whichOnPlay,this.whichOnPause),this._currentTrack=s.video;case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"preloadToAnotherTrack",value:function(){var e=Object(v.a)(f.a.mark((function e(t,n){var a,r,i,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("%cpreloadToSkip","background: #444; color: #bada55; padding: 2px; border-radius:2px",t),e.next=3,null===(a=this.videoSources)||void 0===a?void 0:a.fetch(t);case 3:o=this.BTrack.id===(null===(r=this.currentTrack)||void 0===r?void 0:r.id)?this.ATrack:this.BTrack,console.debug("Load to track_".concat(o.name)),o.setVideo(t,null===(i=this.videoSources)||void 0===i?void 0:i.getVideo(t.id)),n&&o.play();case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e,t;this.currentTrack&&this.currentTrack.paused&&(console.debug("play video"),this.currentTrack.play(),null===(e=this.onPlay)||void 0===e||e.call(this,null===(t=this.currentTrack)||void 0===t?void 0:t.id))}},{key:"pause",value:function(){var e,t,n,a;(null===(e=this.currentTrack)||void 0===e?void 0:e.paused)||(null===(t=this.currentTrack)||void 0===t||t.pause(),null===(n=this.onPause)||void 0===n||n.call(this,null===(a=this.currentTrack)||void 0===a?void 0:a.id))}},{key:"seekTo",value:function(){var e=Object(v.a)(f.a.mark((function e(t,n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadVideo(t);case 2:this.currentTrack.currentTime=n/t.frameRate+.001,console.debug("switch to video:",t,"set currentTime to frameIdx",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),ht=Object(j.a)("frames"),pt=function(e){Object(m.a)(n,e);var t=Object(O.a)(n);function n(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ot;return Object(h.a)(this,n),(e=t.call(this)).dataLoader=a,Object.defineProperty(Object(b.a)(e),ht,{writable:!0,value:void 0}),e.dataLoader.onLoad=function(t,n){var a,r;null===(a=(r=e).onLoad)||void 0===a||a.call(r,t,"Data",n)},e.dataLoader.onUnload=function(t){var n,a;null===(n=(a=e).onUnload)||void 0===n||n.call(a,t,"Data")},e}return Object(p.a)(n,[{key:"frames",get:function(){return Object(g.a)(this,ht)[ht]},set:function(e){Object(g.a)(this,ht)[ht]=e}},{key:"fetchVideos",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,a,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(et.a)(Object(tt.a)(n.prototype),"fetchVideos",this).call(this),t=Object(I.a)(this.videos),e.prev=2,t.s();case 4:if((a=t.n()).done){e.next=10;break}return r=a.value,e.next=8,this.dataLoader.fetch(r);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),t.e(e.t0);case 15:return e.prev=15,t.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(){return e.apply(this,arguments)}}()},{key:"isLoaded",value:function(e){return this.dataLoader.isLoaded(e)&&Object(et.a)(Object(tt.a)(n.prototype),"isLoaded",this).call(this,e)}},{key:"loadVideo",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var a,r,i=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>1&&void 0!==i[1]&&i[1],(null===(a=this.currentTrack)||void 0===a?void 0:a.id)!==t.id){e.next=3;break}return e.abrupt("return");case 3:return Object(et.a)(Object(tt.a)(n.prototype),"loadVideo",this).call(this,t,r),e.next=6,this.dataLoader.fetch(t);case 6:this.frames=this.dataLoader.getVideoData(t.id);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(vt);function bt(){return new Worker(n.p+"static/js/loadData.worker.8a7f35a0.js")}var mt=Object(j.a)("getBins"),Ot=function(e){Object(m.a)(n,e);var t=Object(O.a)(n);function n(){var e;return Object(h.a)(this,n),e=t.call(this,bt),Object.defineProperty(Object(b.a)(e),mt,{writable:!0,value:void 0}),e.playerBins={},Object(g.a)(Object(b.a)(e),mt)[mt]=Y(e.worker,"Bins"),e}return Object(p.a)(n,[{key:"loadBins",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(g.a)(this,mt)[mt]();case 2:this.playerBins=e.sent;case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(ot),gt=Object(j.a)("gazeQueue"),jt=Object(j.a)("frameQueue"),yt=Object(j.a)("mousePos"),xt=Object(j.a)("playerAttentions"),_t=Object(j.a)("keyPlayers"),St=Object(j.a)("keyPlayer_buffer_size"),kt=Object(j.a)("getPlayerTeam"),Et=new(function(e){Object(m.a)(n,e);var t=Object(O.a)(n);function n(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ot;return Object(h.a)(this,n),(e=t.call(this,a)).onGaze=void 0,e.onUpdateLvInt=void 0,e.onUpdateLvSync=void 0,Object.defineProperty(Object(b.a)(e),gt,{writable:!0,value:[]}),Object.defineProperty(Object(b.a)(e),jt,{writable:!0,value:[]}),Object.defineProperty(Object(b.a)(e),yt,{writable:!0,value:{x:0,y:0}}),e.onSocket=function(t){var n,a,r=JSON.parse(t.data),i=Math.round(1e3*r[1]),o=e.getClosetFrame(i);if(o){var c=Ee(),s=c.x,l=c.y,d=c.wScale,u=void 0===d?1:d,f=c.hScale,v=void 0===f?1:f,h=window.innerWidth/window.outerWidth,p=window.innerHeight/window.outerHeight,m={x:A.MOUSE_GAZE?Object(g.a)(Object(b.a)(e),yt)[yt].x:(r[0][0]*h-s)*u,y:A.MOUSE_GAZE?Object(g.a)(Object(b.a)(e),yt)[yt].y:((r[0][1]+20)*p-l)*v,ts:i,fIdx:null===o||void 0===o?void 0:o.fIdx,videoId:null===o||void 0===o?void 0:o.videoId};Object(g.a)(Object(b.a)(e),gt)[gt].push(m);var O=e.getLookAt(m);null===(n=(a=e).onGaze)||void 0===n||n.call(a,m,O),e.updateInteLv(m,O)}},Object.defineProperty(Object(b.a)(e),xt,{writable:!0,value:{lastTs:-1,fIdx:-1,videoId:void 0,players:{}}}),Object.defineProperty(Object(b.a)(e),_t,{writable:!0,value:[]}),Object.defineProperty(Object(b.a)(e),St,{writable:!0,value:100}),e.lastFocus={pos:{x:0,y:0}},Object.defineProperty(Object(b.a)(e),kt,{writable:!0,value:function(e){return e?E.h[e].team:void 0}}),A.MOUSE_GAZE&&(document.body.addEventListener("mousemove",(function(t){var n,a=null===(n=document.getElementById("canvasWrapper"))||void 0===n?void 0:n.getBoundingClientRect();if(void 0!==a){var r=a.x,i=a.y,o=Ee(),c=o.wScale,s=void 0===c?1:c,l=o.hScale,d=void 0===l?1:l;Object(g.a)(Object(b.a)(e),yt)[yt]={x:(t.clientX-r)*s,y:(t.clientY-i)*d}}})),setInterval((function(){e.onSocket({data:JSON.stringify([[0,0],Date.now()/1e3])})}),1e3/30)),e}return Object(p.a)(n,[{key:"pushFrameHistory",value:function(e){Object(g.a)(this,jt)[jt].push(e)}},{key:"getClosetFrame",value:function(e){var t,n=1/0,a=void 0,r=Object(I.a)(Object(s.a)(Object(g.a)(this,jt)[jt]).reverse());try{for(r.s();!(t=r.n()).done;){var i=t.value,o=Math.abs(i.ts-e);if(!(o<n))break;n=o,a=i}}catch(c){r.e(c)}finally{r.f()}return a}},{key:"latestGaze",get:function(){return Object(g.a)(this,gt)[gt][Object(g.a)(this,gt)[gt].length-1]}},{key:"getClosetGaze",value:function(e){var t,n=1/0,a=void 0,r=Object(I.a)(Object(s.a)(Object(g.a)(this,gt)[gt]).reverse());try{for(r.s();!(t=r.n()).done;){var i=t.value,o=Math.abs(i.ts-e);if(!(o<n))break;n=o,a=i}}catch(c){r.e(c)}finally{r.f()}return a}},{key:"getLookAt",value:function(e){var t,n,a=e.x,r=e.y;if(e.videoId===(null===(t=this.currentVideo)||void 0===t?void 0:t.id)){var i=null===(n=this.frames)||void 0===n?void 0:n[e.fIdx];if(null===i||void 0===i?void 0:i.players){var o=E.d;return i.players.filter((function(e){var t=e.bbox;return a>t.x-o&&r>t.y-o&&a<t.x+t.w+o&&r<t.y+t.h+o}))}}}},{key:"updateInteLv",value:function(e,t){var n,a=e.ts,r=e.fIdx,i=Object(g.a)(this,xt)[xt],o=i.lastTs,c=i.players;var s=-1===o?c:Object.keys(c).reduce((function(e,t){var n,r,i,s,l=+t,d=(null!==(n=null===(r=c[l])||void 0===r?void 0:r.att)&&void 0!==n?n:0)*Math.pow(.2,(a-o)/500),u=null!==(i=null===(s=c[l])||void 0===s?void 0:s.on)&&void 0!==i&&i;return e[l]={on:!(d<E.e.off)&&u,att:d,looked:!1},e}),{});t&&t.forEach((function(e){var t,n,r=e.id;r in s||(s[r]={on:!1,att:0,looked:!0});var i,l,d=null!==(t=null===(n=c[r])||void 0===n?void 0:n.att)&&void 0!==t?t:0,u=(i=d,l=a-o,1-Math.pow(.2,(l-500*Math.log(1-i)/Math.log(5))/500)),f=u>E.e.on||s[r].on;s[r]={att:u,on:f,looked:!0}})),Object(g.a)(this,xt)[xt]={lastTs:a,fIdx:r,videoId:e.videoId,players:s},null===(n=this.onUpdateLvInt)||void 0===n||n.call(this,Object(g.a)(this,xt)[xt])}},{key:"getNextBallHolder",value:function(e,t,n,a){var r;t*=null===(r=this.currentVideo)||void 0===r?void 0:r.frameRate;for(var i=e;i<e+t;++i){var o,c=null===(o=this.frames)||void 0===o?void 0:o[i];if(c){var s=c.ball;if(null===s||void 0===s?void 0:s.playerId){if(!(null===n||void 0===n?void 0:n.playerId))return E.h[s.playerId].team===a?s.playerId:void 0;if(s.playerId!==n.playerId&&E.h[s.playerId].team===E.h[n.playerId].team)return s.playerId}}}}},{key:"getEmptyPlayer",value:function(e,t,n){if(void 0!==e&&void 0!==n){var a,r=e.filter((function(e){var t=e.tracking;return void 0!==t.x&&void 0!==t.y})),i=r.filter((function(e){return E.h[e.id].team!==n})),o=r.filter((function(e){return E.h[e.id].team===n})),c=[],s=Object(I.a)(o);try{var l=function(){var e=a.value,n=e.dataPkg;if(e.id===t)return"continue";if(!n.inOffsensiveCourt)return"continue";if(i.map((function(t){return z(t.tracking,e.tracking)})).every((function(e){return e>E.b}))){var r=function(e){var t=E.h[e].team;return new Set(["CLE","OKC"]).has(t)?{x:5.8,y:25}:{x:88.2,y:25}}(e.id),o=r.x,s=r.y,l=z(e.tracking,{x:o,y:s});c.push([e,l])}};for(s.s();!(a=s.n()).done;)l()}catch(d){s.e(d)}finally{s.f()}return c.sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}}},{key:"fetchFocus",value:function(){var e=this.latestGaze;if(!e)return this.lastFocus;var t=this.lastFocus.pos,n=Math.min(600,e.x-t.x),a=Math.min(600,e.y-t.y);return t={x:t.x+n,y:t.y+a},this.lastFocus={pos:t},this.lastFocus}},{key:"pickPlayers",value:function(e,t,n,a){var r,i,o,l,u=this;Object.keys(Object(g.a)(this,_t)[_t]).length>Object(g.a)(this,St)[St]&&Object(g.a)(this,_t)[_t].pop();var f=null===(r=this.frames)||void 0===r?void 0:r[e];if(!f)return{};var v=f.ball,h=f.players,p=f.teamWithBall,b=void 0===p?Object(g.a)(this,kt)[kt](null===h||void 0===h||null===(i=h.find((function(e){return e.id===(null===v||void 0===v?void 0:v.playerId)})))||void 0===i?void 0:i.id):p,m=Object(g.a)(this,xt)[xt].players,O=[],j=[];if(null===v||void 0===v?void 0:v.playerId){O.push({id:v.playerId,type:K.BALL_HOLDER}),j.push({id:v.playerId,type:new Set([X.Normal])});var y=null===h||void 0===h?void 0:h.find((function(e){return e.id===v.playerId}));(null===y||void 0===y?void 0:y.tracking.defending)&&j.push({id:null===y||void 0===y?void 0:y.tracking.defending,type:new Set([X.Normal])}),null===h||void 0===h||h.filter((function(e){return e.tracking.defending===v.playerId})).forEach((function(e){return j.push({id:e.id,type:new Set([X.Normal])})}))}Object.entries(n).forEach((function(e){var t=Object(c.a)(e,2),n=t[0];"On"===t[1]&&O.push({id:+n,type:K.BALL_HOLDER})}));var x=this.getNextBallHolder(e,E.g,v);x&&O.length<E.f&&(O.push({id:x,type:K.NEXT_BALL_HOLDER}),j.push({id:x,type:new Set([X.Normal])}));var _=t.vis_empty_player?this.getEmptyPlayer(null===h||void 0===h?void 0:h.filter((function(e){return!O.some((function(t){return t.id===e.id}))})),null===v||void 0===v?void 0:v.playerId,b):[];null===_||void 0===_||_.filter((function(e){var t=e.bbox;if(!a)return!0;var n=a.pos,r=n.x,i=n.y;return r>t.x-60&&i>t.y-60&&r<t.x+t.w+60&&i<t.y+t.h+60})).forEach((function(e){O.length+1<E.f&&(O.push({id:e.id,type:K.EMPTY_PLAYER}),j.push({id:e.id,type:new Set([X.Normal])}))}));var S=null!==(o=null===(l=Object(g.a)(this,_t)[_t])||void 0===l?void 0:l[0])&&void 0!==o?o:{},k=S.players,A=void 0===k?[]:k,w=S.fIdx,I=void 0===w?0:w,T=S.videoId,C=(A=A.filter((function(e){var t;return T===(null===(t=u.currentVideo)||void 0===t?void 0:t.id)}))).filter((function(e){return!O.find((function(t){return e.id===t.id}))})).map((function(t){return t.last.status="exit",t.last.progress-=e-I,t})),M=A.filter((function(e){return!C.find((function(t){return t.id===e.id}))})).map((function(t){return t.last.progress=Math.min(6,t.last.progress+e-I),t.last.status=6===t.last.progress?"update":"enter",t})),L=O.filter((function(e){return!A.find((function(t){return t.id===e.id}))})).map((function(e){return e.last={status:"enter",progress:0},e})),F=[].concat(Object(s.a)(L),Object(s.a)(M),Object(s.a)(C.filter((function(e){return e.last.progress>0}))));return F.length>=E.f&&console.warn("More than the upper limit"),j=[].concat(Object(s.a)(j),Object(s.a)(F.map((function(e){return{id:e.id,type:new Set([X.Normal])}})))),t.gaze_focus&&Object.entries(m).forEach((function(e){var t=Object(c.a)(e,2),n=t[0],a=t[1],r=a.att,i=a.on,o=a.looked;j.push({id:+n,att:r,on:i,looked:o,type:new Set([X.Interest])})})),Object.entries(n).forEach((function(e){var t=Object(c.a)(e,2),n=t[0];"On"===t[1]&&j.push({id:+n,type:new Set([X.Normal])})})),Object(g.a)(this,_t)[_t].unshift({fIdx:e,videoId:this.currentVideo.id,players:F}),{lv1Players:F.filter((function(e){return"Off"!==n[e.id]})).reduce((function(e,t){return t.id in e||(e[t.id]=t),t.type<e[t.id].type&&(e[t.id].type=t.type),e}),{}),lv2Players:j.filter((function(e){return"Off"!==n[e.id]||e.type.has(X.Interest)})).reduce((function(e,t){return t.id in e?e[t.id]=Object(d.a)(Object(d.a)(Object(d.a)({},e[t.id]),t),{},{type:P(t.type,e[t.id].type)}):e[t.id]=t,e}),{}),teamWithBall:b,ballHolder:null===h||void 0===h?void 0:h.find((function(e){return e.id===(null===v||void 0===v?void 0:v.playerId)}))}}},{key:"loadBins",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataLoader.loadBins();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getPlayerBins",value:function(e){if(e)return this.dataLoader.playerBins[e]}},{key:"getCurrentBin",value:function(e){if(e){var t=e.tracking,n=t.x,a=t.y;return void 0!==n&&void 0!==a?ke([{LOC_X:10*n,LOC_Y:10*a}])[0]:void 0}}}]),n}(pt)),At={vis_off_ring:!0,vis_def_sheild:!0,vis_key_player:!0,vis_empty_player:!0,vis_top_view:!0,gaze_focus:!0,gaze_filter:!1},wt=Object(j.a)("visualizer"),It=function(e){Object(m.a)(n,e);var t=Object(O.a)(n);function n(){var e;Object(h.a)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).state={pauseLoading:void 0,videos:[],currentVideoIdx:0,currentFrameIdx:0,currentFrame:void 0,currentGaze:void 0,gazePlayers:void 0,attentions:void 0,attentionsOverTime:void 0,pickedPlayers:{},features:At,playerFlag:{},playing:!1},Object.defineProperty(Object(b.a)(e),wt,{writable:!0,value:r.a.createRef()}),e.pushFrameHistory=function(t,n,a){var r=e.state.videos,i=r.findIndex((function(e){return e.id===t}));if(-1!==i){var o=r[i];Et.pushFrameHistory({videoId:o.id,fIdx:n,ts:a})}else Et.pause()},e.onClickInterval=function(){var t=Object(v.a)(f.a.mark((function t(n,a){var r,i,o,c;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.state.videos,i=Z(a,r),o=i.videoIdx,c=i.frameIdx,Et.pause(),t.next=5,Et.seekTo(r[o],c);case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),e.onPlayVideo=Object(v.a)(f.a.mark((function t(){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.state.playing?Et.pause():Et.play();case 2:case"end":return t.stop()}}),t)}))),e}return Object(p.a)(n,[{key:"currentVideo",get:function(){return this.state.videos[this.state.currentVideoIdx]}},{key:"componentDidMount",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,n,a,r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(xe.a.VIDEO_IDS.map(function(){var e=Object(v.a)(f.a.mark((function e(t){var n,a,r,i,o,c,s,l,d;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat("/iBall","/assets/").concat(xe.a.GAME_ID,"/").concat(t,"/").concat(t,"-meta.json")).then((function(e){return e.json()}));case 3:return n=e.sent,a=n.max_frame,r=n.start_frame,i=void 0===r?0:r,o=n.fps,c=n.h,s=n.w,l=n.version,d=t.endsWith(",t"),e.abrupt("return",{gameId:xe.a.GAME_ID,id:t,maxFrame:a,startFame:i,isTransit:d,frameRate:o,loadedData:0,loadedVideo:0,width:s,height:c,version:l});case 15:throw e.prev=15,e.t0=e.catch(0),console.log("Something wrong with maxjson",t),e.t0;case 19:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t){return e.apply(this,arguments)}}()));case 2:return n=e.sent,this.setState({videos:n}),Et.videos=n,Et.onGaze=function(e,t){return r.setState({currentGaze:e,gazePlayers:t})},Et.onUpdateLvInt=function(e){return r.setState({attentions:e})},Et.onLoad=function(e,t,n){var a=r.state.videos,i=a.findIndex((function(t){return t.id===e}));-1!==i&&(a[i]=Object(d.a)(Object(d.a)({},a[i]),{},Object(l.a)({},"loaded".concat(t),void 0===n?1:n)),r.setState({videos:Object(s.a)(a)}))},Et.onUnload=function(e,t){var n=r.state.videos,a=n.findIndex((function(t){return t.id===e}));-1!==a&&(n[a]=Object(d.a)(Object(d.a)({},n[a]),{},Object(l.a)({},"loaded".concat(t),0)),r.setState({videos:Object(s.a)(n)}))},Et.onPause=function(e){return r.setState({playing:!1})},Et.onPlay=function(e){return r.setState({playing:!0,pauseLoading:void 0})},Et.addOnFrameListener(this.pushFrameHistory),Et.addOnFrameListener(function(){var e=Object(v.a)(f.a.mark((function e(t,n,a,i){var o,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=r.state.videos,c=o.findIndex((function(e){return e.id===t})),r.setState({currentFrameIdx:n,currentVideoIdx:c,currentFrame:i});case 3:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}()),a=this.state.currentVideoIdx,e.next=16,Et.loadBins();case 16:return e.next=18,Et.fetchVideos();case 18:return e.next=20,Et.loadVideo(n[a]);case 20:this.setState({playerFlag:Array.from(new Set(Object.values(null!==(t=Et.frames)&&void 0!==t?t:{}).flatMap((function(e){var t;return null===(t=e.players)||void 0===t?void 0:t.map((function(e){return e.id}))})))).reduce((function(e,t){return t&&(e[t]="Auto"),e}),{})});case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){}},{key:"loadedPrecentage",value:function(){var e=this.state.videos;return e.reduce((function(e,t){return e+(2*t.loadedData+t.loadedVideo)}),0)/e.reduce((function(e,t){return e+(t.isTransit?1:3)}),0)}},{key:"renderProgressbar",value:function(){var e=100*this.loadedPrecentage();return 100===e?null:Object(we.jsx)("div",{style:{position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:Object(we.jsxs)(_.a,{value:e,styles:Object(_.b)({pathColor:"rgb(62, 152, 199)",textColor:"#f88",trailColor:"#d6d6d6",backgroundColor:"#3e98c7"}),children:[Object(we.jsx)("div",{style:{color:"#f88",fontSize:"40px"},children:"".concat(0|e,"%")}),Object(we.jsx)("div",{style:{color:"#f88",fontSize:"24px"},children:"~1min"})]})})}},{key:"renderToggle",value:function(){var e=this,t=this.state.features;return Object(we.jsxs)("div",{className:"featurePanel",children:[Object(we.jsx)("h4",{style:{textAlign:"center"},children:"Features"}),Object.entries(t).filter((function(e){var t=Object(c.a)(e,2),n=t[0];t[1];return"onPlayers"!==n&&"offPlayers"!==n})).map((function(n){var a=Object(c.a)(n,2),r=a[0],i=a[1];return Object(we.jsxs)("div",{className:"featureItem",children:[Object(we.jsx)(x.a,{id:"cheese-status",checked:i,onChange:function(n){t[r]=!i,e.setState({features:t})}}),Object(we.jsx)("span",{children:r.split("_").join(" ")})]},r)}))]})}},{key:"renderPlayerToggle",value:function(){var e=this,t=this.state.playerFlag;return Object(we.jsxs)("div",{className:"playerPanel",children:[Object(we.jsx)("h4",{style:{textAlign:"center"},children:"Players"}),Object(we.jsx)("div",{className:"btn-group",children:["Auto","On","Off"].map((function(n){return Object(we.jsxs)("button",{onClick:function(){Object.keys(t).forEach((function(e){t[+e]=n})),e.setState({playerFlag:Object(d.a)({},t)})},children:[n," All"]})}))}),Object(we.jsx)("div",{className:"gridContainer",children:Object.entries(t).map((function(n){var a=Object(c.a)(n,2),r=a[0],i=a[1];return Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)("span",{className:"gridItem",children:E.h[+r].ln}),Object(we.jsx)("label",{className:"gridItem",children:Object(we.jsx)("select",{name:"pflag",id:"pflag",value:i,onChange:function(n){t[+r]=n.target.value,e.setState({playerFlag:Object(d.a)({},t)})},children:["Auto","On","Off"].map((function(e){return Object(we.jsx)("option",{value:e,children:e})}))})})]})}))})]})}},{key:"render",value:function(){var e,t,n=this,a=this.state,r=a.currentVideoIdx,i=a.currentFrameIdx,o=a.features,s=a.playerFlag,u=a.currentGaze,f=a.currentFrame,v=a.gazePlayers,h=a.pauseLoading,p=a.attentions,b=a.attentionsOverTime,m=a.pickedPlayers,O=a.playing,j=a.videos,y=null===(e=Et.frames)||void 0===e?void 0:e[i];return Object(we.jsxs)(we.Fragment,{children:[this.renderProgressbar(),this.renderToggle(),this.renderPlayerToggle(),o.vis_top_view&&Object(we.jsx)(Ve,{currentFrameData:y}),Object(we.jsx)("div",{className:"up",children:Object(we.jsxs)("div",{className:"full",children:[Object(we.jsx)(Te,{ref:Object(g.a)(this,wt)[wt],currentVideo:this.currentVideo,currentFrameIdx:i,currentFrame:f,features:o,playerFlags:s,gaze:u,gazePlayers:v,onPickPlayers:function(e,t,a){var r=j.findIndex((function(e){return e.id===n.currentVideo.id}));if(-1!==r){var i=V(r,e,j);n.setState({pickedPlayers:Object(d.a)(Object(d.a)({},m),{},Object(l.a)({},i,{lv1Players:t,lv2Players:a}))})}},children:Object(we.jsx)($e,{currentVideo:this.currentVideo,currentFrameData:y,gaze:A.GAZE?u:void 0,gazePlayers:v,bbox:!1})}),A&&Object(we.jsxs)("div",{className:"debug",children:[A.ATTENTIONS&&Object(we.jsx)("div",{className:"chart",children:Object(we.jsx)(Be,{fixY:!0,data:(null===p||void 0===p?void 0:p.players)?Object.entries(null===p||void 0===p?void 0:p.players).map((function(e){var t=Object(c.a)(e,2),n=t[0],a=t[1];return{id:n,value:a.att,fill:a.on?"teal":"lightpink"}}),{}):[]})}),A.LINE&&Object(we.jsx)("div",{className:"chart",children:Object(we.jsx)(He,{width:600,data:null!==(t=null===b||void 0===b?void 0:b.filter((function(e){return void 0!==e.videoId})).map((function(e){var t,n,a=e.fIdx,r=e.players,o=e.videoId,c=(null!==(t=null===(n=Et.frames)||void 0===n?void 0:n[i])&&void 0!==t?t:{}).players,s=function(e){if(!e||0===e.length)return 0;var t=e.length,n=e.reduce((function(e,t){return e+t}))/t;return Math.sqrt(e.map((function(e){return Math.pow(e-n,2)})).reduce((function(e,t){return e+t}))/t)}(null===c||void 0===c?void 0:c.map((function(e){var t,n;return null!==(t=null===(n=r[e.id])||void 0===n?void 0:n.att)&&void 0!==t?t:0}))),l=j.findIndex((function(e){return e.id===o}));return{fIdx:V(l,a,j),videoIdx:l,value:s}})))&&void 0!==t?t:[]})})]}),Object(we.jsx)("div",{className:"controls",children:Object(we.jsx)("button",{id:"playpause",className:"play button is-outlined",type:"button",disabled:void 0!==h||1!==this.loadedPrecentage(),onClick:function(){return n.onPlayVideo()},children:O?Object(we.jsx)(S.a,{style:{transform:"scale(1.5)"}}):void 0!==h?Object(we.jsx)(k.a,{style:{transform:"scale(1.5)"}}):Object(we.jsx)(S.b,{style:{transform:"scale(1.5)"}})})})]})}),A.TIMELINE&&Object(we.jsx)(qe,{mode:"S",videos:j,currentVideoIdx:r,currentFrameIdx:i,enableClips:!1,onClickInterval:this.onClickInterval})]})}}]),n}(r.a.Component);o.a.render(Object(we.jsx)(r.a.StrictMode,{children:Object(we.jsx)(It,{})}),document.getElementById("root"))}},[[80,1,2]]]);
//# sourceMappingURL=main.ad83857f.chunk.js.map