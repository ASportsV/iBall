{"version":3,"sources":["param.ts","@const/players.ts","@const/gaze.ts","@const/style.ts","@const/index.ts","../common/src/@types/basic.ts","../common/src/@types/index.ts","../common/src/@const/ui.ts","../common/src/@const/draw.ts","../common/src/@utils/array.ts","../common/src/@utils/async.ts","../common/src/@utils/debug.ts","../common/src/@utils/type.ts","../common/src/@utils/hash.ts","../common/src/@utils/video.ts","../common/src/@utils/geometry.ts","../common/src/@utils/worker.ts","@types/gameData.ts","../common/src/@draw/frame.ts","../common/src/@draw/object.ts","../common/src/@draw/geometry.ts","components/Visualizer/visualizeData.ts","@utils.ts","components/Visualizer/index.tsx","components/BarChart/idnex.tsx","components/DebugCourt/index.tsx","../common/src/@components/Timeline/Interval.tsx","../common/src/@components/Timeline/index.tsx","../common/src/@components/SVGOverlay/index.tsx","components/SVGOverlay/index.tsx","../common/src/DataLoader/loadFrames.worker.ts","../common/src/DataLoader/DataLoader.ts","../common/src/DataLoader/Database.ts","../common/src/VideoEnv/VideoPlayer/VideoLoader.ts","../common/src/VideoEnv/VideoPlayer/VideoPlayer.ts","../common/src/VideoEnv/index.ts","VideoEnv/loadData.worker.ts","VideoEnv/DataLoader.ts","App.tsx","VideoEnv/index.ts","index.tsx"],"names":["Parameters","GAME_ID","UNIT_ID","console","log","global","location","search","debug","VIDEO_ID_GROUPS","this","params","URLSearchParams","gameId","get","includes","alert","unitId","mode","toUpperCase","initParams","PLAYER_META","2760","fn","ln","offSpeed","team","star","2738","101106","201575","203110","203105","203084","203546","203949","1626172","202691","2571","201578","2733","201939","201574","101112","2563","202697","2747","2592","203099","203925","203895","201567","202681","2544","203521","2590","2210","201619","202389","202684","201566","201627","203079","2555","202713","200779","201586","202683","203500","201571","203460","1626166","201142","202362","101108","200755","2746","201599","203143","2037","201601","203085","201933","202325","1718","202332","GAZE_R","Object","entries","reduce","o","pId","Math","random","NEXT_BALL_HOLDER_TIME_RANGE","LV_INTEREST_THRESHOLD","off","on","EMPTY_SPACE_THRESHOLD","MAX_HIGHLIGHTED","FOCUS","min","max","mina","maxa","miniMapSize","miniMapWidth","COLORS","offense_inner_border","offense_bg_fill","offense_outer_border","defense_bg_fill","defense_fg_fill","player_name","BG_MASK_ALPHA","FG_MASK_ALPHA","off_df_link","star_name","star_star","game2_unit0","game1_unit0","game1_unit1","game1_unit2","game2_unit1","game2_unit2","Side","Direction","TPlayerOption","DEBUG","OVERLAY","COURT","GAZE","BBOX","LINE","ATTENTIONS","TIMELINE","MOUSE_GAZE","DEBUG_MEM","extent","d","ArrayToDict","arr","key","f","union","setA","setB","_union","Set","elem","add","wait","ms","a","Promise","resolve","reject","setTimeout","waitUntil","checkFun","interval","setInterval","bytesToMB","bytes","toFixed","debugMem","memory","performance","usedJSHeapSize","totalJSHeapSize","_intervalIdGen","intervalIdGen","getImg","src","img","Image","onload","e","URL","revokeObjectURL","undefined","globalFIdxToLocal","globalFrameIdx","videos","accFrame","videoIdx","length","video","maxFrame","frameIdx","localFIdxToGlobalFIdx","localFIdx","accFrameIdx","i","distPoints","p1","p2","dx","x","dy","y","sqrt","getAngle","x1","y1","x2","y2","radians","atan2","PI","wrapWorker","workerFunc","cb","worker","args","postMessage","addEventListener","handler","data","removeEventListener","PLAYER_STATUS","KeyPlayerType","Lv2PlayerType","drawRawFrame","layer","frame","darkenAlpha","canvas","width","height","ctx","drawImage","drawOverlay","alpha","save","fillStyle","fillRect","restore","internalCanvas","document","createElement","getContext","obj","applyStyle","style","forEach","lineWidth","strokeStyle","font","textBaseline","lineCap","lineJoin","value","pattern","globalAlpha","opacity","roundTo2PI","r","drawVis","visCtx","circles","sheilds","debugCtx","b","c","setTransform","circleTXY","map","cx","cy","tx","ty","filter","inOffsensiveCourt","_","cIdx","beginPath","arc","in_r","fill","size","out_r","globalCompositeOperation","stroke","drawVisRings","invertTXY","getA1A2","tangle","tdist","a1","MIN_DIST","MAX_DIST","a2","sheild","theta","cos","sin","ox","oy","grd","createLinearGradient","addColorStop","shadowColor","shadowBlur","moveTo","lineTo","smoothDFdiff","dist","pow","atan","tan","ma1","ma2","drawVisSheilds","drawGlows","players","savedFG","player","bbox","w","h","att","drawSpotLights","frames","last","progress","r1","type","EMPTY_PLAYER","STAR","dAlpha","nodes","uNodes","faces","z","p","n","face","rotateX3D","sinTheta","cosTheta","node","translate","v0","v1","v2","v3","closePath","_draw","internalCtx","drawHL","mask","lv1Players","lv2Players","features","ballHolder","filter_focus","pos","createRadialGradient","unImportantPlayers","find","lv2","id","lv1","lv2PlayerLooked","has","Interest","looked","lv2PlayerNotLooked","lp","vis_key_player","shooterIcon","process","defenderIcon","starIcon","ICONS","shooter","defender","drawIcon","iconHeight","offset","icon","iconWidth","drawName","namePos","lastname","textAlign","textwidth","measureText","textheight","fillText","floor","getRegionKey","area","match","getArea","AREA","RANGE","mapRegionToPoint","region","endsWith","hexbin","d3Hexbin","LOC_X","LOC_Y","radius","SHOT_ZONE_AREA","BASIC","SHOT_ZONE_BASIC","SHOT_ZONE_RANGE","FGA","FGM","rate","FG_PCT","exp","getCanvasAbsTopLeft","elm","getElementById","getBoundingClientRect","window","outerHeight","wScale","hScale","Scales","regionScale","scaleOrdinal","schemeSet3","twoPTColor","scaleSequential","interpolateYlGnBu","domain","twoPT","range","threePTColor","threePT","radiusScale","scaleSqrt","regionExp","interpolateReds","layerIds","Visualizer","layers","l","isOnLv2Player","Normal","keypoints","left_hip","right_hip","left_ankle","right_ankle","preProps","currentFrameIdx","props","currentFrame","playerFlags","cleanAllExcept","currentFrameData","videoEnv","ball","gaze_filter","fetchFocus","pickPlayers","dataToVis","offensiveRings","dataPkg","offensive","vis_off_ring","smoothRegionExp","get2DPos","defensiveSheilds","defensive","vis_def_sheild","diff","speed","defendingPlayer","draw","playerId","values","ip","currentVideo","className","marginLeft","alt","idx","ref","children","layerId","keys","lId","clearRect","React","Component","AxisBottom","scale","transform","useRef","useEffect","current","select","call","axisBottom","AxisLeft","axisLeft","BarChart","fixY","normalizeY","maxY","margin","scaleX","scaleBand","scaleY","scaleLinear","bandwidth","LineChart","fIdx","minFIdx","maxFIdx","push","sort","fIdxs","minIdx","points","lineGenerator","line","curve","curveMonotoneX","strokeWidth","scaleT2Minimap","HexaBin","memo","isIn","hexagon","Hexagon","playerBins","currentBin","position","overflow","Court","playerMarkers","tracking","mIdx","top","left","backgroundColor","color","fontSize","playerWithBall","getCurrentBin","getPlayerBins","displayName","Interval","state","isMoving","isAdjusting","cursorStatus","onResizeStart","direction","button","stopPropagation","mx","clientX","setState","oBBox","body","classList","onResizing","preventDefault","stopImmediatePropagation","getEW","wx","ex","onAdjusting","onResizeEnd","onAdjustingEnd","remove","onMoveStart","onMoving","newx","onMoveEnd","focused","initializing","clsx","onMouseDown","parentDim","currentTarget","parentElement","abs","onMouseMove","onClick","onClickInterval","pad","num","slice","hhmmss","secs","t","minutes","Timeline","createRef","imgWidth","intervalSelectorHeight","parentOffsetx","isDrawing","onDrawStart","scrollLeft","clientY","bottom","enableClips","clips","frame2pos","start","end","curFrame","pos2frame","newIntervalId","newInterval","onUpsertClip","intervalId","omx","onDrawing","drawingInterval","int","maxdx","mindx","startFrame","endFrame","onDrawEnd","drawingIntervalIdx","findIndex","updateInterval","clipId","end_","targetIntervalIdx","targetInterval","intervalIdx","numberOfImg","intervalCount","trackWidth","totalTrackWidth","globalMaxFrames","round","v","trackWidthFactor","currentVideoIdx","frameRate","ceil","maxTime","containerHeightPadding","prevProps","innerWidth","documentElement","clientWidth","right","scrollTo","behavior","focusedClipId","globalCurFrameIdx","containerHeight","currentTime","flex","isTransit","loadedData","loadedVideo","renderClips","SVGLayer","activeBBoxes","viewBox","preserveAspectRatio","target","onClickBG","onContextMenu","onDoubleClick","onDBClick","floodColor","result","in","onClickPlayer","screenPos","onClickBall","Overlay","gaze","gazePlayers","svgLayerProps","teamWithBall","textAnchor","alignmentBaseline","some","Worker_fn","Worker","DataLoader","MyWorker","memVideoData","onLoad","onUnload","vId","videoId","shouldWait","isLoaded","progressOffset","framesToSave","itemsForBatch","all","createObjectURL","Dexie","VideoLoader","memVideos","nextVideo","load","onloadeddata","VideoTrack","name","videoPlayer","CallBackHandle","onPlay","onPause","invokeFrameHandlers","now","metadata","currentTrack","mediaTime","frameOffset","len","onFrameHandlers","Date","requestVideoFrameCallback","videoElm","cancelVideoFrameCallback","play","VideoPlayer","_currentTrack","videoSources","ATrack","BTrack","whichOnPause","ev","whichOnPlay","addOnFrameListener","ts","videoFrame","curVideoIdx","warn","nextVideoIdx","preloadToAnotherTrack","pause","loadVideo","splice","fetch","trackToLoad","trackToUnload","unLoad","newVideo","setVideo","getVideo","paused","VideoEnv","dataLoader","progres","getVideoData","IBallDataLoader","IBallWorker","onGaze","onUpdateLvInt","onUpdateLvSync","onSocket","rawGaze","JSON","parse","closetFrame","getClosetFrame","wOutToIn","outerWidth","hOutToIn","innerHeight","attendPlayers","getLookAt","updateInteLv","lastTs","lastFocus","stringify","gTs","minDist","Infinity","minFrame","reverse","fTs","minGaze","gx","gy","cf","newAttentions","initialValue","dt","oldAttention","currentFIdx","timeRange","nextFrame","nextBall","ballHolderId","trackedPlayers","defenders","offensors","emptyOffensors","every","GOAL_BASKET_POS","bx","by","distToBasket","latestGaze","filter_center","pop","playerAttentions","currentlv1Players","BALL_HOLDER","defending","nextBallHolder","getNextBallHolder","NEXT_BALL_HOLDER","emptyPlayers","vis_empty_player","getEmptyPlayer","lastLv1Players","lastFIdx","lastVideoId","exitPlayers","cp","status","updatePlayers","ep","enterPlayers","gaze_focus","unshift","loadBins","enabledFeatures","vis_top_view","App","pauseLoading","currentGaze","attentions","attentionsOverTime","pickedPlayers","playerFlag","playing","pushFrameHistory","localFrameIdx","seekTo","onPlayVideo","VIDEO_IDS","then","json","max_frame","start_frame","fps","version","startFame","newCurVideoIdx","fetchVideos","Array","from","flatMap","loadedPrecentage","text","styles","buildStyles","pathColor","textColor","trailColor","k","checked","onChange","split","join","renderProgressbar","renderToggle","renderPlayerToggle","onPickPlayers","vIdx","globalFIdx","std","array","mean","standardDeviation","disabled","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.391a659e.chunk.js","sourcesContent":["import { VIDEO_ID_GROUPS } from \"@const\"\nimport { UnitID, GameID } from \"@types\"\n\nexport class Parameters {\n\n    // get VIDEO_FRAME_RATE() {\n    //     return this.GAME_ID === 'game1' ? 29.97 : 29.81\n    // }\n\n    get VIDEO_IDS() {\n        return VIDEO_ID_GROUPS[`${this.GAME_ID}_${this.UNIT_ID}`]\n    }\n\n    constructor(\n        public readonly GAME_ID: GameID = 'game1',\n        public readonly UNIT_ID: UnitID = 'unit0',\n        // public readonly MODE: 'AUG' | 'FULL' | 'RAW' = 'FULL',\n        // public readonly LV_FOCUS: boolean = MODE === 'FULL',\n        // public readonly LV_INTRE: boolean = MODE === 'FULL'\n    ) {\n        console.log(global.location.search)\n        console.debug(`%cParams:\n    GAME_ID: ${GAME_ID},\n    UNIT_ID: ${UNIT_ID},\n    `, 'background: #444; color: #bada55; padding: 2px; border-radius:2px')\n}\n// MODE: ${MODE},\n// LV_FOCUS: ${LV_FOCUS},\n// LV_INTRE: ${LV_INTRE}\n}\n\nfunction initParams() {\n    const params = new URLSearchParams(global.location.search);\n    let gameId: GameID = 'game1'\n    if(params.get('g') !== null) {\n        gameId = `game${params.get('g')}` as GameID\n    }\n    // validate\n    if(!['game1', 'game2'].includes(gameId)) {\n        alert('GameId must be game1 or game2')\n    }\n\n    let unitId: UnitID = 'unit0'\n    if(params.get('u') !== null) {\n        unitId = `unit${params.get('u')}` as UnitID\n    }\n    if(!['unit0', 'unit1', 'unit2'].includes(unitId)) {\n        alert('UnitId must be unit0, unit1, or unit2')\n    }\n\n    let mode: 'AUG' | 'FULL' | 'RAW' = 'FULL'\n    if(params.get('m') !== null) {\n        mode =  params.get('m')!.toUpperCase() as 'AUG' | 'FULL' | 'RAW'\n    }\n    if(!['AUG', 'FULL', 'RAW'].includes(mode)) {\n        alert('Mode must be RAW, AUG, or FULL')\n    }\n\n    let lvFocus: boolean = mode === 'FULL'\n    if(params.get('gf') !== null) {\n        lvFocus = params.get('gf') === 'true'\n    }\n    \n    let lvInt = mode === 'FULL'\n    if(params.get('gi') !== null) {\n        lvInt = params.get('gi') === 'true'\n    }\n\n    return new Parameters(gameId, unitId) //, mode, lvFocus, lvInt)\n}\n\nexport const params = initParams()","import type { PlayerID } from \"@types\"\n\nexport const TEAM_META = {\n    GSW: {},\n    CLE: {},\n    OKC: {},\n    LAC: {}\n}\n\n//offSpeed is actually AVG Defense Speed\nexport const PLAYER_META = {\n    2760: { fn: \"Anderson\", ln: \"Varejao\", offSpeed: 4.07, team: 'GSW', star: false },\n    2738: { fn: \"Andre\", ln: \"Iguodala\", offSpeed: 3.78, team: 'GSW', star: false },\n    101106: { fn: \"Andrew\", ln: \"Bogut\", offSpeed: 3.5, team: 'GSW', star: false },\n    201575: { fn: \"Brandon\", ln: \"Rush\", offSpeed: 4.09, team: 'GSW', star: false },\n    203110: { fn: \"Draymond\", ln: \"Green\", offSpeed: 3.49, team: 'GSW', star: 'defender' },\n    203105: { fn: \"Festus\", ln: \"Ezeli\", offSpeed: 3.97, team: 'GSW', star: false },\n    203084: { fn: \"Harrison\", ln: \"Barnes\", offSpeed: 4.02, team: 'GSW', star: false },\n    203546: { fn: \"Ian\", ln: \"Clark\", offSpeed: 4.07, team: 'GSW', star: false },\n    203949: { fn: \"James Michael\", ln: \"McAdoo\", offSpeed: 4.27, team: 'GSW', star: false },\n    1626172: { fn: \"Kevon\", ln: \"Looney\", offSpeed: 4.05, team: 'GSW', star: false },\n    202691: { fn: \"Klay\", ln: \"Thompson\", offSpeed: 3.85, team: 'GSW', star: 'shooter' },\n    2571: { fn: \"Leandro\", ln: \"Barbosa\", offSpeed: 3.88, team: 'GSW', star: false },\n    201578: { fn: \"Marreese\", ln: \"Speights\", offSpeed: 3.67, team: 'GSW', star: false },\n    2733: { fn: \"Shaun\", ln: \"Livingston\", offSpeed: 3.85, team: 'GSW', star: false },\n    201939: { fn: \"Stephen\", ln: \"Curry\", offSpeed: 3.68, team: 'GSW', star: 'shooter' },\n    201574: { fn: \"Jason\", ln: \"Thompson\", offSpeed: 3.68, team: 'GSW', star: false },\n\n    101112: { fn: \"Channing\", ln: \"Frye\", offSpeed: 3.61, team: 'CLE', star: false },\n    2563: { fn: \"Dahntay\", ln: \"Jones\", offSpeed: 4.31, team: 'CLE', star: false },\n    202697: { fn: \"Iman\", ln: \"Shumpert\", offSpeed: 4.08, team: 'CLE', star: false },\n    2747: { fn: \"JR\", ln: \"Smith\", offSpeed: 3.92, team: 'CLE', star: false },\n    2592: { fn: \"James\", ln: \"Jones\", offSpeed: 3.84, team: 'CLE', star: false },\n    203099: { fn: \"Jared\", ln: \"Cunningham\", offSpeed: 4.24, team: 'CLE', star: false },\n    203925: { fn: \"Joe\", ln: \"Harris\", offSpeed: 4.6, team: 'CLE', star: false },\n    203895: { fn: \"Jordan\", ln: \"McRae\", offSpeed: 3.6, team: 'CLE', star: false },\n    201567: { fn: \"Kevin\", ln: \"Love\", offSpeed: 3.86, team: 'CLE', star: false },\n    202681: { fn: \"Kyrie\", ln: \"Irving\", offSpeed: 3.78, team: 'CLE', star: false },\n    2544: { fn: \"LeBron\", ln: \"James\", offSpeed: 3.72, team: 'CLE', star: 'star' },\n    203521: { fn: \"Matthew\", ln: \"Dellavedova\", offSpeed: 3.9, team: 'CLE', star: false },\n    2590: { fn: \"Mo\", ln: \"Williams\", offSpeed: 3.92, team: 'CLE', star: false },\n    2210: { fn: \"Richard\", ln: \"Jefferson\", offSpeed: 3.96, team: 'CLE', star: false },\n    201619: { fn: \"Sasha\", ln: \"Kaun\", offSpeed: 4.12, team: 'CLE', star: false },\n    202389: { fn: \"Timofey\", ln: \"Mozgov\", offSpeed: 4.12, team: 'CLE', star: false },\n    202684: { fn: \"Tristan\", ln: \"Thompson\", offSpeed: 4.1, team: 'CLE', star: false },\n\n    201566: { fn: 'Russell', ln: 'Westbrook', offSpeed: 3.71, team: 'OKC', star: 'shooter' },\n    201627: { fn: 'Anthony', ln: 'Morrow', offSpeed: 3.80, team: 'OKC', star: false },\n    203079: { fn: 'Dion', ln: 'Waiters', offSpeed: 3.74, team: 'OKC', star: false },\n    2555: { fn: 'Nick', ln: 'Collison', offSpeed: 3.90, team: 'OKC', star: false },\n    202713: { fn: 'Kyle', ln: 'Singler', offSpeed: 4.21, team: 'OKC', star: false },\n    200779: { fn: 'Steve', ln: 'Novak', offSpeed: 3.87, team: 'OKC', star: false },\n    201586: { fn: 'Serge', ln: 'Ibaka', offSpeed: 3.67, team: 'OKC', star: false },\n    202683: { fn: 'Enes', ln: 'Kanter', offSpeed: 3.89, team: 'OKC', star: false },\n    203500: { fn: 'Steven', ln: 'Adams', offSpeed: 3.79, team: 'OKC', star: false },\n    201571: { fn: 'D.J.', ln: 'Augustin', offSpeed: 3.84, team: 'OKC', star: false },\n    203460: { fn: 'Andre', ln: 'Roberson', offSpeed: 4.36, team: 'OKC', star: false },\n    1626166: { fn: 'Cameron', ln: 'Payne', offSpeed: 4.11, team: 'OKC', star: false },\n    201142: { fn: 'Kevin', ln: 'Durant', offSpeed: 3.47, team: 'OKC', star: 'shooter' },\n\n    202362: { fn: 'Lance', ln: 'Stephenson', offSpeed: 3.98, team: 'LAC', star: false },\n    101108: { fn: 'Chris', ln: 'Paul', offSpeed: 3.67, team: 'LAC', star: 'star' },\n    200755: { fn: 'Redick', ln: 'JJ', offSpeed: 4.11, team: 'LAC', star: false },\n    2746: { fn: 'Josh', ln: 'Smith', offSpeed: 3.72, team: 'LAC', star: false },\n    201599: { fn: 'DeAndre', ln: 'Jordan', offSpeed: 3.68, team: 'LAC', star: false },\n    203143: { fn: 'Pablo', ln: 'Prigioni', offSpeed: 4.46, team: 'LAC', star: false },\n    2037: { fn: 'Jamal', ln: 'Crawford', offSpeed: 3.72, team: 'LAC', star: false },\n    201601: { fn: 'Luc', ln: 'Mbah a Moute', offSpeed: 4.08, team: 'LAC', star: false },\n    203085: { fn: 'Austin', ln: 'Rivers', offSpeed: 4.13, team: 'LAC', star: false },\n    201933: { fn: 'Blake', ln: 'Griffin', offSpeed: 3.56, team: 'LAC', star: false },\n    202325: { fn: 'Wesley', ln: 'Johnson', offSpeed: 4.06, team: 'LAC', star: false },\n    1718: { fn: 'Paul', ln: 'Pierce', offSpeed: 3.54, team: 'LAC', star: false },\n    202332: { fn: 'Cole', ln: 'Aldrich', offSpeed: 3.96, team: 'LAC', star: false },\n} as const\n\n\nexport const PLAYER_RANDOM_FACTOR = Object.entries(PLAYER_META)\n    .reduce((o, [pId, _]) => {\n        o[+pId as PlayerID] = Math.random() * 0.6\n        return o\n    }, {} as Record<PlayerID, number>)","export const GAZE_R = 20\n\n// lnSync threshold in ms, if you are not watching all the key players at least EXPLORE_MODE_THRESHOLD ms, the system will show you the next highlight\nexport const NEXT_BALL_HOLDER_TIME_RANGE = 1.8\nexport const LV_INTEREST_THRESHOLD = { off: 0.03, on: 0.6 }\n// // for lvSync\n// export const EXPLORE_MODE_THRESHOLD = 1500 // ms\n// // the highlight triggered by lvSync will exist for EXPLORE_STAY_THRESHOLD ms\nexport const EXPLORE_STAY_THRESHOLD = 1500\n// the min distance for an empty player, which means that if the distance between an offensor\n// and his closet defender is larger than EMPTY_SPACE_THRESHOLD, the system will think the offensor is an empty player\nexport const EMPTY_SPACE_THRESHOLD = 8\nexport const MAX_HIGHLIGHTED = 4 //{ S1: 2, S2: 3 }[LV_SYNC]\nexport const FOCUS = { min: 10, max: 630, mina: 0.2, maxa: 0.35 }","\nconst miniMapWidth = 360 * 1\nexport const miniMapSize: [number, number] = [miniMapWidth, miniMapWidth * 50 / 94]\nexport const COLORS = {\n    offense_inner_border: '#f5f5f5',\n    offense_bg_fill: '#f5f5f577',\n    offense_outer_border: 'rgba(220, 220, 220, 0.1)',\n    defense_bg_fill: `rgba(255, 255, 255, 0.15)`,\n    defense_fg_fill: `#f5f5f5`,\n    player_name: '#f5f5f5',\n    BG_MASK_ALPHA: 0.3,\n    FG_MASK_ALPHA: 0.2,\n    off_df_link: '255, 255, 255',\n    star_name: 'rgb(255, 243, 194)',\n    star_star: 'rgb(255, 243, 194)', // 'rgb(255,215,120)'\n} as const","export * from './players'\nexport * from './gaze'\nexport * from './style'\n\n// video players\nexport const VIDEO_ID_GROUPS = {\n    game2_unit0: [],\n    game1_unit0: [\n        // '0_,',\n        // '1_c,t',\n        // '2_c,l',\n        // '3_c,t',\n        '4_,',\n        '5_c,t',\n        '6_,',\n    ],\n    game1_unit1: [\n        '4_,',\n        '5_c,t',\n        '6_,',\n        '7_c,t',\n        '8_c,',\n        '9_c,t',\n        '10_,',\n        '11_c,t',\n        '12_,',\n        '13_c,t',\n        '14_c,',\n        '15_c,t',\n    ],\n    game1_unit2: [\n        '16_,',\n        '17_c,t',\n        '18_,l',\n        '19_c,t',\n        '20_,',\n        '21_c,t',\n        '22_,',\n        '23_c,t',\n        '24_,l',\n        '25_c,t',\n        '26_,l',\n        '27_,l',\n        '28_,l',\n        '30_,'\n    ],\n    game2_unit1: [\n        '0_,',\n        '1_c,t',\n        '2_,t',\n        '3_c,',\n        '4_c,t',\n        '5_c,',\n        '6_c,t',\n        '7_c,l',\n        '8_c,t',\n        '9_c,',\n        '10_c,t'\n    ],\n    game2_unit2: [\n        '11_,t',\n        '12_c,l',\n        '13_c,',\n        '14_c,t',\n        '15_c,',\n        '16_c,t',\n        '17_,l',\n        '18_c,t',\n        '19_,t',\n        '20_c,',\n        '21_c,t',\n        '22_c,l',\n        '23_c,t',\n        '24_,l',\n        '25_c,t',\n        '26_,',\n        '27_c,t',\n        '28_,',\n        '29_c,t',\n        '30_,t',\n        '31_c,',\n        '32_c,t',\n        '33_,t',\n        '34_c,',\n        '35_c,t',\n    ]\n} as const\n","/**\n * Basic geometry data type\n */\nexport interface Point {\n    readonly x: number\n    readonly y: number\n}\nexport type Route = [Point, Point, Point, Point]\n\nexport interface BBox {\n    readonly x: number;\n    readonly y: number;\n    readonly w: number;\n    readonly h: number\n}\n\nexport enum Side {\n    MIDDLE = 'MIDDLE',\n    LEFT = 'LEFT',\n    RIGHT = 'RIGHT'\n}\n\nexport enum Direction {\n    N = 'NORTH',\n    S = 'SOUTH',\n    E = 'EAST',\n    W = 'WEST',\n    NE = 'NORTH_EAST',\n    NW = 'NORTH_WEST',\n    SE = 'SOUTH_EAST',\n    SW = 'SOUTH_WEST'\n}\n","export * from './basic'\nexport * from './data'\nexport * from './ui'\nexport * from './database'\nexport * from './draw'\n\n// iball\nexport type Overwrite<T, U> = Pick<T, Exclude<keyof T, keyof U>> & U;\n\n/**\nCreate a type that requires exactly one of the given keys and disallows more. The remaining keys are kept as is.\nUse-cases:\n- Creating interfaces for components that only need one of the keys to display properly.\n- Declaring generic keys in a single place for a single use-case that gets narrowed down via `RequireExactlyOne`.\nThe caveat with `RequireExactlyOne` is that TypeScript doesn't always know at compile time every key that will exist at runtime. Therefore `RequireExactlyOne` can't do anything to prevent extra keys it doesn't know about.\n@example\n```\nimport {RequireExactlyOne} from 'type-fest';\ntype Responder = {\n    text: () => string;\n    json: () => string;\n    secure: boolean;\n};\nconst responder: RequireExactlyOne<Responder, 'text' | 'json'> = {\n    // Adding a `text` key here would cause a compile error.\n    json: () => '{\"message\": \"ok\"}',\n    secure: true\n};\n```\n@category Object\n*/\nexport type RequireExactlyOne<ObjectType, KeysType extends keyof ObjectType = keyof ObjectType> =\n    { [Key in KeysType]: (\n        Required<Pick<ObjectType, Key>> &\n        Partial<Record<Exclude<KeysType, Key>, never>>\n    ) }[KeysType] & Omit<ObjectType, KeysType>;\n\nexport enum TPlayerOption {\n    Far = 1,\n    Near = 0,\n    Both = -1\n}\n","export const DEBUG = {\n    OVERLAY: false,\n    COURT: true,\n    GAZE: false,\n    BBOX: false,\n    LINE: false,\n    ATTENTIONS: false,\n    TIMELINE: true,\n    MOUSE_GAZE: true,\n    DEBUG_MEM: false\n}","\nexport const COLORS = {\n    offense_inner_border: '#f5f5f5',\n    offense_bg_fill: '#f5f5f577',\n    offense_outer_border: 'rgba(220, 220, 220, 0.1)',\n    defense_bg_fill: `rgba(255, 255, 255, 0.15)`,\n    defense_fg_fill: `#f5f5f5`,\n    player_name: '#f5f5f5',\n    BG_MASK_ALPHA: 0.25,\n    FG_MASK_ALPHA: 0.2,\n    off_df_link: '255, 255, 255',\n    star_name: 'rgb(255, 243, 194)',\n    star_star: 'rgb(255, 243, 194)', // 'rgb(255,215,120)'\n} as const","export const extent = (d: number[]) => {\n  return [\n    Math.min(...d),\n    Math.max(...d)\n  ] as [number, number]\n}\n\nexport function standardDeviation(array?: number[]) {\n  if (!array || array.length === 0) return 0\n  const n = array.length\n  const mean = array.reduce((a, b) => a + b) / n\n  return Math.sqrt(array.map(x => Math.pow(x - mean, 2)).reduce((a, b) => a + b) / n)\n}\n\nexport function ArrayToDict<T, K extends keyof T>(arr: T[], key: K) {\n  return arr.reduce((o, f) => {\n    o[f[key] as any] = f\n    return o\n  }, {} as Record<string | number | symbol, T>)\n}\n\nexport function union<T>(setA: Set<T>, setB: Set<T>) {\n  const _union = new Set(setA);\n  for (const elem of setB) {\n    _union.add(elem);\n  }\n  return _union;\n}\n\n\nif (process.env.NODE_ENV !== 'production') {\n  (global as any).$RefreshReg$ = () => { };\n  (global as any).$RefreshSig$ = () => () => { };\n}","export async function wait(ms: number) {\n  return new Promise((resolve, reject) => {\n    setTimeout(resolve, ms)\n  })\n}\n\nexport async function waitUntil(checkFun: () => boolean, interval = 70) {\n  return new Promise(resolve => {\n    setInterval(() => {\n      if (checkFun())\n        resolve(null)\n    }, interval)\n  })\n}","function bytesToMB(bytes: number) {\n  return (bytes / 1024 / 1024).toFixed(2)\n}\n\nexport function debugMem() {\n  const memory: any = (performance as any).memory\n  console.debug(`Used / Total: ${bytesToMB(memory.usedJSHeapSize)}mb / ${bytesToMB(memory.totalJSHeapSize)}mb`)\n}\n\nexport function debugLog() {\n  return (target: any, prop: string, descriptior: PropertyDescriptor = Object.getOwnPropertyDescriptor(target, prop)!) => {\n    const originalMethod = descriptior.value;\n\n    if (descriptior.value[Symbol.toStringTag] === 'AsyncFunction') {\n      //editing the descriptor/value parameter\n      descriptior.value = async function (...args: any[]) {\n        // note usage of originalMethod here\n        console.group(`%c>>>>> Call:${prop}`, 'background: #222; color: #bada55');\n        const ret = await originalMethod.apply(this, args);\n        console.groupEnd()\n        // console.groupEnd(`%c<<<< End:${prop}`, 'background: #222; color: #bada55');\n        return ret\n      };\n\n    } else {\n      //editing the descriptor/value parameter\n      descriptior.value = function (...args: any[]) {\n        // note usage of originalMethod here\n        console.log(`%c>>>>> Call:${prop}`, 'background: #222; color: #bada55');\n        const ret = originalMethod.apply(this, args);\n        console.log(`%c<<<< End:${prop}`, 'background: #222; color: #bada55');\n        return ret\n      };\n    }\n\n    // return edited descriptor as opposed to overwriting the descriptor\n    return descriptior;\n  }\n}\n","import { Point } from \"../@types/basic\"\n\n/**\n * type grauding\n */\n// export function isEnitity(t: SpacyRet) {\n//     return t.ent_type !== '' || ['NOUN', 'VERB', 'AUX'].includes(t.pos) || t.tag.startsWith('VB') || t.coref?.some(r => r.ent_type)\n// }\n\nexport const isPoint = (p: any): p is Point => typeof p === 'object' &&\n    'x' in p &&\n    'y' in p &&\n    typeof p['x'] === 'number' &&\n    typeof p['y'] === 'number' ","let _intervalIdGen = 0\nexport function intervalIdGen() {\n    return ++_intervalIdGen\n}\n\nexport function getHash(input: string) {\n    let hash = 0, len = input.length;\n    for (var i = 0; i < len; i++) {\n        hash = ((hash << 5) - hash) + input.charCodeAt(i);\n        hash |= 0; // to 32bit integer\n    }\n    return hash;\n}","import { BaseVideo } from \"../@types\"\n\nexport async function getImg(src: string) {\n  const img = new Image()\n  img.src = src\n  await new Promise(resolve => {\n    img.onload = e => {\n      URL.revokeObjectURL(src)\n      resolve(undefined)\n    }\n  })\n  return img\n}\n\nexport function globalFIdxToLocal<GameID extends string, VideoID extends string>(globalFrameIdx: number, videos: BaseVideo<GameID, VideoID>[]) {\n  let accFrame = 0\n  let videoIdx = 0\n  for (videoIdx = 0; videoIdx < videos.length; ++videoIdx) {\n    const video = videos[videoIdx]\n    if (globalFrameIdx >= accFrame && globalFrameIdx < accFrame + video.maxFrame) {\n      break\n    } else {\n      accFrame += video.maxFrame\n    }\n  }\n  const newCurFrameIdx = globalFrameIdx - accFrame\n  return { videoIdx, frameIdx: newCurFrameIdx }\n}\n\nexport function localFIdxToGlobalFIdx<GameID extends string, VideoID extends string>(videoIdx: number, localFIdx: number, videos: BaseVideo<GameID, VideoID>[]) {\n  let accFrameIdx = 0\n  for (let i = 0; i < videoIdx; ++i)\n    accFrameIdx += videos[i].maxFrame\n  return accFrameIdx + localFIdx\n}\n","import { Point } from \"../@types\"\n\nexport const arr2Point = (arr: [number, number]): Point => ({ x: arr[0], y: arr[1] })\n\nexport const distPoints = (p1: Point, p2: Point) => {\n\n    const dx = p1.x - p2.x\n    const dy = p1.y - p2.y\n\n    return Math.sqrt(dx * dx + dy * dy)\n}\n\nexport const diffPoints = (p1: Point, p2: Point) => ({ x: p1.x - p2.x, y: p1.y - p2.y })\nexport const addPoints = (p1: Point, p2: Point) => ({ x: p1.x + p2.x, y: p1.y + p2.y })\nexport const centerOfPoints = (points: Point[] | Array<[number, number]>): Point => {\n    if (typeof points[0] === 'object') {\n        const oPoints: Point[] = points as Point[]\n        return {\n            x: oPoints.reduce((o, p) => o + p.x, 0) / oPoints.length,\n            y: oPoints.reduce((o, p) => o + p.y, 0) / oPoints.length,\n        }\n    }\n    const aPoints: Array<[number, number]> = points as Array<[number, number]>\n    return {\n        x: aPoints.reduce((o, p) => o + p[0], 0) / aPoints.length,\n        y: aPoints.reduce((o, p) => o + p[1], 0) / aPoints.length,\n    }\n}\n\nexport const extendCrossLine = (from: Point, to: Point, extend: number = 0): Point => {\n    let k = (to.y - from.y) / (to.x - from.x)\n    k = -1 / k\n\n    const center = centerOfPoints([from, to])\n\n    const theta = Math.atan(k)\n    const dy = Math.abs(extend * Math.sin(theta))\n    const dx = Math.abs(extend * Math.cos(theta))\n\n    const direc = (extend / Math.abs(extend)) || 0\n\n    return { x: center.x + direc * dx, y: center.y + direc * dy }\n}\n\nexport const extendLine = (from: Point, to: Point, extend: number = 0): Point => {\n\n    const k = (to.y - from.y) / (to.x - from.x)\n\n    const theta = Math.atan(k)\n    const dy = Math.abs(extend * Math.sin(theta))\n    const dx = Math.abs(extend * Math.cos(theta))\n\n    const direcX = (extend / Math.abs(extend)) || 0 //((to.x - from.x) / Math.abs(to.x - from.x)) || 0\n    const direcY = direcX //((to.y - from.y) / Math.abs(to.y - from.y)) || 0\n\n    return { x: to.x + direcX * dx, y: to.y + direcY * dy }\n}\n// perpendicular line\nexport const crossLine = (from: Point, to: Point, extend: number = 0): Point => {\n    const k = (to.y - from.y) / (to.x - from.x)\n    const k2 = -1 / k\n    const theta = Math.atan(k2)\n    const cP = centerOfPoints([from, to])\n\n    const dy = Math.abs(extend * Math.sin(theta))\n    const dx = Math.abs(extend * Math.cos(theta))\n\n    const direcX = ((to.x - from.x) / Math.abs(to.x - from.x)) || 0\n    const direcY = ((to.y - from.y) / Math.abs(to.y - from.y)) || 0\n\n    return { x: cP.x + direcX * dx, y: cP.y + -direcY * dy }\n\n}\n\nconst getLineFromPoints = (line: [Point, Point]) => {\n    const k = (line[1].y - line[0].y) / (line[1].x - line[0].x)\n    const b = line[0].y - k * line[0].x\n\n    return { k, b }\n}\n\n\nexport const intersectionOf2Lin = (line1: [Point, Point], line2: [Point, Point]): Point => {\n    const { k: k1, b: b1 } = getLineFromPoints(line1)\n    const { k: k2, b: b2 } = getLineFromPoints(line2)\n\n    // console.debug(`\n    //   ${line1[0].y} = ${k1 * line1[0].x + b1}\n    //   ${line1[1].y} = ${k1 * line1[1].x + b1}\n\n    //   ${line2[0].y} = ${k2 * line2[0].x + b2}\n    //   ${line2[1].y} = ${k2 * line2[1].x + b2}\n    // `)\n\n    const xi = (b2 - b1) / (k1 - k2)\n    const yi = k1 * xi + b1\n\n    // console.debug(`\n    //   line1: (${line1[0].x},${line1[0].y}) (${line1[1].x},${line1[1].y})\n    //   line2: (${line2[0].x},${line2[0].y}) (${line2[1].x},${line2[1].y})\n    // `)\n    // console.debug(`\n    //   xi: ${xi}, yi: ${yi}\n    // `)\n\n    return { x: xi, y: yi }\n}\n\n\nexport const atan2Normalized = (y: number, x: number) => {\n    var result = Math.atan2(y, x);\n    if (result < 0) {\n        result += (2 * Math.PI);\n    }\n    return result;\n}\n\nexport function getAngle(x1: number, y1: number, x2: number, y2: number) {\n    const [dx, dy] = [x2 - x1, y2 - y1]\n    let radians = (dx || dy)\n        ? Math.atan2(dy, dx)\n        : 0\n    if (radians < 0) radians += 2 * Math.PI\n    return radians * (180 / Math.PI)\n}\n\n// Return: Close approximation of the length of a Cubic Bezier curve\n//\n// Ax,Ay,Bx,By,Cx,Cy,Dx,Dy: the 4 control points of the curve\n// sampleCount [optional, default=40]: how many intervals to calculate\n// Requires: cubicQxy (included below)\n//\nexport function cubicBezierLength(A: Point, B: Point, C: Point, D: Point, sampleCount = 40) {\n    var ptCount = sampleCount;\n    var totDist = 0;\n    var lastX = A.x;\n    var lastY = A.y;\n    var dx, dy;\n    for (var i = 1; i < ptCount; i++) {\n        var pt = cubicQxy(i / ptCount, A.x, A.y, B.x, B.y, C.x, C.y, D.x, D.y);\n        dx = pt.x - lastX;\n        dy = pt.y - lastY;\n        totDist += Math.sqrt(dx * dx + dy * dy);\n        lastX = pt.x;\n        lastY = pt.y;\n    }\n    dx = D.x - lastX;\n    dy = D.y - lastY;\n    totDist += Math.sqrt(dx * dx + dy * dy);\n    return Math.floor(totDist);\n}\n\n\n// Return: an [x,y] point along a cubic Bezier curve at interval T\n//\n// Attribution: Stackoverflow's @Blindman67\n// Cite: http://stackoverflow.com/questions/36637211/drawing-a-curved-line-in-css-or-canvas-and-moving-circle-along-it/36827074#36827074\n// As modified from the above citation\n// \n// t: an interval along the curve (0<=t<=1)\n// ax,ay,bx,by,cx,cy,dx,dy: control points defining the curve\n//\nfunction cubicQxy(t: number, ax: number, ay: number, bx: number, by: number, cx: number, cy: number, dx: number, dy: number) {\n    ax += (bx - ax) * t;\n    bx += (cx - bx) * t;\n    cx += (dx - cx) * t;\n    ax += (bx - ax) * t;\n    bx += (cx - bx) * t;\n    ay += (by - ay) * t;\n    by += (cy - by) * t;\n    cy += (dy - cy) * t;\n    ay += (by - ay) * t;\n    by += (cy - by) * t;\n    return ({\n        x: ax + (bx - ax) * t,\n        y: ay + (by - ay) * t\n    });\n}\n\n// cubic bezier percent is 0-1\nexport function getCubicBezierXYatPercent(startPt: Point, controlPt1: Point,\n    controlPt2: Point, endPt: Point, percent: number) {\n    const x = CubicN(percent, startPt.x, controlPt1.x, controlPt2.x, endPt.x);\n    const y = CubicN(percent, startPt.y, controlPt1.y, controlPt2.y, endPt.y);\n    return ({ x: x, y: y });\n}\n\n// cubic helper formula at percent distance\nfunction CubicN(pct: number, a: number, b: number, c: number, d: number) {\n    var t2 = pct * pct;\n    var t3 = t2 * pct;\n    return a + (-a * 3 + pct * (3 * a - a * pct)) * pct\n        + (3 * b + pct * (-6 * b + b * 3 * pct)) * pct\n        + (c * 3 - c * 3 * pct) * t2\n        + d * t3;\n}","export function wrapWorker<In extends unknown[], Out>(\n  workerFunc: { new(): Worker },\n  key: string,\n  cb?: (...args: any[]) => void): (...args: In) => Promise<Out> {\n  const worker = new workerFunc()\n  return async (...args: In) => {\n    worker.postMessage([key, ...args])\n\n    return await new Promise<Out>(resolve => {\n      const handler = (e: MessageEvent<any>) => {\n        if (e.data[0] !== key) {\n          cb?.(e.data)\n          return\n        }\n        worker.removeEventListener('message', handler)\n        resolve(e.data[1])\n      }\n      worker.addEventListener('message', handler)\n    })\n  }\n}","import { Overwrite } from \"common/@types\"\nimport type { PlayerID, VideoID } from \"./index\"\n\nexport enum PLAYER_STATUS {\n  offensive = 'in_offensive',\n  defensive = 'in_defensive',\n  other = 'in_other'\n}\nexport interface OffensivePkg {\n  mode: PLAYER_STATUS.offensive\n  region: string\n  diff: number\n  eDiff: number\n  freq: number\n  regionRate: number\n  regionExp: number\n  smoothRegionExp: number\n  inOffsensiveCourt: boolean\n}\nexport interface DefensivePkg {\n  mode: PLAYER_STATUS.defensive\n  defendingPlayer: PlayerID\n  tangle: number\n  tdist: number\n  diff: number\n  smoothDFdiff: number\n  speed: number\n  freq: number\n}\nexport type DataPkg = OffensivePkg | DefensivePkg\n\nexport interface FrameStamp {\n  videoId: VideoID\n  fIdx: number\n  ts: number\n}\n\nexport interface Gaze extends FrameStamp {\n  x: number,\n  y: number\n}\n\nexport type AttentionWeights = { att: number, looked: boolean, on: boolean }\n\n// Partial<Record<PlayerId, { att: number, looked: boolean, on: boolean }>>\nexport interface Attentions {\n  lastTs: number\n  fIdx: number\n  videoId?: VideoID\n  players: Partial<Record<PlayerID, AttentionWeights>>\n}\n\nexport type HighlightWeights = Partial<Record<PlayerID, { lostTs: number, sync: boolean }>>\nexport interface Highlights {\n  lastTs: number\n  players: HighlightWeights\n}\n\nexport interface DefenseRecord {\n  PLAYER_ID: PlayerID\n  DEFENSE_CATEGORY: string,\n  FREQ: number,\n  D_FGM: number,\n  D_FGA: number,\n  D_FG_PCT: number,\n  NORMAL_FG_PCT: number,\n  PCT_PLUSMINUS: number,\n  AVG_DEF_SPEED: number\n}\n\nexport enum KeyPlayerType {\n  BALL_HOLDER = 0,\n  NEXT_BALL_HOLDER = 1,\n  EMPTY_PLAYER = 2,\n  STAR = 3,\n}\nexport interface KeyPlayer {\n  id: PlayerID\n  last: { progress: number, status: 'enter' | 'update' | 'exit' } // in frames, exist when NEXT_BALL_HOLDER\n  type: KeyPlayerType\n}\nexport enum Lv2PlayerType {\n  Interest = 1,\n  Normal = 2,\n  Normal_Interest = 3,\n}\nexport interface Lv2Player extends Partial<AttentionWeights> {\n  id: PlayerID\n  type: Set<Lv2PlayerType>\n}\n\nexport type CachePlayerBin = Overwrite<PlayerShotBin, {\n  region: { AREA: string, BASIC: string, RANGE: string }\n}>\n\nexport interface ShotRecord {\n  // shot_id: string\n  // ACTION_TYPE: string\n  // EVENT_TYPE: string // \"Missed Shot\"\n  GAME_EVENT_ID: string // \"555\"\n  GAME_ID: string // \"21500030\"\n  // GRID_TYPE: string //\"Shot Chart Detail\"\n  // HTM: string //\"HOU\"\n  LOC_X: number //\"-68\"\n  LOC_Y: number // \"242\"\n  // MINUTES_REMAINING: number //\"3\"\n  // PERIOD: number //\"4\"\n  PLAYER_ID: PlayerID //\"203546\"\n  // PLAYER_NAME: string //\"Ian Clark\"\n  // SECONDS_REMAINING: number // \"18\"\n  // SHOT_ATTEMPTED_FLAG: string // \"1\"\n  // SHOT_DISTANCE: number // \"25\"\n  made: number // \"0\"\n  // SHOT_TYPE: string //\"3PT Field Goal\"\n  SHOT_ZONE: { AREA: string, BASIC: string, RANGE: string }\n  // _AREA: string //\"Center(C)\"\n  // SHOT_ZONE_BASIC: string // \"Above the Break 3\"\n  // SHOT_ZONE_RANGE: string //\"24+ ft.\"\n  // TEAM_ID: number //\"1610612744\"\n  // VTM: string //\"GSW\"\n}\n\nexport type PlayerShotBin = {\n  region: string\n  regionRate: number\n  regionFreq: number // freq in this bin by region\n  regionExp: number // expect point value\n  diff: number // ergion diff to league average\n  eDiff: number\n  x: number\n  y: number\n}","import { COLORS } from \"../@const/draw\";\nimport { Layer } from \"../@types\";\n\nfunction drawRawFrame(layer: Layer, frame: CanvasImageSource, darkenAlpha = 0.1) {\n    const { width, height } = layer.canvas\n    layer.ctx.drawImage(frame, 0, 0, width, height);\n\n    if (darkenAlpha !== 0) {\n        drawOverlay(layer, darkenAlpha)\n    }\n}\n\nfunction drawOverlay(layer: Layer, alpha: number = COLORS.BG_MASK_ALPHA) {\n    const { ctx, canvas } = layer\n    const { width, height } = canvas\n\n    ctx.save()\n    ctx.fillStyle = `rgba(0, 0, 0, ${alpha})`;\n    ctx.fillRect(0, 0, width, height);\n    ctx.restore()\n}\n\nfunction fadeOutLayer(layer: Layer, alpha: number) {\n    layer.ctx.save()\n    layer.ctx.globalAlpha = alpha\n    layer.ctx.globalCompositeOperation = 'copy';\n    layer.ctx.drawImage(layer.canvas, 0, 0)\n    layer.ctx.restore()\n}\n\n\nexport {\n    drawRawFrame as bg,\n    drawOverlay as overlay,\n    fadeOutLayer as fadeOutFrame\n}","import type { Layer } from \"../@types/draw\";\nimport type { BasePlayer } from \"../@types/data\";\nimport type { Point } from \"../@types/basic\";\nimport { fadeOutFrame } from './frame'\n\nfunction drawBall(layer: Layer, ball?: Point, trail = false) {\n\n  const { width, height } = layer.canvas\n  if (trail) {\n    fadeOutFrame(layer, 0.9)\n  } else {\n    layer.ctx.clearRect(0, 0, width, height)\n  }\n\n  if (ball) {\n    const { x: cx, y: cy } = ball\n    layer.ctx.beginPath()\n    layer.ctx.lineWidth = 3\n    layer.ctx.strokeStyle = 'steelblue'\n    layer.ctx.fillStyle = 'rgba(236, 240, 241, 1)'\n    layer.ctx.arc(cx, cy, 5, 0, 2 * Math.PI)\n    layer.ctx.fill()\n    layer.ctx.stroke()\n  }\n}\n\nconst internalCanvas = document.createElement('canvas')\nconst internalCtx = internalCanvas.getContext('2d')!\nfunction drawFullBrightPlayers<PlayerID extends number>(layer: Layer,\n  frame: CanvasImageSource,\n  mask: CanvasImageSource,\n  players: BasePlayer<PlayerID>[],\n  glow: boolean = true\n) {\n  const { ctx } = layer\n  const { width, height } = layer.canvas\n\n  // mask get full bright players\n  internalCanvas.width = width\n  internalCanvas.height = height\n  internalCtx.save()\n  internalCtx.drawImage(mask, 0, 0)\n  internalCtx.globalCompositeOperation = 'source-in'\n  internalCtx.drawImage(frame, 0, 0)\n  internalCtx.restore()\n\n  ctx.save()\n  if (glow) {\n    ctx.shadowBlur = 30\n    ctx.shadowColor = 'rgba(255, 255, 255, 0.5)';\n  }\n  players\n    .forEach(player => {\n      const { x, y, w, h } = player.bbox\n      ctx.drawImage(internalCanvas,\n        x, y, w, h,\n        x, y, w, h)\n    })\n  ctx.restore()\n\n}\n\nexport {\n  drawBall as ball,\n  drawFullBrightPlayers as fullbrightPlayers,\n}\n","import type { Point, Route } from \"../@types\"\n\ninterface Style {\n  fillStyle?: string | CanvasGradient | CanvasPattern | { pattern: CanvasPattern, opacity: number }\n  lineWidth?: number\n  strokeStyle?: string\n  font?: string\n  textBaseline?: CanvasTextBaseline\n  lineCap?: CanvasLineCap\n  lineJoin?: CanvasLineJoin\n}\ntype Entries<T> = {\n  [K in keyof T]: [K, T[K]]\n}[keyof T][]\n\n// type Style = Partial<Pick<CanvasRenderingContext2D, 'fillStyle' | 'strokeStyle' | 'lineWidth' | 'font' | 'textBaseline'>>\n\nfunction entries<T extends {}>(obj: T): Entries<T> {\n  return Object.entries(obj) as any;\n}\n\nfunction applyStyle(ctx: CanvasRenderingContext2D, style: Style = {}) {\n  entries(style).forEach((e) => {\n    if (e?.[0] === 'lineWidth' && e[1] !== undefined) {\n      ctx.lineWidth = e[1] // value\n    }\n    if (e?.[0] === 'strokeStyle' && e[1] !== undefined) {\n      ctx.strokeStyle = e[1]//value\n    }\n    if (e?.[0] === 'font' && e[1]) {\n      ctx.font = e[1]\n    }\n    if (e?.[0] === 'textBaseline' && e[1]) {\n      ctx.textBaseline = e[1]\n    }\n    if (e?.[0] === 'lineCap' && e[1]) {\n      ctx.lineCap = e[1]\n    }\n    if (e?.[0] === 'lineJoin' && e[1]) {\n      ctx.lineJoin = e[1]\n    }\n  })\n\n  if (style.fillStyle) {\n    const value = style.fillStyle\n    if (typeof value === 'object' && 'pattern' in value && 'opacity' in value) {\n      ctx.fillStyle = value.pattern\n      ctx.globalAlpha = value.opacity;\n    } else {\n      ctx.fillStyle = value\n    }\n  }\n}\n\nfunction drawLine(ctx: CanvasRenderingContext2D, sx: number, sy: number, dx: number, dy: number, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n  ctx.beginPath()\n  ctx.moveTo(sx, sy)\n  ctx.lineTo(dx, dy)\n  ctx.stroke()\n}\n\nfunction drawHLine(ctx: CanvasRenderingContext2D, sx: number, sy: number, dx: number, style: Style = {}) {\n  drawLine(ctx, sx, sy, dx, sy, style)\n}\n\nfunction drawPolygon(ctx: CanvasRenderingContext2D, points: Point[], style?: Style): void;\nfunction drawPolygon(ctx: CanvasRenderingContext2D, points: [number, number][], style?: Style): void;\nfunction drawPolygon(ctx: CanvasRenderingContext2D, points: [number, number][] | Point[], style: Style = {}): void {\n\n  if (points.length === 0) return\n  const pointsToDraw: [number, number][] = Array.isArray(points[0])\n    ? points as [number, number][]\n    : (points as Point[]).map(p => ([p.x, p.y])) as [number, number][]\n\n  let [x, y] = pointsToDraw[0]\n\n  ctx.save()\n  applyStyle(ctx, style)\n\n  ctx.beginPath()\n  ctx.moveTo(x, y)\n  for (let i = 1, len = pointsToDraw.length; i < len; ++i) {\n    ([x, y] = pointsToDraw[i]);\n    ctx.lineTo(x, y)\n  }\n  ctx.closePath();\n  ctx.stroke()\n\n  ctx.fill();\n  ctx.restore()\n}\n\n\nfunction drawPolyline(ctx: CanvasRenderingContext2D, points: [number, number][] | Point[], style: Style = {}): void {\n\n  if (points.length === 0) return\n  const pointsToDraw: [number, number][] = Array.isArray(points[0])\n    ? points as [number, number][]\n    : (points as Point[]).map(p => ([p.x, p.y])) as [number, number][]\n\n  let [x, y] = pointsToDraw[0]\n\n  ctx.save()\n  applyStyle(ctx, style)\n\n  ctx.beginPath()\n  ctx.moveTo(x, y)\n  for (let i = 1, len = pointsToDraw.length; i < len; ++i) {\n    ([x, y] = pointsToDraw[i]);\n    ctx.lineTo(x, y)\n  }\n  // ctx.closePath();\n  ctx.stroke()\n\n  // ctx.fill();\n  ctx.restore()\n}\n\n\nfunction drawCurve(ctx: CanvasRenderingContext2D, route: Route, style: Style = {}) {\n\n  ctx.save()\n  applyStyle(ctx, style)\n\n  ctx.beginPath();\n  ctx.moveTo(route[0].x, route[0].y)\n  ctx.bezierCurveTo(\n    route[1].x, route[1].y,\n    route[2].x, route[2].y,\n    route[3].x, route[3].y\n  )\n  ctx.stroke()\n  // ctx.fill();\n  ctx.restore()\n  // ctx.fillStyle = ctx.strokeStyle\n  // triangleAt(ctx, route[2], route[3], 10)\n}\n\nfunction triangleAt(ctx: CanvasRenderingContext2D, from: Point, center: Point, r: number, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n\n  // draw arrow\n  let x_center = center.x;\n  let y_center = center.y;\n\n  let angle, x, y\n  ctx.beginPath();\n\n  angle = Math.atan2(center.y - from.y, center.x - from.x)\n  x_center -= r * Math.cos(angle);\n  y_center -= r * Math.sin(angle);\n  x = r * Math.cos(angle) + x_center\n  y = r * Math.sin(angle) + y_center\n  ctx.moveTo(x, y);\n\n  angle += (1 / 3) * (2 * Math.PI)\n  x = r * Math.cos(angle) + x_center\n  y = r * Math.sin(angle) + y_center\n  ctx.lineTo(x, y);\n\n  angle += (1 / 3) * (2 * Math.PI)\n  x = r * Math.cos(angle) + x_center\n  y = r * Math.sin(angle) + y_center\n  ctx.lineTo(x, y);\n\n  ctx.closePath();\n\n\n  ctx.fill();\n  ctx.restore()\n}\n\ninterface ArrowParams {\n  from: Point\n  to: Point\n  arrowSize: number\n  z?: boolean\n  double?: boolean\n}\nfunction drawArrow(ctx: CanvasRenderingContext2D, { from, to, arrowSize, z = false, double = false }: ArrowParams, style: Style = {}) {\n  // draw line\n  ctx.save()\n  applyStyle(ctx, style)\n\n  if (z) {\n    ctx.transform(1, 0, -0.2, .8, from.x, from.y);\n  }\n  const nFrom = z ? { x: 0, y: 0 } : from\n  const nTo = z ? { x: to.x - from.x, y: to.y - from.y } : to\n\n  if (double) {\n    triangleAt(ctx, nTo, nFrom, arrowSize, style)\n  }\n\n  ctx.beginPath();\n  const angle = Math.atan2(nTo.y - nFrom.y, nTo.x - nFrom.x)\n  ctx.moveTo(nFrom.x + arrowSize * Math.cos(angle), nFrom.y + arrowSize * Math.sin(angle));\n  ctx.lineTo(nTo.x - arrowSize * Math.cos(angle), nTo.y - arrowSize * Math.sin(angle));\n  ctx.stroke();\n  ctx.fill();\n\n  triangleAt(ctx, nFrom, nTo, arrowSize, style)\n  ctx.restore()\n}\n\ninterface CircleParams {\n  x: number, y: number, r: number, angle?: number, z?: boolean\n}\nfunction drawCircle(ctx: CanvasRenderingContext2D, { x, y, r, angle = 2 * Math.PI, z = false }: CircleParams, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n\n  if (z) {\n    ctx.transform(1, 0, -0.2, .5, x, y);\n  }\n  x = z ? 0 : x\n  y = z ? 0 : y\n\n  ctx.beginPath();\n  ctx.arc(x, y, r, 0, angle)\n  ctx.lineTo(x, y)\n\n  ctx.stroke()\n  ctx.fill();\n\n  ctx.restore()\n}\n\ninterface RingParams extends CircleParams {\n  r2: number\n}\nfunction drawRing(ctx: CanvasRenderingContext2D, { x, y, r, r2, angle = 2 * Math.PI, z = false }: RingParams, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n\n  // draw outer\n  drawCircle(ctx, { x, y, r: r2, angle, z })\n\n  // cut inner\n  ctx.globalCompositeOperation = 'destination-out'\n  drawCircle(ctx, { x, y, r, angle, z })\n\n  ctx.restore()\n}\n\ninterface RoundedRectParams {\n  x: number\n  y: number\n  w: number\n  h: number\n  r: number\n  z?: boolean\n}\nfunction drawRoundedRect(ctx: CanvasRenderingContext2D, { x, y, w, h, r, z = false }: RoundedRectParams, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n\n  if (z) {\n    ctx.transform(1, 0, -0.1, .9, x, y);\n  }\n  x = z ? 0 : x\n  y = z ? 0 : y\n\n  if (w < 2 * r) r = w / 2;\n  if (h < 2 * r) r = h / 2;\n  ctx.beginPath();\n  ctx.moveTo(x + r, y);\n  ctx.arcTo(x + w, y, x + w, y + h, r);\n  ctx.arcTo(x + w, y + h, x, y + h, r);\n  ctx.arcTo(x, y + h, x, y, r);\n  ctx.arcTo(x, y, x + w, y, r);\n  ctx.closePath();\n\n  ctx.stroke()\n  ctx.fill();\n\n  ctx.restore()\n}\n\ninterface TextParams {\n  x: number,\n  y: number,\n  text: string\n  z?: boolean\n}\n/**\n * use top left as the default baseline\n * @param ctx \n * @param param1 \n * @param style \n */\nfunction drawText(ctx: CanvasRenderingContext2D, { x, y, text, z = false }: TextParams, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n  ctx.textBaseline = 'top'\n\n  if (z) {\n    ctx.transform(1, 0, -0.1, .9, x, y);\n  }\n  x = z ? 0 : x\n  y = z ? 0 : y\n\n  ctx.strokeText(text, x, y)\n  ctx.fillText(text, x, y)\n  ctx.restore()\n}\n\ninterface ConeParams {\n  x: number\n  y: number\n  r: number\n  h: number\n  r1?: number\n}\ntype Point3D = [number, number, number]\nfunction drawCone(ctx: CanvasRenderingContext2D, { x, y, r, h, r1 = 0 }: ConeParams, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n\n  const dAlpha = 0.1;\n\n  const nodes: Point3D[] = [\n    // [0, -h, 0]\n  ];\n  const uNodes: Point3D[] = []\n\n  const faces: [Point3D, Point3D, Point3D, Point3D][] = [];\n  //creating nodes\n  let alpha = 0;\n  // let i = 1;\n  for (let i = 0; alpha <= 2 * Math.PI + dAlpha; ++i) {\n    // while () {\n    let x = r * Math.cos(alpha);\n    let z = r * Math.sin(alpha);\n    nodes[i] = [x, 0, z];\n    alpha += dAlpha;\n\n    x = r1 * Math.cos(alpha);\n    z = r1 * Math.sin(alpha);\n    uNodes[i] = [x, -(1 - r1 / r) * h, z];\n  }\n\n  //creating faces\n  let p = 0;\n  for (let n = 0; n < nodes.length - 1; n++) {\n    let face: [Point3D, Point3D, Point3D, Point3D] = [uNodes[p], nodes[p], nodes[p + 1], uNodes[p + 1]];\n    faces[n] = face;\n    p += 1;\n  }\n\n  // Rotate shape around the x-axis\n  function rotateX3D(theta: number) {\n    const sinTheta = Math.sin(-theta);\n    const cosTheta = Math.cos(-theta);\n\n    for (let n = 0; n < nodes.length; n++) {\n      let node = nodes[n];\n      let y = node[1];\n      let z = node[2];\n      node[1] = y * cosTheta - z * sinTheta;\n      node[2] = z * cosTheta + y * sinTheta;\n\n      node = uNodes[n];\n      y = node[1];\n      z = node[2];\n      node[1] = y * cosTheta - z * sinTheta;\n      node[2] = z * cosTheta + y * sinTheta;\n    }\n  }\n\n  //rotateZ3D(10 * Math.PI / 180);\n  rotateX3D((20 * Math.PI) / 180);\n\n  ctx.translate(x, y);\n\n  // Draw faces\n  for (let i = 0; i < faces.length; i++) {\n    const [v0, v1, v2, v3] = faces[i]\n    ctx.beginPath();\n    ctx.moveTo(v0[0], v0[1]);\n    ctx.lineTo(v1[0], v1[1]);\n    ctx.lineTo(v2[0], v2[1]);\n    ctx.lineTo(v3[0], v3[1]);\n    ctx.lineTo(v0[0], v0[1]);\n    ctx.fill();\n    // ctx.stroke();\n    ctx.closePath();\n  }\n\n  ctx.restore()\n}\n\ninterface LabelParams {\n  x: number,\n  y: number,\n  w: number, h: number,\n  text: string\n}\nfunction drawLabel(ctx: CanvasRenderingContext2D, { x, y, w, h, text }: LabelParams, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n\n  ctx.beginPath()\n  ctx.moveTo(x, y);\n  ctx.lineTo(x + 100, y - 50)\n  ctx.stroke()\n\n  ctx.rect(x + 100, y - 50, w, h)\n  ctx.stroke()\n  ctx.fillStyle = '#fff'\n  ctx.fill()\n  applyStyle(ctx, style)\n\n  // ctx.strokeText(text, x + 110, y - 50)\n  ctx.fillText(text, x + 105, y - 50 + 5)\n  ctx.restore()\n}\n\n\nexport {\n  drawLine as line,\n  drawHLine as hLine,\n  drawPolygon as polygon,\n  drawPolyline as polyline,\n  drawArrow as arrow,\n  drawCurve as curve,\n  drawCircle as circle,\n  drawRing as ring,\n  drawRoundedRect as roundedRect,\n  drawText as text,\n  drawCone as cone,\n  drawLabel as label,\n}\n\n/**\n * Draws a cardinal spline through given point array. Points must be arranged\n * as: [x1, y1, x2, y2, ..., xn, yn]. It adds the points to the current path.\n *\n * The method continues previous path of the context. If you don't want that\n * then you need to use moveTo() with the first point from the input array.\n *\n * The points for the cardinal spline are returned as a new array.\n *\n * @param {CanvasRenderingContext2D} ctx - context to use\n * @param {Array} points - point array\n * @param {Number} [tension=0.5] - tension. Typically between [0.0, 1.0] but can be exceeded\n * @param {Number} [numOfSeg=20] - number of segments between two points (line resolution)\n * @param {Boolean} [close=false] - Close the ends making the line continuous\n * @returns {Float32Array} New array with the calculated points that was added to the path\n */\nexport function _curve(ctx: CanvasRenderingContext2D, _points: Point[], tension: number = 0.5, numOfSeg: number = 20, close: boolean = false) {\n  const points = _points.flatMap(p => ([p.x, p.y]))\n\n  // let i = 1,\n  let l = points.length,\n    rPos = 0,\n    rLen = (l - 2) * numOfSeg + 2 + (close ? 2 * numOfSeg : 0),\n    res = new Float32Array(rLen);\n\n  let pts = [...points];\n  if (close) {\n    pts.unshift(points[l - 1]);\t\t\t\t// insert end point as first point\n    pts.unshift(points[l - 2]);\n    pts.push(points[0], points[1]); \t\t// first point as last point\n  } else {\n    pts.unshift(points[1]);\t\t\t\t\t// copy 1. point and insert at beginning\n    pts.unshift(points[0]);\n    pts.push(points[l - 2], points[l - 1]);\t// duplicate end-points\n  }\n\n  // cache inner-loop calculations as they are based on t alone\n  const cache = new Float32Array((numOfSeg + 2) * 4)\n  let cachePtr = 4;\n  cache[0] = 1;\t\t\t\t\t\t\t\t// 1,0,0,0\n  for (let i = 1; i < numOfSeg; i++) {\n    let st = i / numOfSeg,\n      st2 = st * st,\n      st3 = st2 * st,\n      st23 = st3 * 2,\n      st32 = st2 * 3;\n\n    cache[cachePtr++] = st23 - st32 + 1;\t// c1\n    cache[cachePtr++] = st32 - st23;\t\t// c2\n    cache[cachePtr++] = st3 - 2 * st2 + st;\t// c3\n    cache[cachePtr++] = st3 - st2;\t\t\t// c4\n  }\n  cache[++cachePtr] = 1;\t\t\t\t\t\t// 0,1,0,0\n\n  // calc. points\n  parse(pts, cache, points.length);\n\n  if (close) {\n    //l = points.length;\n    pts = [];\n    pts.push(points[l - 4], points[l - 3], points[l - 2], points[l - 1]); // second last and last\n    pts.push(points[0], points[1], points[2], points[3]); // first and second\n    parse(pts, cache, 4);\n  }\n\n  function parse(pts: number[], cache: Float32Array, l: number) {\n\n    for (let i = 2, t; i < l; i += 2) {\n\n      let pt1 = pts[i],\n        pt2 = pts[i + 1],\n        pt3 = pts[i + 2],\n        pt4 = pts[i + 3],\n\n        t1x = (pt3 - pts[i - 2]) * tension,\n        t1y = (pt4 - pts[i - 1]) * tension,\n        t2x = (pts[i + 4] - pt1) * tension,\n        t2y = (pts[i + 5] - pt2) * tension;\n\n      for (t = 0; t < numOfSeg; t++) {\n\n        var c = t << 2, //t * 4;\n\n          c1 = cache[c],\n          c2 = cache[c + 1],\n          c3 = cache[c + 2],\n          c4 = cache[c + 3];\n\n        res[rPos++] = c1 * pt1 + c2 * pt3 + c3 * t1x + c4 * t2x;\n        res[rPos++] = c1 * pt2 + c2 * pt4 + c3 * t1y + c4 * t2y;\n      }\n    }\n  }\n\n  // add last point\n  l = close ? 0 : points.length - 2;\n  res[rPos++] = points[l];\n  res[rPos] = points[l + 1];\n\n  // add lines to path\n  ctx.moveTo(points[0], points[1]);\n  for (let i = 0, len = res.length; i < len; i += 2) {\n    ctx.lineTo(res[i], res[i + 1]);\n  }\n  // stroke path\n  ctx.stroke();\n\n  return res;\n}","import { Point } from 'common/@types'\nimport { getAngle } from \"common/@utils\";\n\nimport { PLAYER_META, COLORS, FOCUS, LV_INTEREST_THRESHOLD } from \"@const\";\nimport { PlayerID, KeyPlayer, KeyPlayerType, Lv2Player, Lv2PlayerType, Player } from \"@types\";\n\nimport * as _draw from 'common/@draw'\nimport { EnabledFeatures } from 'App';\n\nexport interface VisRing {\n  cx: number,\n  cy: number,\n  fill: string,\n  size: number,\n  inOffsensiveCourt: boolean\n}\n\nfunction drawVisRings(visCtx: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D, circles: VisRing[]) {\n  // 0 draw vis circle\n  visCtx.save()\n  const [a, b, c, d, e, f] = [1.75257350e+00, 5.98341402e-02, -8.91780472e-01, 2.49200452e-01, 0, 0]\n  visCtx.setTransform(a, b, c, d, e, f);\n  const circleTXY = circles.map(({ cx, cy }) => {\n    const tx = (cx - (c / d) * cy + (c / d) * f - e) / (a - (c / d) * b)\n    const ty = (cx - e - a * tx) / c\n    return { tx, ty }\n  })\n\n  const in_r = 10\n  const max_out_r = 22\n  // draw outer\n  circles\n    .filter(c => c.inOffsensiveCourt)\n    .forEach((_, cIdx) => {\n      const { tx, ty } = circleTXY[cIdx]\n      const out_r = in_r + max_out_r //25\n      visCtx.fillStyle = COLORS.offense_outer_border\n      visCtx.beginPath()\n      visCtx.arc(tx, ty, out_r, 0, 2 * Math.PI);\n      visCtx.fill();\n    })\n\n  // draw middle\n  circles.forEach(({ size, fill }, cIdx) => {\n    const { tx, ty } = circleTXY[cIdx]\n    const out_r = in_r + max_out_r * size //25\n    visCtx.fillStyle = fill\n    visCtx.beginPath()\n    visCtx.arc(tx, ty, out_r, 0, 2 * Math.PI);\n    visCtx.fill();\n  })\n\n  // cut innner\n  visCtx.globalCompositeOperation = 'destination-out'\n  circles.forEach(({ fill }, cIdx) => {\n    const { tx, ty } = circleTXY[cIdx]\n    visCtx.beginPath()\n    visCtx.arc(tx, ty, in_r, 0, 2 * Math.PI)\n    visCtx.fill()\n  })\n\n  // draw outer borders\n  visCtx.globalCompositeOperation = 'source-over'\n\n  visCtx.lineWidth = 1;\n  visCtx.strokeStyle = COLORS.offense_bg_fill\n  circles\n    .filter(c => c.inOffsensiveCourt)\n    .forEach((_, cIdx) => {\n      const { tx, ty } = circleTXY[cIdx]\n      const out_r = in_r + max_out_r //25\n      visCtx.beginPath()\n      visCtx.arc(tx, ty, out_r, 0, 2 * Math.PI);\n      visCtx.stroke()\n    })\n\n  // draw inner borders\n  visCtx.strokeStyle = COLORS.offense_inner_border //\"#313131\"\n  circles.forEach(({ inOffsensiveCourt }, cIdx) => {\n    const { tx, ty } = circleTXY[cIdx]\n    visCtx.lineWidth = inOffsensiveCourt ? 1 : 3;\n    visCtx.beginPath()\n    visCtx.arc(tx, ty, in_r, 0, 2 * Math.PI)\n    visCtx.stroke()\n  })\n\n  visCtx.restore()\n}\n\nexport interface VisSheild {\n  // fillColor: string,\n  diff: number,\n  smoothDFdiff: number\n  speed: number,\n  cx: number,\n  cy: number,\n  dx: number\n  dy: number\n  tangle: number\n  tdist: number\n  // right: boolean\n}\n\nconst roundTo2PI = (r: number) => (r + 2) % 2\n\nfunction drawVisSheilds(visCtx: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D, sheilds: VisSheild[], debugCtx?: CanvasRenderingContext2D) {\n  visCtx.save()\n  // const [a, b, c, d, e, f] = [1.75257350e+00, 5.98341402e-02, -8.91780472e-01, 5.49200452e-01, 0, 0]\n  const [a, b, c, d, e, f] = [1.75257350e+00, 0.0000001, 0.0000001, 5.49200452e-01, 0, 0]\n  visCtx.setTransform(a, b, c, d, e, f);\n\n  const invertTXY = (x: number, y: number) => {\n    const tx = (x - (c / d) * y + (c / d) * f - e) / (a - (c / d) * b)\n    const ty = (x - e - a * tx) / c\n    return { x: tx, y: ty }\n  }\n\n  // const convertTXY = (x: number, y: number) => {\n  //   const nx = a * x + c * y + e - 800\n  //   const ny = b * x + d * y + f - 0\n  //   return { x: nx, y: ny }\n  // }\n\n  const getA1A2 = (tangle: number, tdist: number) => {\n    const base = 0.02\n    const range = 0.13\n    let a1 = roundTo2PI(tangle - base\n      - range * Math.max(0, Math.min(1, 1 - (tdist - MIN_DIST) / MAX_DIST))\n    )\n    let a2 = roundTo2PI(tangle + base\n      + range * Math.max(0, Math.min(1, 1 - (tdist - MIN_DIST) / MAX_DIST)))\n\n    // swap\n    // if (a2 < a1 && !(a1 > 1.5 && a2 < 0.5)) [a2, a1] = [a1, a2]\n    if ((a2 < a1 && !(a1 > 1.5 && a2 < 0.5)) || (a1 < .5 && a2 > 1.5)) [a2, a1] = [a1, a2]\n    return [a1, a2]\n  }\n\n  // draw lines\n  const MAX_DIST = 12\n  const MIN_DIST = 3.5\n  visCtx.save()\n  for (const sheild of sheilds) {\n    const { cx, cy, dx, dy, tdist } = sheild\n\n    if (tdist >= MAX_DIST || tdist <= MIN_DIST) continue\n\n    const theta = getAngle(cx, cy, dx, dy) / 180\n    // console.debug(`cx:${cx}, cy:${cy}, dx:${dx}, dy:${dy}, theta:${theta}`)\n\n    visCtx.beginPath()\n    visCtx.lineWidth = 2\n    const { x: ox, y: oy } = invertTXY(cx + 40 * Math.cos(theta * Math.PI), cy + 40 * Math.sin(theta * Math.PI))\n    const { x, y } = invertTXY(dx - 50 * Math.cos(theta * Math.PI), dy - 50 * Math.sin(theta * Math.PI))\n\n    const grd = visCtx.createLinearGradient(ox, oy, x, y);\n    grd.addColorStop(0, `rgba(${COLORS.off_df_link}, 0.1)`);\n    grd.addColorStop(0.1, `rgba(${COLORS.off_df_link}, ${0.3 + 0.5 * ((MAX_DIST - tdist) / MAX_DIST)})`);\n    grd.addColorStop(0.9, `rgba(${COLORS.off_df_link}, ${0.3 + 0.5 * ((MAX_DIST - tdist) / MAX_DIST)})`);\n    grd.addColorStop(1, `rgba(${COLORS.off_df_link}, 0.1)`);\n\n    visCtx.strokeStyle = grd\n    visCtx.shadowColor = `rgb(${COLORS.off_df_link})`\n    visCtx.shadowBlur = 5\n    visCtx.moveTo(ox, oy)\n    visCtx.lineTo(x, y)\n    visCtx.stroke()\n  }\n  visCtx.restore()\n\n  const in_r = 100\n  for (const sheild of sheilds) {\n    let { cx, cy, dx, dy, tdist, smoothDFdiff } = sheild\n\n    // r\n    const out_r = in_r + 4 + Math.max(0, smoothDFdiff) * 15\n    visCtx.lineWidth = out_r - in_r;\n\n    // 2d angle\n    const theta = getAngle(cx, cy, dx, dy) / 180\n    const dist = Math.max(0,\n      - 30 + in_r * Math.sqrt(1 / (Math.pow(Math.cos(theta * Math.PI) / a, 2) + Math.pow(Math.sin(theta * Math.PI) / d, 2)))\n    )\n\n    cx = cx - dist * Math.cos(theta * Math.PI)\n    cy = cy - dist * Math.sin(theta * Math.PI)\n    const { x: tx, y: ty } = invertTXY(cx, cy)\n\n    // cal start and end angle\n    // 3d angle\n    let tangle = Math.atan(a * Math.tan(theta * Math.PI) / d) / Math.PI\n    // opposite\n    if (theta > 0.5 && theta <= 1.5) tangle = (tangle + 1) % 2\n\n    const [a1, a2] = getA1A2(tangle, tdist)\n    const [ma1, ma2] = getA1A2(tangle, MIN_DIST)\n\n    // visCtx.beginPath()\n    // visCtx.strokeStyle = 'rgba(125, 0, 0, 1)'\n    // visCtx.arc(tx, ty, in_r + (out_r - in_r) / 2,0 * Math.PI, 2 * Math.PI);\n    // visCtx.stroke()\n\n    // bg first\n    visCtx.strokeStyle = COLORS.defense_bg_fill\n    // visCtx.shadowColor = `#f5f5f599`\n    // visCtx.shadowBlur = 5\n    visCtx.beginPath()\n    visCtx.arc(tx, ty, in_r + (out_r - in_r) / 2, ma1 * Math.PI, ma2 * Math.PI);\n    visCtx.stroke()\n    // fill\n    visCtx.strokeStyle = COLORS.defense_fg_fill\n    visCtx.beginPath()\n    visCtx.arc(tx, ty, in_r + (out_r - in_r) / 2, a1 * Math.PI, a2 * Math.PI);\n    visCtx.stroke();\n  }\n\n  visCtx.restore()\n}\n\nfunction drawVis(visCtx: CanvasRenderingContext2D, circles: VisRing[], sheilds: VisSheild[], debugCtx?: CanvasRenderingContext2D) {\n  drawVisRings(visCtx, circles)\n  drawVisSheilds(visCtx, sheilds, debugCtx)\n}\n\n\n\nfunction drawGlows(ctx: CanvasRenderingContext2D, players: Array<Player & Lv2Player>, savedFG: CanvasRenderingContext2D) {\n  ctx.save()\n  ctx.shadowColor = 'rgba(255, 255, 255, 0.5)';\n  players\n    .forEach(player => {\n      const { x, y, w, h } = player.bbox\n      ctx.shadowBlur = player.on ? 10 : 40 * (player.att ?? 0 - LV_INTEREST_THRESHOLD.off);\n      ctx.drawImage(savedFG.canvas,\n        x, y, w, h,\n        x, y, w, h)\n    })\n  ctx.restore()\n}\n\nfunction drawSpotLights(ctx: CanvasRenderingContext2D, players: Array<Player & KeyPlayer>, savedFG: CanvasRenderingContext2D) {\n  players\n    ?.forEach(player => {\n      const { progress: frames } = player.last\n      const { x, y, w, h } = player.bbox\n      let r1 = player.type === KeyPlayerType.EMPTY_PLAYER\n        ? 30\n        : player.type === KeyPlayerType.STAR\n          ? 30\n          : 20\n\n      // full bright image\n      ctx.drawImage(savedFG.canvas,\n        x, y, w, h,\n        x, y, w, h)\n\n      _draw.cone(ctx,\n        {\n          x: x + w * 0.5,\n          y: y + h,\n          r: 50 * (frames / 6),\n          r1: r1 * (frames / 6),\n          h: player.type === KeyPlayerType.EMPTY_PLAYER\n            ? 800\n            : player.type === KeyPlayerType.STAR\n              ? 800\n              : 1000\n        },\n        {\n          lineWidth: 1, strokeStyle: \"rgba(220, 220, 220, 0.05)\",\n          fillStyle: player.type === KeyPlayerType.EMPTY_PLAYER\n            ? 'rgba(50, 220, 128, 0.1)'\n            : player.type === KeyPlayerType.STAR\n              ? 'rgba(255,215,120, 0.08)'\n              : 'rgba(220, 220, 220, 0.1)',\n          lineCap: 'round', lineJoin: 'round'\n        }\n      )\n    })\n}\n\nconst internalCanvas = document.createElement('canvas')\nconst internalCtx = internalCanvas.getContext('2d')!\n/**\n * Highlight levels:\n * - full brights: all lv1 and lv2 players\n * =========== Focus layer ====== \n * - glow effect: lv2 interested\n * - spotlight_white: lv1 key players's full bright should be above the focus mask\n * - spotlight_green: lv1 empty players\n */\nfunction drawHL(ctx: CanvasRenderingContext2D,\n  frame: CanvasImageSource,\n  mask: CanvasImageSource,\n  players: Player[],\n  lv1Players: Array<Player & KeyPlayer> = [],\n  lv2Players: Array<Player & Lv2Player> = [],\n  features: EnabledFeatures,\n  ballHolder?: PlayerID | null,\n  filter_focus?: { pos: Point }) {\n  const { width, height } = ctx.canvas\n\n  // mask get fg\n  internalCanvas.width = width\n  internalCanvas.height = height\n  internalCtx.save()\n  internalCtx.drawImage(mask, 0, 0)\n  internalCtx.globalCompositeOperation = 'source-in'\n  internalCtx.drawImage(frame, 0, 0)\n  internalCtx.restore()\n\n  // draw fg with mask\n  // ctx.save()\n  ctx.drawImage(internalCanvas, 0, 0)\n  // ctx.globalCompositeOperation = 'source-atop'\n  // ctx.fillStyle = `rgba(0, 0, 0, ${COLORS.FG_MASK_ALPHA})`\n  // ctx.fillRect(0, 0, width, height);\n  // ctx.restore()\n\n  // focus mask\n  if (filter_focus) {\n    const { pos } = filter_focus\n    ctx.save()\n    const grd = ctx.createRadialGradient(pos.x, pos.y, FOCUS.min, pos.x, pos.y, FOCUS.max);\n    grd.addColorStop(0, `rgba(0, 0, 0, ${FOCUS.mina})`);\n    grd.addColorStop(1, `rgba(0, 0, 0, ${FOCUS.maxa})`);\n    ctx.fillStyle = grd;\n    ctx.globalCompositeOperation = 'source-atop'\n    ctx.fillRect(0, 0, width, height);\n    ctx.restore()\n\n    //unimportant players\n    const unImportantPlayers = players.filter(p =>\n      !lv2Players.find(lv2 => lv2.id === p.id) &&\n      !lv1Players.find(lv1 => lv1.id === p.id))\n\n    ctx.save()\n    unImportantPlayers.forEach(p => {\n      const { x, y, w, h } = p.bbox\n      ctx.drawImage(internalCtx.canvas,\n        x, y, w, h,\n        x, y, w, h)\n    })\n    // ctx.fillStyle = `rgba(0, 0, 0, ${COLORS.FG_MASK_ALPHA})`\n    // ctx.globalCompositeOperation = 'source-atop'\n    // ctx.fillRect(0, 0, width, height);\n    ctx.restore()\n  }\n\n  // need this for the focus mask\n  // basic hilight, full bright\n  const lv2PlayerLooked = lv2Players\n    .filter(p => p.id !== ballHolder &&\n      p.type.has(Lv2PlayerType.Interest) && p.looked && (p.att ?? 0) > LV_INTEREST_THRESHOLD.off)\n  const lv2PlayerNotLooked = lv2Players\n    .filter(p => !(lv2PlayerLooked.find(lp => lp.id === p.id)))\n  lv2PlayerNotLooked.forEach(player => {\n    const { x, y, w, h } = player.bbox\n    ctx.drawImage(internalCtx.canvas,\n      x, y, w, h,\n      x, y, w, h)\n  })\n\n  // only looked, will show glow\n  drawGlows(ctx, lv2PlayerLooked, internalCtx)\n\n  // spot light \n  if (features.vis_key_player) {\n    drawSpotLights(ctx, lv1Players, internalCtx)\n  }\n}\n\n/**\n * For draw star\n */\nfunction rotate2D(vecArr: Array<[number, number]>, byRads: number) {\n  const mat = [\n    [Math.cos(byRads), -Math.sin(byRads)],\n    [Math.sin(byRads), Math.cos(byRads)]\n  ];\n  const result: Array<[number, number]> = [];\n  for (let i = 0; i < vecArr.length; ++i) {\n    result[i] = [\n      mat[0][0] * vecArr[i][0] + mat[0][1] * vecArr[i][1],\n      mat[1][0] * vecArr[i][0] + mat[1][1] * vecArr[i][1]\n    ];\n  }\n  return result;\n}\n\nfunction generateStarTriangles(numPoints: number, r: number) {\n  const triangleBase = r * Math.tan(Math.PI / numPoints);\n  // console.log(\"Base: \" + triangleBase);\n  const triangle: Array<[number, number]> = [\n    [0, r],\n    [triangleBase / 2, 0],\n    [-triangleBase / 2, 0], [0, r]\n  ];\n  const result = [];\n  for (let i = 0; i < numPoints; ++i) {\n    result[i] = rotate2D(triangle, i * (2 * Math.PI / numPoints));\n  }\n  return result;\n}\n\nfunction drawStar(ctx: CanvasRenderingContext2D, r: number, offset: [number, number], flipVert: boolean) {\n  const sign = flipVert ? -1 : 1;\n  const obj = generateStarTriangles(5, r);\n\n  ctx.save()\n  ctx.fillStyle = COLORS.star_star\n  for (let objIdx = 0; objIdx < obj.length; ++objIdx) {\n    const elem = obj[objIdx];\n    ctx.moveTo(elem[0][0] + offset[0], sign * elem[0][1] + offset[1]);\n    ctx.beginPath();\n    for (let vert = 1; vert < elem.length; ++vert) {\n      ctx.lineTo(elem[vert][0] + offset[0], sign * elem[vert][1] + offset[1]);\n    }\n    ctx.fill();\n  }\n  ctx.beginPath()\n  ctx.arc(offset[0], offset[1], r, 0, 2 * Math.PI)\n  ctx.strokeStyle = COLORS.star_star\n  ctx.stroke()\n  ctx.restore()\n}\n\n\nconst shooterIcon = new Image()\nshooterIcon.src = `${process.env.PUBLIC_URL}/shooter.png`\nconst defenderIcon = new Image()\ndefenderIcon.src = `${process.env.PUBLIC_URL}/defender.png`\nconst starIcon = new Image()\nstarIcon.src = `${process.env.PUBLIC_URL}/star.png`\nconst ICONS = {\n  shooter: shooterIcon,\n  defender: defenderIcon,\n  star: starIcon\n}\n\n\n// shooterIcon.style.filter = `invert(80%) sepia(77%) saturate(366%) hue-rotate(328deg) brightness(102%) contrast(101%);`\nfunction drawIcon(ctx: CanvasRenderingContext2D, iconHeight: number, offset: [number, number], icon: keyof typeof ICONS) {\n  if (icon === 'star') {\n    //   drawStar(ctx, iconHeight / 2, offset, true)\n    drawIcon(ctx, iconHeight, [offset[0] - iconHeight, offset[1]], 'shooter')\n    drawIcon(ctx, iconHeight, offset, 'defender')\n  } else {\n    const iconWidth = iconHeight * ICONS[icon].width / ICONS[icon].height\n    internalCanvas.width = iconWidth\n    internalCanvas.height = iconHeight\n    internalCtx.save()\n    internalCtx.drawImage(ICONS[icon],\n      0, 0, ICONS[icon].width, ICONS[icon].height,\n      0, 0, iconWidth, iconHeight)\n    internalCtx.globalCompositeOperation = 'source-in'\n    internalCtx.fillStyle = COLORS.star_star\n    internalCtx.fillRect(0, 0, iconWidth, iconHeight)\n    internalCtx.restore()\n    ctx.drawImage(internalCanvas, offset[0] - iconWidth * 0.5, offset[1] - iconHeight * 0.5)\n  }\n}\n\nfunction drawName(ctx: CanvasRenderingContext2D, player?: Player) {\n  if (!player) return\n\n  const { id, namePos } = player\n  const textheight = 18\n  const lastname = PLAYER_META[id].ln\n\n  ctx.save()\n  ctx.fillStyle = PLAYER_META[id].star ? COLORS.star_name : COLORS.player_name\n  ctx.font = `bold ${textheight}px Arial`;\n  ctx.textAlign = \"center\";\n  const textwidth = ctx.measureText(lastname).width\n  const x = PLAYER_META[id].star === 'star' ? namePos.x + textheight / 2 : namePos.x\n  ctx.fillText(lastname, x, namePos.y)\n  ctx.restore()\n\n  if (PLAYER_META[id].star) {\n    const starR = Math.floor(textheight / 2) - 1\n    const starPadding = 5\n    const iconHeight = textheight\n    drawIcon(ctx, iconHeight, [\n      x - (textwidth + starR) * 0.5 - starPadding,\n      namePos.y - textheight / 2 + 2],\n      PLAYER_META[id].star as any)\n  }\n}\n\nexport {\n  // drawFG as fg,\n\n  drawVisRings as circles,\n  drawVisSheilds as sheilds,\n  drawHL as HL,\n  drawVis as Vis,\n  drawStar as Star,\n  drawName as Name,\n}","import { Hexbin, HexbinBin, hexbin as d3Hexbin } from 'd3-hexbin';\nimport { scaleSequential, scaleSqrt, scaleOrdinal } from 'd3-scale'\nimport { interpolateReds, interpolateYlGnBu, schemeSet3 } from 'd3-scale-chromatic'\n\nimport type { Point } from \"common/@types\"\nimport { distPoints } from \"common/@utils\"\n\nimport { PLAYER_META } from \"@const\"\nimport type { GameID } from '@types'\nimport type { PlayerID, CachePlayerBin, ShotRecord } from '@types';\nimport { params } from 'param';\n\nif (process.env.NODE_ENV !== 'production') {\n  (global as any).$RefreshReg$ = () => { };\n  (global as any).$RefreshSig$ = () => () => { };\n}\n\nconst getArea = (area: string) => area.match(/\\((\\w+)\\)/)?.[1]\nconst getRegionKey = (r: { AREA: string, BASIC: string, RANGE: string }) =>\n  getArea(r.AREA) + \"_\" +\n  r.RANGE\n\nconst mapRegionToPoint = (region: string) => {\n  return region && (region.endsWith(\"24+ ft.\") || region.endsWith(\"Back Court Shot\")) ? 3 : 2\n}\n\nexport const hRadius = 7\nexport const hexbin = d3Hexbin<ShotRecord>()\n  .x(d => d.LOC_X)\n  .y(d => d.LOC_Y)\n  .radius(hRadius)\n\nexport const leagueAvgByRegion = [\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Above the Break 3\",\n    \"SHOT_ZONE_AREA\": \"Back Court(BC)\",\n    \"SHOT_ZONE_RANGE\": \"Back Court Shot\",\n    \"FGA\": 59,\n    \"FGM\": 4,\n    \"FG_PCT\": 0.068\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Above the Break 3\",\n    \"SHOT_ZONE_AREA\": \"Center(C)\",\n    \"SHOT_ZONE_RANGE\": \"24+ ft.\",\n    \"FGA\": 10885,\n    \"FGM\": 3746,\n    \"FG_PCT\": 0.344\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Above the Break 3\",\n    \"SHOT_ZONE_AREA\": \"Left Side Center(LC)\",\n    \"SHOT_ZONE_RANGE\": \"24+ ft.\",\n    \"FGA\": 16648,\n    \"FGM\": 5802,\n    \"FG_PCT\": 0.349\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Above the Break 3\",\n    \"SHOT_ZONE_AREA\": \"Right Side Center(RC)\",\n    \"SHOT_ZONE_RANGE\": \"24+ ft.\",\n    \"FGA\": 15837,\n    \"FGM\": 5597,\n    \"FG_PCT\": 0.353\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Backcourt\",\n    \"SHOT_ZONE_AREA\": \"Back Court(BC)\",\n    \"SHOT_ZONE_RANGE\": \"Back Court Shot\",\n    \"FGA\": 440,\n    \"FGM\": 17,\n    \"FG_PCT\": 0.039\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"In The Paint (Non-RA)\",\n    \"SHOT_ZONE_AREA\": \"Center(C)\",\n    \"SHOT_ZONE_RANGE\": \"Less Than 8 ft.\",\n    \"FGA\": 19352,\n    \"FGM\": 7561,\n    \"FG_PCT\": 0.391\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"In The Paint (Non-RA)\",\n    \"SHOT_ZONE_AREA\": \"Center(C)\",\n    \"SHOT_ZONE_RANGE\": \"8-16 ft.\",\n    \"FGA\": 6851,\n    \"FGM\": 2889,\n    \"FG_PCT\": 0.422\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"In The Paint (Non-RA)\",\n    \"SHOT_ZONE_AREA\": \"Left Side(L)\",\n    \"SHOT_ZONE_RANGE\": \"8-16 ft.\",\n    \"FGA\": 2089,\n    \"FGM\": 842,\n    \"FG_PCT\": 0.403\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"In The Paint (Non-RA)\",\n    \"SHOT_ZONE_AREA\": \"Right Side(R)\",\n    \"SHOT_ZONE_RANGE\": \"8-16 ft.\",\n    \"FGA\": 1932,\n    \"FGM\": 799,\n    \"FG_PCT\": 0.414\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Left Corner 3\",\n    \"SHOT_ZONE_AREA\": \"Left Side(L)\",\n    \"SHOT_ZONE_RANGE\": \"24+ ft.\",\n    \"FGA\": 7864,\n    \"FGM\": 2939,\n    \"FG_PCT\": 0.374\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Center(C)\",\n    \"SHOT_ZONE_RANGE\": \"16-24 ft.\",\n    \"FGA\": 7324,\n    \"FGM\": 2897,\n    \"FG_PCT\": 0.396\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Center(C)\",\n    \"SHOT_ZONE_RANGE\": \"8-16 ft.\",\n    \"FGA\": 2265,\n    \"FGM\": 987,\n    \"FG_PCT\": 0.436\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Left Side Center(LC)\",\n    \"SHOT_ZONE_RANGE\": \"16-24 ft.\",\n    \"FGA\": 7754,\n    \"FGM\": 3066,\n    \"FG_PCT\": 0.395\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Left Side(L)\",\n    \"SHOT_ZONE_RANGE\": \"8-16 ft.\",\n    \"FGA\": 7639,\n    \"FGM\": 3005,\n    \"FG_PCT\": 0.393\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Left Side(L)\",\n    \"SHOT_ZONE_RANGE\": \"16-24 ft.\",\n    \"FGA\": 5452,\n    \"FGM\": 2173,\n    \"FG_PCT\": 0.399\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Right Side Center(RC)\",\n    \"SHOT_ZONE_RANGE\": \"16-24 ft.\",\n    \"FGA\": 8145,\n    \"FGM\": 3249,\n    \"FG_PCT\": 0.399\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Right Side(R)\",\n    \"SHOT_ZONE_RANGE\": \"8-16 ft.\",\n    \"FGA\": 7630,\n    \"FGM\": 3011,\n    \"FG_PCT\": 0.395\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Right Side(R)\",\n    \"SHOT_ZONE_RANGE\": \"16-24 ft.\",\n    \"FGA\": 4924,\n    \"FGM\": 1996,\n    \"FG_PCT\": 0.405\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Restricted Area\",\n    \"SHOT_ZONE_AREA\": \"Center(C)\",\n    \"SHOT_ZONE_RANGE\": \"Less Than 8 ft.\",\n    \"FGA\": 67443,\n    \"FGM\": 40634,\n    \"FG_PCT\": 0.602\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Right Corner 3\",\n    \"SHOT_ZONE_AREA\": \"Right Side(R)\",\n    \"SHOT_ZONE_RANGE\": \"24+ ft.\",\n    \"FGA\": 7360,\n    \"FGM\": 2803,\n    \"FG_PCT\": 0.381\n  }\n].reduce((o, d) => {\n  const key = getRegionKey({ AREA: d.SHOT_ZONE_AREA, BASIC: d.SHOT_ZONE_BASIC, RANGE: d.SHOT_ZONE_RANGE })\n  o[key] = {\n    FGA: d.FGA,\n    FGM: d.FGM,\n    rate: d.FG_PCT,\n    exp: mapRegionToPoint(key) * d.FG_PCT\n  }\n  return o\n}, {} as Record<string, { FGA: number, FGM: number, rate: number, exp: number }>)\n\nconst groupShotsByRegion = (shots: ShotRecord[]) => {\n  const byRegion = shots\n    .reduce((o, r) => {\n      const key = getRegionKey(r.SHOT_ZONE)\n      if (!(key in o)) {\n        o[key] = []\n      }\n      o[key].push(r)\n      return o\n    }, {} as Record<string, ShotRecord[]>)\n\n  const byRegionAndPercentage: Record<string, {\n    shots: ShotRecord[],\n    rate: number,\n    diff: number,\n    eDiff: number,\n    exp: number,\n    region: { AREA: string, BASIC: string, RANGE: string }\n  }> = {}\n\n  for (const key of Object.keys(byRegion)) {\n    const shots = byRegion[key]\n    const rate = shots.filter(s => +s.made).length / shots.length\n    const diff = rate - leagueAvgByRegion[key].rate\n    const exp = rate * mapRegionToPoint(key)\n\n    byRegionAndPercentage[key] = {\n      shots,\n      region: shots[0].SHOT_ZONE,\n      rate,\n      exp,\n      diff,\n      eDiff: 2 * (-0.5 + 1 / (1 + Math.exp(-5 * diff))),\n    }\n  }\n\n  return byRegionAndPercentage\n}\n\nconst mapLOCTOTracking = (onTheRight: boolean, r: ShotRecord) => ({ //, mapSize: [number, number]) => ({\n  ...r,\n  LOC_X: (onTheRight ? (940 - (r.LOC_Y + 52.5)) : (r.LOC_Y + 52.5)), // / (940 / mapSize[0]),\n  LOC_Y: ((onTheRight ? r.LOC_X : -r.LOC_X) + 250), // / (500 / mapSize[1])\n})\n\n// detect whether at 2 or 3 points region\nconst TwoOrThreePt = ({ x, y }: Point) => {\n  if (x === undefined || y === undefined) return 2\n  const point1 = 14\n  const point2 = 5.25 + 23.75\n  if (x < 47) {\n    // on the left\n    if (x < point1) {\n      // check y\n      return (y > 3 && y < (50 - 3)) ? 2 : 3\n    } else if (x < point2) {\n      // check dist\n      const dist = distPoints({ x, y }, { x: 5.25, y: 25 })\n      return dist > 23.75 ? 3 : 2\n    }\n  } else {\n    // on the right\n    if (x > (94 - point1)) {\n      return (y > 3 && y < (50 - 3)) ? 2 : 3\n    } else if (x > (94 - point2)) {\n      const dist = distPoints({ x, y }, { x: 94 - 5.25, y: 25 })\n      return dist > 23.75 ? 3 : 2\n    }\n  }\n}\n\n\nfunction normalize(v?: number, min?: number, max?: number) {\n  if (v === undefined || min === undefined || max === undefined) return -1\n  return (v - min) / (max - min)\n}\n\nfunction POS_TO_OFF_TEAM(gameId: GameID, x?: number) {\n  if (x === undefined) return undefined\n  return gameId === 'game1'\n    ? x < 47 ? 'CLE' : 'GSW'\n    : x < 47 ? 'OKC' : 'LAC'\n}\n\nexport function GOAL_BASKET_POS(playerId: PlayerID) {\n  const team = PLAYER_META[playerId].team\n  const left = new Set(['CLE', 'OKC'])\n  // const right = new Set(['GSW', 'LAC'])\n\n  return left.has(team) ? { x: 5.8, y: 25 } : { x: 88.2, y: 25 }\n}\n\nfunction PLAYER_ID_TO_OFF_RIGHT(playerId: PlayerID) {\n  return new Set(['GSW', 'LAC']).has(PLAYER_META[playerId].team)\n}\n\nfunction getPlayerBins(hexbin: Hexbin<ShotRecord>, playerId: PlayerID, shotRecords: ShotRecord[]) {\n  const onTheRight = PLAYER_ID_TO_OFF_RIGHT(playerId)\n  const leagueShots = shotRecords\n    .map(r => mapLOCTOTracking(onTheRight, r))\n  const playerShots = leagueShots\n    .filter(r => r.PLAYER_ID === playerId)\n\n  const playerShotsByRegion = groupShotsByRegion(playerShots)\n  const bins = hexbin(leagueShots)\n  const playerShotInBinWithDiff = bins\n    .map(d => {\n      const [region, value] = Object.entries(groupShotsByRegion(d))\n        .reduce((o, d) => (o && o[1].shots.length > d[1].shots.length) ? o : d)\n\n      const dft = leagueAvgByRegion[region]\n      const {\n        rate = dft?.rate ?? 0,\n        diff = 0,\n        eDiff = 0,\n        exp = dft?.exp ?? 0\n      } = playerShotsByRegion[region] ?? {}\n\n      const newD = d as HexbinBin<ShotRecord> & CachePlayerBin\n      newD.region = value.region\n      newD.diff = diff;\n      newD.eDiff = eDiff;\n      newD.regionRate = rate;\n      newD.regionExp = exp\n      return newD\n    })\n\n  // normalize\n  playerShotInBinWithDiff.forEach(d => {\n    ; (d as CachePlayerBin).regionFreq = d.length / Math.max(...playerShotInBinWithDiff.filter(r => r.region === d.region).map(r => r.length))\n  })\n\n  return playerShotInBinWithDiff.map(({ x, y, region, regionExp, regionRate, regionFreq, diff, eDiff }) => ({\n    x, y, region, regionExp, regionRate, regionFreq, diff, eDiff\n  })) as CachePlayerBin[]\n}\n\n/**\n * dirty hack\n */\nexport function getCanvasAbsTopLeft() {\n  const elm = document.getElementById(\"canvasWrapper\")\n  if (!elm) return { x: 0, y: 0 }\n  const { x, y, width, height } = elm?.getBoundingClientRect()\n  return {\n    // x: x + window.screenX,\n    // y: y + window.screenY + window.outerHeight - window.innerHeight,\n    x: x,\n    y: y + window.outerHeight / 50,\n    wScale: 1280 / width,\n    hScale: 720 / height\n  }\n}\n\nconst Scales = {\n  regionScale: scaleOrdinal<string>(schemeSet3),\n  twoPTColor: scaleSequential<string>(interpolateYlGnBu)\n    // .domain([-0.4, 0.4]),\n    .domain([0.2, 0.8]),\n  twoPT: scaleSequential<number>()\n    .domain([0, 0.4])\n    .range([0, 1]),\n  threePTColor: scaleSequential<string>(interpolateYlGnBu)\n    // .domain([-0.27, 0.27]),\n    .domain([0.2, 0.8]),\n  threePT: scaleSequential<number>()\n    .domain([0, 0.27])\n    .range([0, 1]),\n  radiusScale: scaleSqrt()\n    .domain([0, 1])\n    .range([1, hRadius]),\n  regionExp: scaleSequential<string>(interpolateReds)\n    .domain([0.1, params.GAME_ID === 'game1' ? 2 : 2.5])\n} as const\n\nexport {\n  Scales,\n  mapRegionToPoint, TwoOrThreePt, normalize, getPlayerBins,\n  PLAYER_ID_TO_OFF_RIGHT, POS_TO_OFF_TEAM,\n  getArea, getRegionKey, groupShotsByRegion, mapLOCTOTracking\n}","import \"./style.scss\"\nimport React from 'react'\n\nimport { Layer } from 'common/@types'\nimport {\n  Attentions,\n  DefensivePkg,\n  Gaze, KeyPlayer,\n  Lv2Player, Lv2PlayerType, OffensivePkg, PLAYER_STATUS,\n  PlayerID, Player,\n  Video\n} from '@types'\n\nimport * as _draw from 'common/@draw'\nimport * as draw from './visualizeData'\nimport { EnabledFeatures, videoEnv } from '../../App'\nimport { VisRing, VisSheild } from \"./visualizeData\"\nimport { PLAYER_META } from \"@const\"\nimport { Scales } from \"@utils\"\n\nconst layerIds = ['0_bg', '1_vis', '2_fg', '3_annot', '4_debug'] as const\n\n// 0bg --> raw frame\n// 1vis --> vis\n// 2fg --> fg + dark mask\n// 3annot --> highlighted players\n\nexport type LayerId = typeof layerIds[number]\n\ninterface Props {\n  currentVideo: Video\n  currentFrameIdx: number\n  currentFrame?: HTMLVideoElement\n  // currentFrameData?: Frame\n\n  gaze?: Gaze\n  attentions?: Attentions\n  gazePlayers?: Player[]\n\n  features: EnabledFeatures\n  playerFlags: Partial<Record<PlayerID, 'Auto' | 'On' | 'Off'>>\n\n  onPickPlayers?: (fIdx: number, lv1Players: Record<PlayerID, KeyPlayer>, lv2Players: Record<PlayerID, Lv2Player>) => void\n}\n\nexport class Visualizer extends React.Component<Props, {}> {\n\n  public readonly layers: Record<LayerId, Layer | null> = layerIds.reduce((o, l) => {\n    o[l] = null\n    return o\n  }, {} as Record<LayerId, Layer | null>)\n\n  get2DPos(id: PlayerID, players: Player[]) {\n    const { bbox, keypoints } = players?.find(p => p.id === id)!\n    const team = PLAYER_META[id].team\n    const { y, h } = bbox\n    const { left_hip, right_hip, left_ankle, right_ankle } = keypoints\n\n    // calculate cx and cy\n    const cx = (left_hip.x + right_hip.x) / 2\n    const cy = (y + h + Math.max(left_ankle.y, right_ankle.y)) / 2\n\n    return { cx, cy, team }\n  }\n\n  isOnLv2Player = (p: Player, lv2Players: Record<PlayerID, Lv2Player>) => p.id in lv2Players\n    && (\n      (lv2Players[p.id].type.has(Lv2PlayerType.Interest) && lv2Players[p.id].on)\n      || lv2Players[p.id].type.has(Lv2PlayerType.Normal)\n      // || lv2Players[p.id].type === Lv2PlayerType.Normal_Interest\n    )\n\n  async componentDidUpdate(preProps: Props) {\n    if (preProps.currentFrameIdx !== this.props.currentFrameIdx) {\n      const {\n        currentFrameIdx,\n        currentFrame,\n        features,\n        playerFlags\n      } = this.props\n      if (!currentFrame) return\n\n      this.cleanAllExcept('0_bg')\n      _draw.bg(this.layers['0_bg']!, currentFrame)\n      // dark overlay\n      _draw.overlay(this.layers['1_vis']!, 0.18)\n      // if (currentVideo.isTransit || params.MODE === 'RAW') return\n\n      const currentFrameData = videoEnv.frames?.[currentFrameIdx]\n      if (!currentFrameData) return\n\n      const { players, ball } = currentFrameData\n      if (!players) return\n\n      // // Step1. detect the players to show\n      const filter_focus = features.gaze_filter ? videoEnv.fetchFocus() : undefined\n      const { lv1Players, lv2Players } = videoEnv.pickPlayers(currentFrameIdx, features, playerFlags, filter_focus)\n      if (!lv1Players && !lv2Players) return\n\n      // DEBUG.TIMELINE && this.props.onPickPlayers?.(currentFrameIdx, lv1Players, lv2Players)\n\n      // Step2 Decide the data to show for each player\n      const dataToVis = players!.filter(p => this.isOnLv2Player(p, lv2Players))\n\n      // Step3 Visualization & Render\n\n      const offensiveRings: VisRing[] = dataToVis\n        .filter(p => p.dataPkg?.mode === PLAYER_STATUS.offensive && features.vis_off_ring)\n        .map(({ dataPkg, id }) => {\n          // console.log('Offensive circle', id, PLAYER_META[id].ln)\n          let { smoothRegionExp, inOffsensiveCourt } = dataPkg as OffensivePkg\n          const { cx, cy } = this.get2DPos(id, players)\n          const fill = Scales.regionExp(smoothRegionExp)\n          return { cx, cy, fill, size: Math.min(1, smoothRegionExp / 2), inOffsensiveCourt }\n        })\n\n      const defensiveSheilds: VisSheild[] = dataToVis\n        .filter(p => p.dataPkg?.mode === PLAYER_STATUS.defensive && features.vis_def_sheild)\n        .map(({ dataPkg, id }) => {\n          let { diff, speed, tangle, tdist, defendingPlayer, smoothDFdiff } = dataPkg as DefensivePkg\n          const { cx, cy } = this.get2DPos(id, players)\n          const { cx: dx, cy: dy } = this.get2DPos(defendingPlayer, players)\n\n          return {\n            cx, cy,\n            dx, dy,\n            diff, tangle, tdist,\n            smoothDFdiff,\n            speed,\n          }\n        })\n      draw.Vis(this.layers['1_vis']!.ctx, offensiveRings, defensiveSheilds, this.layers['4_debug']?.ctx)\n\n      // draw fg\n      // draw.fg(this.layers['2_fg']?.ctx!, this.layers['0_bg']!.canvas, currentFrameData.mask!)\n      draw.HL(this.layers['3_annot']?.ctx!, this.layers['0_bg']!.canvas, currentFrameData.mask!,\n        players,\n        // \n        players?.filter(p => p.id in lv1Players)\n          .map(p => ({ ...p, ...lv1Players[p.id] })),\n        players.filter(p => p.id in lv2Players)\n          .map(p => ({ ...p, ...lv2Players[p.id] })),\n        features,\n        ball?.playerId,\n        filter_focus\n      )\n\n      // 3. text annotations\n      draw.Name(this.layers['3_annot']?.ctx!, players.find(p => p.id === ball?.playerId))\n      // only on, will show the name\n      Object.values(lv2Players)\n        .filter(p => p.type.has(Lv2PlayerType.Interest) && p.on)\n        .forEach(ip => {\n          draw.Name(this.layers['3_annot']?.ctx!, players.find(p => p.id === ip.id))\n        })\n    }\n  }\n\n  render() {\n    const { currentVideo } = this.props\n    const { width = 0, height = 0 } = currentVideo ?? {}\n\n    return (<div className='visualizationContainer'\n\n      style={{\n        marginLeft: '20px',\n        // justifyContent: 'center' //DEBUG ? 'flex-start' : 'center'\n      }}\n    >\n      <div id=\"canvasWrapper\" className=\"canvasWrapper\">\n        <img alt=\"www\" src=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\"\n          style={{ height: `${width / height * 100}%` }}\n        ></img>\n        {layerIds.map((l, idx) =>\n          <canvas id={l}\n            key={idx}\n            width={width}\n            height={height}\n            ref={ref => {\n              if (!ref) return\n              this.layers[l] = { canvas: ref, ctx: ref.getContext('2d')! }\n            }}\n          />)}\n        {this.props.children}\n      </div>\n    </div>)\n  }\n\n  public cleanAllExcept(layerId: LayerId) {\n    Object.keys(this.layers)\n      .filter(lId => lId !== layerId)\n      .forEach((lId) => {\n        const l = this.layers[lId as LayerId]\n        l?.ctx.clearRect(0, 0, l.canvas.width, l.canvas.height)\n      })\n  }\n}","import { useEffect, useRef } from \"react\";\n\nimport { axisBottom, axisLeft } from \"d3-axis\";\nimport { ScaleBand, scaleBand, ScaleLinear, scaleLinear } from \"d3-scale\";\nimport { select } from 'd3-selection'\nimport { line, curveMonotoneX } from 'd3-shape'\n\nimport { extent } from \"common/@utils\";\ninterface AxisBottomProps {\n  scale: ScaleBand<string> | ScaleLinear<number, number>;\n  transform: string;\n}\n\nexport function AxisBottom({ scale, transform }: AxisBottomProps) {\n  const ref = useRef<SVGGElement>(null);\n\n  useEffect(() => {\n    if (ref.current) {\n      select(ref.current).call(axisBottom(scale as any));\n    }\n  }, [scale]);\n\n  return <g ref={ref} transform={transform} />;\n}\n\nexport interface AxisLeftProps {\n  scale: ScaleLinear<number, number, never>;\n}\n\nfunction AxisLeft({ scale }: AxisLeftProps) {\n  const ref = useRef<SVGGElement>(null);\n\n  useEffect(() => {\n    if (ref.current) {\n      select(ref.current).call(axisLeft(scale));\n    }\n  }, [scale]);\n\n  return <g ref={ref} />;\n}\n\ninterface ChartProps {\n  width?: number\n  height?: number\n}\n\ninterface BarChartProps extends ChartProps {\n  fixY?: boolean\n  maxY?: number\n  data: Array<{ id: string, value: number, fill: string }>\n}\n\nexport function BarChart({ fixY: normalizeY = false, maxY = 1, data = [], width: w = 400, height: h = 200 }: BarChartProps) {\n\n  const margin = { top: 10, right: 10, bottom: 20, left: 50 };\n  const width = w - margin.left - margin.right;\n  const height = h - margin.top - margin.bottom;\n\n  const scaleX = scaleBand()\n    .domain(new Set(data.map(d => d.id)))\n    .range([0, width]);\n\n  const scaleY = scaleLinear()\n    .domain([0, normalizeY ? maxY : Math.max(...data.map(d => d.value))])\n    .range([height, 0]);\n  return <svg\n    width={width + margin.left + margin.right}\n    height={height + margin.top + margin.bottom}\n  >\n    <g transform={`translate(${margin.left}, ${margin.top})`}>\n      <AxisBottom scale={scaleX} transform={`translate(0, ${height})`} />\n      <AxisLeft scale={scaleY} />\n\n      {data\n        .map(({ id, value, fill }, idx) => (\n          <rect\n            key={`${id}_${idx}`}\n            x={scaleX(id)}\n            y={scaleY(value)}\n            width={scaleX.bandwidth()}\n            height={height - scaleY(value)}\n            fill={fill}\n          // fill={value.on ? \"teal\" : \"lightpink\"}\n          />\n        ))}\n\n    </g>\n  </svg>\n}\n\n\ninterface LineChartProps extends ChartProps {\n  data: Array<{ fIdx: number, videoIdx: number, value: number }>\n}\n\nexport function LineChart({ data, width: w = 400, height: h = 200 }: LineChartProps) {\n\n  const margin = { top: 10, right: 10, bottom: 20, left: 50 };\n  const width = w - margin.left - margin.right;\n  const height = h - margin.top - margin.bottom;\n\n  const [minFIdx, maxFIdx] = extent(data.map(d => d.fIdx))\n\n  const videos = Object.entries(data.reduce((o, d) => {\n    if (!(d.videoIdx in o)) o[d.videoIdx] = []\n    o[d.videoIdx].push(d.fIdx)\n    return o\n  }, {} as Record<number, number[]>))\n    .sort((a, b) => +a[0] - +b[0])\n    .map(([_, fIdxs]) => {\n      const [minIdx, maxIdx] = extent(fIdxs)\n      return { x: minIdx, w: maxIdx - minIdx }\n    })\n\n  // merge data points\n  const points = Object.values(\n    data.reduce((o, d) => {\n      const key = `${d.fIdx}_${d.value}`\n      if(!(key in o)) o[key] = d\n      return o\n    }, {} as Record<string, any>)\n  )\n\n  const scaleX = scaleLinear()\n    .domain([minFIdx, maxFIdx])\n    .range([0, width]);\n\n  const scaleY = scaleLinear()\n    .domain([0, 0.6])\n    .range([height, 0]);\n\n  const lineGenerator = line<{ fIdx: number, value: number }>()\n    .x(d => scaleX(d.fIdx))\n    .y(d => scaleY(d.value))\n    .curve(curveMonotoneX);\n\n  return <svg\n    width={width + margin.left + margin.right}\n    height={height + margin.top + margin.bottom}\n  >\n    <g transform={`translate(${margin.left}, ${margin.top})`}>\n      <AxisBottom scale={scaleX} transform={`translate(0, ${height})`} />\n      <AxisLeft scale={scaleY} />\n\n      {videos.map(({ x, w }, idx) => <rect\n        key={`${idx}`}\n        x={scaleX(x)}\n        y={scaleY(0.6)}\n        width={scaleX(w)}\n        height={height - scaleY(0.6)}\n        fill={'rgba(30, 30, 30, 0.1)'}\n      />\n      )}\n\n      <path\n        stroke=\"black\"\n        strokeWidth={2}\n        fill=\"none\"\n        d={lineGenerator(points) ?? ''}\n      >\n      </path>\n    </g>\n  </svg>\n}","import \"./style.scss\"\n\nimport React, { memo } from 'react'\nimport type { Frame } from 'common/@types';\n\nimport type { PlayerID, PlayerShotBin, ShotRecord } from '@types'\nimport { miniMapSize, PLAYER_META } from '@const';\n\nimport { hexbin, Scales } from \"@utils\";\nimport { HexbinBin } from 'd3-hexbin';\nimport { videoEnv } from 'App';\n\n\nconst scaleT2Minimap = miniMapSize[0] / 94;\n\nconst HexaBin = memo(function HexaBin(props: { isIn: boolean, d: PlayerShotBin }) {\n  const { isIn, d } = props\n  return <path\n    // fill={mapRegionToPoint(d.region) === 2\n    //   ? dataTower.scales.twoPTColor(d.regionRate)\n    //   : dataTower.scales.threePTColor(d.regionRate)}\n    // fill={dataTower.scales.regionScale(d.region)}\n    className=\"court_bin\"\n    fill={Scales.regionExp(d.regionExp)}\n    strokeWidth={isIn ? 2 : 0}\n    d={`M${d.x},${d.y}${hexbin.hexagon()}`}\n  ></path>;\n  //dataTower.scales.radiusScale(d.freqByRegion)\n})\n\ninterface HexaProps {\n  currentBin?: HexbinBin<ShotRecord>\n  playerBins?: PlayerShotBin[]\n}\nconst Hexagon = memo(function Hexagon(props: HexaProps) {\n  const { playerBins, currentBin } = props\n\n  return <svg width={miniMapSize[0]} height={`${scaleT2Minimap * 50}px`}\n    style={{ position: 'absolute', overflow: 'visible' }}>\n    <g transform={`scale(${miniMapSize[0] / 940})`}>\n      {playerBins?.map(d => {\n        const isIn = d.x === currentBin?.x && d.y === currentBin?.y;\n        return <HexaBin key={`${d.x}_${d.y}`} d={d} isIn={isIn} />\n      })}\n    </g>\n  </svg>;\n})\n\ninterface CourtProps {\n  currentFrameData?: Frame<PlayerID>\n}\nexport const Court = memo(function Court(props: CourtProps) {\n  const { currentFrameData } = props;\n\n  if (!currentFrameData)\n    return <></>\n\n  const { players, ball } = currentFrameData; // \n\n  const playerMarkers = players\n    ?.filter(({ tracking }) => tracking.x !== undefined && tracking.y !== undefined)\n    .map(({ tracking, id }, mIdx) => {\n      const { x: tx, y: ty } = tracking\n      const team = PLAYER_META[id].team\n\n      return <div key={id}\n        className=\"marker\"\n        style={{\n          top: ty! * scaleT2Minimap,\n          left: tx! * scaleT2Minimap,\n          backgroundColor: ['GSW', 'LAC'].includes(team) ? 'steelblue' : '#ff6347',\n          color: ball?.playerId === id ? 'red' : '#000',\n          fontSize: ball?.playerId === id ? '15px' : '12px'\n        }}\n      >{PLAYER_META[id]?.ln}</div>;\n    });\n\n  if (ball) {\n    playerMarkers?.push(<div key={'ball'}\n      className=\"marker\"\n      style={{\n        top: ball.tracking.y * scaleT2Minimap,\n        left: ball.tracking.x * scaleT2Minimap,\n        backgroundColor: 'orange'\n      }}\n    ></div>);\n  }\n\n  // id 201939\n  const playerId = ball?.playerId;\n  const playerWithBall = players?.find(p => p.id === playerId);\n\n  const currentBin = videoEnv.getCurrentBin(playerWithBall)\n  const playerBins = videoEnv.getPlayerBins(playerWithBall?.id)\n\n  return <div className=\"court\">\n    {playerId && <Hexagon\n      currentBin={currentBin}\n      playerBins={playerBins}\n    ></Hexagon>}\n    {playerMarkers}\n    <img\n      className=\"court-img\"\n      style={{ width: miniMapSize[0] }}\n      src={`${process.env.PUBLIC_URL}/court.png`}\n    >\n    </img>\n  </div>;\n\n})\nCourt.displayName = 'Court'\n","import React from \"react\";\nimport clsx from 'clsx';\n\nimport { Interval as TInterval } from '../../@types'\n\ntype Direction = 'e' | 'w'\n\ninterface Props extends TInterval {\n  id: number\n  focused: boolean\n  initializing: boolean\n  x: number\n  w: number\n  style?: React.CSSProperties\n  onMoving: (id: number, updateInterval: { x: number, w: number }) => void\n  onAdjusting: (id: number, updateInterval: { x: number, w: number }) => void\n  onAdjustingEnd: (id: number, resizeIntervalEnd: { x: number, w: number }, end_?: boolean) => void\n  getEW: (id: number) => { ex: number, wx: number } | undefined\n  onClickInterval: (id: number) => void\n}\n\ninterface State {\n  isMoving: { ox: number } | null\n  isAdjusting: {\n    direction: Direction,\n    oBBox: { x: number, w: number },\n    ox: number\n  } | null\n  cursorStatus: 'movable' | 'resizable' | null\n}\n\nexport class Interval extends React.Component<Props, State> {\n\n  state: State = {\n    isMoving: null,\n    isAdjusting: null,\n    cursorStatus: null, //\n  }\n\n  componentDidMount() {\n    window.addEventListener('mousemove', this.onMoving)\n    window.addEventListener('mouseup', this.onMoveEnd)\n    window.addEventListener('mousemove', this.onResizing)\n    window.addEventListener('mouseup', this.onResizeEnd)\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('mousemove', this.onMoving)\n    window.removeEventListener('mouseup', this.onMoveEnd)\n    window.removeEventListener('mousemove', this.onResizing)\n    window.removeEventListener('mouseup', this.onResizeEnd)\n  }\n\n  /** Resizing the bbox */\n  onResizeStart = (e: React.MouseEvent<HTMLDivElement, MouseEvent>, direction: Direction) => {\n    if (e.button !== 0) return\n    e.stopPropagation()\n    const { x, w } = this.props\n    // \n    const mx = e.clientX\n\n    this.setState({\n      isAdjusting: {\n        direction,\n        oBBox: { x, w },\n        ox: mx // , \n      },\n      cursorStatus: 'resizable'\n    })\n    document.body.classList.add('adjusting', direction)\n  }\n\n  onResizing = (e: MouseEvent) => {\n    const { isAdjusting } = this.state\n    if (isAdjusting === null || e.button !== 0) return\n    e.preventDefault()\n    e.stopImmediatePropagation()\n\n    let { x, w, id } = this.props\n    const { direction, oBBox, ox } = isAdjusting\n    const mx = e.clientX\n    const dx = mx - ox\n\n    const { wx, ex } = this.props.getEW(id)!\n    switch (direction) {\n      case 'w':\n        // , xw\n        x = Math.min(oBBox.x + oBBox.w, oBBox.x + dx) // \n        x = Math.max(wx, x) // \n        w = Math.min(oBBox.x + oBBox.w - wx, oBBox.w - dx)   // \n        w = Math.max(0, w) // \n        break\n      case 'e':\n        // , w, 0\n        w = Math.max(0, oBBox.w + dx)\n        w = Math.min(ex - x, w)  // \n        break\n    }\n\n    this.props.onAdjusting?.(this.props.id, { x, w })\n  }\n\n  onResizeEnd = (e: MouseEvent) => {\n    const { isAdjusting } = this.state\n    if (isAdjusting === null || e.button !== 0) return\n    e.preventDefault()\n    e.stopImmediatePropagation()\n\n    let { x, w, id } = this.props\n    this.props.onAdjustingEnd?.(id, { x, w }, true)\n\n    this.setState({\n      isAdjusting: null\n    })\n    document.body.classList.remove('adjusting', 'w', 'e', 's', 'n')\n  }\n\n  /** Dragging the bbox */\n  onMoveStart = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    // not left click\n    if (e.button !== 0) return\n    e.stopPropagation()\n    e.preventDefault()\n\n    const { x } = this.props\n    const mx = e.clientX;\n    this.setState({\n      isMoving: { ox: mx - x },\n      cursorStatus: 'movable'\n    })\n  }\n\n  onMoving = (e: MouseEvent) => {\n    const { isMoving } = this.state\n    if (isMoving === null) return\n    e.preventDefault()\n    e.stopImmediatePropagation()\n\n    const mx = e.clientX\n    let { w, id } = this.props\n    const { wx, ex } = this.props.getEW(id)!\n    let newx = Math.max(wx, mx - isMoving.ox)\n    newx = Math.min(newx, ex - w)\n\n    this.props.onMoving?.(this.props.id, { x: newx, w })\n  }\n\n  onMoveEnd = (e: MouseEvent) => {\n    const { isMoving } = this.state\n    if (isMoving === null || e.button !== 0) return\n    e.preventDefault()\n    e.stopImmediatePropagation()\n\n    this.setState({ isMoving: null })\n  }\n\n  render() {\n    const { x, w, focused, initializing, style = {} } = this.props\n    const { isAdjusting, isMoving, cursorStatus } = this.state\n    return <div className={clsx('interval-container', { focused })}\n      style={{ left: x }}\n    >\n      <div\n        className={clsx('interval', cursorStatus)}\n        style={{ width: w, ...style }}\n        onMouseDown={e => {\n          const parentDim = e.currentTarget.parentElement!.getBoundingClientRect()\n          // local coordinate\n          const mx = e.clientX - parentDim.x\n\n          // detect if left or right edge\n          if (Math.abs(mx) < 3) {\n            this.onResizeStart(e, 'w')\n          } else if (Math.abs(mx - w) < 3) {\n            this.onResizeStart(e, 'e')\n          } else {\n            // not on the edge\n            this.onMoveStart(e)\n          }\n        }}\n        onMouseMove={e => {\n          if (isAdjusting || isMoving) return\n          // icon for the cursor status\n          const { w } = this.props\n          const parentDim = e.currentTarget.parentElement!.getBoundingClientRect()\n          // local coordinate in parent\n          const mx = e.clientX - parentDim.x\n\n          // detect if left or right edge\n          if (Math.abs(mx) < 3 || Math.abs(mx - w) < 3) {\n            this.setState({ cursorStatus: 'resizable' })\n          } else {\n            // not on the edge\n            this.setState({ cursorStatus: 'movable' })\n          }\n        }}\n        onClick={e => this.props.onClickInterval(this.props.id)}\n      >\n      </div>\n    </div>\n  }\n}","import \"./style.scss\";\nimport React from \"react\";\n\nimport { Interval, Clip, BaseVideo } from '../../@types'\nimport { intervalIdGen, localFIdxToGlobalFIdx } from '../../@utils'\n\nimport { Interval as CInterval } from './Interval'\n\nfunction pad(num: number) {\n  return (\"0\" + num).slice(-2);\n}\nfunction hhmmss(secs: number) {\n  const t = Math.floor(secs * 1000);\n  // const ms = t % 1000;\n  secs = Math.floor(t / 1000);\n  let minutes = Math.floor(secs / 60);\n  secs = secs % 60;\n  minutes = minutes % 60;\n  return `${pad(minutes)}:${pad(secs)}`;\n}\n\ninterface BaseProps<GameID extends string, VideoID extends string> {\n  mode?: 'S' | 'M' | 'L'\n\n  videos: BaseVideo<GameID, VideoID>[];\n  currentVideoIdx: number;\n  currentFrameIdx: number\n\n  // style\n  containerHeightPadding?: number\n\n  // encodedData?: TDataOption[]\n  children?: (globalTrackWidth: number, globalMaxFrames: number) => React.ReactNode\n  onClickInterval?: (clipId: number, globalFrameIdx: number) => void;  // \n}\n\nexport type TimelineProps<GameID extends string, VideoID extends string> = BaseProps<GameID, VideoID> & ({\n  enableClips: false\n} | {\n  enableClips: true\n  clips: Clip<VideoID>[]\n  focusedClipId: number\n\n  onUpsertClip?: (id: number, interval: Partial<Interval> | null) => void\n})\n\n// interface xProps {\n// showEvents: boolean\n// handlers\n// onParse: (id: number, rawtext: string, visFunc: (entities: Entity[]) => void) => void\n// onChangeText?: (id: number, rawtext: string) => void\n// }\n\ninterface State {\n  isDrawing: { intervalId: number, ox: number, omx: number } | null;  // omx: dx ox: \n}\n\nexport class Timeline<GameID extends string, VideoID extends string> extends React.Component<TimelineProps<GameID, VideoID>, State> {\n\n  get globalMaxFrames() { return this.props.videos.reduce((o, v) => o + v.maxFrame, -1) }\n  get trackWidthFactor() {\n    return this.globalMaxFrames < 500 ? 4 : 1\n  }\n  get totalTrackWidth() {\n    return this.globalMaxFrames * this.trackWidthFactor\n  }\n  get globalCurFrameIdx() {\n    const { currentFrameIdx, currentVideoIdx, videos } = this.props\n    return localFIdxToGlobalFIdx(currentVideoIdx, currentFrameIdx, videos)\n  }\n  get maxTime() { return this.props.videos.reduce((o, v) => o + v.maxFrame / v.frameRate, 0) }\n  get numberOfImg() { return Math.ceil(this.maxTime) * 2 }\n  get intervalSelectorHeight() {\n    const { mode = 'M' } = this.props\n    return mode === 'M'\n      ? 60\n      : mode === 'S'\n        ? 30\n        : 90\n  }\n  get containerHeight() {\n    const { containerHeightPadding = 60 } = this.props\n    return this.intervalSelectorHeight + containerHeightPadding\n  }\n\n  #pointer = React.createRef<HTMLDivElement>()\n  imgWidth = (this.intervalSelectorHeight * 1920) / 1080\n  parentOffsetx: number = 0\n  state: State = {\n    isDrawing: null,\n  }\n\n  canvas?: HTMLCanvasElement\n  ctx?: CanvasRenderingContext2D\n\n  componentDidMount() {\n    const { enableClips } = this.props\n\n    if (enableClips) {\n      window.addEventListener('mousemove', this.onDrawing)\n      window.addEventListener('mouseup', this.onDrawEnd)\n    }\n  }\n\n  componentDidUpdate(prevProps: Readonly<TimelineProps<GameID, VideoID>>): void {\n    if (prevProps.currentFrameIdx !== this.props.currentFrameIdx) {\n      if (this.#pointer.current) {\n        const bbox = this.#pointer.current.getBoundingClientRect()\n        if (bbox.left > (window.innerWidth || document.documentElement.clientWidth) || bbox.right < 0) {\n          console.log(bbox, window.innerWidth, document.documentElement.clientWidth)\n          this.#pointer.current.parentElement?.scrollTo({ behavior: 'smooth', left: bbox.left + 400 })\n          // .scrollIntoView({ behavior: \"smooth\", block: \"nearest\", inline: \"center\" })\n        }\n        // ;(this.#pointer.current as any).scrollIntoViewIfNeeded(true)\n      }\n    }\n\n    // const { pickedPlayers } = this.props\n    // if (Object.keys(preProps.pickedPlayers).length < Object.keys(pickedPlayers).length) {\n    //   const { ctx, globalCurFrameIdx } = this\n    //   const maxFIdx = Math.max(...Object.keys(pickedPlayers).map(f => +f))\n    //   const { lv1Players, lv2Players } = pickedPlayers[maxFIdx]\n    //   const maxY = 40\n\n    //   const playersOn = Object.values(lv2Players).filter(p => p.on)\n    //   let y1 = maxY - playersOn.length * 5\n    //   ctx!.lineWidth = 1\n    //   ctx!.strokeStyle = 'red'\n    //   ctx!.beginPath()\n    //   ctx?.moveTo(globalCurFrameIdx, y1)\n    //   ctx?.lineTo(globalCurFrameIdx, maxY)\n    //   ctx!.stroke()\n\n    //   const lv1NotOnNotEmpty = Object.keys(lv1Players)\n    //     .filter(pId => !playersOn.find(p => p.id === +pId) && lv1Players[+pId as PlayerId].type !== KeyPlayerType.EMPTY_PLAYER)\n    //   ctx!.strokeStyle = '#f5f5f5'\n    //   let y2 = y1 - lv1NotOnNotEmpty.length * 5\n    //   ctx?.beginPath()\n    //   ctx?.moveTo(globalCurFrameIdx, y2)\n    //   ctx?.lineTo(globalCurFrameIdx, y1)\n    //   ctx!.stroke()\n\n\n    //   const lv1NotOnEmpty = Object.keys(lv1Players)\n    //     .filter(pId => !playersOn.find(p => p.id === +pId) && lv1Players[+pId as PlayerId].type === KeyPlayerType.EMPTY_PLAYER)\n    //   ctx!.strokeStyle = '#f5f5f5'\n    //   let y3 = y2 - lv1NotOnEmpty.length * 5\n    //   ctx?.beginPath()\n    //   ctx?.moveTo(globalCurFrameIdx, y3)\n    //   ctx?.lineTo(globalCurFrameIdx, y2)\n    //   ctx!.stroke()\n    // }\n\n\n    // const { ctx } = this\n    // if (prevProps.videos.length !== this.props.videos.length && ctx) {\n    //   ctx!.lineWidth = 1\n    //   ctx!.strokeStyle = 'green'\n    //   ctx!.beginPath()\n    //   ctx?.moveTo(0, 40 - 5 * 3)\n    //   ctx?.lineTo(this.totalTrackWidth, 40 - 5 * 3)\n    //   ctx!.stroke()\n\n    //   ctx!.beginPath()\n    //   ctx?.moveTo(0, 40 - 5 * 4)\n    //   ctx?.lineTo(this.totalTrackWidth, 40 - 5 * 4)\n    //   ctx!.stroke()\n    // }\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('mousemove', this.onDrawing)\n    window.removeEventListener('mouseup', this.onDrawEnd)\n  }\n\n  /** Draw interval */\n  onDrawStart = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    if (e.button !== 0) return;\n\n    const parentDim = e.currentTarget.parentElement!.getBoundingClientRect()\n    this.parentOffsetx = -parentDim.x + e.currentTarget.scrollLeft\n    const mx = e.clientX // , \n    const ox = mx + this.parentOffsetx // interval, \n\n    // click on progressbar\n    if (e.clientY >= parentDim.bottom - 8) return\n\n    if (!this.props.enableClips) {\n      const globalFrameIdx = this.pos2frame(ox)\n      this.props.onClickInterval?.(-1, globalFrameIdx)\n    } else {\n      const { clips } = this.props\n      // if click within an interval\n      if (clips.find(i => this.frame2pos(i.interval.start) <= ox && ox <= this.frame2pos(i.interval.end))) {\n        const curFrame = this.pos2frame(ox)\n        this.props.onClickInterval?.(-1, curFrame)\n      } else {\n        // id\n        const newIntervalId = intervalIdGen()\n        // interval interval\n        let i = 0;\n        for (; i < clips.length; i++) {\n          if (this.frame2pos(clips[i].interval.start) > ox) {\n            break;\n          }\n        }\n\n        const startFrame = this.pos2frame(ox)\n        const endFrame = this.pos2frame(ox + 0)\n        const newInterval: Interval = {\n          // x: ox,\n          // w: 0,\n          start: startFrame,\n          end: endFrame\n        }\n        this.props.onUpsertClip?.(newIntervalId, newInterval)\n\n        this.setState({\n          isDrawing: { intervalId: newIntervalId, omx: mx, ox: ox },\n        })\n      }\n    }\n  }\n\n  onDrawing = (e: MouseEvent) => {\n    const { isDrawing } = this.state\n    if (e.button !== 0 || isDrawing === null || !this.props.enableClips) return;\n\n    const { clips } = this.props\n    const mx = e.clientX\n    const drawingInterval = clips.find(int => int.id === isDrawing.intervalId) //  \n    if (!drawingInterval) return\n\n    // intervalxwidth\n    let dx = mx - isDrawing.omx // x\n    // \n    const { wx, ex } = this.getEW(drawingInterval.id)!\n    const maxdx = ex - isDrawing.ox\n    const mindx = wx - isDrawing.ox\n    if (dx < mindx) {\n      dx = mindx\n    } else if (dx > maxdx) {\n      dx = maxdx\n    }\n\n    const startFrame = dx > 0 ? drawingInterval.interval.start : this.pos2frame(Math.max(isDrawing.ox + dx, 0))\n    const w = Math.abs(dx)\n    const endFrame = startFrame + this.pos2frame(w)\n    this.props.onUpsertClip?.(drawingInterval.id, { start: startFrame, end: endFrame })\n  }\n\n  onDrawEnd = (e: MouseEvent) => {\n    const { isDrawing } = this.state\n    if (e.button !== 0 || isDrawing === null || !this.props.enableClips) return\n    const { clips } = this.props\n    const drawingIntervalIdx = clips.findIndex(int => int.id === isDrawing.intervalId)\n    if (drawingIntervalIdx === -1) return\n\n    const drawingInterval = clips[drawingIntervalIdx]\n\n    this.setState({ isDrawing: null })\n    const { start, end } = drawingInterval.interval\n    if (end - start <= 2) {\n      this.props.onUpsertClip?.(drawingInterval.id, null)\n    }\n    this.props.onClickInterval?.(drawingInterval.id, start)\n  }\n\n  updateInterval = (clipId: number, newInterval: { x?: number, w?: number }, end_ = false) => {\n    if (!this.props.enableClips) return\n\n    const { clips } = this.props\n    const targetIntervalIdx = clips.findIndex(int => int.id === clipId)\n    const targetInterval = clips[targetIntervalIdx].interval\n\n    const start = newInterval.x ? this.pos2frame(newInterval.x) : targetInterval.start\n    const end = newInterval.w ? (this.pos2frame(newInterval.w) + start) : targetInterval.end\n\n    this.props.onUpsertClip?.(clipId, ((end - start <= 2) && end_) ? null : { start, end })\n  }\n\n  getEW = (intervalIdx: number) => {\n    if (!this.props.enableClips) return\n\n    const { clips } = this.props\n    const { numberOfImg } = this\n\n    const intervalCount = clips.findIndex(int => int.id === intervalIdx)!\n    let ex = 0, wx = 0\n\n    if (intervalCount === 0) {\n      wx = this.parentOffsetx\n    } else {\n      wx = this.frame2pos(clips[intervalCount - 1].interval.end) + 1\n    }\n\n    if (intervalCount === clips.length - 1) {\n      ex = (this.intervalSelectorHeight * 1920) / 1080 * numberOfImg + this.parentOffsetx\n    } else {\n      ex = this.frame2pos(clips[intervalCount + 1].interval.start) - 1\n    }\n\n    return { wx, ex }\n  }\n\n  pos2frame = (pos: number) => {\n    const { totalTrackWidth: trackWidth, globalMaxFrames: maxFrame } = this\n    return Math.round(Math.min(pos, trackWidth) / trackWidth * maxFrame)\n  }\n  frame2pos = (frame: number) => {\n    const { totalTrackWidth: trackWidth, globalMaxFrames: maxFrame } = this\n    return (frame / maxFrame) * (trackWidth)\n  }\n\n  // renderIndicator() {\n  //   const { events, maxFrame, clips, encodedData = [] } = this.props\n  //   const { imgWidth, numberOfImg } = this\n\n  //   const indicators = []\n  //   for (const clip of clips) {\n  //     const { interval } = clip\n  //     const coverEvents = events.filter(evt => evt.to >= interval.start && evt.from <= interval.end)\n  //     for (const coverEvt of coverEvents) {\n  //       if ((coverEvt?.type === EvtType.PlayerHit || coverEvt?.type === EvtType.PlayerMove)\n  //         && encodedData.some(k => toPause.has(k))) {\n  //         indicators.push(coverEvt)\n  //         break\n  //       }\n  //     }\n  //   }\n\n  //   // render indicators\n  //   return indicators.map(evt => {\n  //     return <div key={`${evt.type}_${evt.from}_${evt.to}`} className={'trigger'} style={{\n  //       left: `${imgWidth * numberOfImg * evt.data.hit! / maxFrame}px`,\n  //     }}>\n\n  //     </div>\n  //   })\n  // }\n\n  renderClips() {\n    if (!this.props.enableClips) return\n    const { clips, focusedClipId } = this.props\n    const { isDrawing } = this.state\n\n    return clips.map(({ id: intervalId, interval }, idx) =>\n      <CInterval\n        key={intervalId}\n        id={intervalId}\n        x={this.frame2pos(interval.start)}\n        w={this.frame2pos(interval.end - interval.start)}\n        style={{ height: `${this.intervalSelectorHeight + 10}px` }}\n        focused={focusedClipId === intervalId}\n        onMoving={this.updateInterval}\n        onAdjusting={this.updateInterval}\n        onAdjustingEnd={this.updateInterval}\n        getEW={this.getEW}\n        initializing={isDrawing?.intervalId === intervalId}\n        onClickInterval={(id) => {\n          this.props.onClickInterval?.(intervalId, interval.start)\n        }}\n        {...interval}\n      />\n    )\n  }\n\n  render() {\n    const { currentFrameIdx, videos } = this.props;\n    const { maxTime, globalMaxFrames: maxFrame, intervalSelectorHeight, globalCurFrameIdx, containerHeight } = this\n\n    const currentTime = currentFrameIdx / (videos[0]?.frameRate ?? 30)\n\n    return (\n      <div className=\"timeline-container\" style={{ flex: `0 0 ${containerHeight}px` }}>\n        <div className=\"timeline\"\n          onMouseDown={this.onDrawStart}>\n          <div className=\"time-info\">\n            <span>\n              {\" \"}\n              {hhmmss(currentTime)} ({currentFrameIdx}) / {hhmmss(maxTime)} ({maxFrame})\n            </span>\n          </div>\n          <div className=\"pointer\" ref={this.#pointer}\n            style={{\n              left: `calc(12px + ${this.frame2pos(globalCurFrameIdx)}px)`,\n            }}\n          ></div>\n\n          <div id=\"timeline-progress\" className=\"track-container\">\n            {videos.map(v => <div\n              key={v.id}\n              className=\"track\"\n              style={{\n                width: `${v.maxFrame * this.trackWidthFactor}px`,\n                height: intervalSelectorHeight,\n                backgroundColor: v.isTransit ? '#515151' : 'rgb(116 99 57)',\n                opacity: ((v.isTransit || v.loadedData === 1) && v.loadedVideo === 1) ? 1 : 0.5\n              }}>\n              <span className=\"video-name\">{v.id}</span>\n              {/* {this.renderIndicator()} */}\n              {this.props.children?.(this.totalTrackWidth, this.globalMaxFrames)}\n            </div>\n            )}\n            {/*<div className=\"track\">\n               {Array(numberOfImg).fill(0)\n                .map((_, idx) => (\n                  <img\n                    alt='bg'\n                    key={`img_${idx}`}\n                    className=\"img\"\n                    src={`/assets/${videoId}/reduced_frames/${Math.floor(\n                      (maxFrame * idx) / numberOfImg\n                    )}.jpg`}\n                    // x={idx * imgWidth}\n                    draggable=\"false\"\n                    height={this.intervalSelectorHeight}\n                    width={imgWidth}\n                  />\n                ))} \n            </div>*/}\n            {this.renderClips()}\n          </div>\n\n          {/* <canvas\n            ref={ref => {\n              if (!ref || this.canvas) return\n              this.canvas = ref\n              this.ctx = ref.getContext('2d')!\n            }}\n            className=\"debug-timeline\"\n            width={`${this.totalTrackWidth}px`}\n            height={`${40}px`}>\n          </canvas> */}\n\n        </div>\n      </div>\n    );\n  }\n}\n","import './style.scss'\nimport React from 'react'\n\nimport type { Ball, Frame, BasePlayer, BaseVideo } from '../../@types'\n\nexport interface SVGLayerProps<GameID extends string, VideoID extends string, PlayerID extends number> {\n  // width: number\n  // height: number\n  currentVideo: BaseVideo<GameID, VideoID>\n  currentFrameData?: Frame<PlayerID>\n  activeBBoxes?: Array<PlayerID | 'ball'>\n\n  // animatedFrameIdx: number\n  onContextMenu?: (e: React.MouseEvent<SVGSVGElement, MouseEvent>) => void\n  onClickBG?: () => void\n  onClickPlayer?: (player: BasePlayer<PlayerID>, idx: number) => void\n  onClickBall?: (ball: Ball) => void\n  onDBClick?: () => void\n}\n\nfunction convertRemToPixels(rem: number) {\n  return rem * parseFloat(getComputedStyle(document.documentElement).fontSize);\n}\n\nexport class SVGLayer<GameID extends string, VideoID extends string, PlayerID extends number> extends React.Component<SVGLayerProps<GameID, VideoID, PlayerID>> {\n\n  render() {\n    const {\n      currentVideo,\n      currentFrameData,\n      activeBBoxes\n    } = this.props\n    const { height = 0, width = 0 } = currentVideo ?? {}\n\n    const players = currentFrameData?.players ?? []\n    const ball = currentFrameData?.ball ?? null\n\n    return <svg className=\"overlay\" height={height} width={width}\n      viewBox={`0 0 ${width} ${height}`}\n      preserveAspectRatio='xMinYMin meet'\n      onClick={(e) => {\n        if (e.target === e.currentTarget)\n          this.props.onClickBG?.()\n      }}\n      onContextMenu={this.props.onContextMenu}\n      onDoubleClick={e => {\n        if (e.target === e.currentTarget)\n          this.props.onDBClick?.()\n      }}\n    >\n      <defs>\n        <filter x=\"0\" y=\"0\" width=\"1\" height=\"1\" id=\"solid\">\n          <feFlood floodColor=\"yellow\" result=\"bg\" />\n          <feMerge>\n            <feMergeNode in=\"bg\" />\n            <feMergeNode in=\"SourceGraphic\" />\n          </feMerge>\n        </filter>\n      </defs>\n\n      {players.map((player, idx) => <rect key={idx}\n        className={`bbox ${activeBBoxes?.includes(player.id) ? 'active' : ''}`}\n        x={player.bbox.x}\n        y={player.bbox.y}\n        width={player.bbox.w}\n        height={player.bbox.h}\n\n        onContextMenu={e => {\n          e.preventDefault()\n          e.stopPropagation()\n          // this.props.onClickPersonBBox(idx, b)\n        }}\n        onClick={e => {\n          e.stopPropagation()\n          this.props.onClickPlayer?.(player, idx)\n        }}\n      />)}\n\n      {ball && <circle\n        className={`ball ${activeBBoxes?.includes('ball') ? 'active' : ''}`}\n        cx={ball.screenPos.x}\n        cy={ball.screenPos.y}\n        r={5} // hardcode value\n        onClick={e => {\n          e.stopPropagation()\n          this.props.onClickBall?.(ball)\n        }}\n      >\n      </circle>}\n      {this.props.children}\n    </svg>\n  }\n}","import React from 'react'\n\nimport { SVGLayer, SVGLayerProps } from 'common/@components'\nimport { GameID, Gaze, Player, PlayerID, PLAYER_STATUS, VideoID } from '@types'\nimport { GAZE_R, PLAYER_META } from '@const'\nimport { Frame } from 'common/@types'\n\ninterface Props extends SVGLayerProps<GameID, VideoID, PlayerID> {\n  currentFrameData?: Frame<PlayerID>\n\n  gazePlayers?: Player[]\n  gaze?: Gaze\n  // sync?: boolean\n  bbox?: boolean\n}\n\nexport class Overlay extends React.Component<Props> {\n\n  render() {\n    const {\n      gaze,\n      gazePlayers,\n      bbox = true,\n      currentFrameData,\n      ...svgLayerProps\n    } = this.props\n    const { teamWithBall, ball, players } = currentFrameData ?? {}\n    const { isTransit } = svgLayerProps.currentVideo ?? {}\n\n    return <SVGLayer\n      {...svgLayerProps}\n    >\n\n      {gaze && <g transform={`translate(${gaze.x}, ${gaze.y})`}>\n        <circle r={GAZE_R}\n          stroke={'red'}\n          fill={'rgba(255, 0, 0, 0.1)'}></circle>\n        <text\n          textAnchor=\"middle\"\n          // stroke=\"#fff\"\n          fill='#fff'\n          // stroke-width=\"1px\"\n          alignmentBaseline=\"middle\"\n        >\n          {(gaze.x).toFixed(0)}, {(gaze.y).toFixed(0)}\n          fIdx: {gaze.fIdx}\n        </text>\n      </g>\n      }\n\n      {!isTransit && <text x={10} y={20} fill={'#fff'}>Team w/ ball: {teamWithBall}</text>}\n      {!isTransit && <text x={150} y={20} fill={'#fff'}>Ballholder: {ball?.playerId ? PLAYER_META[ball!.playerId].ln : null}</text>}\n      {/* {!isTransit && <text x={350} y={20} fill={'#fff'}>FrameIdx: {frameIdx}</text>} */}\n\n      {!isTransit && bbox && players\n        ?.filter(({ dataPkg }) => dataPkg)\n        .map(({ bbox, id, dataPkg }) => {\n          return <g\n            key={id}\n            className={`bbox ${gazePlayers?.some(p => p.id === id) ? 'active' : ''}`}\n            transform={`translate(${bbox.x}, ${bbox.y})`}>\n            <rect\n              width={bbox.w}\n              height={bbox.h}\n            />\n            {dataPkg && <text\n              fill='#fff'\n              alignmentBaseline=\"middle\"\n            >\n              {`${dataPkg.mode}, v: ${(dataPkg?.mode === PLAYER_STATUS.defensive\n                ? dataPkg.diff\n                : dataPkg.regionExp).toFixed(1)}`}\n            </text>\n            }\n          </g>\n        }\n        )}\n    </SVGLayer>\n  }\n}\n","export default function Worker_fn() {\n  return new Worker(__webpack_public_path__ + \"static/js/loadFrames.worker.204ea63a.js\");\n}\n","import type {\n  Frame,\n  BaseVideo,\n  CacheFrameData\n} from \"../@types\"\nimport { DEBUG } from '../@const';\nimport { getImg, wait, debugMem, ArrayToDict, waitUntil, wrapWorker } from '../@utils';\n\nimport MyWorker from './loadFrames.worker';\n\nexport class DataLoader<GameID extends string, VideoID extends string, PlayerID extends number> {\n\n  // shotRecords: ShotRecord[] = []\n  #Loading: Partial<Record<VideoID, boolean>> = {}\n\n  // video data per frame\n  memVideoData: Partial<Record<VideoID, Record<number, Frame<PlayerID>>>> = {}\n\n  onLoad?: (videoId: VideoID, progress?: number) => void\n  onUnload?: (videoId: VideoID) => void\n\n  #getFrames: (video: BaseVideo<GameID, VideoID>) => Promise<CacheFrameData<PlayerID>[] | undefined>\n  constructor(readonly worker: { new(): Worker } = MyWorker) {\n    this.#getFrames = wrapWorker<[BaseVideo<GameID, VideoID>], CacheFrameData<PlayerID>[] | undefined>(worker, 'Frames', (d) => {\n      if (d[0] === 'Progress') {\n        const [_, vId, progress] = d\n        this.onLoad?.(vId, progress)\n      }\n    })\n  }\n\n  /**\n   * ----------------- Data Loading --------------------\n   */\n  isLoaded(video: BaseVideo<GameID, VideoID>) {\n    return video.isTransit || video.id in this.memVideoData\n  }\n  getVideoData(videoId: VideoID) {\n    return this.memVideoData[videoId]\n  }\n\n  #pre_load_batch_size = 50\n  async fetch(video: BaseVideo<GameID, VideoID>, shouldWait: boolean = false) {\n\n    if (this.#Loading[video.id]) {\n      // wait until anothe thread finish\n      await waitUntil(() => !this.#Loading[video.id])\n      return\n    }\n\n    this.#Loading[video.id] = true\n    console.debug('preload===>', video)\n    // if not in mem, load from db\n    if (!this.isLoaded(video)) {\n      // step 1, get from db\n      const frames = await this.#getFrames(video)\n      if (!frames) {\n        this.#Loading[video.id] = false\n        return\n      }\n      const progressOffset = 0.6\n      this.onLoad?.(video.id, progressOffset)\n\n      // step2, process to mem\n      console.log(`%cMain thread processing ${video.id} to mem =====>`, 'color:#f5f5f5;background: #00695c; padding: 2px; border-radius:2px')\n      // should not do at once, chunck frames into groups\n      let framesToSave: Frame<PlayerID>[] = []\n      console.debug('===>parsing blob to img...')\n      for (let i = 0; i < Object.keys(frames).length; i += this.#pre_load_batch_size) {\n        const itemsForBatch = frames.slice(i, i + this.#pre_load_batch_size)\n        framesToSave = [\n          ...framesToSave,\n          ...(await Promise.all(itemsForBatch.map(async (frame) => {\n            const mask = await getImg(URL.createObjectURL(frame.mask!))\n            return { ...frame, mask } as any as Frame<PlayerID>\n          })))\n        ]\n        this.onLoad?.(video.id, progressOffset + (0.95 - progressOffset) * i / Object.keys(frames).length)\n\n        if (shouldWait) {\n          await wait(30)\n        }\n      }\n      // sort\n      framesToSave.sort((a, b) => a.idx - b.idx)\n      console.debug(`<=====${video.id} Done!`, framesToSave[0])\n      // Step3. save to mem\n      this.memVideoData[video.id] = ArrayToDict(framesToSave, 'idx')\n      this.onLoad?.(video.id, 1)\n      DEBUG.DEBUG_MEM && debugMem()\n\n      console.log(`%cMain thread done processing ${video.id} to mem<======`, 'color:#f5f5f5;background: #00695c; padding: 2px; border-radius:2px')\n    }\n    this.#Loading[video.id] = false\n  }\n\n  unloadFromMem(video?: BaseVideo<GameID, VideoID>) {\n    if (video === undefined || video.isTransit) return\n    delete this.memVideoData[video.id]\n    this.onUnload?.(video.id)\n    DEBUG.DEBUG_MEM && debugMem()\n  }\n}","\nimport Dexie from 'dexie';\nimport { CacheFrameData, VideoDataVersion } from '../@types'\n\ninterface BaseTables<PID extends number> {\n  frames: CacheFrameData<PID>,\n  videoDataVersions: VideoDataVersion\n}\n\nexport class Database<PID extends number, T extends Record<string, any> = {}, K = T & BaseTables<PID>> extends Dexie {\n  // meta\n  public readonly myTables: { [k in keyof K]: Dexie.Table<K[k]> }\n\n  constructor(stores?: Record<keyof T, string>) {\n    super(\"Database\");\n    this.version(6).stores({\n      frames: \"[gameId+videoId+idx]\",\n      videoDataVersions: \"[gameId+videoId]\",\n      ...(stores ?? {})\n    });\n\n    this.myTables = ['frames', 'videoDataVersions', ...Object.keys(stores ?? {})]\n      .reduce((o, d) => {\n        o[d as keyof K] = this.table(d)\n        return o\n      }, {} as Record<keyof K, Dexie.Table<any>>)\n\n  }\n}","import { DEBUG } from \"../../@const\"\nimport type { BaseVideo } from \"../../@types\"\nimport { debugMem, waitUntil } from \"../../@utils\"\n\n\nexport class VideoLoader<GameID extends string, VideoID extends string> {\n  #Loading: Partial<Record<VideoID, boolean>> = {}\n\n  onLoad?: (videoId: VideoID) => void\n  onUnload?: (videoId: VideoID) => void\n  private memVideos: Partial<Record<VideoID, HTMLVideoElement>> = {}\n\n  getVideo(videoId: VideoID) {\n    return this.memVideos[videoId]\n  }\n\n  isLoaded(video: BaseVideo<GameID, VideoID>) {\n    return video.id in this.memVideos\n  }\n\n  async fetch(video: BaseVideo<GameID, VideoID>) {\n\n    if (this.#Loading[video.id]) {\n      // wait until anothe thread finish\n      await waitUntil(() => !this.#Loading[video.id])\n      return\n    }\n\n    this.#Loading[video.id] = true\n    if (!this.isLoaded(video)) {\n      console.debug('VideoLoader.preLoadToMem', video)\n      const nextVideo = document.createElement('video')\n      nextVideo.src = `${process.env.PUBLIC_URL}/assets/${video.gameId}/${video.id}/${video.id}.mp4`\n      nextVideo.id = video.id\n      nextVideo.load()\n      await new Promise(resolve => {\n        // nextVideo.onloadedmetadata = () => console.log('onloadedmetadata', video.id)\n        nextVideo.onloadeddata = resolve\n      })\n      console.debug('VideoLoader.preLoadToMem ==> Done', video)\n\n      // load to mem\n      this.memVideos[video.id] = nextVideo\n      this.onLoad?.(video.id)\n      DEBUG.DEBUG_MEM && debugMem()\n    }\n    this.#Loading[video.id] = false\n  }\n}\n","import type { BaseVideo } from \"../../@types\"\nimport { VideoLoader } from './VideoLoader'\n\nclass VideoTrack<GameID extends string, VideoID extends string> {\n  private get frameOffset() {\n    // hardcode value, I dont know why\n    return this.#videoMeta?.frameRate === 50 ? 0 : 1\n  }\n\n  #videoMeta?: BaseVideo<GameID, VideoID>\n  #video?: HTMLVideoElement\n  get video() { return this.#video }\n  get id() { return this.#video?.id }\n\n  CallBackHandle: number | null = null\n\n  onPlay: EventListener | null = null\n  onPause: EventListener | null = null\n  setVideo(video: BaseVideo<GameID, VideoID>, videoElm: HTMLVideoElement | undefined) {\n    this.#video = videoElm\n    this.#video?.requestVideoFrameCallback(this.invokeFrameHandlers)\n    this.#videoMeta = video\n  }\n  load(onPlay: EventListener, onPause: EventListener) {\n    this.onPlay = onPlay\n    this.onPause = onPause\n    this.#video?.addEventListener('play', onPlay)\n    this.#video?.addEventListener('pause', onPause)\n  }\n\n  unLoad() {\n    if (this.onPlay)\n      this.#video?.removeEventListener('play', this.onPlay)\n    if (this.onPause)\n      this.#video?.removeEventListener('pause', this.onPause)\n    if (this.CallBackHandle !== null)\n      this.#video?.cancelVideoFrameCallback(this.CallBackHandle)\n    this.#video?.load()\n    this.#video = undefined\n    this.#videoMeta = undefined\n  }\n\n  constructor(public readonly name: string, private readonly videoPlayer: VideoPlayer<GameID, VideoID>) { }\n\n  play() {\n    this.#video?.play()\n  }\n\n  invokeFrameHandlers: VideoFrameRequestCallback = (now, metadata) => {\n  \n    if (this.#video === this.videoPlayer.currentTrack) {\n      const rawFrame = Math.round(metadata.mediaTime * this.#videoMeta!.frameRate) //when play, videoMeta must set\n      const frameIdx = rawFrame - this.frameOffset\n      const videoId = this.videoPlayer.currentTrack!.id\n      for (let i = 0, len = this.videoPlayer.onFrameHandlers.length; i < len; ++i) {\n        this.videoPlayer.onFrameHandlers[i].call(this, videoId, frameIdx, Date.now(), this.videoPlayer.currentTrack!)\n      }\n    }\n\n    if (this.#video) {\n      this.CallBackHandle = this.#video?.requestVideoFrameCallback(this.invokeFrameHandlers)\n    }\n  }\n}\n\nexport class VideoPlayer<GameID extends string, VideoID extends string> {\n  protected _currentTrack?: HTMLVideoElement\n  public get currentTrack() { return this._currentTrack }\n  // video meta\n  #currentVideo: BaseVideo<GameID, VideoID> | null = null\n  protected set currentVideo(v) { this.#currentVideo = v }\n  get currentVideo() { return this.#currentVideo }\n\n  // video sources\n  videoSources = new VideoLoader<GameID, VideoID>()\n\n  /**\n   * A video player has two video track.\n   * It uses one track to preload, and the other track to play\n   */\n  protected ATrack = new VideoTrack<GameID, VideoID>('A', this)\n  protected BTrack = new VideoTrack<GameID, VideoID>('B', this)\n  onFrameHandlers: Array<(vId: string, fIdx: number, ts: number, videoFrame: HTMLVideoElement) => void> = []\n\n  // event handlers\n  onPlay?: (videoId: VideoID) => void\n  onPause?: (videoId: VideoID) => void\n  onLoad?: (videoId: VideoID, type: 'Video' | 'Data', progress?: number) => void\n  onUnload?: (videoId: VideoID, type: 'Video' | 'Data') => void\n  public videos: BaseVideo<GameID, VideoID>[] = []\n\n  constructor() {\n    // auto switch to the next clip\n    this.addOnFrameListener(async (videoId, frameIdx, ts, videoFrame) => {\n      const curVideoIdx = this.videos.findIndex(v => v.id === videoId)\n      if (curVideoIdx === -1) {\n        console.warn('There must be something wrong since it cannot find the video from the videoList in the videoPlayer', videoId, this.videos)\n        return\n      }\n\n      // preload to the other track\n      if (frameIdx + 5 === this.currentVideo?.maxFrame) {\n        // should load next\n        const nextVideoIdx = curVideoIdx + 1\n        if (this.videos[nextVideoIdx] !== undefined) {\n          this.preloadToAnotherTrack(this.videos[nextVideoIdx], true)\n        }\n      }\n\n      // load to the current track\n      if (frameIdx + 1 === this.currentVideo?.maxFrame) {\n        const nextVideoIdx = curVideoIdx + 1\n        if (this.videos[nextVideoIdx] === undefined) {\n          this.pause()\n          return\n        }\n        await this.loadVideo(this.videos[nextVideoIdx], true)\n        // should also load data after extension\n      }\n    })\n\n    // videoSources\n    this.videoSources.onLoad = (videoId: VideoID) => {\n      this.onLoad?.(videoId, 'Video')\n    }\n    this.videoSources.onUnload = (videoId: VideoID) => {\n      this.onUnload?.(videoId, 'Video')\n    }\n  }\n\n  addOnFrameListener(fn: (vId: string, frameIdx: number, ts: number, videoFrame: HTMLVideoElement) => void) {\n    this.onFrameHandlers.splice(this.onFrameHandlers.length - 2, 0, fn)\n  }\n\n  // data control\n  async fetchVideos() {\n    for (const video of this.videos) {\n      await this.videoSources.fetch(video)\n    }\n  }\n  isLoaded(video: BaseVideo<GameID, VideoID>) {\n    return this.videoSources.isLoaded(video)\n  }\n\n  // this is for assertion?\n  private whichOnPause = (ev: Event) => {\n    const v = ev.target as HTMLVideoElement\n    if (v.id === this.currentTrack?.id) {\n      this.onPause?.(v.id as VideoID)\n    }\n  }\n  private whichOnPlay = (ev: Event) => {\n    const v = ev.target as HTMLVideoElement\n    if (v.id === this.currentTrack?.id) {\n      this.onPlay?.(v.id as VideoID)\n    }\n  }\n\n  // video track control\n  async loadVideo(video: BaseVideo<GameID, VideoID>, play = false) {\n    // not load\n    if (this.currentTrack?.id === video.id) return\n    this.currentVideo = video\n\n    // ensure load to preTrack\n    if (this.ATrack.id !== video.id && this.BTrack.id !== video.id) {\n      await this.preloadToAnotherTrack(video, play)\n    }\n\n    const [trackToLoad, trackToUnload] = this.ATrack.id === video.id\n      ? [this.ATrack, this.BTrack]\n      : [this.BTrack, this.ATrack]\n    console.debug(`TrackToLoad: ${trackToLoad.name}_${trackToLoad.id} ${trackToLoad.video?.currentTime}, TrackToUnload: ${trackToUnload.name}_${trackToUnload.id}`)\n\n    // clean the currentTrack\n    trackToUnload.unLoad()\n    trackToLoad.load(this.whichOnPlay, this.whichOnPause)\n    this._currentTrack = trackToLoad.video\n  }\n\n  async preloadToAnotherTrack(newVideo: BaseVideo<GameID, VideoID>, play: boolean) {\n    console.log('%cpreloadToSkip', 'background: #444; color: #bada55; padding: 2px; border-radius:2px', newVideo)\n    await this.videoSources?.fetch(newVideo)\n\n    // load to the ohter track, prefer ATrack\n    const trackToLoad = this.BTrack.id === this.currentTrack?.id\n      ? this.ATrack\n      : this.BTrack\n    console.debug(`Load to track_${trackToLoad.name}`)\n\n    trackToLoad.setVideo(newVideo, this.videoSources?.getVideo(newVideo.id))\n    play && trackToLoad.play()\n  }\n\n  // video control\n  play() {\n    if (!this.currentTrack || !this.currentTrack.paused) return\n    console.debug('play video')\n    // this.currentTrack.playbackRate = 0.75\n    this.currentTrack.play()\n    this.onPlay?.(this.currentTrack?.id as VideoID)\n  }\n\n  pause() {\n    if (this.currentTrack?.paused) return\n    this.currentTrack?.pause()\n    this.onPause?.(this.currentTrack?.id as VideoID)\n  }\n\n  async seekTo(video: BaseVideo<GameID, VideoID>, frameIdx: number) {\n    await this.loadVideo(video)\n\n    this.currentTrack!.currentTime = (frameIdx / video.frameRate) + 0.001\n    console.debug('switch to video:', video, 'set currentTime to frameIdx', frameIdx)\n  }\n}\n","import { Frame, BaseVideo } from '../@types'\n\nimport { DataLoader } from '../DataLoader'\nimport { VideoPlayer } from './VideoPlayer'\n\nexport class VideoEnv<\n  GameID extends string,\n  VideoID extends string,\n  PlayerID extends number\n> extends VideoPlayer<GameID, VideoID> {\n\n  /**\n   * add a dataLoader to the VideoPlayer\n   */\n  // dataLoader: DataLoader\n\n  // data\n  #frames: Record<number, Frame<PlayerID>> | undefined\n  get frames() { return this.#frames }\n  set frames(v) { this.#frames = v }\n\n  // combine event\n  constructor(readonly dataLoader: DataLoader<GameID, VideoID, PlayerID> = new DataLoader()) {\n    super()\n    // this.dataLoader = new DataLoader(postProcessingData)\n    // combine event\n    this.dataLoader.onLoad = (videoId: VideoID, progres?: number) => {\n      this.onLoad?.(videoId, 'Data', progres)\n    }\n    this.dataLoader.onUnload = (videoId: VideoID) => {\n      this.onUnload?.(videoId, 'Data')\n    }\n  }\n\n  async fetchVideos() {\n    super.fetchVideos()\n    for (const video of this.videos) {\n      await this.dataLoader.fetch(video)\n    }\n  }\n\n  isLoaded(video: BaseVideo<GameID, VideoID>) {\n    return this.dataLoader.isLoaded(video) && super.isLoaded(video)\n  }\n\n  async loadVideo(video: BaseVideo<GameID, VideoID>, play = false) {\n    // not load\n    if (this.currentTrack?.id === video.id) return\n    super.loadVideo(video, play)\n    // load data\n    await this.dataLoader.fetch(video)\n    this.frames = this.dataLoader.getVideoData(video.id)\n  }\n\n  // one off data load\n  // async loadBins() {\n  //   return this.dataLoader.loadBins()\n  // }\n}","export default function Worker_fn() {\n  return new Worker(__webpack_public_path__ + \"static/js/loadData.worker.8a7f35a0.js\");\n}\n","import { GameID, PlayerID, PlayerShotBin, VideoID } from '@types';\nimport { wrapWorker } from 'common/@utils';\nimport { DataLoader } from 'common/DataLoader';\nimport IBallWorker from './loadData.worker'\n\nexport class IBallDataLoader extends DataLoader<GameID, VideoID, PlayerID> {\n\n    #getBins: () => Promise<Partial<Record<PlayerID, PlayerShotBin[]>>>\n\n    constructor() {\n        super(IBallWorker)\n        this.#getBins = wrapWorker<[], Partial<Record<PlayerID, PlayerShotBin[]>>>(this.worker, 'Bins')\n    }\n\n    /**\n     * -------------- Game data ----------------\n     */\n    playerBins: Partial<Record<PlayerID, PlayerShotBin[]>> = {}\n    async loadBins() {\n        this.playerBins = await this.#getBins();\n    }\n}","import \"./App.scss\";\nimport 'react-circular-progressbar/dist/styles.css';\nimport \"react-toggle/style.css\"\n\nimport React from \"react\";\nimport Toggle from 'react-toggle'\nimport { CircularProgressbar, buildStyles } from 'react-circular-progressbar';\nimport { IoPlaySharp, IoPauseSharp } from 'react-icons/io5'\nimport { AiOutlineLoading } from 'react-icons/ai'\n\nimport type {\n  Attentions, Gaze, KeyPlayer, Lv2Player,\n  PlayerID, Player,\n  VideoID, Video\n} from '@types'\nimport { PLAYER_META } from '@const'\n\nimport { DEBUG } from 'common/@const'\nimport { standardDeviation, globalFIdxToLocal, localFIdxToGlobalFIdx } from \"common/@utils\";\n\nimport {\n  BarChart,\n  LineChart,\n  Visualizer,\n  Overlay,\n  Court\n} from './components'\nimport { Timeline } from 'common/@components'\n\nimport { params } from \"param\";\nimport { IBallVideoEnv } from \"VideoEnv\";\n\nexport const videoEnv = new IBallVideoEnv()\n\n// now this flag is a bit messy, some are applied to pickPlayer, some are applied to rendering\nconst enabledFeatures = {\n  vis_off_ring: true,\n  vis_def_sheild: true,\n  vis_key_player: true,\n  vis_empty_player: true,\n  vis_top_view: true,\n  gaze_focus: true,\n  gaze_filter: false,\n}\nexport type EnabledFeatures = typeof enabledFeatures\n\ninterface State {\n  videos: Video[]\n  pauseLoading: VideoID | undefined\n  currentVideoIdx: number\n  currentFrameIdx: number\n  currentGaze: Gaze | undefined\n  currentFrame?: HTMLVideoElement\n  // player status\n  gazePlayers?: Player[]\n  attentions?: Attentions\n  attentionsOverTime?: Attentions[]\n  pickedPlayers: Record<number, { lv1Players: Record<PlayerID, KeyPlayer>, lv2Players: Record<PlayerID, Lv2Player> }>\n\n  // enable features:\n  features: EnabledFeatures\n  playerFlag: Partial<Record<PlayerID, 'Auto' | 'On' | 'Off'>>\n\n  playing: boolean\n}\n\nexport class App extends React.Component<{}, State> {\n\n  state: State = {\n    // playing\n    pauseLoading: undefined,\n    videos: [],\n    currentVideoIdx: 0,\n    currentFrameIdx: 0,\n    currentFrame: undefined,\n    currentGaze: undefined,\n    gazePlayers: undefined,\n    attentions: undefined,\n    attentionsOverTime: undefined,\n    pickedPlayers: {},\n    //\n    features: enabledFeatures,\n    playerFlag: {},\n    //\n    playing: false,\n  }\n\n  #visualizer: React.RefObject<Visualizer> = React.createRef()\n\n  get currentVideo() { return this.state.videos[this.state.currentVideoIdx] }\n\n  async componentDidMount() {\n    // should load parameters here\n\n    // get the data from the server and construct a data tower for this video\n    const videos = await Promise.all(params.VIDEO_IDS.map(async (videoId: string) => {\n\n      try {\n        const { max_frame: maxFrame, start_frame = 0, fps, h, w, version } = (await fetch(`${process.env.PUBLIC_URL}/assets/${params.GAME_ID}/${videoId}/${videoId}-meta.json`).then(r => r.json()))\n        const isTransit = videoId.endsWith(',t')\n\n        return {\n          gameId: params.GAME_ID,\n          id: videoId as VideoID,\n          maxFrame,\n          startFame: start_frame,\n          isTransit,\n          frameRate: fps, //params.GAME_ID === 'game1' ? 29.97 : 29.81,\n          loadedData: 0,\n          loadedVideo: 0,\n          width: w,\n          height: h,\n          version,\n        }\n      } catch (e) {\n        console.log('Something wrong with maxjson', videoId)\n        throw e\n      }\n    }))\n    this.setState({ videos })\n\n    // set up videoEnv\n    videoEnv.videos = videos\n\n    videoEnv.onGaze = (currentGaze, gazePlayers) => this.setState({ currentGaze, gazePlayers })\n    videoEnv.onUpdateLvInt = attentions => this.setState({ attentions })\n    videoEnv.onLoad = (videoId: VideoID, type: 'Data' | 'Video', progress) => {\n      const { videos } = this.state\n      const videoIdx = videos.findIndex(v => v.id === videoId)\n      if (videoIdx !== -1) {\n        videos[videoIdx] = {\n          ...videos[videoIdx],\n          [`loaded${type}`]: progress === undefined ? 1 : progress\n          // loaded: videoEnv.isLoaded(videos[videoIdx])\n        }\n        this.setState({ videos: [...videos] })\n      }\n    }\n    videoEnv.onUnload = (videoId: VideoID, type: 'Data' | 'Video') => {\n      const { videos } = this.state\n      const videoIdx = videos.findIndex(v => v.id === videoId)\n      if (videoIdx !== -1) {\n        videos[videoIdx] = {\n          ...videos[videoIdx],\n          [`loaded${type}`]: 0\n          // loaded: videoEnv.isLoaded(videos[videoIdx])\n        }\n        this.setState({ videos: [...videos] })\n      }\n    }\n\n    videoEnv.onPause = (videoId) => this.setState({ playing: false })\n    videoEnv.onPlay = (videoId) => this.setState({ playing: true, pauseLoading: undefined })\n\n    // setup videoEngine\n    // invoke the handler for each frame\n    videoEnv.addOnFrameListener(this.pushFrameHistory)\n    videoEnv.addOnFrameListener(async (videoId, frameIdx, ts, videoFrame) => {\n      const { videos } = this.state\n      const newCurVideoIdx = videos.findIndex(v => v.id === videoId)\n      this.setState({\n        currentFrameIdx: frameIdx,\n        currentVideoIdx: newCurVideoIdx,\n        currentFrame: videoFrame\n      })\n    })\n\n    // load the frames\n    const { currentVideoIdx } = this.state\n    await videoEnv.loadBins()\n    await videoEnv.fetchVideos()\n    // preload videos\n    await videoEnv.loadVideo(videos[currentVideoIdx])\n\n\n    // check players\n    this.setState({\n      playerFlag: Array.from(new Set(\n        Object.values(videoEnv.frames ?? {}).flatMap(f => f.players?.map(p => p.id))\n      ))\n        .reduce((o, pId) => {\n          if (pId) {\n            o[pId] = 'Auto'\n          }\n          return o\n        }, {} as Partial<Record<PlayerID, 'Auto'>>)\n    })\n  }\n\n  componentWillUnmount() {\n    // dataTower.onGaze = undefined\n    // dataTower.onUpdateLvInt = undefined\n    // dataTower.onUpdateLvSync = undefined\n    // dataTower.onLoadToMem = undefined\n    // dataTower.onUnloadToMem = undefined\n    // videoEngine.clean()\n    // videoEngine.onLoadToMem = undefined\n    // videoEngine.onPause = undefined\n    // videoEngine.onPlay = undefined\n  }\n\n  pushFrameHistory = (videoId: string, localFrameIdx: number, ts: number) => {\n    const { videos } = this.state\n    const videoIdx = videos.findIndex(v => v.id === videoId)\n\n    if (videoIdx === -1) {\n      videoEnv.pause()\n      return\n    }\n\n    const video = videos[videoIdx]\n    videoEnv.pushFrameHistory({ videoId: video.id, fIdx: localFrameIdx, ts })\n  }\n\n  onClickInterval = async (clipId: number, globalFrameIdx: number) => {\n    // videoFrame\n    const { videos } = this.state\n    const { videoIdx, frameIdx } = globalFIdxToLocal(globalFrameIdx, videos)\n    videoEnv!.pause();\n    await videoEnv!.seekTo(videos[videoIdx], frameIdx)\n  }\n\n  onPlayVideo = async () => {\n    const { playing } = this.state\n    if (playing) {\n      videoEnv!.pause()\n    } else {\n      videoEnv!.play()\n    }\n  }\n\n  loadedPrecentage() {\n    const { videos } = this.state\n    // assuming loading data takes 2x times than loading videos\n    const value = videos.reduce((o, d) => o += d.loadedData * 2 + d.loadedVideo, 0) / videos.reduce((o, v) => o + (v.isTransit ? 1 : 3), 0)\n    return value\n  }\n\n  renderProgressbar() {\n    const value = this.loadedPrecentage() * 100\n    return value === 100 ? null : <div style={{\n      position: 'fixed',\n      left: '50%',\n      top: '50%',\n      transform: 'translate(-50%, -50%)'\n    }}>\n      <CircularProgressbar\n        value={value}\n        text={`${value | 0}%`}\n        styles={buildStyles({\n          pathColor: `rgb(62, 152, 199)`,\n          textColor: '#f88',\n          trailColor: '#d6d6d6',\n          backgroundColor: '#3e98c7',\n        })}\n      />\n    </div>\n  }\n\n  renderToggle() {\n    const { features } = this.state\n    return <div className=\"featurePanel\">\n      <h4 style={{ textAlign: 'center' }}>Features</h4>\n      {Object.entries(features)\n        .filter(([k, v]) => k !== 'onPlayers' && k !== 'offPlayers')\n        .map(([k, v]) => {\n\n          return <div className=\"featureItem\" key={k}>\n            <Toggle\n              id='cheese-status'\n              // defaultChecked={v as boolean}\n              checked={v as boolean}\n              onChange={(e) => {\n                ; (features as any)[k] = !v\n                this.setState({ features })\n              }} />\n            <span>{k.split('_').join(' ')}</span>\n          </div>\n        })}\n    </div>\n  }\n\n  renderPlayerToggle() {\n    const { playerFlag } = this.state\n    return <div className=\"playerPanel\">\n      <h4 style={{ textAlign: 'center' }}>Players</h4>\n      <div className=\"btn-group\">\n        {['Auto', 'On', 'Off'].map(v => <button onClick={() => {\n          Object.keys(playerFlag)\n            .forEach(pId => {\n              playerFlag[+pId as PlayerID] = v as 'Auto' | 'On' | 'Off'\n            })\n          this.setState({ playerFlag: { ...playerFlag } })\n        }}>{v} All</button>)}\n      </div>\n      <div className=\"gridContainer\">\n        {Object.entries(playerFlag)\n          .map(([pId, v]) => {\n            return <>\n              <span className=\"gridItem\">\n                {PLAYER_META[+pId as PlayerID].ln}\n              </span>\n              <label className=\"gridItem\">\n                <select name=\"pflag\" id=\"pflag\" value={v}\n                  onChange={e => {\n                    playerFlag[+pId as PlayerID] = e.target.value as 'Auto' | 'On' | 'Off'\n                    this.setState({ playerFlag: { ...playerFlag } })\n                  }}\n                >\n                  {['Auto', 'On', 'Off'].map(value =>\n                    <option value={value}>{value}</option>\n                  )}\n                </select>\n              </label>\n            </>\n          })}\n      </div>\n    </div>\n  }\n\n  render() {\n    const {\n      currentVideoIdx,\n      currentFrameIdx,\n\n      features,\n      playerFlag,\n\n      currentGaze,\n      currentFrame,\n      gazePlayers,\n\n      pauseLoading,\n      attentions,\n      attentionsOverTime,\n      pickedPlayers,\n      // sync,\n      playing,\n      videos,\n    } = this.state;\n    const currentFrameData = videoEnv.frames?.[currentFrameIdx]\n\n    return (\n      <>\n        {this.renderProgressbar()}\n\n        {this.renderToggle()}\n        {this.renderPlayerToggle()}\n\n        {features.vis_top_view && <Court\n          currentFrameData={currentFrameData}\n        />}\n        <div className=\"up\">\n          <div className=\"full\">\n            <Visualizer ref={this.#visualizer}\n              // video\n              currentVideo={this.currentVideo}\n              currentFrameIdx={currentFrameIdx}\n              currentFrame={currentFrame}\n              // feature\n              features={features}\n              playerFlags={playerFlag}\n              // gaze\n              gaze={currentGaze}\n              gazePlayers={gazePlayers}\n              onPickPlayers={(fIdx, lv1Players, lv2Players) => {\n                const vIdx = videos.findIndex(v => v.id === this.currentVideo.id)\n                if (vIdx === -1) return\n\n                const globalFIdx = localFIdxToGlobalFIdx(vIdx, fIdx, videos)\n                this.setState({\n                  pickedPlayers: { ...pickedPlayers, [globalFIdx]: { lv1Players, lv2Players } }\n                })\n              }}\n            >\n\n              <Overlay\n                currentVideo={this.currentVideo}\n                currentFrameData={currentFrameData}\n                gaze={DEBUG.GAZE ? currentGaze : undefined}\n                gazePlayers={gazePlayers}\n                bbox={false}\n              />\n\n              {/* {DEBUG.OVERLAY &&\n                <Overlay\n                  width={videoWidth}\n                  height={videoHeight}\n                  frameIdx={currentFrameIdx}\n                  bbox={DEBUG.BBOX}\n                  isTransit={this.currentVideo?.isTransit}\n                />\n              } */}\n            </Visualizer>\n\n            {DEBUG && <div className=\"debug\">\n              {DEBUG.ATTENTIONS &&\n                <div className=\"chart\">\n                  <BarChart\n                    fixY={true}\n                    data={attentions?.players\n                      ? Object.entries(attentions?.players).map(([playerId, { att, on }]) => {\n                        return { id: playerId, value: att, fill: on ? \"teal\" : \"lightpink\" }\n                      }, {} as Record<string, { value: number, fill: string }>) : []}\n                  />\n                </div>\n              }\n              {DEBUG.LINE &&\n                <div className=\"chart\">\n                  <LineChart\n                    width={600}\n                    data={attentionsOverTime\n                      ?.filter(({ videoId }) => videoId !== undefined)\n                      .map(({ fIdx, players: playerAttentions, videoId }) => {\n\n                        const { players } = videoEnv!.frames?.[currentFrameIdx] ?? {}\n                        const std = standardDeviation(players?.map(p => playerAttentions[p.id]?.att ?? 0))\n                        const videoIdx = videos.findIndex(v => v.id === videoId)!\n                        const globalFIdx = localFIdxToGlobalFIdx(videoIdx, fIdx, videos)\n                        return { fIdx: globalFIdx, videoIdx, value: std }\n                      }) ?? []}\n                  />\n                </div>\n              }\n            </div>\n            }\n            <div className=\"controls\">\n              <button\n                id=\"playpause\"\n                className=\"play button is-outlined\"\n                type=\"button\"\n                disabled={pauseLoading !== undefined || this.loadedPrecentage() !== 1}\n                onClick={() => this.onPlayVideo()}\n              >\n                {playing\n                  ? <IoPauseSharp style={{ transform: 'scale(1.5)' }} />\n                  : pauseLoading !== undefined\n                    ? <AiOutlineLoading style={{ transform: 'scale(1.5)' }} />\n                    : <IoPlaySharp style={{ transform: 'scale(1.5)' }} />}\n              </button>\n            </div>\n          </div>\n          {/* <div className=\"divide\"> </div> */}\n        </div>\n\n        {DEBUG.TIMELINE &&\n          <Timeline\n            mode=\"S\"\n            videos={videos}\n            currentVideoIdx={currentVideoIdx}\n            currentFrameIdx={currentFrameIdx}\n            enableClips={false}\n            // pickedPlayers={pickedPlayers}\n            onClickInterval={this.onClickInterval}\n          />\n        }\n      </>)\n  }\n}","import type { Ball, Point } from 'common/@types'\nimport {\n  PlayerID, TeamID,\n  Attentions, AttentionWeights,\n  FrameStamp, Gaze, Highlights,\n  KeyPlayer,\n  KeyPlayerType,\n  Lv2Player,\n  Lv2PlayerType,\n  OffensivePkg,\n  VideoID,\n  GameID, Player\n} from \"@types\"\n\nimport { distPoints, union } from 'common/@utils';\nimport { getCanvasAbsTopLeft, GOAL_BASKET_POS, hexbin, hRadius } from '@utils';\n\nimport { DEBUG } from 'common/@const'\nimport {\n  PLAYER_META,\n  EMPTY_SPACE_THRESHOLD, GAZE_R, LV_INTEREST_THRESHOLD, MAX_HIGHLIGHTED, NEXT_BALL_HOLDER_TIME_RANGE,\n} from '@const';\nimport { params } from 'param';\n\nimport { VideoEnv } from 'common/VideoEnv';\n\nimport { EnabledFeatures } from 'App';\nimport { IBallDataLoader } from './DataLoader';\n\nexport class IBallVideoEnv extends VideoEnv<GameID, VideoID, PlayerID> {\n  // gaze events\n  onGaze?: (p: Gaze, player?: Player[]) => void\n  onUpdateLvInt?: (att: Attentions) => void\n  onUpdateLvSync?: (sync: boolean, hilights: Highlights) => void\n\n  #gazeQueue: Gaze[] = []\n  #frameQueue: FrameStamp[] = []\n  #mousePos: Point = { x: 0, y: 0 }\n  constructor(dataLoader = new IBallDataLoader()) {\n    super(dataLoader)\n\n    if (DEBUG.MOUSE_GAZE) {\n      document.body.addEventListener('mousemove', e => {\n\n        const bbox = document.getElementById('canvasWrapper')?.getBoundingClientRect()\n        if (bbox === undefined) return\n        const ox = bbox.x\n        const oy = bbox.y\n        const { wScale = 1, hScale = 1 } = getCanvasAbsTopLeft()\n        this.#mousePos = { x: (e.clientX - ox!) * wScale, y: (e.clientY - oy!) * hScale }\n      })\n\n      setInterval(() => {\n        this.onSocket({ data: JSON.stringify([[0, 0], Date.now() / 1000]) })\n      }, 1000 / 30)\n    }\n\n    // console.log('Gaze init----')\n    // const socket = new WebSocket('ws://localhost:5000/echo');\n    // socket.addEventListener('message', this.onSocket);\n  }\n\n  /**\n   * -------------- Gaze data ----------------\n   */\n  onSocket = (ev: any) => {\n    const rawGaze = JSON.parse(ev.data) as [[number, number], number]\n    const ts = Math.round(rawGaze[1] * 1000)\n    // get the closetFrame\n    const closetFrame = this.getClosetFrame(ts)\n    // console.warn('Cannot find closetframe of gaze', rawGaze)\n    if (!closetFrame) {\n      // maybe should find frame in lazy mode?\n      return\n    }\n\n    const { x: ox, y: oy, wScale = 1, hScale = 1 } = getCanvasAbsTopLeft()\n    const wOutToIn = window.innerWidth / window.outerWidth\n    const hOutToIn = window.innerHeight / window.outerHeight\n    const x = DEBUG.MOUSE_GAZE\n      ? this.#mousePos.x\n      : (rawGaze[0][0] * wOutToIn - ox) * wScale\n    const y = DEBUG.MOUSE_GAZE\n      ? this.#mousePos.y\n      : ((rawGaze[0][1] + 20) * hOutToIn - oy) * hScale\n\n    const gaze: Gaze = {\n      x, y,\n      ts,\n      fIdx: closetFrame?.fIdx,\n      videoId: closetFrame?.videoId\n    }\n    this.#gazeQueue.push(gaze)\n\n    // get lookat\n    const attendPlayers = this.getLookAt(gaze)\n    this.onGaze?.(gaze, attendPlayers)\n\n    // calculate inteLv\n    // save inteLv\n    this.updateInteLv(gaze, attendPlayers)\n  }\n\n  pushFrameHistory(data: FrameStamp) {\n    this.#frameQueue.push(data)\n  }\n  getClosetFrame(gTs: number) {\n    let minDist = Infinity\n    let minFrame = undefined\n    for (const frame of [...this.#frameQueue].reverse()) {\n      const dist = Math.abs(frame.ts - gTs)\n      if (dist < minDist) {\n        minDist = dist\n        minFrame = frame\n      }\n      // if not decrease anymore, stop\n      else break\n    }\n    return minFrame\n  }\n\n  get latestGaze() { return this.#gazeQueue[this.#gazeQueue.length - 1] }\n  getClosetGaze(fTs: number) {\n    let minDist = Infinity\n    let minGaze = undefined\n    for (const gaze of [...this.#gazeQueue].reverse()) {\n      const dist = Math.abs(gaze.ts - fTs)\n      if (dist < minDist) {\n        minDist = dist\n        minGaze = gaze\n      }\n      // if not decrease anymore, stop\n      else break\n    }\n    return minGaze\n  }\n\n  getLookAt(gaze: Gaze) {\n    const { x: gx, y: gy, videoId } = gaze\n    // frame data\n    // @TODO, can be error since the frame maybe not loaded in cur memory\n    if (videoId !== this.currentVideo?.id) return\n    const cf = this.frames?.[gaze.fIdx]\n    if (!cf?.players) return\n\n    const radius = GAZE_R\n    const attendedPlayers = cf.players.filter(({ bbox }) => {\n      return gx > (bbox.x - radius) &&\n        gy > (bbox.y - radius) &&\n        gx < (bbox.x + bbox.w + radius) &&\n        gy < (bbox.y + bbox.h + radius)\n    })\n    return attendedPlayers\n  }\n\n  #playerAttentions: Attentions = { lastTs: -1, fIdx: -1, videoId: undefined, players: {} }\n  updateInteLv(gaze: Gaze, attendPlayers?: Player[]) {\n    const { ts, fIdx } = gaze\n    const { lastTs, players } = this.#playerAttentions\n    const T = 500 // default 1000ms\n    const decayRate = 1 / 5\n    // const maxAttention = incrRate * 19.144 * 0.96\n\n    /**\n     * Generalized weight increase algorithm.\n     * @param initialValue The starting weight of the player.\n     * @param dt The amount of time elapsed since the last update.\n     * @returns The new weight of the player.\n     */\n    function increaseFunction(initialValue: number, dt: number) {\n      return 1 - decayRate ** ((dt - (T * Math.log(1 - initialValue) / Math.log(5))) / T)\n    }\n\n    const newAttentions = lastTs === -1 ? players : Object.keys(players)\n      .reduce((o, pId) => {\n        const playerId = +pId as PlayerID\n        const base = players[playerId]?.att ?? 0\n        const att = base * Math.pow(decayRate, (ts - lastTs) / T)\n        const on = players[playerId]?.on ?? false\n        o[playerId] = {\n          on: att < LV_INTEREST_THRESHOLD.off ? false : on, // turn to false if less than threshold\n          att, looked: false\n        }\n        return o\n      }, {} as Record<PlayerID, AttentionWeights>)\n\n    if (attendPlayers) {\n      attendPlayers.forEach(({ id }) => {\n        if (!(id in newAttentions)) newAttentions[id] = { on: false, att: 0, looked: true }\n        const oldAttention = players[id]?.att ?? 0\n        const att = increaseFunction(oldAttention, ts - lastTs)\n        const on = att > LV_INTEREST_THRESHOLD.on\n          ? true\n          : newAttentions[id]!.on\n        newAttentions[id] = {\n          att, on, looked: true\n        }\n      })\n    }\n\n    this.#playerAttentions = {\n      lastTs: ts,\n      fIdx,\n      videoId: gaze.videoId,\n      players: newAttentions\n    }\n    this.onUpdateLvInt?.(this.#playerAttentions)\n  }\n\n  /**\n   * ----------------- Visualization Management\n   */\n  #keyPlayers: Array<{\n    fIdx: number,\n    videoId: string,\n    players: KeyPlayer[],\n  }> = []\n  #keyPlayer_buffer_size = 100\n\n  /**\n   * \n   * @param currentFIdx \n   * @param timeRange in sec\n   * @param ball \n   * @returns \n   */\n  getNextBallHolder(currentFIdx: number, timeRange: number, ball?: Ball, teamWithBall?: TeamID) {\n    timeRange *= this.currentVideo?.frameRate!\n    for (let i = currentFIdx; i < currentFIdx + timeRange; ++i) {\n      const nextFrame = this.frames?.[i]\n      if (!nextFrame) continue\n\n      const { ball: nextBall } = nextFrame\n      if (!nextBall?.playerId) continue\n\n      if (!ball?.playerId) {// now is empty\n        return PLAYER_META[nextBall.playerId].team === teamWithBall ? nextBall.playerId : undefined\n      } else { // now is not empty\n        if (nextBall.playerId !== ball.playerId && PLAYER_META[nextBall.playerId].team === PLAYER_META[ball.playerId].team) { // should be the same team\n          return nextBall.playerId\n        }\n      }\n    }\n  }\n\n  getEmptyPlayer(players?: Player[], ballHolderId?: PlayerID | null, teamWithBall?: TeamID) {\n    if (players === undefined || teamWithBall === undefined) return\n    const trackedPlayers = players.filter(({ tracking }) => tracking.x !== undefined && tracking.y !== undefined)\n    const defenders = trackedPlayers.filter(p => PLAYER_META[p.id].team !== teamWithBall)\n    const offensors = trackedPlayers.filter(p => PLAYER_META[p.id].team === teamWithBall)\n\n    const emptyOffensors: Array<[Player, number]> = []\n    for (const p of offensors) {\n      const { dataPkg, id } = p\n      if (id === ballHolderId) continue\n      if (!(dataPkg as OffensivePkg).inOffsensiveCourt) continue\n\n      const dists = defenders.map(d => distPoints(d.tracking, p.tracking))\n      if (dists.every(d => d > EMPTY_SPACE_THRESHOLD)) {\n        // TODO, dist to the basket\n        // dist to the ballholder\n        const { x: bx, y: by } = GOAL_BASKET_POS(p.id)\n        const distToBasket = distPoints(p.tracking, { x: bx, y: by })\n        emptyOffensors.push([p, distToBasket])\n      }\n    }\n    return emptyOffensors.sort((a, b) => a[1] - b[1]).map(d => d[0])\n  }\n\n  private lastFocus: { pos: Point } = { pos: { x: 0, y: 0 } }\n  fetchFocus() {\n    const gaze = this.latestGaze\n    if (!gaze) return this.lastFocus\n\n    let { pos } = this.lastFocus\n    const dx = Math.min(600, gaze.x - pos.x)\n    const dy = Math.min(600, gaze.y - pos.y)\n    pos = {\n      x: pos.x + dx,\n      y: pos.y + dy\n    }\n\n    this.lastFocus = { pos }\n    return this.lastFocus\n  }\n\n  // helper function  \n  #getPlayerTeam = (playerId?: PlayerID) => playerId ? PLAYER_META[playerId].team : undefined\n  pickPlayers(currentFIdx: number,\n    features: EnabledFeatures,\n    playerFlags: Partial<Record<PlayerID, 'Auto' | 'On' | 'Off'>>,\n    filter_center?: { pos: Point; }\n  ) {\n\n    if (Object.keys(this.#keyPlayers).length > this.#keyPlayer_buffer_size) {\n      this.#keyPlayers.pop()\n    }\n\n    const currentFrame = this.frames?.[currentFIdx]\n    if (!currentFrame) return {}\n    const {\n      ball,\n      players,\n      teamWithBall = this.#getPlayerTeam(players?.find(p => p.id === ball?.playerId)?.id)\n    } = currentFrame\n\n    // attend players\n    const { players: playerAttentions } = this.#playerAttentions\n\n    // collect current\n    let currentlv1Players: Omit<KeyPlayer, 'last'>[] = []\n    let lv2Players: Lv2Player[] = []\n    // ball holder first\n    if (ball?.playerId) {\n      currentlv1Players.push({ id: ball.playerId, type: KeyPlayerType.BALL_HOLDER })\n      // should add to lv2 if sync\n      lv2Players.push({ id: ball.playerId, type: new Set([Lv2PlayerType.Normal]) })\n\n      // add the defender of the ball holder\n      // @Note, the defending field stores the defender of the ball holder, and the defending of defenders\n      const ballHolder = players?.find(p => p.id === ball.playerId)\n      ballHolder?.tracking.defending && lv2Players.push({\n        id: ballHolder?.tracking.defending as PlayerID,\n        type: new Set([Lv2PlayerType.Normal])\n      })\n      players?.filter(p => p.tracking.defending === ball.playerId).forEach(p => lv2Players.push({\n        id: p.id,\n        type: new Set([Lv2PlayerType.Normal])\n      }))\n    }\n\n    // do playerFlags for Lv1 player\n    Object.entries(playerFlags)\n      .forEach(([pId, v]) => {\n        if (v === 'On') {\n          currentlv1Players.push({ id: +pId as PlayerID, type: KeyPlayerType.BALL_HOLDER })\n        }\n      })\n\n    // who will get the ball in the next Xsec\n    const nextBallHolder = this.getNextBallHolder(currentFIdx, NEXT_BALL_HOLDER_TIME_RANGE, ball)\n    if (nextBallHolder && currentlv1Players.length < MAX_HIGHLIGHTED) {\n      currentlv1Players.push({ id: nextBallHolder, type: KeyPlayerType.NEXT_BALL_HOLDER })\n      lv2Players.push({ id: nextBallHolder, type: new Set([Lv2PlayerType.Normal]) })\n    }\n\n    const emptyPlayers = features.vis_empty_player\n      ? this.getEmptyPlayer(\n        players?.filter(p => !currentlv1Players.some(d => d.id === p.id)),\n        ball?.playerId,\n        teamWithBall)\n      : []\n    // do gaze_filter\n    emptyPlayers\n      ?.filter(({ bbox }) => {\n        if (!filter_center) return true\n        const radius = 60\n        const { x: gx, y: gy } = filter_center.pos\n        return gx > (bbox.x - radius) &&\n          gy > (bbox.y - radius) &&\n          gx < (bbox.x + bbox.w + radius) &&\n          gy < (bbox.y + bbox.h + radius)\n      })\n      .forEach(p => {\n        if ((currentlv1Players.length + 1) < MAX_HIGHLIGHTED) {\n          currentlv1Players.push({ id: p.id, type: KeyPlayerType.EMPTY_PLAYER })\n          lv2Players.push({ id: p.id, type: new Set([Lv2PlayerType.Normal]) })\n        }\n      })\n\n    // management\n    let { players: lastLv1Players = [], fIdx: lastFIdx = 0, videoId: lastVideoId } = this.#keyPlayers?.[0] ?? {}\n    lastLv1Players = lastLv1Players\n      .filter(p => lastVideoId === this.currentVideo?.id) // && PLAYER_META[p.id].team === teamWithBall)\n    // exit\n    const exitPlayers = lastLv1Players\n      .filter(p =>  //p.last.status === 'exit' || \n        !currentlv1Players.find(cp => p.id === cp.id))\n      // update exist player's values\n      .map(p => {\n        p.last.status = 'exit'\n        p.last.progress -= currentFIdx - lastFIdx\n        return p\n      })\n\n    const updatePlayers = lastLv1Players\n      // U - E\n      .filter(p => !exitPlayers.find(ep => ep.id === p.id))\n      // .filter(p => currentlv1Players.find(cp => cp.id === p.id))\n      .map(p => {\n        // 6 / 30 s === 200ms\n        p.last.progress = Math.min(6, p.last.progress + currentFIdx - lastFIdx)\n        p.last.status = p.last.progress === 6 ? 'update' : 'enter'\n        return p\n      })\n\n    // enter\n    const enterPlayers = currentlv1Players\n      .filter(cp => !lastLv1Players.find(p => p.id === cp.id))\n      .map(p => {\n        ; (p as KeyPlayer).last = { status: 'enter', progress: 0 }\n        return p as KeyPlayer\n      })\n\n    // control here\n    const lv1Players: KeyPlayer[] = [\n      ...enterPlayers,\n      ...updatePlayers,\n      ...exitPlayers.filter(p => p.last.progress > 0)\n    ]\n\n    if (lv1Players.length >= MAX_HIGHLIGHTED) {\n      console.warn('More than the upper limit')\n    }\n\n    lv2Players = [\n      ...lv2Players,\n      ...lv1Players.map(p => ({\n        id: p.id,\n        type: new Set([Lv2PlayerType.Normal])\n      }))\n    ]\n\n    // Step2 find the interested players, gaze_focus, default to open\n    if (features.gaze_focus) {\n      Object.entries(playerAttentions)\n        .forEach(([pId, { att, on, looked }]) => {\n          lv2Players.push({ id: +pId as PlayerID, att, on, looked, type: new Set([Lv2PlayerType.Interest]) })\n        })\n    }\n    // do playerFlags for Lv2 player\n    Object.entries(playerFlags)\n      .forEach(([pId, v]) => {\n        if (v === 'On') {\n          lv2Players.push({ id: +pId as PlayerID, type: new Set([Lv2PlayerType.Normal]) })\n        }\n      })\n\n    // cache the keyplayers\n    this.#keyPlayers.unshift({\n      fIdx: currentFIdx,\n      videoId: this.currentVideo!.id,\n      players: lv1Players\n    })\n\n    return {\n      lv1Players: lv1Players\n        .filter(p => playerFlags[p.id] !== 'Off')\n        .reduce((o, p) => {\n          if (!(p.id in o)) {\n            o[p.id] = p\n          }\n          // use the higher rank\n          if (p.type < o[p.id].type) {\n            o[p.id].type = p.type\n          }\n\n          return o\n        }, {} as Record<PlayerID, KeyPlayer>),\n      //\n      lv2Players: lv2Players\n        .filter(p => playerFlags[p.id] !== 'Off' || p.type.has(Lv2PlayerType.Interest))\n        .reduce((o, p) => {\n          if (!(p.id in o)) o[p.id] = p\n          else {\n            o[p.id] = { ...o[p.id], ...p, type: union(p.type, o[p.id].type) }\n          }\n          return o\n        }, {} as Record<PlayerID, Lv2Player>),\n      teamWithBall,\n      ballHolder: players?.find(p => p.id === ball?.playerId)\n    }\n  }\n\n  /**\n   * -------------- Game data ----------------\n   */\n  async loadBins() {\n    await (this.dataLoader as IBallDataLoader).loadBins()\n  }\n  getPlayerBins(playerId?: PlayerID) {\n    if (!playerId) return\n    return (this.dataLoader as IBallDataLoader).playerBins[playerId]\n  }\n  getCurrentBin(player?: Player) {\n    if (!player) return\n\n    const { x: tx, y: ty } = player.tracking\n    const currentBin = (tx !== undefined && ty !== undefined)\n      ? hexbin([{\n        LOC_X: tx * 10,\n        LOC_Y: ty * 10\n      } as any])[0]\n      : undefined;\n    return currentBin\n  }\n\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { App } from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n"],"sourceRoot":""}