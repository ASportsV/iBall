{"version":3,"sources":["@const/players.ts","@const/gaze.ts","@const/style.ts","@const/index.ts","param.ts","../common/src/@types/basic.ts","../common/src/@types/index.ts","../common/src/@const/ui.ts","../common/src/@const/draw.ts","../common/src/@utils/array.ts","../common/src/@utils/async.ts","../common/src/@utils/debug.ts","../common/src/@utils/type.ts","../common/src/@utils/hash.ts","../common/src/@utils/video.ts","../common/src/@utils/geometry.ts","../common/src/@utils/worker.ts","@types/gameData.ts","../common/src/@draw/frame.ts","../common/src/@draw/object.ts","../common/src/@draw/geometry.ts","components/Visualizer/visualizeData.ts","@utils.ts","components/Visualizer/index.tsx","components/DebugCourt/index.tsx","../common/src/@components/Timeline/Interval.tsx","../common/src/@components/Timeline/index.tsx","../common/src/@components/SVGOverlay/index.tsx","components/SVGOverlay/index.tsx","components/CommentBox/index.tsx","components/Danmu/index.tsx","../common/src/DataLoader/loadFrames.worker.ts","../common/src/DataLoader/DataLoader.ts","../common/src/DataLoader/Database.ts","../common/src/VideoEnv/VideoPlayer/VideoLoader.ts","../common/src/VideoEnv/VideoPlayer/VideoPlayer.ts","../common/src/VideoEnv/index.ts","VideoEnv/loadData.worker.ts","VideoEnv/DataLoader.ts","VideoEnv/index.ts","filebase.ts","App.tsx","index.tsx"],"names":["PLAYER_META","2760","fn","ln","offSpeed","team","star","2738","101106","201575","203110","203105","203084","203546","203949","1626172","202691","2571","201578","2733","201939","201574","101112","2563","202697","2747","2592","203099","203925","203895","201567","202681","2544","203521","2590","2210","201619","202389","202684","201566","201627","203079","2555","202713","200779","201586","202683","203500","201571","203460","1626166","201142","202362","101108","200755","2746","201599","203143","2037","201601","203085","201933","202325","1718","202332","GAZE_R","Object","entries","reduce","o","pId","Math","random","NEXT_BALL_HOLDER_TIME_RANGE","LV_INTEREST_THRESHOLD","off","on","EMPTY_SPACE_THRESHOLD","MAX_HIGHLIGHTED","FOCUS","min","max","mina","maxa","miniMapSize","miniMapWidth","COLORS","offense_inner_border","offense_bg_fill","offense_outer_border","defense_bg_fill","defense_fg_fill","player_name","BG_MASK_ALPHA","FG_MASK_ALPHA","off_df_link","star_name","star_star","VIDEO_ID_GROUPS","game2_unit0","game1_unit0","game1_unit1","game1_unit2","game2_unit1","game2_unit2","Parameters","GAME_ID","UNIT_ID","console","log","global","location","search","debug","this","params","URLSearchParams","gameId","get","includes","alert","unitId","mode","toUpperCase","initParams","Side","Direction","TPlayerOption","DEBUG","ArrayToDict","arr","key","f","union","setA","setB","_union","Set","elem","add","wait","ms","a","Promise","resolve","reject","setTimeout","waitUntil","checkFun","interval","setInterval","bytesToMB","bytes","toFixed","debugMem","memory","performance","usedJSHeapSize","totalJSHeapSize","_intervalIdGen","intervalIdGen","getImg","src","img","Image","onload","e","URL","revokeObjectURL","undefined","globalFIdxToLocal","globalFrameIdx","videos","accFrame","videoIdx","length","video","maxFrame","frameIdx","distPoints","p1","p2","dx","x","dy","y","sqrt","getAngle","x1","y1","x2","y2","radians","atan2","PI","wrapWorker","workerFunc","cb","worker","args","postMessage","addEventListener","handler","data","removeEventListener","PLAYER_STATUS","KeyPlayerType","Lv2PlayerType","drawRawFrame","layer","frame","darkenAlpha","canvas","width","height","ctx","drawImage","drawOverlay","alpha","save","fillStyle","fillRect","restore","internalCanvas","document","createElement","getContext","obj","applyStyle","style","forEach","lineWidth","strokeStyle","font","textBaseline","lineCap","lineJoin","value","pattern","globalAlpha","opacity","roundTo2PI","r","drawVis","visCtx","circles","sheilds","debugCtx","b","c","d","setTransform","circleTXY","map","cx","cy","tx","ty","filter","inOffsensiveCourt","_","cIdx","beginPath","arc","in_r","fill","size","out_r","globalCompositeOperation","stroke","drawVisRings","invertTXY","getA1A2","tangle","tdist","a1","MIN_DIST","MAX_DIST","a2","sheild","theta","cos","sin","ox","oy","grd","createLinearGradient","addColorStop","shadowColor","shadowBlur","moveTo","lineTo","smoothDFdiff","dist","pow","atan","tan","ma1","ma2","drawVisSheilds","drawGlows","players","savedFG","player","bbox","w","h","att","drawSpotLights","frames","last","progress","r1","type","EMPTY_PLAYER","STAR","dAlpha","nodes","uNodes","faces","i","z","p","n","face","rotateX3D","sinTheta","cosTheta","node","translate","v0","v1","v2","v3","closePath","_draw","internalCtx","drawHL","mask","lv1Players","lv2Players","features","ballHolder","filter_focus","pos","createRadialGradient","unImportantPlayers","find","lv2","id","lv1","lv2PlayerLooked","has","Interest","looked","lv2PlayerNotLooked","lp","vis_key_player","shooterIcon","process","defenderIcon","starIcon","ICONS","shooter","defender","drawIcon","iconHeight","offset","icon","iconWidth","drawName","namePos","lastname","textAlign","textwidth","measureText","textheight","fillText","floor","getRegionKey","area","match","getArea","AREA","RANGE","mapRegionToPoint","region","endsWith","hexbin","d3Hexbin","LOC_X","LOC_Y","radius","SHOT_ZONE_AREA","BASIC","SHOT_ZONE_BASIC","SHOT_ZONE_RANGE","FGA","FGM","rate","FG_PCT","exp","getCanvasAbsTopLeft","elm","getElementById","getBoundingClientRect","window","outerHeight","wScale","hScale","Scales","regionScale","scaleOrdinal","schemeSet3","twoPTColor","scaleSequential","interpolateYlGnBu","domain","twoPT","range","threePTColor","threePT","radiusScale","scaleSqrt","regionExp","interpolateReds","layerIds","Visualizer","layers","l","isOnLv2Player","Normal","keypoints","left_hip","right_hip","left_ankle","right_ankle","preProps","currentFrameIdx","props","currentFrame","playerFlags","cleanAllExcept","currentFrameData","videoEnv","ball","gaze_filter","fetchFocus","pickPlayers","onPickPlayers","dataToVis","offensiveRings","dataPkg","offensive","vis_off_ring","smoothRegionExp","get2DPos","defensiveSheilds","defensive","vis_def_sheild","diff","speed","defendingPlayer","draw","playerId","values","ip","currentVideo","className","alt","idx","ref","children","layerId","keys","lId","clearRect","React","Component","scaleT2Minimap","HexaBin","memo","isIn","strokeWidth","hexagon","Hexagon","playerBins","currentBin","position","overflow","transform","Court","playerMarkers","tracking","mIdx","top","left","backgroundColor","color","fontSize","push","playerWithBall","getCurrentBin","getPlayerBins","displayName","Interval","state","isMoving","isAdjusting","cursorStatus","onResizeStart","direction","button","stopPropagation","mx","clientX","setState","oBBox","body","classList","onResizing","preventDefault","stopImmediatePropagation","getEW","wx","ex","onAdjusting","onResizeEnd","onAdjustingEnd","remove","onMoveStart","onMoving","newx","onMoveEnd","focused","initializing","clsx","onMouseDown","parentDim","currentTarget","parentElement","abs","onMouseMove","onClick","onClickInterval","pad","num","slice","hhmmss","secs","t","minutes","Timeline","createRef","imgWidth","intervalSelectorHeight","parentOffsetx","isDrawing","onDrawStart","scrollLeft","clientY","bottom","enableClips","clips","frame2pos","start","end","curFrame","pos2frame","newIntervalId","newInterval","onUpsertClip","intervalId","omx","onDrawing","drawingInterval","int","maxdx","mindx","startFrame","endFrame","onDrawEnd","drawingIntervalIdx","findIndex","updateInterval","clipId","end_","targetIntervalIdx","targetInterval","intervalIdx","numberOfImg","intervalCount","trackWidth","totalTrackWidth","globalMaxFrames","round","v","trackWidthFactor","localFIdx","accFrameIdx","localFIdxToGlobalFIdx","currentVideoIdx","frameRate","ceil","maxTime","containerHeightPadding","prevProps","current","innerWidth","documentElement","clientWidth","right","scrollTo","behavior","focusedClipId","globalCurFrameIdx","containerHeight","currentTime","flex","isTransit","loadedData","loadedVideo","renderClips","SVGLayer","activeBBoxes","viewBox","preserveAspectRatio","target","onClickBG","onContextMenu","onDoubleClick","onDBClick","floodColor","result","in","onClickPlayer","screenPos","onClickBall","Overlay","gaze","gazePlayers","svgLayerProps","textAnchor","alignmentBaseline","fIdx","some","CommentBox","text","activeIndex","matches","triggleUpdatePlayerEntities","names","namesToSearch","playerEntities","Array","from","query","name","toLowerCase","RegExp","onUpdatePlayerEntity","onChange","lastIndex","startsWith","m","onKeyDown","event","toInsert","replace","trim","onSend","existPlayers","flatMap","placeholder","index","href","Message","onUpdateStatus","getDuration","content","status","transitionDuration","Danmu","danmuQueue","s","targetDanmu","prevState","snapshot","comments","queue","toLoad","videoId","every","danmu","Worker_fn","Worker","DataLoader","MyWorker","memVideoData","onLoad","onUnload","vId","shouldWait","isLoaded","progressOffset","framesToSave","itemsForBatch","all","createObjectURL","sort","Dexie","VideoLoader","memVideos","nextVideo","load","onloadeddata","VideoTrack","videoPlayer","CallBackHandle","onPlay","onPause","invokeFrameHandlers","now","metadata","currentTrack","mediaTime","frameOffset","len","onFrameHandlers","call","Date","requestVideoFrameCallback","videoElm","cancelVideoFrameCallback","play","VideoPlayer","_currentTrack","videoSources","ATrack","BTrack","whichOnPause","ev","whichOnPlay","addOnFrameListener","ts","videoFrame","curVideoIdx","warn","nextVideoIdx","preloadToAnotherTrack","pause","loadVideo","splice","fetch","trackToLoad","trackToUnload","unLoad","newVideo","setVideo","getVideo","paused","VideoEnv","dataLoader","progres","getVideoData","IBallDataLoader","IBallWorker","IBallVideoEnv","onGaze","onUpdateLvInt","onUpdateLvSync","onSocket","rawGaze","JSON","parse","closetFrame","getClosetFrame","wOutToIn","outerWidth","hOutToIn","innerHeight","attendPlayers","getLookAt","updateInteLv","lastTs","lastFocus","stringify","gTs","minDist","Infinity","minFrame","reverse","fTs","minGaze","gx","gy","cf","newAttentions","initialValue","dt","oldAttention","currentFIdx","timeRange","teamWithBall","nextFrame","nextBall","ballHolderId","trackedPlayers","defenders","offensors","emptyOffensors","GOAL_BASKET_POS","bx","by","distToBasket","latestGaze","filter_center","pop","playerAttentions","currentlv1Players","BALL_HOLDER","defending","nextBallHolder","getNextBallHolder","NEXT_BALL_HOLDER","emptyPlayers","vis_empty_player","getEmptyPlayer","lastLv1Players","lastFIdx","lastVideoId","exitPlayers","cp","updatePlayers","ep","enterPlayers","gaze_focus","unshift","loadBins","app","initializeApp","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","db","getFirestore","COLLECTION_NAME","postComment","meta","pickedPlayers","rest","addDoc","collection","docRef","error","getComment","getDocs","querySnapshot","doc","subscribe","q","onSnapshot","docChanges","change","enabledFeatures","vis_top_view","App","pauseLoading","currentGaze","attentions","attentionsOverTime","playerFlag","playing","pushFrameHistory","localFrameIdx","seekTo","onPlayVideo","VIDEO_IDS","then","json","max_frame","start_frame","fps","version","startFame","newCurVideoIdx","fetchVideos","newComments","loadedPrecentage","styles","buildStyles","pathColor","textColor","trailColor","k","checked","split","join","teamA","teamB","localeCompare","fontWeight","renderProgressbar","zIndex","marginLeft","disabled","pIds","clean","renderToggle","renderPlayerToggle","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.57df6ed9.chunk.js","sourcesContent":["import type { PlayerID } from \"@types\"\n\nexport const TEAM_META = {\n    GSW: {},\n    CLE: {},\n    OKC: {},\n    LAC: {}\n}\n\n//offSpeed is actually AVG Defense Speed\nexport const PLAYER_META = {\n    2760: { fn: \"Anderson\", ln: \"Varejao\", offSpeed: 4.07, team: 'GSW', star: false },\n    2738: { fn: \"Andre\", ln: \"Iguodala\", offSpeed: 3.78, team: 'GSW', star: false },\n    101106: { fn: \"Andrew\", ln: \"Bogut\", offSpeed: 3.5, team: 'GSW', star: false },\n    201575: { fn: \"Brandon\", ln: \"Rush\", offSpeed: 4.09, team: 'GSW', star: false },\n    203110: { fn: \"Draymond\", ln: \"Green\", offSpeed: 3.49, team: 'GSW', star: 'defender' },\n    203105: { fn: \"Festus\", ln: \"Ezeli\", offSpeed: 3.97, team: 'GSW', star: false },\n    203084: { fn: \"Harrison\", ln: \"Barnes\", offSpeed: 4.02, team: 'GSW', star: false },\n    203546: { fn: \"Ian\", ln: \"Clark\", offSpeed: 4.07, team: 'GSW', star: false },\n    203949: { fn: \"James Michael\", ln: \"McAdoo\", offSpeed: 4.27, team: 'GSW', star: false },\n    1626172: { fn: \"Kevon\", ln: \"Looney\", offSpeed: 4.05, team: 'GSW', star: false },\n    202691: { fn: \"Klay\", ln: \"Thompson\", offSpeed: 3.85, team: 'GSW', star: 'shooter' },\n    2571: { fn: \"Leandro\", ln: \"Barbosa\", offSpeed: 3.88, team: 'GSW', star: false },\n    201578: { fn: \"Marreese\", ln: \"Speights\", offSpeed: 3.67, team: 'GSW', star: false },\n    2733: { fn: \"Shaun\", ln: \"Livingston\", offSpeed: 3.85, team: 'GSW', star: false },\n    201939: { fn: \"Stephen\", ln: \"Curry\", offSpeed: 3.68, team: 'GSW', star: 'shooter' },\n    201574: { fn: \"Jason\", ln: \"Thompson\", offSpeed: 3.68, team: 'GSW', star: false },\n\n    101112: { fn: \"Channing\", ln: \"Frye\", offSpeed: 3.61, team: 'CLE', star: false },\n    2563: { fn: \"Dahntay\", ln: \"Jones\", offSpeed: 4.31, team: 'CLE', star: false },\n    202697: { fn: \"Iman\", ln: \"Shumpert\", offSpeed: 4.08, team: 'CLE', star: false },\n    2747: { fn: \"JR\", ln: \"Smith\", offSpeed: 3.92, team: 'CLE', star: false },\n    2592: { fn: \"James\", ln: \"Jones\", offSpeed: 3.84, team: 'CLE', star: false },\n    203099: { fn: \"Jared\", ln: \"Cunningham\", offSpeed: 4.24, team: 'CLE', star: false },\n    203925: { fn: \"Joe\", ln: \"Harris\", offSpeed: 4.6, team: 'CLE', star: false },\n    203895: { fn: \"Jordan\", ln: \"McRae\", offSpeed: 3.6, team: 'CLE', star: false },\n    201567: { fn: \"Kevin\", ln: \"Love\", offSpeed: 3.86, team: 'CLE', star: false },\n    202681: { fn: \"Kyrie\", ln: \"Irving\", offSpeed: 3.78, team: 'CLE', star: false },\n    2544: { fn: \"LeBron\", ln: \"James\", offSpeed: 3.72, team: 'CLE', star: 'star' },\n    203521: { fn: \"Matthew\", ln: \"Dellavedova\", offSpeed: 3.9, team: 'CLE', star: false },\n    2590: { fn: \"Mo\", ln: \"Williams\", offSpeed: 3.92, team: 'CLE', star: false },\n    2210: { fn: \"Richard\", ln: \"Jefferson\", offSpeed: 3.96, team: 'CLE', star: false },\n    201619: { fn: \"Sasha\", ln: \"Kaun\", offSpeed: 4.12, team: 'CLE', star: false },\n    202389: { fn: \"Timofey\", ln: \"Mozgov\", offSpeed: 4.12, team: 'CLE', star: false },\n    202684: { fn: \"Tristan\", ln: \"Thompson\", offSpeed: 4.1, team: 'CLE', star: false },\n\n    201566: { fn: 'Russell', ln: 'Westbrook', offSpeed: 3.71, team: 'OKC', star: 'shooter' },\n    201627: { fn: 'Anthony', ln: 'Morrow', offSpeed: 3.80, team: 'OKC', star: false },\n    203079: { fn: 'Dion', ln: 'Waiters', offSpeed: 3.74, team: 'OKC', star: false },\n    2555: { fn: 'Nick', ln: 'Collison', offSpeed: 3.90, team: 'OKC', star: false },\n    202713: { fn: 'Kyle', ln: 'Singler', offSpeed: 4.21, team: 'OKC', star: false },\n    200779: { fn: 'Steve', ln: 'Novak', offSpeed: 3.87, team: 'OKC', star: false },\n    201586: { fn: 'Serge', ln: 'Ibaka', offSpeed: 3.67, team: 'OKC', star: false },\n    202683: { fn: 'Enes', ln: 'Kanter', offSpeed: 3.89, team: 'OKC', star: false },\n    203500: { fn: 'Steven', ln: 'Adams', offSpeed: 3.79, team: 'OKC', star: false },\n    201571: { fn: 'D.J.', ln: 'Augustin', offSpeed: 3.84, team: 'OKC', star: false },\n    203460: { fn: 'Andre', ln: 'Roberson', offSpeed: 4.36, team: 'OKC', star: false },\n    1626166: { fn: 'Cameron', ln: 'Payne', offSpeed: 4.11, team: 'OKC', star: false },\n    201142: { fn: 'Kevin', ln: 'Durant', offSpeed: 3.47, team: 'OKC', star: 'shooter' },\n\n    202362: { fn: 'Lance', ln: 'Stephenson', offSpeed: 3.98, team: 'LAC', star: false },\n    101108: { fn: 'Chris', ln: 'Paul', offSpeed: 3.67, team: 'LAC', star: 'star' },\n    200755: { fn: 'Redick', ln: 'JJ', offSpeed: 4.11, team: 'LAC', star: false },\n    2746: { fn: 'Josh', ln: 'Smith', offSpeed: 3.72, team: 'LAC', star: false },\n    201599: { fn: 'DeAndre', ln: 'Jordan', offSpeed: 3.68, team: 'LAC', star: false },\n    203143: { fn: 'Pablo', ln: 'Prigioni', offSpeed: 4.46, team: 'LAC', star: false },\n    2037: { fn: 'Jamal', ln: 'Crawford', offSpeed: 3.72, team: 'LAC', star: false },\n    201601: { fn: 'Luc', ln: 'Mbah a Moute', offSpeed: 4.08, team: 'LAC', star: false },\n    203085: { fn: 'Austin', ln: 'Rivers', offSpeed: 4.13, team: 'LAC', star: false },\n    201933: { fn: 'Blake', ln: 'Griffin', offSpeed: 3.56, team: 'LAC', star: false },\n    202325: { fn: 'Wesley', ln: 'Johnson', offSpeed: 4.06, team: 'LAC', star: false },\n    1718: { fn: 'Paul', ln: 'Pierce', offSpeed: 3.54, team: 'LAC', star: false },\n    202332: { fn: 'Cole', ln: 'Aldrich', offSpeed: 3.96, team: 'LAC', star: false },\n} as const\n\n\nexport const PLAYER_RANDOM_FACTOR = Object.entries(PLAYER_META)\n    .reduce((o, [pId, _]) => {\n        o[+pId as PlayerID] = Math.random() * 0.6\n        return o\n    }, {} as Record<PlayerID, number>)","export const GAZE_R = 20\n\n// lnSync threshold in ms, if you are not watching all the key players at least EXPLORE_MODE_THRESHOLD ms, the system will show you the next highlight\nexport const NEXT_BALL_HOLDER_TIME_RANGE = 1.8\nexport const LV_INTEREST_THRESHOLD = { off: 0.03, on: 0.6 }\n// // for lvSync\n// export const EXPLORE_MODE_THRESHOLD = 1500 // ms\n// // the highlight triggered by lvSync will exist for EXPLORE_STAY_THRESHOLD ms\nexport const EXPLORE_STAY_THRESHOLD = 1500\n// the min distance for an empty player, which means that if the distance between an offensor\n// and his closet defender is larger than EMPTY_SPACE_THRESHOLD, the system will think the offensor is an empty player\nexport const EMPTY_SPACE_THRESHOLD = 8\nexport const MAX_HIGHLIGHTED = 4 //{ S1: 2, S2: 3 }[LV_SYNC]\nexport const FOCUS = { min: 10, max: 630, mina: 0.2, maxa: 0.35 }","\nconst miniMapWidth = 360 * 1\nexport const miniMapSize: [number, number] = [miniMapWidth, miniMapWidth * 50 / 94]\nexport const COLORS = {\n    offense_inner_border: '#f5f5f5',\n    offense_bg_fill: '#f5f5f577',\n    offense_outer_border: 'rgba(220, 220, 220, 0.1)',\n    defense_bg_fill: `rgba(255, 255, 255, 0.15)`,\n    defense_fg_fill: `#f5f5f5`,\n    player_name: '#f5f5f5',\n    BG_MASK_ALPHA: 0.3,\n    FG_MASK_ALPHA: 0.2,\n    off_df_link: '255, 255, 255',\n    star_name: 'rgb(255, 243, 194)',\n    star_star: 'rgb(255, 243, 194)', // 'rgb(255,215,120)'\n} as const","export * from './players'\nexport * from './gaze'\nexport * from './style'\n\n// video players\nexport const VIDEO_ID_GROUPS = {\n    game2_unit0: [],\n    game1_unit0: [\n        // '0_,',\n        // '1_c,t',\n        // '2_c,l',\n        // '3_c,t',\n        '4_,',\n        '5_c,t',\n        '6_,',\n    ],\n    game1_unit1: [\n        '4_,',\n        '5_c,t',\n        '6_,',\n        '7_c,t',\n        '8_c,',\n        '9_c,t',\n        '10_,',\n        '11_c,t',\n        '12_,',\n        '13_c,t',\n        '14_c,',\n        '15_c,t',\n    ],\n    game1_unit2: [\n        '16_,',\n        '17_c,t',\n        '18_,l',\n        '19_c,t',\n        '20_,',\n        '21_c,t',\n        '22_,',\n        '23_c,t',\n        '24_,l',\n        '25_c,t',\n        '26_,l',\n        '27_,l',\n        '28_,l',\n        '30_,'\n    ],\n    game2_unit1: [\n        '0_,',\n        '1_c,t',\n        '2_,t',\n        '3_c,',\n        '4_c,t',\n        '5_c,',\n        '6_c,t',\n        '7_c,l',\n        '8_c,t',\n        '9_c,',\n        '10_c,t'\n    ],\n    game2_unit2: [\n        '11_,t',\n        '12_c,l',\n        '13_c,',\n        '14_c,t',\n        '15_c,',\n        '16_c,t',\n        '17_,l',\n        '18_c,t',\n        '19_,t',\n        '20_c,',\n        '21_c,t',\n        '22_c,l',\n        '23_c,t',\n        '24_,l',\n        '25_c,t',\n        '26_,',\n        '27_c,t',\n        '28_,',\n        '29_c,t',\n        '30_,t',\n        '31_c,',\n        '32_c,t',\n        '33_,t',\n        '34_c,',\n        '35_c,t',\n    ]\n} as const\n","import { VIDEO_ID_GROUPS } from \"@const\"\nimport { UnitID, GameID } from \"@types\"\n\nexport class Parameters {\n\n    // get VIDEO_FRAME_RATE() {\n    //     return this.GAME_ID === 'game1' ? 29.97 : 29.81\n    // }\n\n    get VIDEO_IDS() {\n        return VIDEO_ID_GROUPS[`${this.GAME_ID}_${this.UNIT_ID}`]\n    }\n\n    constructor(\n        public readonly GAME_ID: GameID = 'game1',\n        public readonly UNIT_ID: UnitID = 'unit0',\n        // public readonly MODE: 'AUG' | 'FULL' | 'RAW' = 'FULL',\n        // public readonly LV_FOCUS: boolean = MODE === 'FULL',\n        // public readonly LV_INTRE: boolean = MODE === 'FULL'\n    ) {\n        console.log(global.location.search)\n        console.debug(`%cParams:\n    GAME_ID: ${GAME_ID},\n    UNIT_ID: ${UNIT_ID},\n    `, 'background: #444; color: #bada55; padding: 2px; border-radius:2px')\n}\n// MODE: ${MODE},\n// LV_FOCUS: ${LV_FOCUS},\n// LV_INTRE: ${LV_INTRE}\n}\n\nfunction initParams() {\n    const params = new URLSearchParams(global.location.search);\n    let gameId: GameID = 'game1'\n    if(params.get('g') !== null) {\n        gameId = `game${params.get('g')}` as GameID\n    }\n    // validate\n    if(!['game1', 'game2'].includes(gameId)) {\n        alert('GameId must be game1 or game2')\n    }\n\n    let unitId: UnitID = 'unit0'\n    if(params.get('u') !== null) {\n        unitId = `unit${params.get('u')}` as UnitID\n    }\n    if(!['unit0', 'unit1', 'unit2'].includes(unitId)) {\n        alert('UnitId must be unit0, unit1, or unit2')\n    }\n\n    let mode: 'AUG' | 'FULL' | 'RAW' = 'FULL'\n    if(params.get('m') !== null) {\n        mode =  params.get('m')!.toUpperCase() as 'AUG' | 'FULL' | 'RAW'\n    }\n    if(!['AUG', 'FULL', 'RAW'].includes(mode)) {\n        alert('Mode must be RAW, AUG, or FULL')\n    }\n\n    let lvFocus: boolean = mode === 'FULL'\n    if(params.get('gf') !== null) {\n        lvFocus = params.get('gf') === 'true'\n    }\n    \n    let lvInt = mode === 'FULL'\n    if(params.get('gi') !== null) {\n        lvInt = params.get('gi') === 'true'\n    }\n\n    return new Parameters(gameId, unitId) //, mode, lvFocus, lvInt)\n}\n\nexport const params = initParams()","/**\n * Basic geometry data type\n */\nexport interface Point {\n    readonly x: number\n    readonly y: number\n}\nexport type Route = [Point, Point, Point, Point]\n\nexport interface BBox {\n    readonly x: number;\n    readonly y: number;\n    readonly w: number;\n    readonly h: number\n}\n\nexport enum Side {\n    MIDDLE = 'MIDDLE',\n    LEFT = 'LEFT',\n    RIGHT = 'RIGHT'\n}\n\nexport enum Direction {\n    N = 'NORTH',\n    S = 'SOUTH',\n    E = 'EAST',\n    W = 'WEST',\n    NE = 'NORTH_EAST',\n    NW = 'NORTH_WEST',\n    SE = 'SOUTH_EAST',\n    SW = 'SOUTH_WEST'\n}\n","export * from './basic'\nexport * from './data'\nexport * from './ui'\nexport * from './database'\nexport * from './draw'\n\n// iball\nexport type Overwrite<T, U> = Pick<T, Exclude<keyof T, keyof U>> & U;\n\n/**\nCreate a type that requires exactly one of the given keys and disallows more. The remaining keys are kept as is.\nUse-cases:\n- Creating interfaces for components that only need one of the keys to display properly.\n- Declaring generic keys in a single place for a single use-case that gets narrowed down via `RequireExactlyOne`.\nThe caveat with `RequireExactlyOne` is that TypeScript doesn't always know at compile time every key that will exist at runtime. Therefore `RequireExactlyOne` can't do anything to prevent extra keys it doesn't know about.\n@example\n```\nimport {RequireExactlyOne} from 'type-fest';\ntype Responder = {\n    text: () => string;\n    json: () => string;\n    secure: boolean;\n};\nconst responder: RequireExactlyOne<Responder, 'text' | 'json'> = {\n    // Adding a `text` key here would cause a compile error.\n    json: () => '{\"message\": \"ok\"}',\n    secure: true\n};\n```\n@category Object\n*/\nexport type RequireExactlyOne<ObjectType, KeysType extends keyof ObjectType = keyof ObjectType> =\n    { [Key in KeysType]: (\n        Required<Pick<ObjectType, Key>> &\n        Partial<Record<Exclude<KeysType, Key>, never>>\n    ) }[KeysType] & Omit<ObjectType, KeysType>;\n\nexport enum TPlayerOption {\n    Far = 1,\n    Near = 0,\n    Both = -1\n}\n","export const DEBUG = {\n    OVERLAY: false,\n    COURT: true,\n    GAZE: false,\n    BBOX: false,\n    LINE: false,\n    ATTENTIONS: false,\n    TIMELINE: true,\n    MOUSE_GAZE: true,\n    DEBUG_MEM: false\n}","\nexport const COLORS = {\n    offense_inner_border: '#f5f5f5',\n    offense_bg_fill: '#f5f5f577',\n    offense_outer_border: 'rgba(220, 220, 220, 0.1)',\n    defense_bg_fill: `rgba(255, 255, 255, 0.15)`,\n    defense_fg_fill: `#f5f5f5`,\n    player_name: '#f5f5f5',\n    BG_MASK_ALPHA: 0.25,\n    FG_MASK_ALPHA: 0.2,\n    off_df_link: '255, 255, 255',\n    star_name: 'rgb(255, 243, 194)',\n    star_star: 'rgb(255, 243, 194)', // 'rgb(255,215,120)'\n} as const","export const extent = (d: number[]) => {\n  return [\n    Math.min(...d),\n    Math.max(...d)\n  ] as [number, number]\n}\n\nexport function standardDeviation(array?: number[]) {\n  if (!array || array.length === 0) return 0\n  const n = array.length\n  const mean = array.reduce((a, b) => a + b) / n\n  return Math.sqrt(array.map(x => Math.pow(x - mean, 2)).reduce((a, b) => a + b) / n)\n}\n\nexport function ArrayToDict<T, K extends keyof T>(arr: T[], key: K) {\n  return arr.reduce((o, f) => {\n    o[f[key] as any] = f\n    return o\n  }, {} as Record<string | number | symbol, T>)\n}\n\nexport function union<T>(setA: Set<T>, setB: Set<T>) {\n  const _union = new Set(setA);\n  for (const elem of setB) {\n    _union.add(elem);\n  }\n  return _union;\n}\n\n\nif (process.env.NODE_ENV !== 'production') {\n  (global as any).$RefreshReg$ = () => { };\n  (global as any).$RefreshSig$ = () => () => { };\n}","export async function wait(ms: number) {\n  return new Promise((resolve, reject) => {\n    setTimeout(resolve, ms)\n  })\n}\n\nexport async function waitUntil(checkFun: () => boolean, interval = 70) {\n  return new Promise(resolve => {\n    setInterval(() => {\n      if (checkFun())\n        resolve(null)\n    }, interval)\n  })\n}","function bytesToMB(bytes: number) {\n  return (bytes / 1024 / 1024).toFixed(2)\n}\n\nexport function debugMem() {\n  const memory: any = (performance as any).memory\n  console.debug(`Used / Total: ${bytesToMB(memory.usedJSHeapSize)}mb / ${bytesToMB(memory.totalJSHeapSize)}mb`)\n}\n\nexport function debugLog() {\n  return (target: any, prop: string, descriptior: PropertyDescriptor = Object.getOwnPropertyDescriptor(target, prop)!) => {\n    const originalMethod = descriptior.value;\n\n    if (descriptior.value[Symbol.toStringTag] === 'AsyncFunction') {\n      //editing the descriptor/value parameter\n      descriptior.value = async function (...args: any[]) {\n        // note usage of originalMethod here\n        console.group(`%c>>>>> Call:${prop}`, 'background: #222; color: #bada55');\n        const ret = await originalMethod.apply(this, args);\n        console.groupEnd()\n        // console.groupEnd(`%c<<<< End:${prop}`, 'background: #222; color: #bada55');\n        return ret\n      };\n\n    } else {\n      //editing the descriptor/value parameter\n      descriptior.value = function (...args: any[]) {\n        // note usage of originalMethod here\n        console.log(`%c>>>>> Call:${prop}`, 'background: #222; color: #bada55');\n        const ret = originalMethod.apply(this, args);\n        console.log(`%c<<<< End:${prop}`, 'background: #222; color: #bada55');\n        return ret\n      };\n    }\n\n    // return edited descriptor as opposed to overwriting the descriptor\n    return descriptior;\n  }\n}\n","import { Point } from \"../@types/basic\"\n\n/**\n * type grauding\n */\n// export function isEnitity(t: SpacyRet) {\n//     return t.ent_type !== '' || ['NOUN', 'VERB', 'AUX'].includes(t.pos) || t.tag.startsWith('VB') || t.coref?.some(r => r.ent_type)\n// }\n\nexport const isPoint = (p: any): p is Point => typeof p === 'object' &&\n    'x' in p &&\n    'y' in p &&\n    typeof p['x'] === 'number' &&\n    typeof p['y'] === 'number' ","let _intervalIdGen = 0\nexport function intervalIdGen() {\n    return ++_intervalIdGen\n}\n\nexport function getHash(input: string) {\n    let hash = 0, len = input.length;\n    for (var i = 0; i < len; i++) {\n        hash = ((hash << 5) - hash) + input.charCodeAt(i);\n        hash |= 0; // to 32bit integer\n    }\n    return hash;\n}","import { BaseVideo } from \"../@types\"\n\nexport async function getImg(src: string) {\n  const img = new Image()\n  img.src = src\n  await new Promise(resolve => {\n    img.onload = e => {\n      URL.revokeObjectURL(src)\n      resolve(undefined)\n    }\n  })\n  return img\n}\n\nexport function globalFIdxToLocal<GameID extends string, VideoID extends string>(globalFrameIdx: number, videos: BaseVideo<GameID, VideoID>[]) {\n  let accFrame = 0\n  let videoIdx = 0\n  for (videoIdx = 0; videoIdx < videos.length; ++videoIdx) {\n    const video = videos[videoIdx]\n    if (globalFrameIdx >= accFrame && globalFrameIdx < accFrame + video.maxFrame) {\n      break\n    } else {\n      accFrame += video.maxFrame\n    }\n  }\n  const newCurFrameIdx = globalFrameIdx - accFrame\n  return { videoIdx, frameIdx: newCurFrameIdx }\n}\n\nexport function localFIdxToGlobalFIdx<GameID extends string, VideoID extends string>(videoIdx: number, localFIdx: number, videos: BaseVideo<GameID, VideoID>[]) {\n  let accFrameIdx = 0\n  for (let i = 0; i < videoIdx; ++i)\n    accFrameIdx += videos[i].maxFrame\n  return accFrameIdx + localFIdx\n}\n","import { Point } from \"../@types\"\n\nexport const arr2Point = (arr: [number, number]): Point => ({ x: arr[0], y: arr[1] })\n\nexport const distPoints = (p1: Point, p2: Point) => {\n\n    const dx = p1.x - p2.x\n    const dy = p1.y - p2.y\n\n    return Math.sqrt(dx * dx + dy * dy)\n}\n\nexport const diffPoints = (p1: Point, p2: Point) => ({ x: p1.x - p2.x, y: p1.y - p2.y })\nexport const addPoints = (p1: Point, p2: Point) => ({ x: p1.x + p2.x, y: p1.y + p2.y })\nexport const centerOfPoints = (points: Point[] | Array<[number, number]>): Point => {\n    if (typeof points[0] === 'object') {\n        const oPoints: Point[] = points as Point[]\n        return {\n            x: oPoints.reduce((o, p) => o + p.x, 0) / oPoints.length,\n            y: oPoints.reduce((o, p) => o + p.y, 0) / oPoints.length,\n        }\n    }\n    const aPoints: Array<[number, number]> = points as Array<[number, number]>\n    return {\n        x: aPoints.reduce((o, p) => o + p[0], 0) / aPoints.length,\n        y: aPoints.reduce((o, p) => o + p[1], 0) / aPoints.length,\n    }\n}\n\nexport const extendCrossLine = (from: Point, to: Point, extend: number = 0): Point => {\n    let k = (to.y - from.y) / (to.x - from.x)\n    k = -1 / k\n\n    const center = centerOfPoints([from, to])\n\n    const theta = Math.atan(k)\n    const dy = Math.abs(extend * Math.sin(theta))\n    const dx = Math.abs(extend * Math.cos(theta))\n\n    const direc = (extend / Math.abs(extend)) || 0\n\n    return { x: center.x + direc * dx, y: center.y + direc * dy }\n}\n\nexport const extendLine = (from: Point, to: Point, extend: number = 0): Point => {\n\n    const k = (to.y - from.y) / (to.x - from.x)\n\n    const theta = Math.atan(k)\n    const dy = Math.abs(extend * Math.sin(theta))\n    const dx = Math.abs(extend * Math.cos(theta))\n\n    const direcX = (extend / Math.abs(extend)) || 0 //((to.x - from.x) / Math.abs(to.x - from.x)) || 0\n    const direcY = direcX //((to.y - from.y) / Math.abs(to.y - from.y)) || 0\n\n    return { x: to.x + direcX * dx, y: to.y + direcY * dy }\n}\n// perpendicular line\nexport const crossLine = (from: Point, to: Point, extend: number = 0): Point => {\n    const k = (to.y - from.y) / (to.x - from.x)\n    const k2 = -1 / k\n    const theta = Math.atan(k2)\n    const cP = centerOfPoints([from, to])\n\n    const dy = Math.abs(extend * Math.sin(theta))\n    const dx = Math.abs(extend * Math.cos(theta))\n\n    const direcX = ((to.x - from.x) / Math.abs(to.x - from.x)) || 0\n    const direcY = ((to.y - from.y) / Math.abs(to.y - from.y)) || 0\n\n    return { x: cP.x + direcX * dx, y: cP.y + -direcY * dy }\n\n}\n\nconst getLineFromPoints = (line: [Point, Point]) => {\n    const k = (line[1].y - line[0].y) / (line[1].x - line[0].x)\n    const b = line[0].y - k * line[0].x\n\n    return { k, b }\n}\n\n\nexport const intersectionOf2Lin = (line1: [Point, Point], line2: [Point, Point]): Point => {\n    const { k: k1, b: b1 } = getLineFromPoints(line1)\n    const { k: k2, b: b2 } = getLineFromPoints(line2)\n\n    // console.debug(`\n    //   ${line1[0].y} = ${k1 * line1[0].x + b1}\n    //   ${line1[1].y} = ${k1 * line1[1].x + b1}\n\n    //   ${line2[0].y} = ${k2 * line2[0].x + b2}\n    //   ${line2[1].y} = ${k2 * line2[1].x + b2}\n    // `)\n\n    const xi = (b2 - b1) / (k1 - k2)\n    const yi = k1 * xi + b1\n\n    // console.debug(`\n    //   line1: (${line1[0].x},${line1[0].y}) (${line1[1].x},${line1[1].y})\n    //   line2: (${line2[0].x},${line2[0].y}) (${line2[1].x},${line2[1].y})\n    // `)\n    // console.debug(`\n    //   xi: ${xi}, yi: ${yi}\n    // `)\n\n    return { x: xi, y: yi }\n}\n\n\nexport const atan2Normalized = (y: number, x: number) => {\n    var result = Math.atan2(y, x);\n    if (result < 0) {\n        result += (2 * Math.PI);\n    }\n    return result;\n}\n\nexport function getAngle(x1: number, y1: number, x2: number, y2: number) {\n    const [dx, dy] = [x2 - x1, y2 - y1]\n    let radians = (dx || dy)\n        ? Math.atan2(dy, dx)\n        : 0\n    if (radians < 0) radians += 2 * Math.PI\n    return radians * (180 / Math.PI)\n}\n\n// Return: Close approximation of the length of a Cubic Bezier curve\n//\n// Ax,Ay,Bx,By,Cx,Cy,Dx,Dy: the 4 control points of the curve\n// sampleCount [optional, default=40]: how many intervals to calculate\n// Requires: cubicQxy (included below)\n//\nexport function cubicBezierLength(A: Point, B: Point, C: Point, D: Point, sampleCount = 40) {\n    var ptCount = sampleCount;\n    var totDist = 0;\n    var lastX = A.x;\n    var lastY = A.y;\n    var dx, dy;\n    for (var i = 1; i < ptCount; i++) {\n        var pt = cubicQxy(i / ptCount, A.x, A.y, B.x, B.y, C.x, C.y, D.x, D.y);\n        dx = pt.x - lastX;\n        dy = pt.y - lastY;\n        totDist += Math.sqrt(dx * dx + dy * dy);\n        lastX = pt.x;\n        lastY = pt.y;\n    }\n    dx = D.x - lastX;\n    dy = D.y - lastY;\n    totDist += Math.sqrt(dx * dx + dy * dy);\n    return Math.floor(totDist);\n}\n\n\n// Return: an [x,y] point along a cubic Bezier curve at interval T\n//\n// Attribution: Stackoverflow's @Blindman67\n// Cite: http://stackoverflow.com/questions/36637211/drawing-a-curved-line-in-css-or-canvas-and-moving-circle-along-it/36827074#36827074\n// As modified from the above citation\n// \n// t: an interval along the curve (0<=t<=1)\n// ax,ay,bx,by,cx,cy,dx,dy: control points defining the curve\n//\nfunction cubicQxy(t: number, ax: number, ay: number, bx: number, by: number, cx: number, cy: number, dx: number, dy: number) {\n    ax += (bx - ax) * t;\n    bx += (cx - bx) * t;\n    cx += (dx - cx) * t;\n    ax += (bx - ax) * t;\n    bx += (cx - bx) * t;\n    ay += (by - ay) * t;\n    by += (cy - by) * t;\n    cy += (dy - cy) * t;\n    ay += (by - ay) * t;\n    by += (cy - by) * t;\n    return ({\n        x: ax + (bx - ax) * t,\n        y: ay + (by - ay) * t\n    });\n}\n\n// cubic bezier percent is 0-1\nexport function getCubicBezierXYatPercent(startPt: Point, controlPt1: Point,\n    controlPt2: Point, endPt: Point, percent: number) {\n    const x = CubicN(percent, startPt.x, controlPt1.x, controlPt2.x, endPt.x);\n    const y = CubicN(percent, startPt.y, controlPt1.y, controlPt2.y, endPt.y);\n    return ({ x: x, y: y });\n}\n\n// cubic helper formula at percent distance\nfunction CubicN(pct: number, a: number, b: number, c: number, d: number) {\n    var t2 = pct * pct;\n    var t3 = t2 * pct;\n    return a + (-a * 3 + pct * (3 * a - a * pct)) * pct\n        + (3 * b + pct * (-6 * b + b * 3 * pct)) * pct\n        + (c * 3 - c * 3 * pct) * t2\n        + d * t3;\n}","export function wrapWorker<In extends unknown[], Out>(\n  workerFunc: { new(): Worker },\n  key: string,\n  cb?: (...args: any[]) => void): (...args: In) => Promise<Out> {\n  const worker = new workerFunc()\n  return async (...args: In) => {\n    worker.postMessage([key, ...args])\n\n    return await new Promise<Out>(resolve => {\n      const handler = (e: MessageEvent<any>) => {\n        if (e.data[0] !== key) {\n          cb?.(e.data)\n          return\n        }\n        worker.removeEventListener('message', handler)\n        resolve(e.data[1])\n      }\n      worker.addEventListener('message', handler)\n    })\n  }\n}","import { Overwrite } from \"common/@types\"\nimport type { PlayerID, VideoID } from \"./index\"\n\nexport enum PLAYER_STATUS {\n  offensive = 'in_offensive',\n  defensive = 'in_defensive',\n  other = 'in_other'\n}\nexport interface OffensivePkg {\n  mode: PLAYER_STATUS.offensive\n  region: string\n  diff: number\n  eDiff: number\n  freq: number\n  regionRate: number\n  regionExp: number\n  smoothRegionExp: number\n  inOffsensiveCourt: boolean\n}\nexport interface DefensivePkg {\n  mode: PLAYER_STATUS.defensive\n  defendingPlayer: PlayerID\n  tangle: number\n  tdist: number\n  diff: number\n  smoothDFdiff: number\n  speed: number\n  freq: number\n}\nexport type DataPkg = OffensivePkg | DefensivePkg\n\nexport interface FrameStamp {\n  videoId: VideoID\n  fIdx: number\n  ts: number\n}\n\nexport interface Gaze extends FrameStamp {\n  x: number,\n  y: number\n}\n\nexport type AttentionWeights = { att: number, looked: boolean, on: boolean }\n\n// Partial<Record<PlayerId, { att: number, looked: boolean, on: boolean }>>\nexport interface Attentions {\n  lastTs: number\n  fIdx: number\n  videoId?: VideoID\n  players: Partial<Record<PlayerID, AttentionWeights>>\n}\n\nexport type HighlightWeights = Partial<Record<PlayerID, { lostTs: number, sync: boolean }>>\nexport interface Highlights {\n  lastTs: number\n  players: HighlightWeights\n}\n\nexport interface DefenseRecord {\n  PLAYER_ID: PlayerID\n  DEFENSE_CATEGORY: string,\n  FREQ: number,\n  D_FGM: number,\n  D_FGA: number,\n  D_FG_PCT: number,\n  NORMAL_FG_PCT: number,\n  PCT_PLUSMINUS: number,\n  AVG_DEF_SPEED: number\n}\n\nexport enum KeyPlayerType {\n  BALL_HOLDER = 0,\n  NEXT_BALL_HOLDER = 1,\n  EMPTY_PLAYER = 2,\n  STAR = 3,\n}\nexport interface KeyPlayer {\n  id: PlayerID\n  last: { progress: number, status: 'enter' | 'update' | 'exit' } // in frames, exist when NEXT_BALL_HOLDER\n  type: KeyPlayerType\n}\nexport enum Lv2PlayerType {\n  Interest = 1,\n  Normal = 2,\n  Normal_Interest = 3,\n}\nexport interface Lv2Player extends Partial<AttentionWeights> {\n  id: PlayerID\n  type: Set<Lv2PlayerType>\n}\n\nexport type CachePlayerBin = Overwrite<PlayerShotBin, {\n  region: { AREA: string, BASIC: string, RANGE: string }\n}>\n\nexport interface ShotRecord {\n  // shot_id: string\n  // ACTION_TYPE: string\n  // EVENT_TYPE: string // \"Missed Shot\"\n  GAME_EVENT_ID: string // \"555\"\n  GAME_ID: string // \"21500030\"\n  // GRID_TYPE: string //\"Shot Chart Detail\"\n  // HTM: string //\"HOU\"\n  LOC_X: number //\"-68\"\n  LOC_Y: number // \"242\"\n  // MINUTES_REMAINING: number //\"3\"\n  // PERIOD: number //\"4\"\n  PLAYER_ID: PlayerID //\"203546\"\n  // PLAYER_NAME: string //\"Ian Clark\"\n  // SECONDS_REMAINING: number // \"18\"\n  // SHOT_ATTEMPTED_FLAG: string // \"1\"\n  // SHOT_DISTANCE: number // \"25\"\n  made: number // \"0\"\n  // SHOT_TYPE: string //\"3PT Field Goal\"\n  SHOT_ZONE: { AREA: string, BASIC: string, RANGE: string }\n  // _AREA: string //\"Center(C)\"\n  // SHOT_ZONE_BASIC: string // \"Above the Break 3\"\n  // SHOT_ZONE_RANGE: string //\"24+ ft.\"\n  // TEAM_ID: number //\"1610612744\"\n  // VTM: string //\"GSW\"\n}\n\nexport type PlayerShotBin = {\n  region: string\n  regionRate: number\n  regionFreq: number // freq in this bin by region\n  regionExp: number // expect point value\n  diff: number // ergion diff to league average\n  eDiff: number\n  x: number\n  y: number\n}","import { COLORS } from \"../@const/draw\";\nimport { Layer } from \"../@types\";\n\nfunction drawRawFrame(layer: Layer, frame: CanvasImageSource, darkenAlpha = 0.1) {\n    const { width, height } = layer.canvas\n    layer.ctx.drawImage(frame, 0, 0, width, height);\n\n    if (darkenAlpha !== 0) {\n        drawOverlay(layer, darkenAlpha)\n    }\n}\n\nfunction drawOverlay(layer: Layer, alpha: number = COLORS.BG_MASK_ALPHA) {\n    const { ctx, canvas } = layer\n    const { width, height } = canvas\n\n    ctx.save()\n    ctx.fillStyle = `rgba(0, 0, 0, ${alpha})`;\n    ctx.fillRect(0, 0, width, height);\n    ctx.restore()\n}\n\nfunction fadeOutLayer(layer: Layer, alpha: number) {\n    layer.ctx.save()\n    layer.ctx.globalAlpha = alpha\n    layer.ctx.globalCompositeOperation = 'copy';\n    layer.ctx.drawImage(layer.canvas, 0, 0)\n    layer.ctx.restore()\n}\n\n\nexport {\n    drawRawFrame as bg,\n    drawOverlay as overlay,\n    fadeOutLayer as fadeOutFrame\n}","import type { Layer } from \"../@types/draw\";\nimport type { BasePlayer } from \"../@types/data\";\nimport type { Point } from \"../@types/basic\";\nimport { fadeOutFrame } from './frame'\n\nfunction drawBall(layer: Layer, ball?: Point, trail = false) {\n\n  const { width, height } = layer.canvas\n  if (trail) {\n    fadeOutFrame(layer, 0.9)\n  } else {\n    layer.ctx.clearRect(0, 0, width, height)\n  }\n\n  if (ball) {\n    const { x: cx, y: cy } = ball\n    layer.ctx.beginPath()\n    layer.ctx.lineWidth = 3\n    layer.ctx.strokeStyle = 'steelblue'\n    layer.ctx.fillStyle = 'rgba(236, 240, 241, 1)'\n    layer.ctx.arc(cx, cy, 5, 0, 2 * Math.PI)\n    layer.ctx.fill()\n    layer.ctx.stroke()\n  }\n}\n\nconst internalCanvas = document.createElement('canvas')\nconst internalCtx = internalCanvas.getContext('2d')!\nfunction drawFullBrightPlayers<PlayerID extends number>(layer: Layer,\n  frame: CanvasImageSource,\n  mask: CanvasImageSource,\n  players: BasePlayer<PlayerID>[],\n  glow: boolean = true\n) {\n  const { ctx } = layer\n  const { width, height } = layer.canvas\n\n  // mask get full bright players\n  internalCanvas.width = width\n  internalCanvas.height = height\n  internalCtx.save()\n  internalCtx.drawImage(mask, 0, 0)\n  internalCtx.globalCompositeOperation = 'source-in'\n  internalCtx.drawImage(frame, 0, 0)\n  internalCtx.restore()\n\n  ctx.save()\n  if (glow) {\n    ctx.shadowBlur = 30\n    ctx.shadowColor = 'rgba(255, 255, 255, 0.5)';\n  }\n  players\n    .forEach(player => {\n      const { x, y, w, h } = player.bbox\n      ctx.drawImage(internalCanvas,\n        x, y, w, h,\n        x, y, w, h)\n    })\n  ctx.restore()\n\n}\n\nexport {\n  drawBall as ball,\n  drawFullBrightPlayers as fullbrightPlayers,\n}\n","import type { Point, Route } from \"../@types\"\n\ninterface Style {\n  fillStyle?: string | CanvasGradient | CanvasPattern | { pattern: CanvasPattern, opacity: number }\n  lineWidth?: number\n  strokeStyle?: string\n  font?: string\n  textBaseline?: CanvasTextBaseline\n  lineCap?: CanvasLineCap\n  lineJoin?: CanvasLineJoin\n}\ntype Entries<T> = {\n  [K in keyof T]: [K, T[K]]\n}[keyof T][]\n\n// type Style = Partial<Pick<CanvasRenderingContext2D, 'fillStyle' | 'strokeStyle' | 'lineWidth' | 'font' | 'textBaseline'>>\n\nfunction entries<T extends {}>(obj: T): Entries<T> {\n  return Object.entries(obj) as any;\n}\n\nfunction applyStyle(ctx: CanvasRenderingContext2D, style: Style = {}) {\n  entries(style).forEach((e) => {\n    if (e?.[0] === 'lineWidth' && e[1] !== undefined) {\n      ctx.lineWidth = e[1] // value\n    }\n    if (e?.[0] === 'strokeStyle' && e[1] !== undefined) {\n      ctx.strokeStyle = e[1]//value\n    }\n    if (e?.[0] === 'font' && e[1]) {\n      ctx.font = e[1]\n    }\n    if (e?.[0] === 'textBaseline' && e[1]) {\n      ctx.textBaseline = e[1]\n    }\n    if (e?.[0] === 'lineCap' && e[1]) {\n      ctx.lineCap = e[1]\n    }\n    if (e?.[0] === 'lineJoin' && e[1]) {\n      ctx.lineJoin = e[1]\n    }\n  })\n\n  if (style.fillStyle) {\n    const value = style.fillStyle\n    if (typeof value === 'object' && 'pattern' in value && 'opacity' in value) {\n      ctx.fillStyle = value.pattern\n      ctx.globalAlpha = value.opacity;\n    } else {\n      ctx.fillStyle = value\n    }\n  }\n}\n\nfunction drawLine(ctx: CanvasRenderingContext2D, sx: number, sy: number, dx: number, dy: number, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n  ctx.beginPath()\n  ctx.moveTo(sx, sy)\n  ctx.lineTo(dx, dy)\n  ctx.stroke()\n}\n\nfunction drawHLine(ctx: CanvasRenderingContext2D, sx: number, sy: number, dx: number, style: Style = {}) {\n  drawLine(ctx, sx, sy, dx, sy, style)\n}\n\nfunction drawPolygon(ctx: CanvasRenderingContext2D, points: Point[], style?: Style): void;\nfunction drawPolygon(ctx: CanvasRenderingContext2D, points: [number, number][], style?: Style): void;\nfunction drawPolygon(ctx: CanvasRenderingContext2D, points: [number, number][] | Point[], style: Style = {}): void {\n\n  if (points.length === 0) return\n  const pointsToDraw: [number, number][] = Array.isArray(points[0])\n    ? points as [number, number][]\n    : (points as Point[]).map(p => ([p.x, p.y])) as [number, number][]\n\n  let [x, y] = pointsToDraw[0]\n\n  ctx.save()\n  applyStyle(ctx, style)\n\n  ctx.beginPath()\n  ctx.moveTo(x, y)\n  for (let i = 1, len = pointsToDraw.length; i < len; ++i) {\n    ([x, y] = pointsToDraw[i]);\n    ctx.lineTo(x, y)\n  }\n  ctx.closePath();\n  ctx.stroke()\n\n  ctx.fill();\n  ctx.restore()\n}\n\n\nfunction drawPolyline(ctx: CanvasRenderingContext2D, points: [number, number][] | Point[], style: Style = {}): void {\n\n  if (points.length === 0) return\n  const pointsToDraw: [number, number][] = Array.isArray(points[0])\n    ? points as [number, number][]\n    : (points as Point[]).map(p => ([p.x, p.y])) as [number, number][]\n\n  let [x, y] = pointsToDraw[0]\n\n  ctx.save()\n  applyStyle(ctx, style)\n\n  ctx.beginPath()\n  ctx.moveTo(x, y)\n  for (let i = 1, len = pointsToDraw.length; i < len; ++i) {\n    ([x, y] = pointsToDraw[i]);\n    ctx.lineTo(x, y)\n  }\n  // ctx.closePath();\n  ctx.stroke()\n\n  // ctx.fill();\n  ctx.restore()\n}\n\n\nfunction drawCurve(ctx: CanvasRenderingContext2D, route: Route, style: Style = {}) {\n\n  ctx.save()\n  applyStyle(ctx, style)\n\n  ctx.beginPath();\n  ctx.moveTo(route[0].x, route[0].y)\n  ctx.bezierCurveTo(\n    route[1].x, route[1].y,\n    route[2].x, route[2].y,\n    route[3].x, route[3].y\n  )\n  ctx.stroke()\n  // ctx.fill();\n  ctx.restore()\n  // ctx.fillStyle = ctx.strokeStyle\n  // triangleAt(ctx, route[2], route[3], 10)\n}\n\nfunction triangleAt(ctx: CanvasRenderingContext2D, from: Point, center: Point, r: number, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n\n  // draw arrow\n  let x_center = center.x;\n  let y_center = center.y;\n\n  let angle, x, y\n  ctx.beginPath();\n\n  angle = Math.atan2(center.y - from.y, center.x - from.x)\n  x_center -= r * Math.cos(angle);\n  y_center -= r * Math.sin(angle);\n  x = r * Math.cos(angle) + x_center\n  y = r * Math.sin(angle) + y_center\n  ctx.moveTo(x, y);\n\n  angle += (1 / 3) * (2 * Math.PI)\n  x = r * Math.cos(angle) + x_center\n  y = r * Math.sin(angle) + y_center\n  ctx.lineTo(x, y);\n\n  angle += (1 / 3) * (2 * Math.PI)\n  x = r * Math.cos(angle) + x_center\n  y = r * Math.sin(angle) + y_center\n  ctx.lineTo(x, y);\n\n  ctx.closePath();\n\n\n  ctx.fill();\n  ctx.restore()\n}\n\ninterface ArrowParams {\n  from: Point\n  to: Point\n  arrowSize: number\n  z?: boolean\n  double?: boolean\n}\nfunction drawArrow(ctx: CanvasRenderingContext2D, { from, to, arrowSize, z = false, double = false }: ArrowParams, style: Style = {}) {\n  // draw line\n  ctx.save()\n  applyStyle(ctx, style)\n\n  if (z) {\n    ctx.transform(1, 0, -0.2, .8, from.x, from.y);\n  }\n  const nFrom = z ? { x: 0, y: 0 } : from\n  const nTo = z ? { x: to.x - from.x, y: to.y - from.y } : to\n\n  if (double) {\n    triangleAt(ctx, nTo, nFrom, arrowSize, style)\n  }\n\n  ctx.beginPath();\n  const angle = Math.atan2(nTo.y - nFrom.y, nTo.x - nFrom.x)\n  ctx.moveTo(nFrom.x + arrowSize * Math.cos(angle), nFrom.y + arrowSize * Math.sin(angle));\n  ctx.lineTo(nTo.x - arrowSize * Math.cos(angle), nTo.y - arrowSize * Math.sin(angle));\n  ctx.stroke();\n  ctx.fill();\n\n  triangleAt(ctx, nFrom, nTo, arrowSize, style)\n  ctx.restore()\n}\n\ninterface CircleParams {\n  x: number, y: number, r: number, angle?: number, z?: boolean\n}\nfunction drawCircle(ctx: CanvasRenderingContext2D, { x, y, r, angle = 2 * Math.PI, z = false }: CircleParams, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n\n  if (z) {\n    ctx.transform(1, 0, -0.2, .5, x, y);\n  }\n  x = z ? 0 : x\n  y = z ? 0 : y\n\n  ctx.beginPath();\n  ctx.arc(x, y, r, 0, angle)\n  ctx.lineTo(x, y)\n\n  ctx.stroke()\n  ctx.fill();\n\n  ctx.restore()\n}\n\ninterface RingParams extends CircleParams {\n  r2: number\n}\nfunction drawRing(ctx: CanvasRenderingContext2D, { x, y, r, r2, angle = 2 * Math.PI, z = false }: RingParams, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n\n  // draw outer\n  drawCircle(ctx, { x, y, r: r2, angle, z })\n\n  // cut inner\n  ctx.globalCompositeOperation = 'destination-out'\n  drawCircle(ctx, { x, y, r, angle, z })\n\n  ctx.restore()\n}\n\ninterface RoundedRectParams {\n  x: number\n  y: number\n  w: number\n  h: number\n  r: number\n  z?: boolean\n}\nfunction drawRoundedRect(ctx: CanvasRenderingContext2D, { x, y, w, h, r, z = false }: RoundedRectParams, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n\n  if (z) {\n    ctx.transform(1, 0, -0.1, .9, x, y);\n  }\n  x = z ? 0 : x\n  y = z ? 0 : y\n\n  if (w < 2 * r) r = w / 2;\n  if (h < 2 * r) r = h / 2;\n  ctx.beginPath();\n  ctx.moveTo(x + r, y);\n  ctx.arcTo(x + w, y, x + w, y + h, r);\n  ctx.arcTo(x + w, y + h, x, y + h, r);\n  ctx.arcTo(x, y + h, x, y, r);\n  ctx.arcTo(x, y, x + w, y, r);\n  ctx.closePath();\n\n  ctx.stroke()\n  ctx.fill();\n\n  ctx.restore()\n}\n\ninterface TextParams {\n  x: number,\n  y: number,\n  text: string\n  z?: boolean\n}\n/**\n * use top left as the default baseline\n * @param ctx \n * @param param1 \n * @param style \n */\nfunction drawText(ctx: CanvasRenderingContext2D, { x, y, text, z = false }: TextParams, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n  ctx.textBaseline = 'top'\n\n  if (z) {\n    ctx.transform(1, 0, -0.1, .9, x, y);\n  }\n  x = z ? 0 : x\n  y = z ? 0 : y\n\n  ctx.strokeText(text, x, y)\n  ctx.fillText(text, x, y)\n  ctx.restore()\n}\n\ninterface ConeParams {\n  x: number\n  y: number\n  r: number\n  h: number\n  r1?: number\n}\ntype Point3D = [number, number, number]\nfunction drawCone(ctx: CanvasRenderingContext2D, { x, y, r, h, r1 = 0 }: ConeParams, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n\n  const dAlpha = 0.1;\n\n  const nodes: Point3D[] = [\n    // [0, -h, 0]\n  ];\n  const uNodes: Point3D[] = []\n\n  const faces: [Point3D, Point3D, Point3D, Point3D][] = [];\n  //creating nodes\n  let alpha = 0;\n  // let i = 1;\n  for (let i = 0; alpha <= 2 * Math.PI + dAlpha; ++i) {\n    // while () {\n    let x = r * Math.cos(alpha);\n    let z = r * Math.sin(alpha);\n    nodes[i] = [x, 0, z];\n    alpha += dAlpha;\n\n    x = r1 * Math.cos(alpha);\n    z = r1 * Math.sin(alpha);\n    uNodes[i] = [x, -(1 - r1 / r) * h, z];\n  }\n\n  //creating faces\n  let p = 0;\n  for (let n = 0; n < nodes.length - 1; n++) {\n    let face: [Point3D, Point3D, Point3D, Point3D] = [uNodes[p], nodes[p], nodes[p + 1], uNodes[p + 1]];\n    faces[n] = face;\n    p += 1;\n  }\n\n  // Rotate shape around the x-axis\n  function rotateX3D(theta: number) {\n    const sinTheta = Math.sin(-theta);\n    const cosTheta = Math.cos(-theta);\n\n    for (let n = 0; n < nodes.length; n++) {\n      let node = nodes[n];\n      let y = node[1];\n      let z = node[2];\n      node[1] = y * cosTheta - z * sinTheta;\n      node[2] = z * cosTheta + y * sinTheta;\n\n      node = uNodes[n];\n      y = node[1];\n      z = node[2];\n      node[1] = y * cosTheta - z * sinTheta;\n      node[2] = z * cosTheta + y * sinTheta;\n    }\n  }\n\n  //rotateZ3D(10 * Math.PI / 180);\n  rotateX3D((20 * Math.PI) / 180);\n\n  ctx.translate(x, y);\n\n  // Draw faces\n  for (let i = 0; i < faces.length; i++) {\n    const [v0, v1, v2, v3] = faces[i]\n    ctx.beginPath();\n    ctx.moveTo(v0[0], v0[1]);\n    ctx.lineTo(v1[0], v1[1]);\n    ctx.lineTo(v2[0], v2[1]);\n    ctx.lineTo(v3[0], v3[1]);\n    ctx.lineTo(v0[0], v0[1]);\n    ctx.fill();\n    // ctx.stroke();\n    ctx.closePath();\n  }\n\n  ctx.restore()\n}\n\ninterface LabelParams {\n  x: number,\n  y: number,\n  w: number, h: number,\n  text: string\n}\nfunction drawLabel(ctx: CanvasRenderingContext2D, { x, y, w, h, text }: LabelParams, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n\n  ctx.beginPath()\n  ctx.moveTo(x, y);\n  ctx.lineTo(x + 100, y - 50)\n  ctx.stroke()\n\n  ctx.rect(x + 100, y - 50, w, h)\n  ctx.stroke()\n  ctx.fillStyle = '#fff'\n  ctx.fill()\n  applyStyle(ctx, style)\n\n  // ctx.strokeText(text, x + 110, y - 50)\n  ctx.fillText(text, x + 105, y - 50 + 5)\n  ctx.restore()\n}\n\n\nexport {\n  drawLine as line,\n  drawHLine as hLine,\n  drawPolygon as polygon,\n  drawPolyline as polyline,\n  drawArrow as arrow,\n  drawCurve as curve,\n  drawCircle as circle,\n  drawRing as ring,\n  drawRoundedRect as roundedRect,\n  drawText as text,\n  drawCone as cone,\n  drawLabel as label,\n}\n\n/**\n * Draws a cardinal spline through given point array. Points must be arranged\n * as: [x1, y1, x2, y2, ..., xn, yn]. It adds the points to the current path.\n *\n * The method continues previous path of the context. If you don't want that\n * then you need to use moveTo() with the first point from the input array.\n *\n * The points for the cardinal spline are returned as a new array.\n *\n * @param {CanvasRenderingContext2D} ctx - context to use\n * @param {Array} points - point array\n * @param {Number} [tension=0.5] - tension. Typically between [0.0, 1.0] but can be exceeded\n * @param {Number} [numOfSeg=20] - number of segments between two points (line resolution)\n * @param {Boolean} [close=false] - Close the ends making the line continuous\n * @returns {Float32Array} New array with the calculated points that was added to the path\n */\nexport function _curve(ctx: CanvasRenderingContext2D, _points: Point[], tension: number = 0.5, numOfSeg: number = 20, close: boolean = false) {\n  const points = _points.flatMap(p => ([p.x, p.y]))\n\n  // let i = 1,\n  let l = points.length,\n    rPos = 0,\n    rLen = (l - 2) * numOfSeg + 2 + (close ? 2 * numOfSeg : 0),\n    res = new Float32Array(rLen);\n\n  let pts = [...points];\n  if (close) {\n    pts.unshift(points[l - 1]);\t\t\t\t// insert end point as first point\n    pts.unshift(points[l - 2]);\n    pts.push(points[0], points[1]); \t\t// first point as last point\n  } else {\n    pts.unshift(points[1]);\t\t\t\t\t// copy 1. point and insert at beginning\n    pts.unshift(points[0]);\n    pts.push(points[l - 2], points[l - 1]);\t// duplicate end-points\n  }\n\n  // cache inner-loop calculations as they are based on t alone\n  const cache = new Float32Array((numOfSeg + 2) * 4)\n  let cachePtr = 4;\n  cache[0] = 1;\t\t\t\t\t\t\t\t// 1,0,0,0\n  for (let i = 1; i < numOfSeg; i++) {\n    let st = i / numOfSeg,\n      st2 = st * st,\n      st3 = st2 * st,\n      st23 = st3 * 2,\n      st32 = st2 * 3;\n\n    cache[cachePtr++] = st23 - st32 + 1;\t// c1\n    cache[cachePtr++] = st32 - st23;\t\t// c2\n    cache[cachePtr++] = st3 - 2 * st2 + st;\t// c3\n    cache[cachePtr++] = st3 - st2;\t\t\t// c4\n  }\n  cache[++cachePtr] = 1;\t\t\t\t\t\t// 0,1,0,0\n\n  // calc. points\n  parse(pts, cache, points.length);\n\n  if (close) {\n    //l = points.length;\n    pts = [];\n    pts.push(points[l - 4], points[l - 3], points[l - 2], points[l - 1]); // second last and last\n    pts.push(points[0], points[1], points[2], points[3]); // first and second\n    parse(pts, cache, 4);\n  }\n\n  function parse(pts: number[], cache: Float32Array, l: number) {\n\n    for (let i = 2, t; i < l; i += 2) {\n\n      let pt1 = pts[i],\n        pt2 = pts[i + 1],\n        pt3 = pts[i + 2],\n        pt4 = pts[i + 3],\n\n        t1x = (pt3 - pts[i - 2]) * tension,\n        t1y = (pt4 - pts[i - 1]) * tension,\n        t2x = (pts[i + 4] - pt1) * tension,\n        t2y = (pts[i + 5] - pt2) * tension;\n\n      for (t = 0; t < numOfSeg; t++) {\n\n        var c = t << 2, //t * 4;\n\n          c1 = cache[c],\n          c2 = cache[c + 1],\n          c3 = cache[c + 2],\n          c4 = cache[c + 3];\n\n        res[rPos++] = c1 * pt1 + c2 * pt3 + c3 * t1x + c4 * t2x;\n        res[rPos++] = c1 * pt2 + c2 * pt4 + c3 * t1y + c4 * t2y;\n      }\n    }\n  }\n\n  // add last point\n  l = close ? 0 : points.length - 2;\n  res[rPos++] = points[l];\n  res[rPos] = points[l + 1];\n\n  // add lines to path\n  ctx.moveTo(points[0], points[1]);\n  for (let i = 0, len = res.length; i < len; i += 2) {\n    ctx.lineTo(res[i], res[i + 1]);\n  }\n  // stroke path\n  ctx.stroke();\n\n  return res;\n}","import { Point } from 'common/@types'\nimport { getAngle } from \"common/@utils\";\n\nimport { PLAYER_META, COLORS, FOCUS, LV_INTEREST_THRESHOLD } from \"@const\";\nimport { PlayerID, KeyPlayer, KeyPlayerType, Lv2Player, Lv2PlayerType, Player } from \"@types\";\n\nimport * as _draw from 'common/@draw'\nimport { EnabledFeatures } from 'App';\n\nexport interface VisRing {\n  cx: number,\n  cy: number,\n  fill: string,\n  size: number,\n  inOffsensiveCourt: boolean\n}\n\nfunction drawVisRings(visCtx: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D, circles: VisRing[]) {\n  // 0 draw vis circle\n  visCtx.save()\n  const [a, b, c, d, e, f] = [1.75257350e+00, 5.98341402e-02, -8.91780472e-01, 2.49200452e-01, 0, 0]\n  visCtx.setTransform(a, b, c, d, e, f);\n  const circleTXY = circles.map(({ cx, cy }) => {\n    const tx = (cx - (c / d) * cy + (c / d) * f - e) / (a - (c / d) * b)\n    const ty = (cx - e - a * tx) / c\n    return { tx, ty }\n  })\n\n  const in_r = 10\n  const max_out_r = 22\n  // draw outer\n  circles\n    .filter(c => c.inOffsensiveCourt)\n    .forEach((_, cIdx) => {\n      const { tx, ty } = circleTXY[cIdx]\n      const out_r = in_r + max_out_r //25\n      visCtx.fillStyle = COLORS.offense_outer_border\n      visCtx.beginPath()\n      visCtx.arc(tx, ty, out_r, 0, 2 * Math.PI);\n      visCtx.fill();\n    })\n\n  // draw middle\n  circles.forEach(({ size, fill }, cIdx) => {\n    const { tx, ty } = circleTXY[cIdx]\n    const out_r = in_r + max_out_r * size //25\n    visCtx.fillStyle = fill\n    visCtx.beginPath()\n    visCtx.arc(tx, ty, out_r, 0, 2 * Math.PI);\n    visCtx.fill();\n  })\n\n  // cut innner\n  visCtx.globalCompositeOperation = 'destination-out'\n  circles.forEach(({ fill }, cIdx) => {\n    const { tx, ty } = circleTXY[cIdx]\n    visCtx.beginPath()\n    visCtx.arc(tx, ty, in_r, 0, 2 * Math.PI)\n    visCtx.fill()\n  })\n\n  // draw outer borders\n  visCtx.globalCompositeOperation = 'source-over'\n\n  visCtx.lineWidth = 1;\n  visCtx.strokeStyle = COLORS.offense_bg_fill\n  circles\n    .filter(c => c.inOffsensiveCourt)\n    .forEach((_, cIdx) => {\n      const { tx, ty } = circleTXY[cIdx]\n      const out_r = in_r + max_out_r //25\n      visCtx.beginPath()\n      visCtx.arc(tx, ty, out_r, 0, 2 * Math.PI);\n      visCtx.stroke()\n    })\n\n  // draw inner borders\n  visCtx.strokeStyle = COLORS.offense_inner_border //\"#313131\"\n  circles.forEach(({ inOffsensiveCourt }, cIdx) => {\n    const { tx, ty } = circleTXY[cIdx]\n    visCtx.lineWidth = inOffsensiveCourt ? 1 : 3;\n    visCtx.beginPath()\n    visCtx.arc(tx, ty, in_r, 0, 2 * Math.PI)\n    visCtx.stroke()\n  })\n\n  visCtx.restore()\n}\n\nexport interface VisSheild {\n  // fillColor: string,\n  diff: number,\n  smoothDFdiff: number\n  speed: number,\n  cx: number,\n  cy: number,\n  dx: number\n  dy: number\n  tangle: number\n  tdist: number\n  // right: boolean\n}\n\nconst roundTo2PI = (r: number) => (r + 2) % 2\n\nfunction drawVisSheilds(visCtx: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D, sheilds: VisSheild[], debugCtx?: CanvasRenderingContext2D) {\n  visCtx.save()\n  // const [a, b, c, d, e, f] = [1.75257350e+00, 5.98341402e-02, -8.91780472e-01, 5.49200452e-01, 0, 0]\n  const [a, b, c, d, e, f] = [1.75257350e+00, 0.0000001, 0.0000001, 5.49200452e-01, 0, 0]\n  visCtx.setTransform(a, b, c, d, e, f);\n\n  const invertTXY = (x: number, y: number) => {\n    const tx = (x - (c / d) * y + (c / d) * f - e) / (a - (c / d) * b)\n    const ty = (x - e - a * tx) / c\n    return { x: tx, y: ty }\n  }\n\n  // const convertTXY = (x: number, y: number) => {\n  //   const nx = a * x + c * y + e - 800\n  //   const ny = b * x + d * y + f - 0\n  //   return { x: nx, y: ny }\n  // }\n\n  const getA1A2 = (tangle: number, tdist: number) => {\n    const base = 0.02\n    const range = 0.13\n    let a1 = roundTo2PI(tangle - base\n      - range * Math.max(0, Math.min(1, 1 - (tdist - MIN_DIST) / MAX_DIST))\n    )\n    let a2 = roundTo2PI(tangle + base\n      + range * Math.max(0, Math.min(1, 1 - (tdist - MIN_DIST) / MAX_DIST)))\n\n    // swap\n    // if (a2 < a1 && !(a1 > 1.5 && a2 < 0.5)) [a2, a1] = [a1, a2]\n    if ((a2 < a1 && !(a1 > 1.5 && a2 < 0.5)) || (a1 < .5 && a2 > 1.5)) [a2, a1] = [a1, a2]\n    return [a1, a2]\n  }\n\n  // draw lines\n  const MAX_DIST = 12\n  const MIN_DIST = 3.5\n  visCtx.save()\n  for (const sheild of sheilds) {\n    const { cx, cy, dx, dy, tdist } = sheild\n\n    if (tdist >= MAX_DIST || tdist <= MIN_DIST) continue\n\n    const theta = getAngle(cx, cy, dx, dy) / 180\n    // console.debug(`cx:${cx}, cy:${cy}, dx:${dx}, dy:${dy}, theta:${theta}`)\n\n    visCtx.beginPath()\n    visCtx.lineWidth = 2\n    const { x: ox, y: oy } = invertTXY(cx + 40 * Math.cos(theta * Math.PI), cy + 40 * Math.sin(theta * Math.PI))\n    const { x, y } = invertTXY(dx - 50 * Math.cos(theta * Math.PI), dy - 50 * Math.sin(theta * Math.PI))\n\n    const grd = visCtx.createLinearGradient(ox, oy, x, y);\n    grd.addColorStop(0, `rgba(${COLORS.off_df_link}, 0.1)`);\n    grd.addColorStop(0.1, `rgba(${COLORS.off_df_link}, ${0.3 + 0.5 * ((MAX_DIST - tdist) / MAX_DIST)})`);\n    grd.addColorStop(0.9, `rgba(${COLORS.off_df_link}, ${0.3 + 0.5 * ((MAX_DIST - tdist) / MAX_DIST)})`);\n    grd.addColorStop(1, `rgba(${COLORS.off_df_link}, 0.1)`);\n\n    visCtx.strokeStyle = grd\n    visCtx.shadowColor = `rgb(${COLORS.off_df_link})`\n    visCtx.shadowBlur = 5\n    visCtx.moveTo(ox, oy)\n    visCtx.lineTo(x, y)\n    visCtx.stroke()\n  }\n  visCtx.restore()\n\n  const in_r = 100\n  for (const sheild of sheilds) {\n    let { cx, cy, dx, dy, tdist, smoothDFdiff } = sheild\n\n    // r\n    const out_r = in_r + 4 + Math.max(0, smoothDFdiff) * 15\n    visCtx.lineWidth = out_r - in_r;\n\n    // 2d angle\n    const theta = getAngle(cx, cy, dx, dy) / 180\n    const dist = Math.max(0,\n      - 30 + in_r * Math.sqrt(1 / (Math.pow(Math.cos(theta * Math.PI) / a, 2) + Math.pow(Math.sin(theta * Math.PI) / d, 2)))\n    )\n\n    cx = cx - dist * Math.cos(theta * Math.PI)\n    cy = cy - dist * Math.sin(theta * Math.PI)\n    const { x: tx, y: ty } = invertTXY(cx, cy)\n\n    // cal start and end angle\n    // 3d angle\n    let tangle = Math.atan(a * Math.tan(theta * Math.PI) / d) / Math.PI\n    // opposite\n    if (theta > 0.5 && theta <= 1.5) tangle = (tangle + 1) % 2\n\n    const [a1, a2] = getA1A2(tangle, tdist)\n    const [ma1, ma2] = getA1A2(tangle, MIN_DIST)\n\n    // visCtx.beginPath()\n    // visCtx.strokeStyle = 'rgba(125, 0, 0, 1)'\n    // visCtx.arc(tx, ty, in_r + (out_r - in_r) / 2,0 * Math.PI, 2 * Math.PI);\n    // visCtx.stroke()\n\n    // bg first\n    visCtx.strokeStyle = COLORS.defense_bg_fill\n    // visCtx.shadowColor = `#f5f5f599`\n    // visCtx.shadowBlur = 5\n    visCtx.beginPath()\n    visCtx.arc(tx, ty, in_r + (out_r - in_r) / 2, ma1 * Math.PI, ma2 * Math.PI);\n    visCtx.stroke()\n    // fill\n    visCtx.strokeStyle = COLORS.defense_fg_fill\n    visCtx.beginPath()\n    visCtx.arc(tx, ty, in_r + (out_r - in_r) / 2, a1 * Math.PI, a2 * Math.PI);\n    visCtx.stroke();\n  }\n\n  visCtx.restore()\n}\n\nfunction drawVis(visCtx: CanvasRenderingContext2D, circles: VisRing[], sheilds: VisSheild[], debugCtx?: CanvasRenderingContext2D) {\n  drawVisRings(visCtx, circles)\n  drawVisSheilds(visCtx, sheilds, debugCtx)\n}\n\n\n\nfunction drawGlows(ctx: CanvasRenderingContext2D, players: Array<Player & Lv2Player>, savedFG: CanvasRenderingContext2D) {\n  ctx.save()\n  ctx.shadowColor = 'rgba(255, 255, 255, 0.5)';\n  players\n    .forEach(player => {\n      const { x, y, w, h } = player.bbox\n      ctx.shadowBlur = player.on ? 10 : 40 * (player.att ?? 0 - LV_INTEREST_THRESHOLD.off);\n      ctx.drawImage(savedFG.canvas,\n        x, y, w, h,\n        x, y, w, h)\n    })\n  ctx.restore()\n}\n\nfunction drawSpotLights(ctx: CanvasRenderingContext2D, players: Array<Player & KeyPlayer>, savedFG: CanvasRenderingContext2D) {\n  players\n    ?.forEach(player => {\n      const { progress: frames } = player.last\n      const { x, y, w, h } = player.bbox\n      let r1 = player.type === KeyPlayerType.EMPTY_PLAYER\n        ? 30\n        : player.type === KeyPlayerType.STAR\n          ? 30\n          : 20\n\n      // full bright image\n      ctx.drawImage(savedFG.canvas,\n        x, y, w, h,\n        x, y, w, h)\n\n      _draw.cone(ctx,\n        {\n          x: x + w * 0.5,\n          y: y + h,\n          r: 50 * (frames / 6),\n          r1: r1 * (frames / 6),\n          h: player.type === KeyPlayerType.EMPTY_PLAYER\n            ? 800\n            : player.type === KeyPlayerType.STAR\n              ? 800\n              : 1000\n        },\n        {\n          lineWidth: 1, strokeStyle: \"rgba(220, 220, 220, 0.05)\",\n          fillStyle: player.type === KeyPlayerType.EMPTY_PLAYER\n            ? 'rgba(50, 220, 128, 0.1)'\n            : player.type === KeyPlayerType.STAR\n              ? 'rgba(255,215,120, 0.08)'\n              : 'rgba(220, 220, 220, 0.1)',\n          lineCap: 'round', lineJoin: 'round'\n        }\n      )\n    })\n}\n\nconst internalCanvas = document.createElement('canvas')\nconst internalCtx = internalCanvas.getContext('2d')!\n/**\n * Highlight levels:\n * - full brights: all lv1 and lv2 players\n * =========== Focus layer ====== \n * - glow effect: lv2 interested\n * - spotlight_white: lv1 key players's full bright should be above the focus mask\n * - spotlight_green: lv1 empty players\n */\nfunction drawHL(ctx: CanvasRenderingContext2D,\n  frame: CanvasImageSource,\n  mask: CanvasImageSource,\n  players: Player[],\n  lv1Players: Array<Player & KeyPlayer> = [],\n  lv2Players: Array<Player & Lv2Player> = [],\n  features: EnabledFeatures,\n  ballHolder?: PlayerID | null,\n  filter_focus?: { pos: Point }) {\n  const { width, height } = ctx.canvas\n\n  // mask get fg\n  internalCanvas.width = width\n  internalCanvas.height = height\n  internalCtx.save()\n  internalCtx.drawImage(mask, 0, 0)\n  internalCtx.globalCompositeOperation = 'source-in'\n  internalCtx.drawImage(frame, 0, 0)\n  internalCtx.restore()\n\n  // draw fg with mask\n  // ctx.save()\n  ctx.drawImage(internalCanvas, 0, 0)\n  // ctx.globalCompositeOperation = 'source-atop'\n  // ctx.fillStyle = `rgba(0, 0, 0, ${COLORS.FG_MASK_ALPHA})`\n  // ctx.fillRect(0, 0, width, height);\n  // ctx.restore()\n\n  // focus mask\n  if (filter_focus) {\n    const { pos } = filter_focus\n    ctx.save()\n    const grd = ctx.createRadialGradient(pos.x, pos.y, FOCUS.min, pos.x, pos.y, FOCUS.max);\n    grd.addColorStop(0, `rgba(0, 0, 0, ${FOCUS.mina})`);\n    grd.addColorStop(1, `rgba(0, 0, 0, ${FOCUS.maxa})`);\n    ctx.fillStyle = grd;\n    ctx.globalCompositeOperation = 'source-atop'\n    ctx.fillRect(0, 0, width, height);\n    ctx.restore()\n\n    //unimportant players\n    const unImportantPlayers = players.filter(p =>\n      !lv2Players.find(lv2 => lv2.id === p.id) &&\n      !lv1Players.find(lv1 => lv1.id === p.id))\n\n    ctx.save()\n    unImportantPlayers.forEach(p => {\n      const { x, y, w, h } = p.bbox\n      ctx.drawImage(internalCtx.canvas,\n        x, y, w, h,\n        x, y, w, h)\n    })\n    // ctx.fillStyle = `rgba(0, 0, 0, ${COLORS.FG_MASK_ALPHA})`\n    // ctx.globalCompositeOperation = 'source-atop'\n    // ctx.fillRect(0, 0, width, height);\n    ctx.restore()\n  }\n\n  // need this for the focus mask\n  // basic hilight, full bright\n  const lv2PlayerLooked = lv2Players\n    .filter(p => p.id !== ballHolder &&\n      p.type.has(Lv2PlayerType.Interest) && p.looked && (p.att ?? 0) > LV_INTEREST_THRESHOLD.off)\n  const lv2PlayerNotLooked = lv2Players\n    .filter(p => !(lv2PlayerLooked.find(lp => lp.id === p.id)))\n  lv2PlayerNotLooked.forEach(player => {\n    const { x, y, w, h } = player.bbox\n    ctx.drawImage(internalCtx.canvas,\n      x, y, w, h,\n      x, y, w, h)\n  })\n\n  // only looked, will show glow\n  drawGlows(ctx, lv2PlayerLooked, internalCtx)\n\n  // spot light \n  if (features.vis_key_player) {\n    drawSpotLights(ctx, lv1Players, internalCtx)\n  }\n}\n\n/**\n * For draw star\n */\nfunction rotate2D(vecArr: Array<[number, number]>, byRads: number) {\n  const mat = [\n    [Math.cos(byRads), -Math.sin(byRads)],\n    [Math.sin(byRads), Math.cos(byRads)]\n  ];\n  const result: Array<[number, number]> = [];\n  for (let i = 0; i < vecArr.length; ++i) {\n    result[i] = [\n      mat[0][0] * vecArr[i][0] + mat[0][1] * vecArr[i][1],\n      mat[1][0] * vecArr[i][0] + mat[1][1] * vecArr[i][1]\n    ];\n  }\n  return result;\n}\n\nfunction generateStarTriangles(numPoints: number, r: number) {\n  const triangleBase = r * Math.tan(Math.PI / numPoints);\n  // console.log(\"Base: \" + triangleBase);\n  const triangle: Array<[number, number]> = [\n    [0, r],\n    [triangleBase / 2, 0],\n    [-triangleBase / 2, 0], [0, r]\n  ];\n  const result = [];\n  for (let i = 0; i < numPoints; ++i) {\n    result[i] = rotate2D(triangle, i * (2 * Math.PI / numPoints));\n  }\n  return result;\n}\n\nfunction drawStar(ctx: CanvasRenderingContext2D, r: number, offset: [number, number], flipVert: boolean) {\n  const sign = flipVert ? -1 : 1;\n  const obj = generateStarTriangles(5, r);\n\n  ctx.save()\n  ctx.fillStyle = COLORS.star_star\n  for (let objIdx = 0; objIdx < obj.length; ++objIdx) {\n    const elem = obj[objIdx];\n    ctx.moveTo(elem[0][0] + offset[0], sign * elem[0][1] + offset[1]);\n    ctx.beginPath();\n    for (let vert = 1; vert < elem.length; ++vert) {\n      ctx.lineTo(elem[vert][0] + offset[0], sign * elem[vert][1] + offset[1]);\n    }\n    ctx.fill();\n  }\n  ctx.beginPath()\n  ctx.arc(offset[0], offset[1], r, 0, 2 * Math.PI)\n  ctx.strokeStyle = COLORS.star_star\n  ctx.stroke()\n  ctx.restore()\n}\n\n\nconst shooterIcon = new Image()\nshooterIcon.src = `${process.env.PUBLIC_URL}/shooter.png`\nconst defenderIcon = new Image()\ndefenderIcon.src = `${process.env.PUBLIC_URL}/defender.png`\nconst starIcon = new Image()\nstarIcon.src = `${process.env.PUBLIC_URL}/star.png`\nconst ICONS = {\n  shooter: shooterIcon,\n  defender: defenderIcon,\n  star: starIcon\n}\n\n\n// shooterIcon.style.filter = `invert(80%) sepia(77%) saturate(366%) hue-rotate(328deg) brightness(102%) contrast(101%);`\nfunction drawIcon(ctx: CanvasRenderingContext2D, iconHeight: number, offset: [number, number], icon: keyof typeof ICONS) {\n  if (icon === 'star') {\n    //   drawStar(ctx, iconHeight / 2, offset, true)\n    drawIcon(ctx, iconHeight, [offset[0] - iconHeight, offset[1]], 'shooter')\n    drawIcon(ctx, iconHeight, offset, 'defender')\n  } else {\n    const iconWidth = iconHeight * ICONS[icon].width / ICONS[icon].height\n    internalCanvas.width = iconWidth\n    internalCanvas.height = iconHeight\n    internalCtx.save()\n    internalCtx.drawImage(ICONS[icon],\n      0, 0, ICONS[icon].width, ICONS[icon].height,\n      0, 0, iconWidth, iconHeight)\n    internalCtx.globalCompositeOperation = 'source-in'\n    internalCtx.fillStyle = COLORS.star_star\n    internalCtx.fillRect(0, 0, iconWidth, iconHeight)\n    internalCtx.restore()\n    ctx.drawImage(internalCanvas, offset[0] - iconWidth * 0.5, offset[1] - iconHeight * 0.5)\n  }\n}\n\nfunction drawName(ctx: CanvasRenderingContext2D, player?: Player) {\n  if (!player) return\n\n  const { id, namePos } = player\n  const textheight = 18\n  const lastname = PLAYER_META[id].ln\n\n  ctx.save()\n  ctx.fillStyle = PLAYER_META[id].star ? COLORS.star_name : COLORS.player_name\n  ctx.font = `bold ${textheight}px Arial`;\n  ctx.textAlign = \"center\";\n  const textwidth = ctx.measureText(lastname).width\n  const x = PLAYER_META[id].star === 'star' ? namePos.x + textheight / 2 : namePos.x\n  ctx.fillText(lastname, x, namePos.y)\n  ctx.restore()\n\n  if (PLAYER_META[id].star) {\n    const starR = Math.floor(textheight / 2) - 1\n    const starPadding = 5\n    const iconHeight = textheight\n    drawIcon(ctx, iconHeight, [\n      x - (textwidth + starR) * 0.5 - starPadding,\n      namePos.y - textheight / 2 + 2],\n      PLAYER_META[id].star as any)\n  }\n}\n\nexport {\n  // drawFG as fg,\n\n  drawVisRings as circles,\n  drawVisSheilds as sheilds,\n  drawHL as HL,\n  drawVis as Vis,\n  drawStar as Star,\n  drawName as Name,\n}","import { Hexbin, HexbinBin, hexbin as d3Hexbin } from 'd3-hexbin';\nimport { scaleSequential, scaleSqrt, scaleOrdinal } from 'd3-scale'\nimport { interpolateReds, interpolateYlGnBu, schemeSet3 } from 'd3-scale-chromatic'\n\nimport type { Point } from \"common/@types\"\nimport { distPoints } from \"common/@utils\"\n\nimport { PLAYER_META } from \"@const\"\nimport type { GameID } from '@types'\nimport type { PlayerID, CachePlayerBin, ShotRecord } from '@types';\nimport { params } from 'param';\n\nif (process.env.NODE_ENV !== 'production') {\n  (global as any).$RefreshReg$ = () => { };\n  (global as any).$RefreshSig$ = () => () => { };\n}\n\nconst getArea = (area: string) => area.match(/\\((\\w+)\\)/)?.[1]\nconst getRegionKey = (r: { AREA: string, BASIC: string, RANGE: string }) =>\n  getArea(r.AREA) + \"_\" +\n  r.RANGE\n\nconst mapRegionToPoint = (region: string) => {\n  return region && (region.endsWith(\"24+ ft.\") || region.endsWith(\"Back Court Shot\")) ? 3 : 2\n}\n\nexport const hRadius = 7\nexport const hexbin = d3Hexbin<ShotRecord>()\n  .x(d => d.LOC_X)\n  .y(d => d.LOC_Y)\n  .radius(hRadius)\n\nexport const leagueAvgByRegion = [\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Above the Break 3\",\n    \"SHOT_ZONE_AREA\": \"Back Court(BC)\",\n    \"SHOT_ZONE_RANGE\": \"Back Court Shot\",\n    \"FGA\": 59,\n    \"FGM\": 4,\n    \"FG_PCT\": 0.068\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Above the Break 3\",\n    \"SHOT_ZONE_AREA\": \"Center(C)\",\n    \"SHOT_ZONE_RANGE\": \"24+ ft.\",\n    \"FGA\": 10885,\n    \"FGM\": 3746,\n    \"FG_PCT\": 0.344\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Above the Break 3\",\n    \"SHOT_ZONE_AREA\": \"Left Side Center(LC)\",\n    \"SHOT_ZONE_RANGE\": \"24+ ft.\",\n    \"FGA\": 16648,\n    \"FGM\": 5802,\n    \"FG_PCT\": 0.349\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Above the Break 3\",\n    \"SHOT_ZONE_AREA\": \"Right Side Center(RC)\",\n    \"SHOT_ZONE_RANGE\": \"24+ ft.\",\n    \"FGA\": 15837,\n    \"FGM\": 5597,\n    \"FG_PCT\": 0.353\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Backcourt\",\n    \"SHOT_ZONE_AREA\": \"Back Court(BC)\",\n    \"SHOT_ZONE_RANGE\": \"Back Court Shot\",\n    \"FGA\": 440,\n    \"FGM\": 17,\n    \"FG_PCT\": 0.039\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"In The Paint (Non-RA)\",\n    \"SHOT_ZONE_AREA\": \"Center(C)\",\n    \"SHOT_ZONE_RANGE\": \"Less Than 8 ft.\",\n    \"FGA\": 19352,\n    \"FGM\": 7561,\n    \"FG_PCT\": 0.391\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"In The Paint (Non-RA)\",\n    \"SHOT_ZONE_AREA\": \"Center(C)\",\n    \"SHOT_ZONE_RANGE\": \"8-16 ft.\",\n    \"FGA\": 6851,\n    \"FGM\": 2889,\n    \"FG_PCT\": 0.422\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"In The Paint (Non-RA)\",\n    \"SHOT_ZONE_AREA\": \"Left Side(L)\",\n    \"SHOT_ZONE_RANGE\": \"8-16 ft.\",\n    \"FGA\": 2089,\n    \"FGM\": 842,\n    \"FG_PCT\": 0.403\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"In The Paint (Non-RA)\",\n    \"SHOT_ZONE_AREA\": \"Right Side(R)\",\n    \"SHOT_ZONE_RANGE\": \"8-16 ft.\",\n    \"FGA\": 1932,\n    \"FGM\": 799,\n    \"FG_PCT\": 0.414\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Left Corner 3\",\n    \"SHOT_ZONE_AREA\": \"Left Side(L)\",\n    \"SHOT_ZONE_RANGE\": \"24+ ft.\",\n    \"FGA\": 7864,\n    \"FGM\": 2939,\n    \"FG_PCT\": 0.374\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Center(C)\",\n    \"SHOT_ZONE_RANGE\": \"16-24 ft.\",\n    \"FGA\": 7324,\n    \"FGM\": 2897,\n    \"FG_PCT\": 0.396\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Center(C)\",\n    \"SHOT_ZONE_RANGE\": \"8-16 ft.\",\n    \"FGA\": 2265,\n    \"FGM\": 987,\n    \"FG_PCT\": 0.436\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Left Side Center(LC)\",\n    \"SHOT_ZONE_RANGE\": \"16-24 ft.\",\n    \"FGA\": 7754,\n    \"FGM\": 3066,\n    \"FG_PCT\": 0.395\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Left Side(L)\",\n    \"SHOT_ZONE_RANGE\": \"8-16 ft.\",\n    \"FGA\": 7639,\n    \"FGM\": 3005,\n    \"FG_PCT\": 0.393\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Left Side(L)\",\n    \"SHOT_ZONE_RANGE\": \"16-24 ft.\",\n    \"FGA\": 5452,\n    \"FGM\": 2173,\n    \"FG_PCT\": 0.399\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Right Side Center(RC)\",\n    \"SHOT_ZONE_RANGE\": \"16-24 ft.\",\n    \"FGA\": 8145,\n    \"FGM\": 3249,\n    \"FG_PCT\": 0.399\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Right Side(R)\",\n    \"SHOT_ZONE_RANGE\": \"8-16 ft.\",\n    \"FGA\": 7630,\n    \"FGM\": 3011,\n    \"FG_PCT\": 0.395\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Right Side(R)\",\n    \"SHOT_ZONE_RANGE\": \"16-24 ft.\",\n    \"FGA\": 4924,\n    \"FGM\": 1996,\n    \"FG_PCT\": 0.405\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Restricted Area\",\n    \"SHOT_ZONE_AREA\": \"Center(C)\",\n    \"SHOT_ZONE_RANGE\": \"Less Than 8 ft.\",\n    \"FGA\": 67443,\n    \"FGM\": 40634,\n    \"FG_PCT\": 0.602\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Right Corner 3\",\n    \"SHOT_ZONE_AREA\": \"Right Side(R)\",\n    \"SHOT_ZONE_RANGE\": \"24+ ft.\",\n    \"FGA\": 7360,\n    \"FGM\": 2803,\n    \"FG_PCT\": 0.381\n  }\n].reduce((o, d) => {\n  const key = getRegionKey({ AREA: d.SHOT_ZONE_AREA, BASIC: d.SHOT_ZONE_BASIC, RANGE: d.SHOT_ZONE_RANGE })\n  o[key] = {\n    FGA: d.FGA,\n    FGM: d.FGM,\n    rate: d.FG_PCT,\n    exp: mapRegionToPoint(key) * d.FG_PCT\n  }\n  return o\n}, {} as Record<string, { FGA: number, FGM: number, rate: number, exp: number }>)\n\nconst groupShotsByRegion = (shots: ShotRecord[]) => {\n  const byRegion = shots\n    .reduce((o, r) => {\n      const key = getRegionKey(r.SHOT_ZONE)\n      if (!(key in o)) {\n        o[key] = []\n      }\n      o[key].push(r)\n      return o\n    }, {} as Record<string, ShotRecord[]>)\n\n  const byRegionAndPercentage: Record<string, {\n    shots: ShotRecord[],\n    rate: number,\n    diff: number,\n    eDiff: number,\n    exp: number,\n    region: { AREA: string, BASIC: string, RANGE: string }\n  }> = {}\n\n  for (const key of Object.keys(byRegion)) {\n    const shots = byRegion[key]\n    const rate = shots.filter(s => +s.made).length / shots.length\n    const diff = rate - leagueAvgByRegion[key].rate\n    const exp = rate * mapRegionToPoint(key)\n\n    byRegionAndPercentage[key] = {\n      shots,\n      region: shots[0].SHOT_ZONE,\n      rate,\n      exp,\n      diff,\n      eDiff: 2 * (-0.5 + 1 / (1 + Math.exp(-5 * diff))),\n    }\n  }\n\n  return byRegionAndPercentage\n}\n\nconst mapLOCTOTracking = (onTheRight: boolean, r: ShotRecord) => ({ //, mapSize: [number, number]) => ({\n  ...r,\n  LOC_X: (onTheRight ? (940 - (r.LOC_Y + 52.5)) : (r.LOC_Y + 52.5)), // / (940 / mapSize[0]),\n  LOC_Y: ((onTheRight ? r.LOC_X : -r.LOC_X) + 250), // / (500 / mapSize[1])\n})\n\n// detect whether at 2 or 3 points region\nconst TwoOrThreePt = ({ x, y }: Point) => {\n  if (x === undefined || y === undefined) return 2\n  const point1 = 14\n  const point2 = 5.25 + 23.75\n  if (x < 47) {\n    // on the left\n    if (x < point1) {\n      // check y\n      return (y > 3 && y < (50 - 3)) ? 2 : 3\n    } else if (x < point2) {\n      // check dist\n      const dist = distPoints({ x, y }, { x: 5.25, y: 25 })\n      return dist > 23.75 ? 3 : 2\n    }\n  } else {\n    // on the right\n    if (x > (94 - point1)) {\n      return (y > 3 && y < (50 - 3)) ? 2 : 3\n    } else if (x > (94 - point2)) {\n      const dist = distPoints({ x, y }, { x: 94 - 5.25, y: 25 })\n      return dist > 23.75 ? 3 : 2\n    }\n  }\n}\n\n\nfunction normalize(v?: number, min?: number, max?: number) {\n  if (v === undefined || min === undefined || max === undefined) return -1\n  return (v - min) / (max - min)\n}\n\nfunction POS_TO_OFF_TEAM(gameId: GameID, x?: number) {\n  if (x === undefined) return undefined\n  return gameId === 'game1'\n    ? x < 47 ? 'CLE' : 'GSW'\n    : x < 47 ? 'OKC' : 'LAC'\n}\n\nexport function GOAL_BASKET_POS(playerId: PlayerID) {\n  const team = PLAYER_META[playerId].team\n  const left = new Set(['CLE', 'OKC'])\n  // const right = new Set(['GSW', 'LAC'])\n\n  return left.has(team) ? { x: 5.8, y: 25 } : { x: 88.2, y: 25 }\n}\n\nfunction PLAYER_ID_TO_OFF_RIGHT(playerId: PlayerID) {\n  return new Set(['GSW', 'LAC']).has(PLAYER_META[playerId].team)\n}\n\nfunction getPlayerBins(hexbin: Hexbin<ShotRecord>, playerId: PlayerID, shotRecords: ShotRecord[]) {\n  const onTheRight = PLAYER_ID_TO_OFF_RIGHT(playerId)\n  const leagueShots = shotRecords\n    .map(r => mapLOCTOTracking(onTheRight, r))\n  const playerShots = leagueShots\n    .filter(r => r.PLAYER_ID === playerId)\n\n  const playerShotsByRegion = groupShotsByRegion(playerShots)\n  const bins = hexbin(leagueShots)\n  const playerShotInBinWithDiff = bins\n    .map(d => {\n      const [region, value] = Object.entries(groupShotsByRegion(d))\n        .reduce((o, d) => (o && o[1].shots.length > d[1].shots.length) ? o : d)\n\n      const dft = leagueAvgByRegion[region]\n      const {\n        rate = dft?.rate ?? 0,\n        diff = 0,\n        eDiff = 0,\n        exp = dft?.exp ?? 0\n      } = playerShotsByRegion[region] ?? {}\n\n      const newD = d as HexbinBin<ShotRecord> & CachePlayerBin\n      newD.region = value.region\n      newD.diff = diff;\n      newD.eDiff = eDiff;\n      newD.regionRate = rate;\n      newD.regionExp = exp\n      return newD\n    })\n\n  // normalize\n  playerShotInBinWithDiff.forEach(d => {\n    ; (d as CachePlayerBin).regionFreq = d.length / Math.max(...playerShotInBinWithDiff.filter(r => r.region === d.region).map(r => r.length))\n  })\n\n  return playerShotInBinWithDiff.map(({ x, y, region, regionExp, regionRate, regionFreq, diff, eDiff }) => ({\n    x, y, region, regionExp, regionRate, regionFreq, diff, eDiff\n  })) as CachePlayerBin[]\n}\n\n/**\n * dirty hack\n */\nexport function getCanvasAbsTopLeft() {\n  const elm = document.getElementById(\"canvasWrapper\")\n  if (!elm) return { x: 0, y: 0 }\n  const { x, y, width, height } = elm?.getBoundingClientRect()\n  return {\n    // x: x + window.screenX,\n    // y: y + window.screenY + window.outerHeight - window.innerHeight,\n    x: x,\n    y: y + window.outerHeight / 50,\n    wScale: 1280 / width,\n    hScale: 720 / height\n  }\n}\n\nconst Scales = {\n  regionScale: scaleOrdinal<string>(schemeSet3),\n  twoPTColor: scaleSequential<string>(interpolateYlGnBu)\n    // .domain([-0.4, 0.4]),\n    .domain([0.2, 0.8]),\n  twoPT: scaleSequential<number>()\n    .domain([0, 0.4])\n    .range([0, 1]),\n  threePTColor: scaleSequential<string>(interpolateYlGnBu)\n    // .domain([-0.27, 0.27]),\n    .domain([0.2, 0.8]),\n  threePT: scaleSequential<number>()\n    .domain([0, 0.27])\n    .range([0, 1]),\n  radiusScale: scaleSqrt()\n    .domain([0, 1])\n    .range([1, hRadius]),\n  regionExp: scaleSequential<string>(interpolateReds)\n    .domain([0.1, params.GAME_ID === 'game1' ? 2 : 2.5])\n} as const\n\nexport {\n  Scales,\n  mapRegionToPoint, TwoOrThreePt, normalize, getPlayerBins,\n  PLAYER_ID_TO_OFF_RIGHT, POS_TO_OFF_TEAM,\n  getArea, getRegionKey, groupShotsByRegion, mapLOCTOTracking\n}","import \"./style.scss\"\nimport React from 'react'\n\nimport { Layer } from 'common/@types'\nimport {\n  Attentions,\n  DefensivePkg,\n  Gaze, KeyPlayer,\n  Lv2Player, Lv2PlayerType, OffensivePkg, PLAYER_STATUS,\n  PlayerID, Player,\n  Video\n} from '@types'\n\nimport * as _draw from 'common/@draw'\nimport * as draw from './visualizeData'\nimport { EnabledFeatures, videoEnv } from '../../App'\nimport { VisRing, VisSheild } from \"./visualizeData\"\nimport { PLAYER_META } from \"@const\"\nimport { Scales } from \"@utils\"\n\nconst layerIds = ['0_bg', '1_vis', '2_fg', '3_annot', '4_debug'] as const\n\n// 0bg --> raw frame\n// 1vis --> vis\n// 2fg --> fg + dark mask\n// 3annot --> highlighted players\n\nexport type LayerId = typeof layerIds[number]\n\ninterface Props {\n  currentVideo: Video\n  currentFrameIdx: number\n  currentFrame?: HTMLVideoElement\n  // currentFrameData?: Frame\n\n  gaze?: Gaze\n  attentions?: Attentions\n  gazePlayers?: Player[]\n\n  features: EnabledFeatures\n  playerFlags: Partial<Record<PlayerID, 'Auto' | 'On' | 'Off'>>\n\n  onPickPlayers?: (fIdx: number, lv1Players: Record<PlayerID, KeyPlayer>, lv2Players: Record<PlayerID, Lv2Player>) => void\n}\n\nexport class Visualizer extends React.Component<Props, {}> {\n\n  public readonly layers: Record<LayerId, Layer | null> = layerIds.reduce((o, l) => {\n    o[l] = null\n    return o\n  }, {} as Record<LayerId, Layer | null>)\n\n  get2DPos(id: PlayerID, players: Player[]) {\n    const { bbox, keypoints } = players?.find(p => p.id === id)!\n    const team = PLAYER_META[id].team\n    const { y, h } = bbox\n    const { left_hip, right_hip, left_ankle, right_ankle } = keypoints\n\n    // calculate cx and cy\n    const cx = (left_hip.x + right_hip.x) / 2\n    const cy = (y + h + Math.max(left_ankle.y, right_ankle.y)) / 2\n\n    return { cx, cy, team }\n  }\n\n  isOnLv2Player = (p: Player, lv2Players: Record<PlayerID, Lv2Player>) => p.id in lv2Players\n    && (\n      (lv2Players[p.id].type.has(Lv2PlayerType.Interest) && lv2Players[p.id].on)\n      || lv2Players[p.id].type.has(Lv2PlayerType.Normal)\n      // || lv2Players[p.id].type === Lv2PlayerType.Normal_Interest\n    )\n\n  async componentDidUpdate(preProps: Props) {\n    if (preProps.currentFrameIdx !== this.props.currentFrameIdx) {\n      const {\n        currentFrameIdx,\n        currentFrame,\n        features,\n        playerFlags\n      } = this.props\n      if (!currentFrame) return\n\n      this.cleanAllExcept('0_bg')\n      _draw.bg(this.layers['0_bg']!, currentFrame)\n      // dark overlay\n      _draw.overlay(this.layers['1_vis']!, 0.18)\n      // if (currentVideo.isTransit || params.MODE === 'RAW') return\n\n      const currentFrameData = videoEnv.frames?.[currentFrameIdx]\n      if (!currentFrameData) return\n\n      const { players, ball } = currentFrameData\n      if (!players) return\n\n      // // Step1. detect the players to show\n      const filter_focus = features.gaze_filter ? videoEnv.fetchFocus() : undefined\n      const { lv1Players, lv2Players } = videoEnv.pickPlayers(currentFrameIdx, features, playerFlags, filter_focus)\n      if (!lv1Players && !lv2Players) return\n\n      // DEBUG.TIMELINE && \n      this.props.onPickPlayers?.(currentFrameIdx, lv1Players, lv2Players)\n\n      // Step2 Decide the data to show for each player\n      const dataToVis = players!.filter(p => this.isOnLv2Player(p, lv2Players))\n\n      // Step3 Visualization & Render\n\n      const offensiveRings: VisRing[] = dataToVis\n        .filter(p => p.dataPkg?.mode === PLAYER_STATUS.offensive && features.vis_off_ring)\n        .map(({ dataPkg, id }) => {\n          // console.log('Offensive circle', id, PLAYER_META[id].ln)\n          let { smoothRegionExp, inOffsensiveCourt } = dataPkg as OffensivePkg\n          const { cx, cy } = this.get2DPos(id, players)\n          const fill = Scales.regionExp(smoothRegionExp)\n          return { cx, cy, fill, size: Math.min(1, smoothRegionExp / 2), inOffsensiveCourt }\n        })\n\n      const defensiveSheilds: VisSheild[] = dataToVis\n        .filter(p => p.dataPkg?.mode === PLAYER_STATUS.defensive && features.vis_def_sheild)\n        .map(({ dataPkg, id }) => {\n          let { diff, speed, tangle, tdist, defendingPlayer, smoothDFdiff } = dataPkg as DefensivePkg\n          const { cx, cy } = this.get2DPos(id, players)\n          const { cx: dx, cy: dy } = this.get2DPos(defendingPlayer, players)\n\n          return {\n            cx, cy,\n            dx, dy,\n            diff, tangle, tdist,\n            smoothDFdiff,\n            speed,\n          }\n        })\n      draw.Vis(this.layers['1_vis']!.ctx, offensiveRings, defensiveSheilds, this.layers['4_debug']?.ctx)\n\n      // draw fg\n      // draw.fg(this.layers['2_fg']?.ctx!, this.layers['0_bg']!.canvas, currentFrameData.mask!)\n      draw.HL(this.layers['3_annot']?.ctx!, this.layers['0_bg']!.canvas, currentFrameData.mask!,\n        players,\n        // \n        players?.filter(p => p.id in lv1Players)\n          .map(p => ({ ...p, ...lv1Players[p.id] })),\n        players.filter(p => p.id in lv2Players)\n          .map(p => ({ ...p, ...lv2Players[p.id] })),\n        features,\n        ball?.playerId,\n        filter_focus\n      )\n\n      // 3. text annotations\n      draw.Name(this.layers['3_annot']?.ctx!, players.find(p => p.id === ball?.playerId))\n      // only on, will show the name\n      Object.values(lv2Players)\n        .filter(p => p.type.has(Lv2PlayerType.Interest) && p.on)\n        .forEach(ip => {\n          draw.Name(this.layers['3_annot']?.ctx!, players.find(p => p.id === ip.id))\n        })\n    }\n  }\n\n  render() {\n    const { currentVideo } = this.props\n    const { width = 0, height = 0 } = currentVideo ?? {}\n\n    return (<div className='visualizationContainer'\n\n      style={{\n        // marginLeft: '20px',\n        // justifyContent: 'center' //DEBUG ? 'flex-start' : 'center'\n      }}\n    >\n      <div id=\"canvasWrapper\" className=\"canvasWrapper\">\n        <img alt=\"www\" src=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\"\n          style={{ height: `${width / height * 100}%` }}\n        ></img>\n        {layerIds.map((l, idx) =>\n          <canvas id={l}\n            key={idx}\n            width={width}\n            height={height}\n            ref={ref => {\n              if (!ref) return\n              this.layers[l] = { canvas: ref, ctx: ref.getContext('2d')! }\n            }}\n          />)}\n        {this.props.children}\n      </div>\n    </div>)\n  }\n\n  public cleanAllExcept(layerId: LayerId) {\n    Object.keys(this.layers)\n      .filter(lId => lId !== layerId)\n      .forEach((lId) => {\n        const l = this.layers[lId as LayerId]\n        l?.ctx.clearRect(0, 0, l.canvas.width, l.canvas.height)\n      })\n  }\n}","import \"./style.scss\"\n\nimport React, { memo } from 'react'\nimport type { Frame } from 'common/@types';\n\nimport type { PlayerID, PlayerShotBin, ShotRecord } from '@types'\nimport { miniMapSize, PLAYER_META } from '@const';\n\nimport { hexbin, Scales } from \"@utils\";\nimport { HexbinBin } from 'd3-hexbin';\nimport { videoEnv } from 'App';\n\n\nconst scaleT2Minimap = miniMapSize[0] / 94;\n\nconst HexaBin = memo(function HexaBin(props: { isIn: boolean, d: PlayerShotBin }) {\n  const { isIn, d } = props\n  return <path\n    // fill={mapRegionToPoint(d.region) === 2\n    //   ? dataTower.scales.twoPTColor(d.regionRate)\n    //   : dataTower.scales.threePTColor(d.regionRate)}\n    // fill={dataTower.scales.regionScale(d.region)}\n    className=\"court_bin\"\n    fill={Scales.regionExp(d.regionExp)}\n    strokeWidth={isIn ? 2 : 0}\n    d={`M${d.x},${d.y}${hexbin.hexagon()}`}\n  ></path>;\n  //dataTower.scales.radiusScale(d.freqByRegion)\n})\n\ninterface HexaProps {\n  currentBin?: HexbinBin<ShotRecord>\n  playerBins?: PlayerShotBin[]\n}\nconst Hexagon = memo(function Hexagon(props: HexaProps) {\n  const { playerBins, currentBin } = props\n\n  return <svg width={miniMapSize[0]} height={`${scaleT2Minimap * 50}px`}\n    style={{ position: 'absolute', overflow: 'visible' }}>\n    <g transform={`scale(${miniMapSize[0] / 940})`}>\n      {playerBins?.map(d => {\n        const isIn = d.x === currentBin?.x && d.y === currentBin?.y;\n        return <HexaBin key={`${d.x}_${d.y}`} d={d} isIn={isIn} />\n      })}\n    </g>\n  </svg>;\n})\n\ninterface CourtProps {\n  currentFrameData?: Frame<PlayerID>\n}\nexport const Court = memo(function Court(props: CourtProps) {\n  const { currentFrameData } = props;\n\n  if (!currentFrameData)\n    return <></>\n\n  const { players, ball } = currentFrameData; // \n\n  const playerMarkers = players\n    ?.filter(({ tracking }) => tracking.x !== undefined && tracking.y !== undefined)\n    .map(({ tracking, id }, mIdx) => {\n      const { x: tx, y: ty } = tracking\n      const team = PLAYER_META[id].team\n\n      return <div key={id}\n        className=\"marker\"\n        style={{\n          top: ty! * scaleT2Minimap,\n          left: tx! * scaleT2Minimap,\n          backgroundColor: ['GSW', 'LAC'].includes(team) ? 'steelblue' : '#ff6347',\n          color: ball?.playerId === id ? 'red' : '#000',\n          fontSize: ball?.playerId === id ? '15px' : '12px'\n        }}\n      >{PLAYER_META[id]?.ln}</div>;\n    });\n\n  if (ball) {\n    playerMarkers?.push(<div key={'ball'}\n      className=\"marker\"\n      style={{\n        top: ball.tracking.y * scaleT2Minimap,\n        left: ball.tracking.x * scaleT2Minimap,\n        backgroundColor: 'orange'\n      }}\n    ></div>);\n  }\n\n  // id 201939\n  const playerId = ball?.playerId;\n  const playerWithBall = players?.find(p => p.id === playerId);\n\n  const currentBin = videoEnv.getCurrentBin(playerWithBall)\n  const playerBins = videoEnv.getPlayerBins(playerWithBall?.id)\n\n  return <div className=\"court\">\n    {playerId && <Hexagon\n      currentBin={currentBin}\n      playerBins={playerBins}\n    ></Hexagon>}\n    {playerMarkers}\n    <img\n      className=\"court-img\"\n      style={{ width: miniMapSize[0] }}\n      src={`${process.env.PUBLIC_URL}/court.png`}\n    >\n    </img>\n  </div>;\n\n})\nCourt.displayName = 'Court'\n","import React from \"react\";\nimport clsx from 'clsx';\n\nimport { Interval as TInterval } from '../../@types'\n\ntype Direction = 'e' | 'w'\n\ninterface Props extends TInterval {\n  id: number\n  focused: boolean\n  initializing: boolean\n  x: number\n  w: number\n  style?: React.CSSProperties\n  onMoving: (id: number, updateInterval: { x: number, w: number }) => void\n  onAdjusting: (id: number, updateInterval: { x: number, w: number }) => void\n  onAdjustingEnd: (id: number, resizeIntervalEnd: { x: number, w: number }, end_?: boolean) => void\n  getEW: (id: number) => { ex: number, wx: number } | undefined\n  onClickInterval: (id: number) => void\n}\n\ninterface State {\n  isMoving: { ox: number } | null\n  isAdjusting: {\n    direction: Direction,\n    oBBox: { x: number, w: number },\n    ox: number\n  } | null\n  cursorStatus: 'movable' | 'resizable' | null\n}\n\nexport class Interval extends React.Component<Props, State> {\n\n  state: State = {\n    isMoving: null,\n    isAdjusting: null,\n    cursorStatus: null, //鼠标指针状态\n  }\n\n  componentDidMount() {\n    window.addEventListener('mousemove', this.onMoving)\n    window.addEventListener('mouseup', this.onMoveEnd)\n    window.addEventListener('mousemove', this.onResizing)\n    window.addEventListener('mouseup', this.onResizeEnd)\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('mousemove', this.onMoving)\n    window.removeEventListener('mouseup', this.onMoveEnd)\n    window.removeEventListener('mousemove', this.onResizing)\n    window.removeEventListener('mouseup', this.onResizeEnd)\n  }\n\n  /** Resizing the bbox */\n  onResizeStart = (e: React.MouseEvent<HTMLDivElement, MouseEvent>, direction: Direction) => {\n    if (e.button !== 0) return\n    e.stopPropagation()\n    const { x, w } = this.props\n    // 全局坐标\n    const mx = e.clientX\n\n    this.setState({\n      isAdjusting: {\n        direction,\n        oBBox: { x, w },\n        ox: mx // 记录初始鼠标位置, 全局坐标\n      },\n      cursorStatus: 'resizable'\n    })\n    document.body.classList.add('adjusting', direction)\n  }\n\n  onResizing = (e: MouseEvent) => {\n    const { isAdjusting } = this.state\n    if (isAdjusting === null || e.button !== 0) return\n    e.preventDefault()\n    e.stopImmediatePropagation()\n\n    let { x, w, id } = this.props\n    const { direction, oBBox, ox } = isAdjusting\n    const mx = e.clientX\n    const dx = mx - ox\n\n    const { wx, ex } = this.props.getEW(id)!\n    switch (direction) {\n      case 'w':\n        // 如果在左, 更新x和w\n        x = Math.min(oBBox.x + oBBox.w, oBBox.x + dx) // 上限为原来的右边\n        x = Math.max(wx, x) // 下限\n        w = Math.min(oBBox.x + oBBox.w - wx, oBBox.w - dx)   // 上限\n        w = Math.max(0, w) // 下限\n        break\n      case 'e':\n        // 如果在右, 只更新w, 下限为0\n        w = Math.max(0, oBBox.w + dx)\n        w = Math.min(ex - x, w)  // 上限\n        break\n    }\n\n    this.props.onAdjusting?.(this.props.id, { x, w })\n  }\n\n  onResizeEnd = (e: MouseEvent) => {\n    const { isAdjusting } = this.state\n    if (isAdjusting === null || e.button !== 0) return\n    e.preventDefault()\n    e.stopImmediatePropagation()\n\n    let { x, w, id } = this.props\n    this.props.onAdjustingEnd?.(id, { x, w }, true)\n\n    this.setState({\n      isAdjusting: null\n    })\n    document.body.classList.remove('adjusting', 'w', 'e', 's', 'n')\n  }\n\n  /** Dragging the bbox */\n  onMoveStart = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    // not left click\n    if (e.button !== 0) return\n    e.stopPropagation()\n    e.preventDefault()\n\n    const { x } = this.props\n    const mx = e.clientX;\n    this.setState({\n      isMoving: { ox: mx - x },\n      cursorStatus: 'movable'\n    })\n  }\n\n  onMoving = (e: MouseEvent) => {\n    const { isMoving } = this.state\n    if (isMoving === null) return\n    e.preventDefault()\n    e.stopImmediatePropagation()\n\n    const mx = e.clientX\n    let { w, id } = this.props\n    const { wx, ex } = this.props.getEW(id)!\n    let newx = Math.max(wx, mx - isMoving.ox)\n    newx = Math.min(newx, ex - w)\n\n    this.props.onMoving?.(this.props.id, { x: newx, w })\n  }\n\n  onMoveEnd = (e: MouseEvent) => {\n    const { isMoving } = this.state\n    if (isMoving === null || e.button !== 0) return\n    e.preventDefault()\n    e.stopImmediatePropagation()\n\n    this.setState({ isMoving: null })\n  }\n\n  render() {\n    const { x, w, focused, initializing, style = {} } = this.props\n    const { isAdjusting, isMoving, cursorStatus } = this.state\n    return <div className={clsx('interval-container', { focused })}\n      style={{ left: x }}\n    >\n      <div\n        className={clsx('interval', cursorStatus)}\n        style={{ width: w, ...style }}\n        onMouseDown={e => {\n          const parentDim = e.currentTarget.parentElement!.getBoundingClientRect()\n          // local coordinate\n          const mx = e.clientX - parentDim.x\n\n          // detect if left or right edge\n          if (Math.abs(mx) < 3) {\n            this.onResizeStart(e, 'w')\n          } else if (Math.abs(mx - w) < 3) {\n            this.onResizeStart(e, 'e')\n          } else {\n            // not on the edge\n            this.onMoveStart(e)\n          }\n        }}\n        onMouseMove={e => {\n          if (isAdjusting || isMoving) return\n          // icon for the cursor status\n          const { w } = this.props\n          const parentDim = e.currentTarget.parentElement!.getBoundingClientRect()\n          // local coordinate in parent\n          const mx = e.clientX - parentDim.x\n\n          // detect if left or right edge\n          if (Math.abs(mx) < 3 || Math.abs(mx - w) < 3) {\n            this.setState({ cursorStatus: 'resizable' })\n          } else {\n            // not on the edge\n            this.setState({ cursorStatus: 'movable' })\n          }\n        }}\n        onClick={e => this.props.onClickInterval(this.props.id)}\n      >\n      </div>\n    </div>\n  }\n}","import \"./style.scss\";\nimport React from \"react\";\n\nimport { Interval, Clip, BaseVideo } from '../../@types'\nimport { intervalIdGen, localFIdxToGlobalFIdx } from '../../@utils'\n\nimport { Interval as CInterval } from './Interval'\n\nfunction pad(num: number) {\n  return (\"0\" + num).slice(-2);\n}\nfunction hhmmss(secs: number) {\n  const t = Math.floor(secs * 1000);\n  // const ms = t % 1000;\n  secs = Math.floor(t / 1000);\n  let minutes = Math.floor(secs / 60);\n  secs = secs % 60;\n  minutes = minutes % 60;\n  return `${pad(minutes)}:${pad(secs)}`;\n}\n\ninterface BaseProps<GameID extends string, VideoID extends string> {\n  mode?: 'S' | 'M' | 'L'\n\n  videos: BaseVideo<GameID, VideoID>[];\n  currentVideoIdx: number;\n  currentFrameIdx: number\n\n  // style\n  containerHeightPadding?: number\n\n  // encodedData?: TDataOption[]\n  children?: (globalTrackWidth: number, globalMaxFrames: number) => React.ReactNode\n  onClickInterval?: (clipId: number, globalFrameIdx: number) => void;  // 给父组件上传起止帧\n}\n\nexport type TimelineProps<GameID extends string, VideoID extends string> = BaseProps<GameID, VideoID> & ({\n  enableClips: false\n} | {\n  enableClips: true\n  clips: Clip<VideoID>[]\n  focusedClipId: number\n\n  onUpsertClip?: (id: number, interval: Partial<Interval> | null) => void\n})\n\n// interface xProps {\n// showEvents: boolean\n// handlers\n// onParse: (id: number, rawtext: string, visFunc: (entities: Entity[]) => void) => void\n// onChangeText?: (id: number, rawtext: string) => void\n// }\n\ninterface State {\n  isDrawing: { intervalId: number, ox: number, omx: number } | null;  // omx: 全局用于dx ox: 本地坐标系\n}\n\nexport class Timeline<GameID extends string, VideoID extends string> extends React.Component<TimelineProps<GameID, VideoID>, State> {\n\n  get globalMaxFrames() { return this.props.videos.reduce((o, v) => o + v.maxFrame, -1) }\n  get trackWidthFactor() {\n    return this.globalMaxFrames < 500 ? 4 : 1\n  }\n  get totalTrackWidth() {\n    return this.globalMaxFrames * this.trackWidthFactor\n  }\n  get globalCurFrameIdx() {\n    const { currentFrameIdx, currentVideoIdx, videos } = this.props\n    return localFIdxToGlobalFIdx(currentVideoIdx, currentFrameIdx, videos)\n  }\n  get maxTime() { return this.props.videos.reduce((o, v) => o + v.maxFrame / v.frameRate, 0) }\n  get numberOfImg() { return Math.ceil(this.maxTime) * 2 }\n  get intervalSelectorHeight() {\n    const { mode = 'M' } = this.props\n    return mode === 'M'\n      ? 60\n      : mode === 'S'\n        ? 30\n        : 90\n  }\n  get containerHeight() {\n    const { containerHeightPadding = 60 } = this.props\n    return this.intervalSelectorHeight + containerHeightPadding\n  }\n\n  #pointer = React.createRef<HTMLDivElement>()\n  imgWidth = (this.intervalSelectorHeight * 1920) / 1080\n  parentOffsetx: number = 0\n  state: State = {\n    isDrawing: null,\n  }\n\n  canvas?: HTMLCanvasElement\n  ctx?: CanvasRenderingContext2D\n\n  componentDidMount() {\n    const { enableClips } = this.props\n\n    if (enableClips) {\n      window.addEventListener('mousemove', this.onDrawing)\n      window.addEventListener('mouseup', this.onDrawEnd)\n    }\n  }\n\n  componentDidUpdate(prevProps: Readonly<TimelineProps<GameID, VideoID>>): void {\n    if (prevProps.currentFrameIdx !== this.props.currentFrameIdx) {\n      if (this.#pointer.current) {\n        const bbox = this.#pointer.current.getBoundingClientRect()\n        if (bbox.left > (window.innerWidth || document.documentElement.clientWidth) || bbox.right < 0) {\n          console.log(bbox, window.innerWidth, document.documentElement.clientWidth)\n          this.#pointer.current.parentElement?.scrollTo({ behavior: 'smooth', left: bbox.left + 400 })\n          // .scrollIntoView({ behavior: \"smooth\", block: \"nearest\", inline: \"center\" })\n        }\n        // ;(this.#pointer.current as any).scrollIntoViewIfNeeded(true)\n      }\n    }\n\n    // const { pickedPlayers } = this.props\n    // if (Object.keys(preProps.pickedPlayers).length < Object.keys(pickedPlayers).length) {\n    //   const { ctx, globalCurFrameIdx } = this\n    //   const maxFIdx = Math.max(...Object.keys(pickedPlayers).map(f => +f))\n    //   const { lv1Players, lv2Players } = pickedPlayers[maxFIdx]\n    //   const maxY = 40\n\n    //   const playersOn = Object.values(lv2Players).filter(p => p.on)\n    //   let y1 = maxY - playersOn.length * 5\n    //   ctx!.lineWidth = 1\n    //   ctx!.strokeStyle = 'red'\n    //   ctx!.beginPath()\n    //   ctx?.moveTo(globalCurFrameIdx, y1)\n    //   ctx?.lineTo(globalCurFrameIdx, maxY)\n    //   ctx!.stroke()\n\n    //   const lv1NotOnNotEmpty = Object.keys(lv1Players)\n    //     .filter(pId => !playersOn.find(p => p.id === +pId) && lv1Players[+pId as PlayerId].type !== KeyPlayerType.EMPTY_PLAYER)\n    //   ctx!.strokeStyle = '#f5f5f5'\n    //   let y2 = y1 - lv1NotOnNotEmpty.length * 5\n    //   ctx?.beginPath()\n    //   ctx?.moveTo(globalCurFrameIdx, y2)\n    //   ctx?.lineTo(globalCurFrameIdx, y1)\n    //   ctx!.stroke()\n\n\n    //   const lv1NotOnEmpty = Object.keys(lv1Players)\n    //     .filter(pId => !playersOn.find(p => p.id === +pId) && lv1Players[+pId as PlayerId].type === KeyPlayerType.EMPTY_PLAYER)\n    //   ctx!.strokeStyle = '#f5f5f5'\n    //   let y3 = y2 - lv1NotOnEmpty.length * 5\n    //   ctx?.beginPath()\n    //   ctx?.moveTo(globalCurFrameIdx, y3)\n    //   ctx?.lineTo(globalCurFrameIdx, y2)\n    //   ctx!.stroke()\n    // }\n\n\n    // const { ctx } = this\n    // if (prevProps.videos.length !== this.props.videos.length && ctx) {\n    //   ctx!.lineWidth = 1\n    //   ctx!.strokeStyle = 'green'\n    //   ctx!.beginPath()\n    //   ctx?.moveTo(0, 40 - 5 * 3)\n    //   ctx?.lineTo(this.totalTrackWidth, 40 - 5 * 3)\n    //   ctx!.stroke()\n\n    //   ctx!.beginPath()\n    //   ctx?.moveTo(0, 40 - 5 * 4)\n    //   ctx?.lineTo(this.totalTrackWidth, 40 - 5 * 4)\n    //   ctx!.stroke()\n    // }\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('mousemove', this.onDrawing)\n    window.removeEventListener('mouseup', this.onDrawEnd)\n  }\n\n  /** Draw interval */\n  onDrawStart = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    if (e.button !== 0) return;\n\n    const parentDim = e.currentTarget.parentElement!.getBoundingClientRect()\n    this.parentOffsetx = -parentDim.x + e.currentTarget.scrollLeft\n    const mx = e.clientX // 鼠标点击位置, 全局坐标系\n    const ox = mx + this.parentOffsetx // interval初始位置, 本地坐标系\n\n    // click on progressbar\n    if (e.clientY >= parentDim.bottom - 8) return\n\n    if (!this.props.enableClips) {\n      const globalFrameIdx = this.pos2frame(ox)\n      this.props.onClickInterval?.(-1, globalFrameIdx)\n    } else {\n      const { clips } = this.props\n      // if click within an interval\n      if (clips.find(i => this.frame2pos(i.interval.start) <= ox && ox <= this.frame2pos(i.interval.end))) {\n        const curFrame = this.pos2frame(ox)\n        this.props.onClickInterval?.(-1, curFrame)\n      } else {\n        // 获取一个新的id\n        const newIntervalId = intervalIdGen()\n        // 新建一个interval 维护interval起始点从小到大\n        let i = 0;\n        for (; i < clips.length; i++) {\n          if (this.frame2pos(clips[i].interval.start) > ox) {\n            break;\n          }\n        }\n\n        const startFrame = this.pos2frame(ox)\n        const endFrame = this.pos2frame(ox + 0)\n        const newInterval: Interval = {\n          // x: ox,\n          // w: 0,\n          start: startFrame,\n          end: endFrame\n        }\n        this.props.onUpsertClip?.(newIntervalId, newInterval)\n\n        this.setState({\n          isDrawing: { intervalId: newIntervalId, omx: mx, ox: ox },\n        })\n      }\n    }\n  }\n\n  onDrawing = (e: MouseEvent) => {\n    const { isDrawing } = this.state\n    if (e.button !== 0 || isDrawing === null || !this.props.enableClips) return;\n\n    const { clips } = this.props\n    const mx = e.clientX\n    const drawingInterval = clips.find(int => int.id === isDrawing.intervalId) // 浅复制 指针\n    if (!drawingInterval) return\n\n    // 更新这个interval的x和width\n    let dx = mx - isDrawing.omx // 先获取x方向上的差值\n    // 防止重叠\n    const { wx, ex } = this.getEW(drawingInterval.id)!\n    const maxdx = ex - isDrawing.ox\n    const mindx = wx - isDrawing.ox\n    if (dx < mindx) {\n      dx = mindx\n    } else if (dx > maxdx) {\n      dx = maxdx\n    }\n\n    const startFrame = dx > 0 ? drawingInterval.interval.start : this.pos2frame(Math.max(isDrawing.ox + dx, 0))\n    const w = Math.abs(dx)\n    const endFrame = startFrame + this.pos2frame(w)\n    this.props.onUpsertClip?.(drawingInterval.id, { start: startFrame, end: endFrame })\n  }\n\n  onDrawEnd = (e: MouseEvent) => {\n    const { isDrawing } = this.state\n    if (e.button !== 0 || isDrawing === null || !this.props.enableClips) return\n    const { clips } = this.props\n    const drawingIntervalIdx = clips.findIndex(int => int.id === isDrawing.intervalId)\n    if (drawingIntervalIdx === -1) return\n\n    const drawingInterval = clips[drawingIntervalIdx]\n\n    this.setState({ isDrawing: null })\n    const { start, end } = drawingInterval.interval\n    if (end - start <= 2) {\n      this.props.onUpsertClip?.(drawingInterval.id, null)\n    }\n    this.props.onClickInterval?.(drawingInterval.id, start)\n  }\n\n  updateInterval = (clipId: number, newInterval: { x?: number, w?: number }, end_ = false) => {\n    if (!this.props.enableClips) return\n\n    const { clips } = this.props\n    const targetIntervalIdx = clips.findIndex(int => int.id === clipId)\n    const targetInterval = clips[targetIntervalIdx].interval\n\n    const start = newInterval.x ? this.pos2frame(newInterval.x) : targetInterval.start\n    const end = newInterval.w ? (this.pos2frame(newInterval.w) + start) : targetInterval.end\n\n    this.props.onUpsertClip?.(clipId, ((end - start <= 2) && end_) ? null : { start, end })\n  }\n\n  getEW = (intervalIdx: number) => {\n    if (!this.props.enableClips) return\n\n    const { clips } = this.props\n    const { numberOfImg } = this\n\n    const intervalCount = clips.findIndex(int => int.id === intervalIdx)!\n    let ex = 0, wx = 0\n\n    if (intervalCount === 0) {\n      wx = this.parentOffsetx\n    } else {\n      wx = this.frame2pos(clips[intervalCount - 1].interval.end) + 1\n    }\n\n    if (intervalCount === clips.length - 1) {\n      ex = (this.intervalSelectorHeight * 1920) / 1080 * numberOfImg + this.parentOffsetx\n    } else {\n      ex = this.frame2pos(clips[intervalCount + 1].interval.start) - 1\n    }\n\n    return { wx, ex }\n  }\n\n  pos2frame = (pos: number) => {\n    const { totalTrackWidth: trackWidth, globalMaxFrames: maxFrame } = this\n    return Math.round(Math.min(pos, trackWidth) / trackWidth * maxFrame)\n  }\n  frame2pos = (frame: number) => {\n    const { totalTrackWidth: trackWidth, globalMaxFrames: maxFrame } = this\n    return (frame / maxFrame) * (trackWidth)\n  }\n\n  // renderIndicator() {\n  //   const { events, maxFrame, clips, encodedData = [] } = this.props\n  //   const { imgWidth, numberOfImg } = this\n\n  //   const indicators = []\n  //   for (const clip of clips) {\n  //     const { interval } = clip\n  //     const coverEvents = events.filter(evt => evt.to >= interval.start && evt.from <= interval.end)\n  //     for (const coverEvt of coverEvents) {\n  //       if ((coverEvt?.type === EvtType.PlayerHit || coverEvt?.type === EvtType.PlayerMove)\n  //         && encodedData.some(k => toPause.has(k))) {\n  //         indicators.push(coverEvt)\n  //         break\n  //       }\n  //     }\n  //   }\n\n  //   // render indicators\n  //   return indicators.map(evt => {\n  //     return <div key={`${evt.type}_${evt.from}_${evt.to}`} className={'trigger'} style={{\n  //       left: `${imgWidth * numberOfImg * evt.data.hit! / maxFrame}px`,\n  //     }}>\n\n  //     </div>\n  //   })\n  // }\n\n  renderClips() {\n    if (!this.props.enableClips) return\n    const { clips, focusedClipId } = this.props\n    const { isDrawing } = this.state\n\n    return clips.map(({ id: intervalId, interval }, idx) =>\n      <CInterval\n        key={intervalId}\n        id={intervalId}\n        x={this.frame2pos(interval.start)}\n        w={this.frame2pos(interval.end - interval.start)}\n        style={{ height: `${this.intervalSelectorHeight + 10}px` }}\n        focused={focusedClipId === intervalId}\n        onMoving={this.updateInterval}\n        onAdjusting={this.updateInterval}\n        onAdjustingEnd={this.updateInterval}\n        getEW={this.getEW}\n        initializing={isDrawing?.intervalId === intervalId}\n        onClickInterval={(id) => {\n          this.props.onClickInterval?.(intervalId, interval.start)\n        }}\n        {...interval}\n      />\n    )\n  }\n\n  render() {\n    const { currentFrameIdx, videos } = this.props;\n    const { maxTime, globalMaxFrames: maxFrame, intervalSelectorHeight, globalCurFrameIdx, containerHeight } = this\n\n    const currentTime = currentFrameIdx / (videos[0]?.frameRate ?? 30)\n\n    return (\n      <div className=\"timeline-container\" style={{ flex: `0 0 ${containerHeight}px` }}>\n        <div className=\"timeline\"\n          onMouseDown={this.onDrawStart}>\n          <div className=\"time-info\">\n            <span>\n              {\" \"}\n              {hhmmss(currentTime)} ({currentFrameIdx}) / {hhmmss(maxTime)} ({maxFrame})\n            </span>\n          </div>\n          <div className=\"pointer\" ref={this.#pointer}\n            style={{\n              left: `calc(12px + ${this.frame2pos(globalCurFrameIdx)}px)`,\n            }}\n          ></div>\n\n          <div id=\"timeline-progress\" className=\"track-container\">\n            {videos.map(v => <div\n              key={v.id}\n              className=\"track\"\n              style={{\n                width: `${v.maxFrame * this.trackWidthFactor}px`,\n                height: intervalSelectorHeight,\n                backgroundColor: v.isTransit ? '#515151' : 'rgb(116 99 57)',\n                opacity: ((v.isTransit || v.loadedData === 1) && v.loadedVideo === 1) ? 1 : 0.5\n              }}>\n              <span className=\"video-name\">{v.id}</span>\n              {/* {this.renderIndicator()} */}\n              {this.props.children?.(this.totalTrackWidth, this.globalMaxFrames)}\n            </div>\n            )}\n            {/*<div className=\"track\">\n               {Array(numberOfImg).fill(0)\n                .map((_, idx) => (\n                  <img\n                    alt='bg'\n                    key={`img_${idx}`}\n                    className=\"img\"\n                    src={`/assets/${videoId}/reduced_frames/${Math.floor(\n                      (maxFrame * idx) / numberOfImg\n                    )}.jpg`}\n                    // x={idx * imgWidth}\n                    draggable=\"false\"\n                    height={this.intervalSelectorHeight}\n                    width={imgWidth}\n                  />\n                ))} \n            </div>*/}\n            {this.renderClips()}\n          </div>\n\n          {/* <canvas\n            ref={ref => {\n              if (!ref || this.canvas) return\n              this.canvas = ref\n              this.ctx = ref.getContext('2d')!\n            }}\n            className=\"debug-timeline\"\n            width={`${this.totalTrackWidth}px`}\n            height={`${40}px`}>\n          </canvas> */}\n\n        </div>\n      </div>\n    );\n  }\n}\n","import './style.scss'\nimport React from 'react'\n\nimport type { Ball, Frame, BasePlayer, BaseVideo } from '../../@types'\n\nexport interface SVGLayerProps<GameID extends string, VideoID extends string, PlayerID extends number> {\n  // width: number\n  // height: number\n  currentVideo: BaseVideo<GameID, VideoID>\n  currentFrameData?: Frame<PlayerID>\n  activeBBoxes?: Array<PlayerID | 'ball'>\n\n  // animatedFrameIdx: number\n  onContextMenu?: (e: React.MouseEvent<SVGSVGElement, MouseEvent>) => void\n  onClickBG?: () => void\n  onClickPlayer?: (player: BasePlayer<PlayerID>, idx: number) => void\n  onClickBall?: (ball: Ball) => void\n  onDBClick?: () => void\n}\n\nfunction convertRemToPixels(rem: number) {\n  return rem * parseFloat(getComputedStyle(document.documentElement).fontSize);\n}\n\nexport class SVGLayer<GameID extends string, VideoID extends string, PlayerID extends number> extends React.Component<SVGLayerProps<GameID, VideoID, PlayerID>> {\n\n  render() {\n    const {\n      currentVideo,\n      currentFrameData,\n      activeBBoxes\n    } = this.props\n    const { height = 0, width = 0 } = currentVideo ?? {}\n\n    const players = currentFrameData?.players ?? []\n    const ball = currentFrameData?.ball ?? null\n\n    return <svg className=\"overlay\" height={height} width={width}\n      viewBox={`0 0 ${width} ${height}`}\n      preserveAspectRatio='xMinYMin meet'\n      onClick={(e) => {\n        if (e.target === e.currentTarget)\n          this.props.onClickBG?.()\n      }}\n      onContextMenu={this.props.onContextMenu}\n      onDoubleClick={e => {\n        if (e.target === e.currentTarget)\n          this.props.onDBClick?.()\n      }}\n    >\n      <defs>\n        <filter x=\"0\" y=\"0\" width=\"1\" height=\"1\" id=\"solid\">\n          <feFlood floodColor=\"yellow\" result=\"bg\" />\n          <feMerge>\n            <feMergeNode in=\"bg\" />\n            <feMergeNode in=\"SourceGraphic\" />\n          </feMerge>\n        </filter>\n      </defs>\n\n      {players.map((player, idx) => <rect key={idx}\n        className={`bbox ${activeBBoxes?.includes(player.id) ? 'active' : ''}`}\n        x={player.bbox.x}\n        y={player.bbox.y}\n        width={player.bbox.w}\n        height={player.bbox.h}\n\n        onContextMenu={e => {\n          e.preventDefault()\n          e.stopPropagation()\n          // this.props.onClickPersonBBox(idx, b)\n        }}\n        onClick={e => {\n          e.stopPropagation()\n          this.props.onClickPlayer?.(player, idx)\n        }}\n      />)}\n\n      {ball && <circle\n        className={`ball ${activeBBoxes?.includes('ball') ? 'active' : ''}`}\n        cx={ball.screenPos.x}\n        cy={ball.screenPos.y}\n        r={5} // hardcode value\n        onClick={e => {\n          e.stopPropagation()\n          this.props.onClickBall?.(ball)\n        }}\n      >\n      </circle>}\n      {this.props.children}\n    </svg>\n  }\n}","import React from 'react'\n\nimport { SVGLayer, SVGLayerProps } from 'common/@components'\nimport { GameID, Gaze, Player, PlayerID, PLAYER_STATUS, VideoID } from '@types'\nimport { GAZE_R, PLAYER_META } from '@const'\nimport { Frame } from 'common/@types'\n\ninterface Props extends SVGLayerProps<GameID, VideoID, PlayerID> {\n  currentFrameData?: Frame<PlayerID>\n\n  gazePlayers?: Player[]\n  gaze?: Gaze\n  // sync?: boolean\n  bbox?: boolean\n}\n\nexport class Overlay extends React.Component<Props> {\n\n  render() {\n    const {\n      gaze,\n      gazePlayers,\n      bbox = true,\n      currentFrameData,\n      ...svgLayerProps\n    } = this.props\n    const { players } = currentFrameData ?? {}\n    const { isTransit } = svgLayerProps.currentVideo ?? {}\n\n    return <SVGLayer\n      {...svgLayerProps}\n    >\n\n      {gaze && <g transform={`translate(${gaze.x}, ${gaze.y})`}>\n        <circle r={GAZE_R}\n          stroke={'red'}\n          fill={'rgba(255, 0, 0, 0.1)'}></circle>\n        <text\n          textAnchor=\"middle\"\n          // stroke=\"#fff\"\n          fill='#fff'\n          // stroke-width=\"1px\"\n          alignmentBaseline=\"middle\"\n        >\n          {(gaze.x).toFixed(0)}, {(gaze.y).toFixed(0)}\n          fIdx: {gaze.fIdx}\n        </text>\n      </g>\n      }\n\n      {/* {!isTransit && <text x={10} y={20} fill={'#fff'}>Team w/ ball: {teamWithBall}</text>}\n      {!isTransit && <text x={150} y={20} fill={'#fff'}>Ballholder: {ball?.playerId ? PLAYER_META[ball!.playerId].ln : null}</text>} */}\n      {/* {!isTransit && <text x={350} y={20} fill={'#fff'}>FrameIdx: {frameIdx}</text>} */}\n\n      {!isTransit && bbox && players\n        ?.filter(({ dataPkg }) => dataPkg)\n        .map(({ bbox, id, dataPkg }) => {\n          return <g\n            key={id}\n            className={`bbox ${gazePlayers?.some(p => p.id === id) ? 'active' : ''}`}\n            transform={`translate(${bbox.x}, ${bbox.y})`}>\n            <rect\n              width={bbox.w}\n              height={bbox.h}\n            />\n            {dataPkg && <text\n              fill='#fff'\n              alignmentBaseline=\"middle\"\n            >\n              {`${dataPkg.mode}, v: ${(dataPkg?.mode === PLAYER_STATUS.defensive\n                ? dataPkg.diff\n                : dataPkg.regionExp).toFixed(1)}`}\n            </text>\n            }\n          </g>\n        }\n        )}\n    </SVGLayer>\n  }\n}\n","import \"./style.scss\"\n\nimport React from 'react'\nimport { IoSendSharp } from 'react-icons/io5'\nimport { MdComment } from 'react-icons/md'\nimport { PLAYER_META } from \"@const\"\nimport { PlayerID } from \"@types\"\n\ninterface State {\n  text: string\n  activeIndex: number\n  matches: string[]\n  // current Player entities\n  // playerEntities: PlayerID[]\n}\n\ninterface Props {\n  existPlayers: PlayerID[]\n  onSend?: (text: string) => void\n  onUpdatePlayerEntity?: (matches: PlayerID[]) => void\n}\n\nexport class CommentBox extends React.Component<Props, State> {\n\n  state: Readonly<State> = {\n    text: '',\n    activeIndex: 0,\n    matches: [],\n  }\n\n  get namesToSearch() {\n    // check player's name\n    const { existPlayers } = this.props\n    const names = existPlayers\n      .map(pId => ({ id: pId, data: PLAYER_META[pId] }))\n      .flatMap(({ id, data }) => [{ name: data.ln, id }, { name: data.fn, id }])\n    return names\n  }\n\n  clean() {\n    this.setState({ text: '' })\n  }\n\n  triggleUpdatePlayerEntities = () => {\n    const names = this.namesToSearch\n    const { text } = this.state\n    // check existing\n    const playerEntities = Array.from(new Set(names.filter(n => {\n      const query = `#${n.name.toLowerCase()}`\n      return text.toLowerCase().match(new RegExp(query, 'g'))\n    }).map(n => n.id)))\n    this.props.onUpdatePlayerEntity?.(playerEntities)\n  }\n\n  onChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n\n    const names = this.namesToSearch\n    const text = e.target.value;\n    const lastIndex = text.search(/#([^#\\s]*)$/)\n    const query = lastIndex === -1 ? '' : text.slice(lastIndex)\n    const matches = query !== '' ? names.filter(n => n.name.toLowerCase().startsWith(query.slice(1).toLowerCase())) : []\n    this.setState({\n      matches: matches.map(m => m.name),\n      text: text,\n    });\n    this.triggleUpdatePlayerEntities()\n  }\n\n  onKeyDown = (event: React.KeyboardEvent<HTMLInputElement>) => {\n    const { text, activeIndex, matches } = this.state;\n\n    switch (event.key) {\n      case 'Tab':\n      case 'Enter': // Enter key\n        if (matches.length) {\n          const toInsert = matches[activeIndex]\n\n          this.setState({\n            activeIndex: 0,\n            matches: [],\n            text: text.replace(/#([^#]*)$/, `#${toInsert}`),\n          }, this.triggleUpdatePlayerEntities);\n          event.stopPropagation()\n          event.preventDefault()\n        }\n        // send\n        else if (event.target === event.currentTarget && text.trim() !== '') {\n          this.props.onSend?.(text)\n        }\n        break;\n      case 'ArrowUp': // Up arrow\n        if (matches.length) {\n          event.stopPropagation()\n          event.preventDefault()\n          this.setState({\n            activeIndex: activeIndex >= 1 ? activeIndex - 1 : 0\n          });\n        }\n        break;\n      case 'ArrowDown': // Down arrow\n        if (matches.length) {\n          event.stopPropagation()\n          event.preventDefault()\n          this.setState({\n            activeIndex:\n              activeIndex < matches.length - 1\n                ? activeIndex + 1\n                : matches.length - 1\n          });\n        }\n        break;\n      default:\n        break;\n    }\n  }\n\n  render(): React.ReactNode {\n    const { text, matches, activeIndex } = this.state\n\n    return <div className=\"comment-box\">\n      <div className=\"control\">\n        <div className={`dropdown ${matches.length > 0 ? \"is-active\" : \"\"}`} style={{ width: '100%' }}>\n          <div className=\"dropdown-trigger\" style={{ width: '100%' }}>\n            <div className=\"control has-icons-left has-icons-right\">\n              <input className=\"input\" type=\"text\"\n                placeholder=\"Any thoughts? Enter to send..\"\n                value={text}\n                onChange={this.onChange}\n                onKeyDown={this.onKeyDown}\n              />\n              <span className=\"icon is-left\">\n                <MdComment style={{ transform: 'scale(1.5)' }}></MdComment>\n              </span>\n              <span className=\"icon is-right\">\n                <IoSendSharp style={{ transform: 'scale(1.5)' }} />\n              </span>\n            </div>\n          </div>\n          <div className=\"dropdown-menu\"\n            style={{\n              left: `${text.length * 9.5 + 40}px` // hardcode for the text width\n            }}\n          >\n            {matches.length > 0 && (\n              <div className=\"dropdown-content\">\n                {matches.map((match, index) => (\n                  <a\n                    className={`dropdown-item ${index === activeIndex ? \"is-active\" : \"\"\n                      }`}\n                    href=\"/\"\n                    key={`${match}_${index}`}\n                  // onClick={event => this.handleSelection(event, match)}\n                  >\n                    {match}\n                  </a>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  }\n}","import './style.scss'\n\nimport React from 'react'\nimport { IComment } from 'App'\nimport { VideoID } from '@types'\n// import randomColor from 'randomcolor'\n\nconst PUSH = 'PUSH' as const\nconst READY = 'READY' as const\nconst PLAYING = 'PLAYING' as const\nconst OVER = 'OVER' as const\ntype DanmuStatus = typeof PUSH | 'READY' | 'PLAYING' | 'OVER'\n\n\nconst DEFAULT_DURATION = 7500 // ms\nconst DEFAULT_FONT_SIZE = 24\n\ninterface MessageProps {\n  id: string\n  content: string,\n  status: DanmuStatus\n  onUpdateStatus: (id: string, status: DanmuStatus) => void\n  // screen: { width: number, height: number }\n  speed?: number,\n  color?: string\n}\n\nclass Message extends React.Component<MessageProps> {\n\n  state = {\n    y: 50 + Math.random() * 200\n  }\n\n  componentDidMount() {\n    const delay = 100\n    const { id, onUpdateStatus } = this.props\n\n    setTimeout(() => {\n      onUpdateStatus(id, PLAYING)\n    }, delay)\n\n    setTimeout(() => {\n      onUpdateStatus(id, OVER)\n    }, delay + this.getDuration())\n  }\n\n  getDuration() {\n    const { speed = 1 } = this.props\n    return DEFAULT_DURATION / speed\n  }\n\n  render() {\n    const { content, color = '#fff', status } = this.props\n    const { y } = this.state\n    const fontSize = DEFAULT_FONT_SIZE * (status === 'PUSH' ? 2 : 1)\n\n    const style = {\n      transitionDuration: this.getDuration() + 'ms',\n      top: `${y}px`,\n      fontSize,\n      color,\n    }\n\n    return <div\n      className={`danmu-message ${status.toLowerCase()}`}\n      style={style}>\n      {content}\n    </div>\n  }\n}\n\n\ninterface DanmuProps {\n  videoId: VideoID\n  frameIdx: number\n  comments: IComment[]\n}\ninterface DanmuState {\n  danmuQueue: Array<{ id: string, state: DanmuStatus, content: string }>\n}\n\nexport class Danmu extends React.Component<DanmuProps, DanmuState> {\n  state: Readonly<DanmuState> = {\n    danmuQueue: []\n  }\n\n  componentDidUpdate(prevProps: Readonly<DanmuProps>, prevState: Readonly<DanmuState>, snapshot?: any): void {\n    // ignore the update of videos here, can be a problem\n    if (prevProps.frameIdx !== this.props.frameIdx) {\n      // update queue\n      const { comments } = this.props\n      const { danmuQueue: queue } = this.state\n      const toLoad = comments\n        .filter(c => c.frameIdx === this.props.frameIdx && c.videoId === this.props.videoId)\n        .filter(c => queue.every(d => d.id !== c.id))\n      this.setState({\n        danmuQueue: [\n          // remove old\n          ...queue.filter(c => c.state !== 'OVER'),\n          // add new\n          ...toLoad.map(({ id, content }) => ({ id, content, state: READY }))\n        ]\n      })\n    }\n  }\n\n  push({ id, content }: IComment) {\n    const { danmuQueue } = this.state\n    this.setState({\n      danmuQueue: [...danmuQueue, { id, content, state: PUSH }]\n    })\n  }\n\n  onUpdateStatus = (id: string, s: DanmuStatus) => {\n    const { danmuQueue } = this.state\n    const targetDanmu = danmuQueue.find(d => d.id === id)\n    if (targetDanmu) {\n      targetDanmu.state = s\n      this.setState({\n        danmuQueue: [...danmuQueue]\n      })\n    }\n  }\n\n  render() {\n    const { danmuQueue } = this.state\n    return <div className=\"danmu\">\n      <div className=\"danmu-screen\">\n        {danmuQueue\n          .filter(danmu => danmu.state !== 'OVER')\n          .map(({ id, state, content }) => <Message\n            key={id}\n            id={id}\n            status={state}\n            content={content}\n            color={state === 'PUSH' ? '#1E90FF' : '#fff'}\n            onUpdateStatus={this.onUpdateStatus}\n          />)}\n      </div>\n    </div>\n  }\n\n}\n","export default function Worker_fn() {\n  return new Worker(__webpack_public_path__ + \"static/js/loadFrames.worker.204ea63a.js\");\n}\n","import type {\n  Frame,\n  BaseVideo,\n  CacheFrameData\n} from \"../@types\"\nimport { DEBUG } from '../@const';\nimport { getImg, wait, debugMem, ArrayToDict, waitUntil, wrapWorker } from '../@utils';\n\nimport MyWorker from './loadFrames.worker';\n\nexport class DataLoader<GameID extends string, VideoID extends string, PlayerID extends number> {\n\n  // shotRecords: ShotRecord[] = []\n  #Loading: Partial<Record<VideoID, boolean>> = {}\n\n  // video data per frame\n  memVideoData: Partial<Record<VideoID, Record<number, Frame<PlayerID>>>> = {}\n\n  onLoad?: (videoId: VideoID, progress?: number) => void\n  onUnload?: (videoId: VideoID) => void\n\n  #getFrames: (video: BaseVideo<GameID, VideoID>) => Promise<CacheFrameData<PlayerID>[] | undefined>\n  constructor(readonly worker: { new(): Worker } = MyWorker) {\n    this.#getFrames = wrapWorker<[BaseVideo<GameID, VideoID>], CacheFrameData<PlayerID>[] | undefined>(worker, 'Frames', (d) => {\n      if (d[0] === 'Progress') {\n        const [_, vId, progress] = d\n        this.onLoad?.(vId, progress)\n      }\n    })\n  }\n\n  /**\n   * ----------------- Data Loading --------------------\n   */\n  isLoaded(video: BaseVideo<GameID, VideoID>) {\n    return video.isTransit || video.id in this.memVideoData\n  }\n  getVideoData(videoId: VideoID) {\n    return this.memVideoData[videoId]\n  }\n\n  #pre_load_batch_size = 50\n  async fetch(video: BaseVideo<GameID, VideoID>, shouldWait: boolean = false) {\n\n    if (this.#Loading[video.id]) {\n      // wait until anothe thread finish\n      await waitUntil(() => !this.#Loading[video.id])\n      return\n    }\n\n    this.#Loading[video.id] = true\n    console.debug('preload===>', video)\n    // if not in mem, load from db\n    if (!this.isLoaded(video)) {\n      // step 1, get from db\n      const frames = await this.#getFrames(video)\n      if (!frames) {\n        this.#Loading[video.id] = false\n        return\n      }\n      const progressOffset = 0.6\n      this.onLoad?.(video.id, progressOffset)\n\n      // step2, process to mem\n      console.log(`%cMain thread processing ${video.id} to mem =====>`, 'color:#f5f5f5;background: #00695c; padding: 2px; border-radius:2px')\n      // should not do at once, chunck frames into groups\n      let framesToSave: Frame<PlayerID>[] = []\n      console.debug('===>parsing blob to img...')\n      for (let i = 0; i < Object.keys(frames).length; i += this.#pre_load_batch_size) {\n        const itemsForBatch = frames.slice(i, i + this.#pre_load_batch_size)\n        framesToSave = [\n          ...framesToSave,\n          ...(await Promise.all(itemsForBatch.map(async (frame) => {\n            const mask = await getImg(URL.createObjectURL(frame.mask!))\n            return { ...frame, mask } as any as Frame<PlayerID>\n          })))\n        ]\n        this.onLoad?.(video.id, progressOffset + (0.95 - progressOffset) * i / Object.keys(frames).length)\n\n        if (shouldWait) {\n          await wait(30)\n        }\n      }\n      // sort\n      framesToSave.sort((a, b) => a.idx - b.idx)\n      console.debug(`<=====${video.id} Done!`, framesToSave[0])\n      // Step3. save to mem\n      this.memVideoData[video.id] = ArrayToDict(framesToSave, 'idx')\n      this.onLoad?.(video.id, 1)\n      DEBUG.DEBUG_MEM && debugMem()\n\n      console.log(`%cMain thread done processing ${video.id} to mem<======`, 'color:#f5f5f5;background: #00695c; padding: 2px; border-radius:2px')\n    }\n    this.#Loading[video.id] = false\n  }\n\n  unloadFromMem(video?: BaseVideo<GameID, VideoID>) {\n    if (video === undefined || video.isTransit) return\n    delete this.memVideoData[video.id]\n    this.onUnload?.(video.id)\n    DEBUG.DEBUG_MEM && debugMem()\n  }\n}","\nimport Dexie from 'dexie';\nimport { CacheFrameData, VideoDataVersion } from '../@types'\n\ninterface BaseTables<PID extends number> {\n  frames: CacheFrameData<PID>,\n  videoDataVersions: VideoDataVersion\n}\n\nexport class Database<PID extends number, T extends Record<string, any> = {}, K = T & BaseTables<PID>> extends Dexie {\n  // meta\n  public readonly myTables: { [k in keyof K]: Dexie.Table<K[k]> }\n\n  constructor(stores?: Record<keyof T, string>) {\n    super(\"Database\");\n    this.version(6).stores({\n      frames: \"[gameId+videoId+idx]\",\n      videoDataVersions: \"[gameId+videoId]\",\n      ...(stores ?? {})\n    });\n\n    this.myTables = ['frames', 'videoDataVersions', ...Object.keys(stores ?? {})]\n      .reduce((o, d) => {\n        o[d as keyof K] = this.table(d)\n        return o\n      }, {} as Record<keyof K, Dexie.Table<any>>)\n\n  }\n}","import { DEBUG } from \"../../@const\"\nimport type { BaseVideo } from \"../../@types\"\nimport { debugMem, waitUntil } from \"../../@utils\"\n\n\nexport class VideoLoader<GameID extends string, VideoID extends string> {\n  #Loading: Partial<Record<VideoID, boolean>> = {}\n\n  onLoad?: (videoId: VideoID) => void\n  onUnload?: (videoId: VideoID) => void\n  private memVideos: Partial<Record<VideoID, HTMLVideoElement>> = {}\n\n  getVideo(videoId: VideoID) {\n    return this.memVideos[videoId]\n  }\n\n  isLoaded(video: BaseVideo<GameID, VideoID>) {\n    return video.id in this.memVideos\n  }\n\n  async fetch(video: BaseVideo<GameID, VideoID>) {\n\n    if (this.#Loading[video.id]) {\n      // wait until anothe thread finish\n      await waitUntil(() => !this.#Loading[video.id])\n      return\n    }\n\n    this.#Loading[video.id] = true\n    if (!this.isLoaded(video)) {\n      console.debug('VideoLoader.preLoadToMem', video)\n      const nextVideo = document.createElement('video')\n      nextVideo.src = `${process.env.PUBLIC_URL}/assets/${video.gameId}/${video.id}/${video.id}.mp4`\n      nextVideo.id = video.id\n      nextVideo.load()\n      await new Promise(resolve => {\n        // nextVideo.onloadedmetadata = () => console.log('onloadedmetadata', video.id)\n        nextVideo.onloadeddata = resolve\n      })\n      console.debug('VideoLoader.preLoadToMem ==> Done', video)\n\n      // load to mem\n      this.memVideos[video.id] = nextVideo\n      this.onLoad?.(video.id)\n      DEBUG.DEBUG_MEM && debugMem()\n    }\n    this.#Loading[video.id] = false\n  }\n}\n","import type { BaseVideo } from \"../../@types\"\nimport { VideoLoader } from './VideoLoader'\n\nclass VideoTrack<GameID extends string, VideoID extends string> {\n  private get frameOffset() {\n    // hardcode value, I dont know why\n    return this.#videoMeta?.frameRate === 50 ? 0 : 1\n  }\n\n  #videoMeta?: BaseVideo<GameID, VideoID>\n  #video?: HTMLVideoElement\n  get video() { return this.#video }\n  get id() { return this.#video?.id }\n\n  CallBackHandle: number | null = null\n\n  onPlay: EventListener | null = null\n  onPause: EventListener | null = null\n  setVideo(video: BaseVideo<GameID, VideoID>, videoElm: HTMLVideoElement | undefined) {\n    this.#video = videoElm\n    this.#video?.requestVideoFrameCallback(this.invokeFrameHandlers)\n    this.#videoMeta = video\n  }\n  load(onPlay: EventListener, onPause: EventListener) {\n    this.onPlay = onPlay\n    this.onPause = onPause\n    this.#video?.addEventListener('play', onPlay)\n    this.#video?.addEventListener('pause', onPause)\n  }\n\n  unLoad() {\n    if (this.onPlay)\n      this.#video?.removeEventListener('play', this.onPlay)\n    if (this.onPause)\n      this.#video?.removeEventListener('pause', this.onPause)\n    if (this.CallBackHandle !== null)\n      this.#video?.cancelVideoFrameCallback(this.CallBackHandle)\n    this.#video?.load()\n    this.#video = undefined\n    this.#videoMeta = undefined\n  }\n\n  constructor(public readonly name: string, private readonly videoPlayer: VideoPlayer<GameID, VideoID>) { }\n\n  play() {\n    this.#video?.play()\n  }\n\n  invokeFrameHandlers: VideoFrameRequestCallback = (now, metadata) => {\n  \n    if (this.#video === this.videoPlayer.currentTrack) {\n      const rawFrame = Math.round(metadata.mediaTime * this.#videoMeta!.frameRate) //when play, videoMeta must set\n      const frameIdx = rawFrame - this.frameOffset\n      const videoId = this.videoPlayer.currentTrack!.id\n      for (let i = 0, len = this.videoPlayer.onFrameHandlers.length; i < len; ++i) {\n        this.videoPlayer.onFrameHandlers[i].call(this, videoId, frameIdx, Date.now(), this.videoPlayer.currentTrack!)\n      }\n    }\n\n    if (this.#video) {\n      this.CallBackHandle = this.#video?.requestVideoFrameCallback(this.invokeFrameHandlers)\n    }\n  }\n}\n\nexport class VideoPlayer<GameID extends string, VideoID extends string> {\n  protected _currentTrack?: HTMLVideoElement\n  public get currentTrack() { return this._currentTrack }\n  // video meta\n  #currentVideo: BaseVideo<GameID, VideoID> | null = null\n  protected set currentVideo(v) { this.#currentVideo = v }\n  get currentVideo() { return this.#currentVideo }\n\n  // video sources\n  videoSources = new VideoLoader<GameID, VideoID>()\n\n  /**\n   * A video player has two video track.\n   * It uses one track to preload, and the other track to play\n   */\n  protected ATrack = new VideoTrack<GameID, VideoID>('A', this)\n  protected BTrack = new VideoTrack<GameID, VideoID>('B', this)\n  onFrameHandlers: Array<(vId: string, fIdx: number, ts: number, videoFrame: HTMLVideoElement) => void> = []\n\n  // event handlers\n  onPlay?: (videoId: VideoID) => void\n  onPause?: (videoId: VideoID) => void\n  onLoad?: (videoId: VideoID, type: 'Video' | 'Data', progress?: number) => void\n  onUnload?: (videoId: VideoID, type: 'Video' | 'Data') => void\n  public videos: BaseVideo<GameID, VideoID>[] = []\n\n  constructor() {\n    // auto switch to the next clip\n    this.addOnFrameListener(async (videoId, frameIdx, ts, videoFrame) => {\n      const curVideoIdx = this.videos.findIndex(v => v.id === videoId)\n      if (curVideoIdx === -1) {\n        console.warn('There must be something wrong since it cannot find the video from the videoList in the videoPlayer', videoId, this.videos)\n        return\n      }\n\n      // preload to the other track\n      if (frameIdx + 5 === this.currentVideo?.maxFrame) {\n        // should load next\n        const nextVideoIdx = curVideoIdx + 1\n        if (this.videos[nextVideoIdx] !== undefined) {\n          this.preloadToAnotherTrack(this.videos[nextVideoIdx], true)\n        }\n      }\n\n      // load to the current track\n      if (frameIdx + 1 === this.currentVideo?.maxFrame) {\n        const nextVideoIdx = curVideoIdx + 1\n        if (this.videos[nextVideoIdx] === undefined) {\n          this.pause()\n          return\n        }\n        await this.loadVideo(this.videos[nextVideoIdx], true)\n        // should also load data after extension\n      }\n    })\n\n    // videoSources\n    this.videoSources.onLoad = (videoId: VideoID) => {\n      this.onLoad?.(videoId, 'Video')\n    }\n    this.videoSources.onUnload = (videoId: VideoID) => {\n      this.onUnload?.(videoId, 'Video')\n    }\n  }\n\n  addOnFrameListener(fn: (vId: string, frameIdx: number, ts: number, videoFrame: HTMLVideoElement) => void) {\n    this.onFrameHandlers.splice(this.onFrameHandlers.length - 2, 0, fn)\n  }\n\n  // data control\n  async fetchVideos() {\n    for (const video of this.videos) {\n      await this.videoSources.fetch(video)\n    }\n  }\n  isLoaded(video: BaseVideo<GameID, VideoID>) {\n    return this.videoSources.isLoaded(video)\n  }\n\n  // this is for assertion?\n  private whichOnPause = (ev: Event) => {\n    const v = ev.target as HTMLVideoElement\n    if (v.id === this.currentTrack?.id) {\n      this.onPause?.(v.id as VideoID)\n    }\n  }\n  private whichOnPlay = (ev: Event) => {\n    const v = ev.target as HTMLVideoElement\n    if (v.id === this.currentTrack?.id) {\n      this.onPlay?.(v.id as VideoID)\n    }\n  }\n\n  // video track control\n  async loadVideo(video: BaseVideo<GameID, VideoID>, play = false) {\n    // not load\n    if (this.currentTrack?.id === video.id) return\n    this.currentVideo = video\n\n    // ensure load to preTrack\n    if (this.ATrack.id !== video.id && this.BTrack.id !== video.id) {\n      await this.preloadToAnotherTrack(video, play)\n    }\n\n    const [trackToLoad, trackToUnload] = this.ATrack.id === video.id\n      ? [this.ATrack, this.BTrack]\n      : [this.BTrack, this.ATrack]\n    console.debug(`TrackToLoad: ${trackToLoad.name}_${trackToLoad.id} ${trackToLoad.video?.currentTime}, TrackToUnload: ${trackToUnload.name}_${trackToUnload.id}`)\n\n    // clean the currentTrack\n    trackToUnload.unLoad()\n    trackToLoad.load(this.whichOnPlay, this.whichOnPause)\n    this._currentTrack = trackToLoad.video\n  }\n\n  async preloadToAnotherTrack(newVideo: BaseVideo<GameID, VideoID>, play: boolean) {\n    console.log('%cpreloadToSkip', 'background: #444; color: #bada55; padding: 2px; border-radius:2px', newVideo)\n    await this.videoSources?.fetch(newVideo)\n\n    // load to the ohter track, prefer ATrack\n    const trackToLoad = this.BTrack.id === this.currentTrack?.id\n      ? this.ATrack\n      : this.BTrack\n    console.debug(`Load to track_${trackToLoad.name}`)\n\n    trackToLoad.setVideo(newVideo, this.videoSources?.getVideo(newVideo.id))\n    play && trackToLoad.play()\n  }\n\n  // video control\n  play() {\n    if (!this.currentTrack || !this.currentTrack.paused) return\n    console.debug('play video')\n    // this.currentTrack.playbackRate = 0.75\n    this.currentTrack.play()\n    this.onPlay?.(this.currentTrack?.id as VideoID)\n  }\n\n  pause() {\n    if (this.currentTrack?.paused) return\n    this.currentTrack?.pause()\n    this.onPause?.(this.currentTrack?.id as VideoID)\n  }\n\n  async seekTo(video: BaseVideo<GameID, VideoID>, frameIdx: number) {\n    await this.loadVideo(video)\n\n    this.currentTrack!.currentTime = (frameIdx / video.frameRate) + 0.001\n    console.debug('switch to video:', video, 'set currentTime to frameIdx', frameIdx)\n  }\n}\n","import { Frame, BaseVideo } from '../@types'\n\nimport { DataLoader } from '../DataLoader'\nimport { VideoPlayer } from './VideoPlayer'\n\nexport class VideoEnv<\n  GameID extends string,\n  VideoID extends string,\n  PlayerID extends number\n> extends VideoPlayer<GameID, VideoID> {\n\n  /**\n   * add a dataLoader to the VideoPlayer\n   */\n  // dataLoader: DataLoader\n\n  // data\n  #frames: Record<number, Frame<PlayerID>> | undefined\n  get frames() { return this.#frames }\n  set frames(v) { this.#frames = v }\n\n  // combine event\n  constructor(readonly dataLoader: DataLoader<GameID, VideoID, PlayerID> = new DataLoader()) {\n    super()\n    // this.dataLoader = new DataLoader(postProcessingData)\n    // combine event\n    this.dataLoader.onLoad = (videoId: VideoID, progres?: number) => {\n      this.onLoad?.(videoId, 'Data', progres)\n    }\n    this.dataLoader.onUnload = (videoId: VideoID) => {\n      this.onUnload?.(videoId, 'Data')\n    }\n  }\n\n  async fetchVideos() {\n    super.fetchVideos()\n    for (const video of this.videos) {\n      await this.dataLoader.fetch(video)\n    }\n  }\n\n  isLoaded(video: BaseVideo<GameID, VideoID>) {\n    return this.dataLoader.isLoaded(video) && super.isLoaded(video)\n  }\n\n  async loadVideo(video: BaseVideo<GameID, VideoID>, play = false) {\n    // not load\n    if (this.currentTrack?.id === video.id) return\n    super.loadVideo(video, play)\n    // load data\n    await this.dataLoader.fetch(video)\n    this.frames = this.dataLoader.getVideoData(video.id)\n  }\n\n  // one off data load\n  // async loadBins() {\n  //   return this.dataLoader.loadBins()\n  // }\n}","export default function Worker_fn() {\n  return new Worker(__webpack_public_path__ + \"static/js/loadData.worker.8a7f35a0.js\");\n}\n","import { GameID, PlayerID, PlayerShotBin, VideoID } from '@types';\nimport { wrapWorker } from 'common/@utils';\nimport { DataLoader } from 'common/DataLoader';\nimport IBallWorker from './loadData.worker'\n\nexport class IBallDataLoader extends DataLoader<GameID, VideoID, PlayerID> {\n\n    #getBins: () => Promise<Partial<Record<PlayerID, PlayerShotBin[]>>>\n\n    constructor() {\n        super(IBallWorker)\n        this.#getBins = wrapWorker<[], Partial<Record<PlayerID, PlayerShotBin[]>>>(this.worker, 'Bins')\n    }\n\n    /**\n     * -------------- Game data ----------------\n     */\n    playerBins: Partial<Record<PlayerID, PlayerShotBin[]>> = {}\n    async loadBins() {\n        this.playerBins = await this.#getBins();\n    }\n}","import type { Ball, Point } from 'common/@types'\nimport {\n  PlayerID, TeamID,\n  Attentions, AttentionWeights,\n  FrameStamp, Gaze, Highlights,\n  KeyPlayer,\n  KeyPlayerType,\n  Lv2Player,\n  Lv2PlayerType,\n  OffensivePkg,\n  VideoID,\n  GameID, Player\n} from \"@types\"\n\nimport { distPoints, union } from 'common/@utils';\nimport { getCanvasAbsTopLeft, GOAL_BASKET_POS, hexbin, hRadius } from '@utils';\n\nimport { DEBUG } from 'common/@const'\nimport {\n  PLAYER_META,\n  EMPTY_SPACE_THRESHOLD, GAZE_R, LV_INTEREST_THRESHOLD, MAX_HIGHLIGHTED, NEXT_BALL_HOLDER_TIME_RANGE,\n} from '@const';\nimport { params } from 'param';\n\nimport { VideoEnv } from 'common/VideoEnv';\n\nimport { EnabledFeatures } from 'App';\nimport { IBallDataLoader } from './DataLoader';\n\nexport class IBallVideoEnv extends VideoEnv<GameID, VideoID, PlayerID> {\n  // gaze events\n  onGaze?: (p: Gaze, player?: Player[]) => void\n  onUpdateLvInt?: (att: Attentions) => void\n  onUpdateLvSync?: (sync: boolean, hilights: Highlights) => void\n\n  #gazeQueue: Gaze[] = []\n  #frameQueue: FrameStamp[] = []\n  #mousePos: Point = { x: 0, y: 0 }\n  constructor(dataLoader = new IBallDataLoader()) {\n    super(dataLoader)\n\n    if (DEBUG.MOUSE_GAZE) {\n      document.body.addEventListener('mousemove', e => {\n\n        const bbox = document.getElementById('canvasWrapper')?.getBoundingClientRect()\n        if (bbox === undefined) return\n        const ox = bbox.x\n        const oy = bbox.y\n        const { wScale = 1, hScale = 1 } = getCanvasAbsTopLeft()\n        this.#mousePos = { x: (e.clientX - ox!) * wScale, y: (e.clientY - oy!) * hScale }\n      })\n\n      setInterval(() => {\n        this.onSocket({ data: JSON.stringify([[0, 0], Date.now() / 1000]) })\n      }, 1000 / 30)\n    }\n\n    // console.log('Gaze init----')\n    // const socket = new WebSocket('ws://localhost:5000/echo');\n    // socket.addEventListener('message', this.onSocket);\n  }\n\n  /**\n   * -------------- Gaze data ----------------\n   */\n  onSocket = (ev: any) => {\n    const rawGaze = JSON.parse(ev.data) as [[number, number], number]\n    const ts = Math.round(rawGaze[1] * 1000)\n    // get the closetFrame\n    const closetFrame = this.getClosetFrame(ts)\n    // console.warn('Cannot find closetframe of gaze', rawGaze)\n    if (!closetFrame) {\n      // maybe should find frame in lazy mode?\n      return\n    }\n\n    const { x: ox, y: oy, wScale = 1, hScale = 1 } = getCanvasAbsTopLeft()\n    const wOutToIn = window.innerWidth / window.outerWidth\n    const hOutToIn = window.innerHeight / window.outerHeight\n    const x = DEBUG.MOUSE_GAZE\n      ? this.#mousePos.x\n      : (rawGaze[0][0] * wOutToIn - ox) * wScale\n    const y = DEBUG.MOUSE_GAZE\n      ? this.#mousePos.y\n      : ((rawGaze[0][1] + 20) * hOutToIn - oy) * hScale\n\n    const gaze: Gaze = {\n      x, y,\n      ts,\n      fIdx: closetFrame?.fIdx,\n      videoId: closetFrame?.videoId\n    }\n    this.#gazeQueue.push(gaze)\n\n    // get lookat\n    const attendPlayers = this.getLookAt(gaze)\n    this.onGaze?.(gaze, attendPlayers)\n\n    // calculate inteLv\n    // save inteLv\n    this.updateInteLv(gaze, attendPlayers)\n  }\n\n  pushFrameHistory(data: FrameStamp) {\n    this.#frameQueue.push(data)\n  }\n  getClosetFrame(gTs: number) {\n    let minDist = Infinity\n    let minFrame = undefined\n    for (const frame of [...this.#frameQueue].reverse()) {\n      const dist = Math.abs(frame.ts - gTs)\n      if (dist < minDist) {\n        minDist = dist\n        minFrame = frame\n      }\n      // if not decrease anymore, stop\n      else break\n    }\n    return minFrame\n  }\n\n  get latestGaze() { return this.#gazeQueue[this.#gazeQueue.length - 1] }\n  getClosetGaze(fTs: number) {\n    let minDist = Infinity\n    let minGaze = undefined\n    for (const gaze of [...this.#gazeQueue].reverse()) {\n      const dist = Math.abs(gaze.ts - fTs)\n      if (dist < minDist) {\n        minDist = dist\n        minGaze = gaze\n      }\n      // if not decrease anymore, stop\n      else break\n    }\n    return minGaze\n  }\n\n  getLookAt(gaze: Gaze) {\n    const { x: gx, y: gy, videoId } = gaze\n    // frame data\n    // @TODO, can be error since the frame maybe not loaded in cur memory\n    if (videoId !== this.currentVideo?.id) return\n    const cf = this.frames?.[gaze.fIdx]\n    if (!cf?.players) return\n\n    const radius = GAZE_R\n    const attendedPlayers = cf.players.filter(({ bbox }) => {\n      return gx > (bbox.x - radius) &&\n        gy > (bbox.y - radius) &&\n        gx < (bbox.x + bbox.w + radius) &&\n        gy < (bbox.y + bbox.h + radius)\n    })\n    return attendedPlayers\n  }\n\n  #playerAttentions: Attentions = { lastTs: -1, fIdx: -1, videoId: undefined, players: {} }\n  updateInteLv(gaze: Gaze, attendPlayers?: Player[]) {\n    const { ts, fIdx } = gaze\n    const { lastTs, players } = this.#playerAttentions\n    const T = 500 // default 1000ms\n    const decayRate = 1 / 5\n    // const maxAttention = incrRate * 19.144 * 0.96\n\n    /**\n     * Generalized weight increase algorithm.\n     * @param initialValue The starting weight of the player.\n     * @param dt The amount of time elapsed since the last update.\n     * @returns The new weight of the player.\n     */\n    function increaseFunction(initialValue: number, dt: number) {\n      return 1 - decayRate ** ((dt - (T * Math.log(1 - initialValue) / Math.log(5))) / T)\n    }\n\n    const newAttentions = lastTs === -1 ? players : Object.keys(players)\n      .reduce((o, pId) => {\n        const playerId = +pId as PlayerID\n        const base = players[playerId]?.att ?? 0\n        const att = base * Math.pow(decayRate, (ts - lastTs) / T)\n        const on = players[playerId]?.on ?? false\n        o[playerId] = {\n          on: att < LV_INTEREST_THRESHOLD.off ? false : on, // turn to false if less than threshold\n          att, looked: false\n        }\n        return o\n      }, {} as Record<PlayerID, AttentionWeights>)\n\n    if (attendPlayers) {\n      attendPlayers.forEach(({ id }) => {\n        if (!(id in newAttentions)) newAttentions[id] = { on: false, att: 0, looked: true }\n        const oldAttention = players[id]?.att ?? 0\n        const att = increaseFunction(oldAttention, ts - lastTs)\n        const on = att > LV_INTEREST_THRESHOLD.on\n          ? true\n          : newAttentions[id]!.on\n        newAttentions[id] = {\n          att, on, looked: true\n        }\n      })\n    }\n\n    this.#playerAttentions = {\n      lastTs: ts,\n      fIdx,\n      videoId: gaze.videoId,\n      players: newAttentions\n    }\n    this.onUpdateLvInt?.(this.#playerAttentions)\n  }\n\n  /**\n   * ----------------- Visualization Management\n   */\n  #keyPlayers: Array<{\n    fIdx: number,\n    videoId: string,\n    players: KeyPlayer[],\n  }> = []\n  #keyPlayer_buffer_size = 100\n\n  /**\n   * \n   * @param currentFIdx \n   * @param timeRange in sec\n   * @param ball \n   * @returns \n   */\n  getNextBallHolder(currentFIdx: number, timeRange: number, ball?: Ball, teamWithBall?: TeamID) {\n    timeRange *= this.currentVideo?.frameRate!\n    for (let i = currentFIdx; i < currentFIdx + timeRange; ++i) {\n      const nextFrame = this.frames?.[i]\n      if (!nextFrame) continue\n\n      const { ball: nextBall } = nextFrame\n      if (!nextBall?.playerId) continue\n\n      if (!ball?.playerId) {// now is empty\n        return PLAYER_META[nextBall.playerId].team === teamWithBall ? nextBall.playerId : undefined\n      } else { // now is not empty\n        if (nextBall.playerId !== ball.playerId && PLAYER_META[nextBall.playerId].team === PLAYER_META[ball.playerId].team) { // should be the same team\n          return nextBall.playerId\n        }\n      }\n    }\n  }\n\n  getEmptyPlayer(players?: Player[], ballHolderId?: PlayerID | null, teamWithBall?: TeamID) {\n    if (players === undefined || teamWithBall === undefined) return\n    const trackedPlayers = players.filter(({ tracking }) => tracking.x !== undefined && tracking.y !== undefined)\n    const defenders = trackedPlayers.filter(p => PLAYER_META[p.id].team !== teamWithBall)\n    const offensors = trackedPlayers.filter(p => PLAYER_META[p.id].team === teamWithBall)\n\n    const emptyOffensors: Array<[Player, number]> = []\n    for (const p of offensors) {\n      const { dataPkg, id } = p\n      if (id === ballHolderId) continue\n      if (!(dataPkg as OffensivePkg).inOffsensiveCourt) continue\n\n      const dists = defenders.map(d => distPoints(d.tracking, p.tracking))\n      if (dists.every(d => d > EMPTY_SPACE_THRESHOLD)) {\n        // TODO, dist to the basket\n        // dist to the ballholder\n        const { x: bx, y: by } = GOAL_BASKET_POS(p.id)\n        const distToBasket = distPoints(p.tracking, { x: bx, y: by })\n        emptyOffensors.push([p, distToBasket])\n      }\n    }\n    return emptyOffensors.sort((a, b) => a[1] - b[1]).map(d => d[0])\n  }\n\n  private lastFocus: { pos: Point } = { pos: { x: 0, y: 0 } }\n  fetchFocus() {\n    const gaze = this.latestGaze\n    if (!gaze) return this.lastFocus\n\n    let { pos } = this.lastFocus\n    const dx = Math.min(600, gaze.x - pos.x)\n    const dy = Math.min(600, gaze.y - pos.y)\n    pos = {\n      x: pos.x + dx,\n      y: pos.y + dy\n    }\n\n    this.lastFocus = { pos }\n    return this.lastFocus\n  }\n\n  // helper function  \n  #getPlayerTeam = (playerId?: PlayerID) => playerId ? PLAYER_META[playerId].team : undefined\n  pickPlayers(currentFIdx: number,\n    features: EnabledFeatures,\n    playerFlags: Partial<Record<PlayerID, 'Auto' | 'On' | 'Off'>>,\n    filter_center?: { pos: Point; }\n  ) {\n\n    if (Object.keys(this.#keyPlayers).length > this.#keyPlayer_buffer_size) {\n      this.#keyPlayers.pop()\n    }\n\n    const currentFrame = this.frames?.[currentFIdx]\n    if (!currentFrame) return {}\n    const {\n      ball,\n      players,\n      teamWithBall = this.#getPlayerTeam(players?.find(p => p.id === ball?.playerId)?.id)\n    } = currentFrame\n\n    // attend players\n    const { players: playerAttentions } = this.#playerAttentions\n\n    // collect current\n    let currentlv1Players: Omit<KeyPlayer, 'last'>[] = []\n    let lv2Players: Lv2Player[] = []\n    // ball holder first\n    if (ball?.playerId) {\n      currentlv1Players.push({ id: ball.playerId, type: KeyPlayerType.BALL_HOLDER })\n      // should add to lv2 if sync\n      lv2Players.push({ id: ball.playerId, type: new Set([Lv2PlayerType.Normal]) })\n\n      // add the defender of the ball holder\n      // @Note, the defending field stores the defender of the ball holder, and the defending of defenders\n      const ballHolder = players?.find(p => p.id === ball.playerId)\n      ballHolder?.tracking.defending && lv2Players.push({\n        id: ballHolder?.tracking.defending as PlayerID,\n        type: new Set([Lv2PlayerType.Normal])\n      })\n      players?.filter(p => p.tracking.defending === ball.playerId).forEach(p => lv2Players.push({\n        id: p.id,\n        type: new Set([Lv2PlayerType.Normal])\n      }))\n    }\n\n    // do playerFlags for Lv1 player\n    Object.entries(playerFlags)\n      .forEach(([pId, v]) => {\n        if (v === 'On') {\n          currentlv1Players.push({ id: +pId as PlayerID, type: KeyPlayerType.BALL_HOLDER })\n        }\n      })\n\n    // who will get the ball in the next Xsec\n    const nextBallHolder = this.getNextBallHolder(currentFIdx, NEXT_BALL_HOLDER_TIME_RANGE, ball)\n    if (nextBallHolder && currentlv1Players.length < MAX_HIGHLIGHTED) {\n      currentlv1Players.push({ id: nextBallHolder, type: KeyPlayerType.NEXT_BALL_HOLDER })\n      lv2Players.push({ id: nextBallHolder, type: new Set([Lv2PlayerType.Normal]) })\n    }\n\n    const emptyPlayers = features.vis_empty_player\n      ? this.getEmptyPlayer(\n        players?.filter(p => !currentlv1Players.some(d => d.id === p.id)),\n        ball?.playerId,\n        teamWithBall)\n      : []\n    // do gaze_filter\n    emptyPlayers\n      ?.filter(({ bbox }) => {\n        if (!filter_center) return true\n        const radius = 60\n        const { x: gx, y: gy } = filter_center.pos\n        return gx > (bbox.x - radius) &&\n          gy > (bbox.y - radius) &&\n          gx < (bbox.x + bbox.w + radius) &&\n          gy < (bbox.y + bbox.h + radius)\n      })\n      .forEach(p => {\n        if ((currentlv1Players.length + 1) < MAX_HIGHLIGHTED) {\n          currentlv1Players.push({ id: p.id, type: KeyPlayerType.EMPTY_PLAYER })\n          lv2Players.push({ id: p.id, type: new Set([Lv2PlayerType.Normal]) })\n        }\n      })\n\n    // management\n    let { players: lastLv1Players = [], fIdx: lastFIdx = 0, videoId: lastVideoId } = this.#keyPlayers?.[0] ?? {}\n    lastLv1Players = lastLv1Players\n      .filter(p => lastVideoId === this.currentVideo?.id) // && PLAYER_META[p.id].team === teamWithBall)\n    // exit\n    const exitPlayers = lastLv1Players\n      .filter(p =>  //p.last.status === 'exit' || \n        !currentlv1Players.find(cp => p.id === cp.id))\n      // update exist player's values\n      .map(p => {\n        p.last.status = 'exit'\n        p.last.progress -= currentFIdx - lastFIdx\n        return p\n      })\n\n    const updatePlayers = lastLv1Players\n      // U - E\n      .filter(p => !exitPlayers.find(ep => ep.id === p.id))\n      // .filter(p => currentlv1Players.find(cp => cp.id === p.id))\n      .map(p => {\n        // 6 / 30 s === 200ms\n        p.last.progress = Math.min(6, p.last.progress + currentFIdx - lastFIdx)\n        p.last.status = p.last.progress === 6 ? 'update' : 'enter'\n        return p\n      })\n\n    // enter\n    const enterPlayers = currentlv1Players\n      .filter(cp => !lastLv1Players.find(p => p.id === cp.id))\n      .map(p => {\n        ; (p as KeyPlayer).last = { status: 'enter', progress: 0 }\n        return p as KeyPlayer\n      })\n\n    // control here\n    const lv1Players: KeyPlayer[] = [\n      ...enterPlayers,\n      ...updatePlayers,\n      ...exitPlayers.filter(p => p.last.progress > 0)\n    ]\n\n    if (lv1Players.length >= MAX_HIGHLIGHTED) {\n      console.warn('More than the upper limit')\n    }\n\n    lv2Players = [\n      ...lv2Players,\n      ...lv1Players.map(p => ({\n        id: p.id,\n        type: new Set([Lv2PlayerType.Normal])\n      }))\n    ]\n\n    // Step2 find the interested players, gaze_focus, default to open\n    if (features.gaze_focus) {\n      Object.entries(playerAttentions)\n        .forEach(([pId, { att, on, looked }]) => {\n          lv2Players.push({ id: +pId as PlayerID, att, on, looked, type: new Set([Lv2PlayerType.Interest]) })\n        })\n    }\n    // do playerFlags for Lv2 player\n    Object.entries(playerFlags)\n      .forEach(([pId, v]) => {\n        if (v === 'On') {\n          lv2Players.push({ id: +pId as PlayerID, type: new Set([Lv2PlayerType.Normal]) })\n        }\n      })\n\n    // cache the keyplayers\n    this.#keyPlayers.unshift({\n      fIdx: currentFIdx,\n      videoId: this.currentVideo!.id,\n      players: lv1Players\n    })\n\n    return {\n      lv1Players: lv1Players\n        .filter(p => playerFlags[p.id] !== 'Off')\n        .reduce((o, p) => {\n          if (!(p.id in o)) {\n            o[p.id] = p\n          }\n          // use the higher rank\n          if (p.type < o[p.id].type) {\n            o[p.id].type = p.type\n          }\n\n          return o\n        }, {} as Record<PlayerID, KeyPlayer>),\n      //\n      lv2Players: lv2Players\n        .filter(p => playerFlags[p.id] !== 'Off' || p.type.has(Lv2PlayerType.Interest))\n        .reduce((o, p) => {\n          if (!(p.id in o)) o[p.id] = p\n          else {\n            o[p.id] = { ...o[p.id], ...p, type: union(p.type, o[p.id].type) }\n          }\n          return o\n        }, {} as Record<PlayerID, Lv2Player>),\n      teamWithBall,\n      ballHolder: players?.find(p => p.id === ball?.playerId)\n    }\n  }\n\n  /**\n   * -------------- Game data ----------------\n   */\n  async loadBins() {\n    await (this.dataLoader as IBallDataLoader).loadBins()\n  }\n  getPlayerBins(playerId?: PlayerID) {\n    if (!playerId) return\n    return (this.dataLoader as IBallDataLoader).playerBins[playerId]\n  }\n  getCurrentBin(player?: Player) {\n    if (!player) return\n\n    const { x: tx, y: ty } = player.tracking\n    const currentBin = (tx !== undefined && ty !== undefined)\n      ? hexbin([{\n        LOC_X: tx * 10,\n        LOC_Y: ty * 10\n      } as any])[0]\n      : undefined;\n    return currentBin\n  }\n\n}","// Import the functions you need from the SDKs you need\nimport { GameID, KeyPlayer, Lv2Player, Lv2PlayerType, PlayerID, VideoID } from \"@types\";\nimport { EnabledFeatures, PlayerFlag, IComment } from \"App\";\nimport { initializeApp } from \"firebase/app\";\nimport { addDoc, collection, getDocs, getFirestore, onSnapshot, query } from 'firebase/firestore'\n// TODO: Add SDKs for Firebase products that you want to use\n// https://firebase.google.com/docs/web/setup#available-libraries\n\n// Your web app's Firebase configuration\n// For Firebase JS SDK v7.20.0 and later, measurementId is optional\nconst firebaseConfig = {\n  apiKey: process.env.REACT_APP_FILEBASE_KEY,\n  authDomain: process.env.REACT_APP_FILEBASE_AUTH_DOMAIN,\n  projectId: process.env.REACT_APP_FILEBASE_PROJECT_ID,\n  storageBucket: process.env.REACT_APP_FILEBASE_STORAGE_BUCKET,\n  messagingSenderId: process.env.REACT_APP_FILEBASE_SENDER_ID,\n  appId: process.env.REACT_APP_FILEBASE_APP_ID,\n  measurementId: process.env.REACT_APP_FILEBASE_MEASUREMENT_ID\n};\n\n// Initialize Firebase\nconst app = initializeApp(firebaseConfig);\n// Initialize Cloud Firestore and get a reference to the service\nexport const db = getFirestore(app);\n\ninterface DocComment {\n  content: string\n  gameId: GameID,\n  videoId: VideoID,\n  frameIdx: number\n  pickedPlayers: {\n    lv1: Partial<Record<PlayerID, KeyPlayer>>,\n    lv2: Partial<Record<PlayerID, Lv2Player>>\n  }\n  features: EnabledFeatures\n  playerFlag: Partial<Record<PlayerID, PlayerFlag>>\n}\n\nconst COLLECTION_NAME = 'comments'\nexport async function postComment(meta: DocComment) {\n  try {\n\n    const { pickedPlayers, ...rest } = meta\n    const { lv1, lv2 } = pickedPlayers\n\n    const docRef = await addDoc(collection(db, COLLECTION_NAME), {\n      ...rest,\n      pickedPlayers: {\n        lv1,\n        lv2: Object.entries(lv2)\n          .reduce((o, [pId, v]) => {\n            o[+pId as PlayerID] = {\n              ...v,\n              id: v.id,\n              type: Array.from(v.type)\n            }\n            return o\n          }, {} as Partial<Record<PlayerID, Omit<Lv2Player, 'type'> & { type: Lv2PlayerType[] }>>)\n      }\n    })\n    return docRef.id\n  } catch (e) {\n    console.error(\"Error adding document: \", e);\n  }\n}\n\nexport async function getComment() {\n  const querySnapshot = await getDocs(collection(db, COLLECTION_NAME));\n  const comments: IComment[] = []\n  querySnapshot.forEach((doc) => {\n    const { content, gameId, videoId, frameIdx } = doc.data() as DocComment\n    comments.push({\n      id: doc.id,\n      content, gameId, videoId, frameIdx\n    })\n  });\n  return comments\n}\n\n\nexport function subscribe(cb: (comments: IComment[]) => void) {\n  const q = query(collection(db, COLLECTION_NAME));\n  const unsubscribe = onSnapshot(q, (querySnapshot) => {\n    const comments: IComment[] = []\n    querySnapshot.docChanges().forEach((change) => {\n      if (change.type === \"added\") {\n        const { content, gameId, videoId, frameIdx } = change.doc.data() as DocComment\n\n        comments.push({\n          id: change.doc.id,\n          content, gameId, videoId, frameIdx\n        })\n      }\n    })\n    cb(comments)\n  });\n  return unsubscribe\n}\n\n\n","import \"./App.scss\";\nimport 'react-circular-progressbar/dist/styles.css';\nimport \"react-toggle/style.css\"\n\nimport React from \"react\";\nimport Toggle from 'react-toggle'\nimport { CircularProgressbarWithChildren, buildStyles } from 'react-circular-progressbar';\nimport { IoPlaySharp, IoPauseSharp } from 'react-icons/io5'\nimport { AiOutlineLoading } from 'react-icons/ai'\n\nimport {\n  Attentions, Gaze, KeyPlayer, Lv2Player,\n  PlayerID, Player,\n  VideoID, Video, GameID\n} from '@types'\nimport { PLAYER_META } from '@const'\n\nimport { DEBUG } from 'common/@const'\nimport { globalFIdxToLocal } from \"common/@utils\";\n\nimport {\n  Visualizer,\n  Overlay,\n  Court,\n  CommentBox,\n  Danmu\n} from './components'\nimport { Timeline } from 'common/@components'\n\nimport { params } from \"param\";\nimport { IBallVideoEnv } from \"VideoEnv\";\nimport { getComment, postComment, subscribe } from \"filebase\";\n\nexport const videoEnv = new IBallVideoEnv()\n\n// now this flag is a bit messy, some are applied to pickPlayer, some are applied to rendering\nconst enabledFeatures = {\n  vis_off_ring: true,\n  vis_def_sheild: true,\n  vis_key_player: true,\n  vis_empty_player: true,\n  vis_top_view: true,\n  gaze_focus: true,\n  gaze_filter: true,\n}\nexport type EnabledFeatures = typeof enabledFeatures\nexport type PlayerFlag = 'Auto' | 'On' | 'Off'\nexport interface IComment {\n  id: string,\n  content: string,\n  gameId: GameID,\n  videoId: VideoID,\n  frameIdx: number\n}\n\ninterface State {\n  videos: Video[]\n  pauseLoading: VideoID | undefined\n  currentVideoIdx: number\n  currentFrameIdx: number\n  currentGaze: Gaze | undefined\n  currentFrame?: HTMLVideoElement\n  // player status\n  gazePlayers?: Player[]\n  attentions?: Attentions\n  attentionsOverTime?: Attentions[]\n  // pickedPlayers: Record<number, { lv1Players: Record<PlayerID, KeyPlayer>, lv2Players: Record<PlayerID, Lv2Player> }>\n  pickedPlayers: {\n    lv1: Partial<Record<PlayerID, KeyPlayer>>,\n    lv2: Partial<Record<PlayerID, Lv2Player>>\n  }\n  comments: IComment[],\n\n  // enable features:\n  features: EnabledFeatures\n  playerFlag: Partial<Record<PlayerID, PlayerFlag>>\n\n  playing: boolean\n}\n\nexport class App extends React.Component<{}, State> {\n\n  state: State = {\n    // playing\n    pauseLoading: undefined,\n    videos: [],\n    currentVideoIdx: 0,\n    currentFrameIdx: 0,\n    currentFrame: undefined,\n    currentGaze: undefined,\n    gazePlayers: undefined,\n    attentions: undefined,\n    attentionsOverTime: undefined,\n    pickedPlayers: { lv1: {}, lv2: {} },\n    comments: [],\n    //\n    features: enabledFeatures,\n    playerFlag: {},\n    //\n    playing: false,\n  }\n\n  #visualizer: React.RefObject<Visualizer> = React.createRef()\n  #commentBox: React.RefObject<CommentBox> = React.createRef()\n  #danmu: React.RefObject<Danmu> = React.createRef()\n\n  get currentVideo() { return this.state.videos[this.state.currentVideoIdx] }\n\n  async componentDidMount() {\n    // should load parameters here\n\n    // get the data from the server and construct a data tower for this video\n    const videos = await Promise.all(params.VIDEO_IDS.map(async (videoId: string) => {\n\n      try {\n        const { max_frame: maxFrame, start_frame = 0, fps, h, w, version } = (await fetch(`${process.env.PUBLIC_URL}/assets/${params.GAME_ID}/${videoId}/${videoId}-meta.json`).then(r => r.json()))\n        const isTransit = videoId.endsWith(',t')\n\n        return {\n          gameId: params.GAME_ID,\n          id: videoId as VideoID,\n          maxFrame,\n          startFame: start_frame,\n          isTransit,\n          frameRate: fps, //params.GAME_ID === 'game1' ? 29.97 : 29.81,\n          loadedData: 0,\n          loadedVideo: 0,\n          width: w,\n          height: h,\n          version,\n        }\n      } catch (e) {\n        console.log('Something wrong with maxjson', videoId)\n        throw e\n      }\n    }))\n    this.setState({ videos })\n\n    // set up videoEnv\n    videoEnv.videos = videos\n\n    videoEnv.onGaze = (currentGaze, gazePlayers) => this.setState({ currentGaze, gazePlayers })\n    videoEnv.onUpdateLvInt = attentions => this.setState({ attentions })\n    videoEnv.onLoad = (videoId: VideoID, type: 'Data' | 'Video', progress) => {\n      const { videos } = this.state\n      const videoIdx = videos.findIndex(v => v.id === videoId)\n      if (videoIdx !== -1) {\n        videos[videoIdx] = {\n          ...videos[videoIdx],\n          [`loaded${type}`]: progress === undefined ? 1 : progress\n          // loaded: videoEnv.isLoaded(videos[videoIdx])\n        }\n        this.setState({ videos: [...videos] })\n      }\n    }\n    videoEnv.onUnload = (videoId: VideoID, type: 'Data' | 'Video') => {\n      const { videos } = this.state\n      const videoIdx = videos.findIndex(v => v.id === videoId)\n      if (videoIdx !== -1) {\n        videos[videoIdx] = {\n          ...videos[videoIdx],\n          [`loaded${type}`]: 0\n          // loaded: videoEnv.isLoaded(videos[videoIdx])\n        }\n        this.setState({ videos: [...videos] })\n      }\n    }\n\n    videoEnv.onPause = (videoId) => this.setState({ playing: false })\n    videoEnv.onPlay = (videoId) => this.setState({ playing: true, pauseLoading: undefined })\n\n    // setup videoEngine\n    // invoke the handler for each frame\n    videoEnv.addOnFrameListener(this.pushFrameHistory)\n    videoEnv.addOnFrameListener(async (videoId, frameIdx, ts, videoFrame) => {\n      const { videos } = this.state\n      const newCurVideoIdx = videos.findIndex(v => v.id === videoId)\n      this.setState({\n        currentFrameIdx: frameIdx,\n        currentVideoIdx: newCurVideoIdx,\n        currentFrame: videoFrame\n      })\n    })\n\n    // load the frames\n    const { currentVideoIdx } = this.state\n    await videoEnv.loadBins()\n    await videoEnv.fetchVideos()\n    // preload videos\n    await videoEnv.loadVideo(videos[currentVideoIdx])\n    // init\n    const comments = await getComment()\n    this.setState({ comments })\n    // subscribe\n    subscribe((newComments) => {\n      const { comments } = this.state\n      newComments = newComments.filter(c => comments.every(d => d.id !== c.id))\n\n      this.setState({\n        comments: [\n          ...comments,\n          ...newComments\n        ]\n      })\n      newComments.forEach(c => this.#danmu.current?.push(c))\n    })\n\n    // check players\n    this.setState({\n      playerFlag: Array.from(new Set(\n        Object.values(videoEnv.frames ?? {}).flatMap(f => f.players?.map(p => p.id))\n      ))\n        .reduce((o, pId) => {\n          if (pId) {\n            o[pId] = 'Off'\n          }\n          return o\n        }, {} as Partial<Record<PlayerID, 'Off'>>)\n    })\n  }\n\n  componentWillUnmount() {\n    // dataTower.onGaze = undefined\n    // dataTower.onUpdateLvInt = undefined\n    // dataTower.onUpdateLvSync = undefined\n    // dataTower.onLoadToMem = undefined\n    // dataTower.onUnloadToMem = undefined\n    // videoEngine.clean()\n    // videoEngine.onLoadToMem = undefined\n    // videoEngine.onPause = undefined\n    // videoEngine.onPlay = undefined\n  }\n\n  pushFrameHistory = (videoId: string, localFrameIdx: number, ts: number) => {\n    const { videos } = this.state\n    const videoIdx = videos.findIndex(v => v.id === videoId)\n\n    if (videoIdx === -1) {\n      videoEnv.pause()\n      return\n    }\n\n    const video = videos[videoIdx]\n    videoEnv.pushFrameHistory({ videoId: video.id, fIdx: localFrameIdx, ts })\n  }\n\n  onClickInterval = async (clipId: number, globalFrameIdx: number) => {\n    // 直接给videoFrame设帧\n    const { videos } = this.state\n    const { videoIdx, frameIdx } = globalFIdxToLocal(globalFrameIdx, videos)\n    videoEnv!.pause();\n    await videoEnv!.seekTo(videos[videoIdx], frameIdx)\n  }\n\n  onPlayVideo = async () => {\n    const { playing } = this.state\n    if (playing) {\n      videoEnv!.pause()\n    } else {\n      videoEnv!.play()\n    }\n  }\n\n  loadedPrecentage() {\n    const { videos } = this.state\n    // assuming loading data takes 2x times than loading videos\n    const value = videos.reduce((o, d) => o += d.loadedData * 2 + d.loadedVideo, 0) / videos.reduce((o, v) => o + (v.isTransit ? 1 : 3), 0)\n    return value\n  }\n\n  renderProgressbar() {\n    const value = this.loadedPrecentage() * 100\n    return value === 100 ? null : <div style={{\n      position: 'fixed',\n      left: '50%',\n      top: '50%',\n      transform: 'translate(-50%, -50%)'\n    }}>\n      <CircularProgressbarWithChildren\n        value={value}\n        // text={'test'}\n        styles={buildStyles({\n          pathColor: `rgb(62, 152, 199)`,\n          textColor: '#f88',\n          trailColor: '#d6d6d6',\n          backgroundColor: '#3e98c7',\n        })}\n      >\n        <div style={{ color: '#f88', fontSize: '40px' }}>{`${value | 0}%`}</div>\n        <div style={{ color: '#f88', fontSize: '24px' }} >~1min</div>\n      </CircularProgressbarWithChildren>\n    </div>\n  }\n\n  renderToggle() {\n    const { features } = this.state\n    return <div className=\"featurePanel\">\n      <h4 style={{ textAlign: 'center' }}>Features</h4>\n      {Object.entries(features)\n        .filter(([k, v]) => k !== 'onPlayers' && k !== 'offPlayers')\n        .map(([k, v]) => {\n\n          return <div className=\"featureItem\" key={k}>\n            <Toggle\n              key={k}\n              id='cheese-status'\n              // defaultChecked={v as boolean}\n              checked={v as boolean}\n              onChange={(e) => {\n                ; (features as any)[k] = !v\n                this.setState({ features })\n              }} />\n            <span>{k.split('_').join(' ')}</span>\n          </div>\n        })}\n    </div>\n  }\n\n  renderPlayerToggle() {\n    const { playerFlag } = this.state\n    return <div className=\"playerPanel\">\n      <h4 style={{ textAlign: 'center' }}>Players</h4>\n      <div className=\"btn-group\">\n        {['Auto', 'On', 'Off'].map(v =>\n          <button key={`btn_${v}`}\n            onClick={() => {\n              const { playerFlag } = this.state\n              Object.keys(playerFlag)\n                .forEach(pId => {\n                  playerFlag[+pId as PlayerID] = v as PlayerFlag\n                })\n              this.setState({ playerFlag: { ...playerFlag } })\n            }}>{v} All</button>)}\n      </div>\n      <div className=\"gridContainer\">\n        {Object.entries(playerFlag)\n          .sort((a, b) => {\n            const { team: teamA } = PLAYER_META[+a[0] as PlayerID]\n            const { team: teamB } = PLAYER_META[+b[0] as PlayerID]\n\n            return teamA.localeCompare(teamB)\n          })\n          .map(([pId, v]) => {\n            const { team } = PLAYER_META[+pId as PlayerID]\n\n            return <>\n              <span className=\"gridItem\"\n                key={`${pId}_name`}\n                style={{\n                  color: ['GSW', 'LAC'].includes(team)\n                    ? 'steelblue'\n                    : '#ff6347',\n                  fontWeight: 500\n                }}\n              >\n                {PLAYER_META[+pId as PlayerID].ln}\n              </span>\n              <label className=\"gridItem\" key={`${pId}_select`}>\n                <select name=\"pflag\" id=\"pflag\" value={v}\n                  onChange={e => {\n                    playerFlag[+pId as PlayerID] = e.target.value as PlayerFlag\n                    this.setState({ playerFlag: { ...playerFlag } })\n                  }}\n                >\n                  {['Auto', 'On', 'Off'].map(value =>\n                    <option key={value} value={value}>{value}</option>\n                  )}\n                </select>\n              </label>\n            </>\n          })}\n      </div>\n    </div>\n  }\n\n  render() {\n    const {\n      currentVideoIdx,\n      currentFrameIdx,\n\n      features,\n      playerFlag,\n\n      currentGaze,\n      currentFrame,\n      gazePlayers,\n\n      pauseLoading,\n      attentions,\n      attentionsOverTime,\n      pickedPlayers,\n      comments,\n      // sync,\n      playing,\n      videos,\n    } = this.state;\n    const currentFrameData = videoEnv.frames?.[currentFrameIdx]\n\n    return (\n      <>\n        {this.renderProgressbar()}\n        {features.vis_top_view && <Court\n          currentFrameData={currentFrameData}\n        />}\n        <div className=\"up\">\n          <div className=\"left\">\n            <div style={{\n              position: 'absolute',\n              zIndex: 100,\n              color: '#fff',\n              fontSize: '1.5rem',\n              marginLeft: '100px'\n            }}>\n              Play the video and Try hovering on the players :)\n            </div>\n            <Visualizer ref={this.#visualizer}\n              // video\n              currentVideo={this.currentVideo}\n              currentFrameIdx={currentFrameIdx}\n              currentFrame={currentFrame}\n              // feature\n              features={features}\n              playerFlags={playerFlag}\n              // gaze\n              gaze={currentGaze}\n              gazePlayers={gazePlayers}\n              onPickPlayers={(fIdx, lv1Players, lv2Players) => {\n                const vIdx = videos.findIndex(v => v.id === this.currentVideo.id)\n                if (vIdx === -1) return\n\n                this.setState({ pickedPlayers: { lv1: lv1Players, lv2: lv2Players } })\n                // const globalFIdx = localFIdxToGlobalFIdx(vIdx, fIdx, videos)\n                // this.setState({\n                //   pickedPlayers: { ...pickedPlayers, [globalFIdx]: { lv1Players, lv2Players } }\n                // })\n              }}\n            >\n\n              <Overlay\n                currentVideo={this.currentVideo}\n                currentFrameData={currentFrameData}\n                gaze={DEBUG.GAZE ? currentGaze : undefined}\n                gazePlayers={gazePlayers}\n                bbox={false}\n              />\n              <Danmu\n                ref={this.#danmu}\n                videoId={this.currentVideo?.id}\n                frameIdx={currentFrameIdx}\n                comments={comments}\n              />\n            </Visualizer>\n\n            <div className=\"controls\">\n              <button\n                id=\"playpause\"\n                className=\"play button is-outlined\"\n                type=\"button\"\n                disabled={pauseLoading !== undefined || this.loadedPrecentage() !== 1}\n                onClick={() => this.onPlayVideo()}\n              >\n                {playing\n                  ? <IoPauseSharp style={{ transform: 'scale(1.5)' }} />\n                  : pauseLoading !== undefined\n                    ? <AiOutlineLoading style={{ transform: 'scale(1.5)' }} />\n                    : <IoPlaySharp style={{ transform: 'scale(1.5)' }} />}\n              </button>\n              <CommentBox\n                ref={this.#commentBox}\n                existPlayers={Object.keys(playerFlag).map(p => +p) as PlayerID[]}\n                onUpdatePlayerEntity={pIds => {\n                  const { playerFlag } = this.state\n                  pIds.forEach(pId => playerFlag[pId] = 'On')\n                  this.setState({ playerFlag: { ...playerFlag } })\n                }}\n                onSend={async (text) => {\n                  const gameId = this.currentVideo.gameId\n                  const videoId = this.currentVideo.id\n                  const frameIdx = currentFrameIdx\n\n                  const docId = await postComment({\n                    content: text.trim(),\n                    gameId,\n                    videoId,\n                    frameIdx,\n                    features,\n                    playerFlag,\n                    pickedPlayers,\n                  })\n                  // will be updated in the subscribe callback\n                  if (docId) {\n                    // const newComment = { id: docId, content: text, gameId, videoId, frameIdx }\n                    // this.setState({\n                    //   comments: [\n                    //     ...comments,\n                    //     newComment\n                    //   ]\n                    // })\n                    // this.#danmu.current?.push(newComment)\n                    this.#commentBox.current?.clean()\n                  }\n                }}\n              ></CommentBox>\n            </div>\n          </div>\n          {/* <div className=\"divide\"> </div> */}\n\n          <div className=\"right\">\n            {this.renderToggle()}\n            {this.renderPlayerToggle()}\n          </div>\n        </div>\n\n        {DEBUG.TIMELINE &&\n          <Timeline\n            mode=\"S\"\n            videos={videos}\n            currentVideoIdx={currentVideoIdx}\n            currentFrameIdx={currentFrameIdx}\n            enableClips={false}\n            // pickedPlayers={pickedPlayers}\n            onClickInterval={this.onClickInterval}\n          />\n        }\n      </>)\n  }\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { App } from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n"],"sourceRoot":""}