{"version":3,"sources":["param.ts","@const/players.ts","@const/gaze.ts","@const/style.ts","@const/index.ts","../common/src/@types/basic.ts","../common/src/@types/index.ts","../common/src/@const/ui.ts","../common/src/@const/draw.ts","../common/src/@utils/array.ts","../common/src/@utils/async.ts","../common/src/@utils/debug.ts","../common/src/@utils/type.ts","../common/src/@utils/hash.ts","../common/src/@utils/video.ts","../common/src/@utils/geometry.ts","../common/src/@utils/worker.ts","@types/gameData.ts","../common/src/@draw/frame.ts","../common/src/@draw/object.ts","../common/src/@draw/geometry.ts","components/Visualizer/visualizeData.ts","components/Visualizer/index.tsx","components/BarChart/idnex.tsx","../common/src/@components/Timeline/Interval.tsx","../common/src/@components/Timeline/index.tsx","../common/src/@components/SVGOverlay/index.tsx","components/SVGOverlay/index.tsx","@utils.ts","../common/src/DataLoader/loadFrames.worker.ts","../common/src/DataLoader/DataLoader.ts","../common/src/DataLoader/Database.ts","../common/src/VideoEnv/VideoPlayer/VideoLoader.ts","../common/src/VideoEnv/VideoPlayer/VideoPlayer.ts","../common/src/VideoEnv/index.ts","VideoEnv/loadData.worker.ts","App.tsx","VideoEnv/index.ts","index.tsx"],"names":["Parameters","GAME_ID","UNIT_ID","MODE","LV_FOCUS","LV_INTRE","console","log","global","location","search","debug","VIDEO_ID_GROUPS","this","params","URLSearchParams","gameId","get","includes","alert","unitId","mode","toUpperCase","lvFocus","lvInt","initParams","PLAYER_META","2760","fn","ln","offSpeed","team","star","2738","101106","201575","203110","203105","203084","203546","203949","1626172","202691","2571","201578","2733","201939","201574","101112","2563","202697","2747","2592","203099","203925","203895","201567","202681","2544","203521","2590","2210","201619","202389","202684","201566","201627","203079","2555","202713","200779","201586","202683","203500","201571","203460","1626166","201142","202362","101108","200755","2746","201599","203143","2037","201601","203085","201933","202325","1718","202332","PLAYER_RANDOM_FACTOR","Object","entries","reduce","o","pId","Math","random","GAZE_R","NEXT_BALL_HOLDER_TIME_RANGE","LV_INTEREST_THRESHOLD","off","on","EMPTY_SPACE_THRESHOLD","MAX_HIGHLIGHTED","FOCUS","min","max","mina","maxa","COLORS","offense_inner_border","offense_bg_fill","offense_outer_border","defense_bg_fill","defense_fg_fill","player_name","BG_MASK_ALPHA","FG_MASK_ALPHA","off_df_link","star_name","star_star","game2_unit0","game1_unit0","game1_unit1","game1_unit2","game2_unit1","game2_unit2","Side","Direction","TPlayerOption","DEBUG","OVERLAY","COURT","GAZE","BBOX","LINE","ATTENTIONS","TIMELINE","MOUSE_GAZE","DEBUG_MEM","extent","d","ArrayToDict","arr","key","f","union","setA","setB","_union","Set","elem","add","wait","ms","a","Promise","resolve","reject","setTimeout","waitUntil","checkFun","interval","setInterval","bytesToMB","bytes","toFixed","debugMem","memory","performance","usedJSHeapSize","totalJSHeapSize","_intervalIdGen","intervalIdGen","getImg","src","img","Image","onload","e","URL","revokeObjectURL","undefined","globalFIdxToLocal","globalFrameIdx","videos","accFrame","videoIdx","length","video","maxFrame","frameIdx","localFIdxToGlobalFIdx","localFIdx","accFrameIdx","i","distPoints","p1","p2","dx","x","dy","y","sqrt","getAngle","x1","y1","x2","y2","radians","atan2","PI","wrapWorker","workerFunc","cb","worker","args","postMessage","addEventListener","handler","data","removeEventListener","PLAYER_STATUS","KeyPlayerType","Lv2PlayerType","drawRawFrame","layer","frame","darkenAlpha","canvas","width","height","ctx","drawImage","drawOverlay","alpha","save","fillStyle","fillRect","restore","internalCanvas","document","createElement","getContext","obj","applyStyle","style","forEach","lineWidth","strokeStyle","font","textBaseline","lineCap","lineJoin","value","pattern","globalAlpha","opacity","drawCone","r","h","r1","dAlpha","nodes","uNodes","faces","cos","z","sin","p","n","face","rotateX3D","theta","sinTheta","cosTheta","node","translate","v0","v1","v2","v3","beginPath","moveTo","lineTo","fill","closePath","roundTo2PI","drawVis","visCtx","circles","sheilds","debugCtx","b","c","setTransform","circleTXY","map","cx","cy","tx","ty","filter","inOffsensiveCourt","_","cIdx","arc","in_r","size","out_r","globalCompositeOperation","stroke","drawVisCircles","invertTXY","getA1A2","tangle","tdist","a1","MIN_DIST","MAX_DIST","a2","sheild","ox","oy","grd","createLinearGradient","addColorStop","shadowColor","shadowBlur","smoothDFdiff","dist","pow","atan","tan","ma1","ma2","drawVisSheilds","internalCtx","drawHL","mask","players","lv1Players","lv2Players","ballHolder","focus","lv2PlayerLooked","id","type","has","Interest","looked","att","lv2PlayerNotLooked","find","lp","unImportantPlayers","lv2","lv1","pos","createRadialGradient","bbox","w","player","frames","last","progress","EMPTY_PLAYER","STAR","_draw","shooterIcon","process","defenderIcon","starIcon","ICONS","shooter","defender","drawIcon","iconHeight","offset","icon","iconWidth","drawName","namePos","lastname","textAlign","textwidth","measureText","textheight","fillText","floor","layerIds","Visualizer","layers","l","isOnLv2Player","Normal","keypoints","left_hip","right_hip","left_ankle","right_ankle","preProps","currentFrameIdx","props","currentVideo","currentFrame","cleanAllExcept","isTransit","currentFrameData","videoEnv","ball","fetchFocus","pickPlayers","dataToVis","offensiveRings","dataPkg","offensive","smoothRegionExp","get2DPos","scales","regionExp","defensiveSheilds","defensive","diff","speed","defendingPlayer","draw","playerId","values","ip","className","marginLeft","justifyContent","alt","idx","ref","children","layerId","keys","lId","clearRect","React","Component","AxisBottom","scale","transform","useRef","useEffect","current","select","call","axisBottom","AxisLeft","axisLeft","BarChart","fixY","normalizeY","maxY","margin","scaleX","scaleBand","domain","range","scaleY","scaleLinear","bandwidth","LineChart","fIdx","minFIdx","maxFIdx","push","sort","fIdxs","minIdx","points","lineGenerator","line","curve","curveMonotoneX","strokeWidth","Interval","state","isMoving","isAdjusting","cursorStatus","onResizeStart","direction","button","stopPropagation","mx","clientX","setState","oBBox","body","classList","onResizing","preventDefault","stopImmediatePropagation","getEW","wx","ex","onAdjusting","onResizeEnd","onAdjustingEnd","remove","onMoveStart","onMoving","newx","onMoveEnd","window","focused","initializing","clsx","left","onMouseDown","parentDim","currentTarget","parentElement","getBoundingClientRect","abs","onMouseMove","onClick","onClickInterval","pad","num","slice","hhmmss","secs","t","minutes","Timeline","createRef","imgWidth","intervalSelectorHeight","parentOffsetx","isDrawing","onDrawStart","scrollLeft","clientY","bottom","enableClips","clips","frame2pos","start","end","curFrame","pos2frame","newIntervalId","newInterval","onUpsertClip","intervalId","omx","onDrawing","drawingInterval","int","maxdx","mindx","startFrame","endFrame","onDrawEnd","drawingIntervalIdx","findIndex","updateInterval","clipId","end_","targetIntervalIdx","targetInterval","intervalIdx","numberOfImg","intervalCount","trackWidth","totalTrackWidth","globalMaxFrames","round","v","trackWidthFactor","currentVideoIdx","frameRate","ceil","maxTime","containerHeightPadding","prevProps","innerWidth","documentElement","clientWidth","right","scrollIntoView","behavior","block","inline","focusedClipId","globalCurFrameIdx","containerHeight","currentTime","flex","backgroundColor","loadedData","loadedVideo","renderClips","SVGLayer","activeBBoxes","viewBox","preserveAspectRatio","target","onClickBG","onContextMenu","onDoubleClick","onDBClick","floodColor","result","in","onClickPlayer","screenPos","onClickBall","Overlay","gazePlayers","gaze","svgLayerProps","teamWithBall","some","alignmentBaseline","getRegionKey","area","match","getArea","AREA","RANGE","mapRegionToPoint","region","endsWith","d3Hexbin","LOC_X","LOC_Y","radius","SHOT_ZONE_AREA","BASIC","SHOT_ZONE_BASIC","SHOT_ZONE_RANGE","FGA","FGM","rate","FG_PCT","exp","getCanvasAbsTopLeft","elm","getElementById","outerHeight","wScale","hScale","Worker_fn","Worker","DataLoader","MyWorker","memVideoData","onLoad","onUnload","vId","videoId","shouldWait","isLoaded","progressOffset","framesToSave","itemsForBatch","all","createObjectURL","Dexie","VideoLoader","memVideos","nextVideo","load","onloadeddata","VideoTrack","name","videoPlayer","CallBackHandle","onPlay","onPause","invokeFrameHandlers","now","metadata","currentTrack","mediaTime","frameOffset","len","onFrameHandlers","Date","requestVideoFrameCallback","videoElm","cancelVideoFrameCallback","play","VideoPlayer","_currentTrack","videoSources","ATrack","BTrack","whichOnPause","ev","whichOnPlay","addOnFrameListener","ts","videoFrame","curVideoIdx","warn","nextVideoIdx","preloadToAnotherTrack","pause","loadVideo","splice","fetch","trackToLoad","trackToUnload","unLoad","newVideo","setVideo","getVideo","paused","VideoEnv","dataLoader","progres","getVideoData","IBallWorker","onGaze","onUpdateLvInt","onUpdateLvSync","onSocket","rawGaze","JSON","parse","closetFrame","getClosetFrame","wOutToIn","outerWidth","hOutToIn","innerHeight","attendPlayers","getLookAt","updateInteLv","lastTs","lastFocus","regionScale","scaleOrdinal","schemeSet3","twoPTColor","scaleSequential","interpolateYlGnBu","twoPT","threePTColor","threePT","radiusScale","scaleSqrt","interpolateReds","gTs","minDist","Infinity","minFrame","reverse","fTs","minGaze","gx","gy","cf","T","newAttentions","initialValue","dt","oldAttention","currentFIdx","timeRange","nextFrame","nextBall","ballHolderId","trackedPlayers","tracking","defenders","offensors","emptyOffensors","every","GOAL_BASKET_POS","bx","by","distToBasket","latestGaze","pop","playerAttentions","currentlv1Players","BALL_HOLDER","defending","nextBallHolder","getNextBallHolder","NEXT_BALL_HOLDER","emptyPlayers","getEmptyPlayer","lastLv1Players","lastFIdx","lastVideoId","exitPlayers","cp","status","updatePlayers","ep","enterPlayers","unshift","App","pauseLoading","currentGaze","attentions","attentionsOverTime","pickedPlayers","playing","seekTo","onPlayVideo","VIDEO_IDS","then","json","max_frame","start_frame","fps","version","startFame","newCurVideoIdx","fetchVideos","loadedPrecentage","position","top","text","styles","buildStyles","pathColor","textColor","trailColor","renderProgressbar","onPickPlayers","vIdx","globalFIdx","std","array","mean","standardDeviation","disabled","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.c49eb7f0.chunk.js","sourcesContent":["import { VIDEO_ID_GROUPS } from \"@const\"\nimport { UnitID, GameID } from \"@types\"\n\nexport class Parameters {\n\n    // get VIDEO_FRAME_RATE() {\n    //     return this.GAME_ID === 'game1' ? 29.97 : 29.81\n    // }\n\n    get VIDEO_IDS() {\n        return VIDEO_ID_GROUPS[`${this.GAME_ID}_${this.UNIT_ID}`]\n    }\n\n    constructor(\n        public readonly GAME_ID: GameID = 'game1',\n        public readonly UNIT_ID: UnitID = 'unit0',\n        public readonly MODE: 'AUG' | 'FULL' | 'RAW' = 'FULL',\n        public readonly LV_FOCUS: boolean = MODE === 'FULL',\n        public readonly LV_INTRE: boolean = MODE === 'FULL'\n    ) {\n        console.log(global.location.search)\n        console.debug(`%cParams:\n    GAME_ID: ${GAME_ID},\n    UNIT_ID: ${UNIT_ID},\n    MODE: ${MODE},\n    LV_FOCUS: ${LV_FOCUS},\n    LV_INTRE: ${LV_INTRE}\n`, 'background: #444; color: #bada55; padding: 2px; border-radius:2px')\n    }\n}\n\nfunction initParams() {\n    const params = new URLSearchParams(global.location.search);\n    let gameId: GameID = 'game1'\n    if(params.get('g') !== null) {\n        gameId = `game${params.get('g')}` as GameID\n    }\n    // validate\n    if(!['game1', 'game2'].includes(gameId)) {\n        alert('GameId must be game1 or game2')\n    }\n\n    let unitId: UnitID = 'unit0'\n    if(params.get('u') !== null) {\n        unitId = `unit${params.get('u')}` as UnitID\n    }\n    if(!['unit0', 'unit1', 'unit2'].includes(unitId)) {\n        alert('UnitId must be unit0, unit1, or unit2')\n    }\n\n    let mode: 'AUG' | 'FULL' | 'RAW' = 'AUG'\n    if(params.get('m') !== null) {\n        mode =  params.get('m')!.toUpperCase() as 'AUG' | 'FULL' | 'RAW'\n    }\n    if(!['AUG', 'FULL', 'RAW'].includes(mode)) {\n        alert('Mode must be RAW, AUG, or FULL')\n    }\n\n    let lvFocus: boolean = mode === 'FULL'\n    if(params.get('gf') !== null) {\n        lvFocus = params.get('gf') === 'true'\n    }\n    \n    let lvInt = mode === 'FULL'\n    if(params.get('gi') !== null) {\n        lvInt = params.get('gi') === 'true'\n    }\n\n    return new Parameters(gameId, unitId, mode, lvFocus, lvInt)\n}\n\nexport const params = initParams()","import type { PlayerID } from \"@types\"\n\nexport const TEAM_META = {\n    GSW: {},\n    CLE: {},\n    OKC: {},\n    LAC: {}\n}\n\n//offSpeed is actually AVG Defense Speed\nexport const PLAYER_META = {\n    2760: { fn: \"Anderson\", ln: \"Varejao\", offSpeed: 4.07, team: 'GSW', star: false },\n    2738: { fn: \"Andre\", ln: \"Iguodala\", offSpeed: 3.78, team: 'GSW', star: false },\n    101106: { fn: \"Andrew\", ln: \"Bogut\", offSpeed: 3.5, team: 'GSW', star: false },\n    201575: { fn: \"Brandon\", ln: \"Rush\", offSpeed: 4.09, team: 'GSW', star: false },\n    203110: { fn: \"Draymond\", ln: \"Green\", offSpeed: 3.49, team: 'GSW', star: 'defender' },\n    203105: { fn: \"Festus\", ln: \"Ezeli\", offSpeed: 3.97, team: 'GSW', star: false },\n    203084: { fn: \"Harrison\", ln: \"Barnes\", offSpeed: 4.02, team: 'GSW', star: false },\n    203546: { fn: \"Ian\", ln: \"Clark\", offSpeed: 4.07, team: 'GSW', star: false },\n    203949: { fn: \"James Michael\", ln: \"McAdoo\", offSpeed: 4.27, team: 'GSW', star: false },\n    1626172: { fn: \"Kevon\", ln: \"Looney\", offSpeed: 4.05, team: 'GSW', star: false },\n    202691: { fn: \"Klay\", ln: \"Thompson\", offSpeed: 3.85, team: 'GSW', star: 'shooter' },\n    2571: { fn: \"Leandro\", ln: \"Barbosa\", offSpeed: 3.88, team: 'GSW', star: false },\n    201578: { fn: \"Marreese\", ln: \"Speights\", offSpeed: 3.67, team: 'GSW', star: false },\n    2733: { fn: \"Shaun\", ln: \"Livingston\", offSpeed: 3.85, team: 'GSW', star: false },\n    201939: { fn: \"Stephen\", ln: \"Curry\", offSpeed: 3.68, team: 'GSW', star: 'shooter' },\n    201574: { fn: \"Jason\", ln: \"Thompson\", offSpeed: 3.68, team: 'GSW', star: false },\n\n    101112: { fn: \"Channing\", ln: \"Frye\", offSpeed: 3.61, team: 'CLE', star: false },\n    2563: { fn: \"Dahntay\", ln: \"Jones\", offSpeed: 4.31, team: 'CLE', star: false },\n    202697: { fn: \"Iman\", ln: \"Shumpert\", offSpeed: 4.08, team: 'CLE', star: false },\n    2747: { fn: \"JR\", ln: \"Smith\", offSpeed: 3.92, team: 'CLE', star: false },\n    2592: { fn: \"James\", ln: \"Jones\", offSpeed: 3.84, team: 'CLE', star: false },\n    203099: { fn: \"Jared\", ln: \"Cunningham\", offSpeed: 4.24, team: 'CLE', star: false },\n    203925: { fn: \"Joe\", ln: \"Harris\", offSpeed: 4.6, team: 'CLE', star: false },\n    203895: { fn: \"Jordan\", ln: \"McRae\", offSpeed: 3.6, team: 'CLE', star: false },\n    201567: { fn: \"Kevin\", ln: \"Love\", offSpeed: 3.86, team: 'CLE', star: false },\n    202681: { fn: \"Kyrie\", ln: \"Irving\", offSpeed: 3.78, team: 'CLE', star: false },\n    2544: { fn: \"LeBron\", ln: \"James\", offSpeed: 3.72, team: 'CLE', star: 'star' },\n    203521: { fn: \"Matthew\", ln: \"Dellavedova\", offSpeed: 3.9, team: 'CLE', star: false },\n    2590: { fn: \"Mo\", ln: \"Williams\", offSpeed: 3.92, team: 'CLE', star: false },\n    2210: { fn: \"Richard\", ln: \"Jefferson\", offSpeed: 3.96, team: 'CLE', star: false },\n    201619: { fn: \"Sasha\", ln: \"Kaun\", offSpeed: 4.12, team: 'CLE', star: false },\n    202389: { fn: \"Timofey\", ln: \"Mozgov\", offSpeed: 4.12, team: 'CLE', star: false },\n    202684: { fn: \"Tristan\", ln: \"Thompson\", offSpeed: 4.1, team: 'CLE', star: false },\n\n    201566: { fn: 'Russell', ln: 'Westbrook', offSpeed: 3.71, team: 'OKC', star: 'shooter' },\n    201627: { fn: 'Anthony', ln: 'Morrow', offSpeed: 3.80, team: 'OKC', star: false },\n    203079: { fn: 'Dion', ln: 'Waiters', offSpeed: 3.74, team: 'OKC', star: false },\n    2555: { fn: 'Nick', ln: 'Collison', offSpeed: 3.90, team: 'OKC', star: false },\n    202713: { fn: 'Kyle', ln: 'Singler', offSpeed: 4.21, team: 'OKC', star: false },\n    200779: { fn: 'Steve', ln: 'Novak', offSpeed: 3.87, team: 'OKC', star: false },\n    201586: { fn: 'Serge', ln: 'Ibaka', offSpeed: 3.67, team: 'OKC', star: false },\n    202683: { fn: 'Enes', ln: 'Kanter', offSpeed: 3.89, team: 'OKC', star: false },\n    203500: { fn: 'Steven', ln: 'Adams', offSpeed: 3.79, team: 'OKC', star: false },\n    201571: { fn: 'D.J.', ln: 'Augustin', offSpeed: 3.84, team: 'OKC', star: false },\n    203460: { fn: 'Andre', ln: 'Roberson', offSpeed: 4.36, team: 'OKC', star: false },\n    1626166: { fn: 'Cameron', ln: 'Payne', offSpeed: 4.11, team: 'OKC', star: false },\n    201142: { fn: 'Kevin', ln: 'Durant', offSpeed: 3.47, team: 'OKC', star: 'shooter' },\n\n    202362: { fn: 'Lance', ln: 'Stephenson', offSpeed: 3.98, team: 'LAC', star: false },\n    101108: { fn: 'Chris', ln: 'Paul', offSpeed: 3.67, team: 'LAC', star: 'star' },\n    200755: { fn: 'Redick', ln: 'JJ', offSpeed: 4.11, team: 'LAC', star: false },\n    2746: { fn: 'Josh', ln: 'Smith', offSpeed: 3.72, team: 'LAC', star: false },\n    201599: { fn: 'DeAndre', ln: 'Jordan', offSpeed: 3.68, team: 'LAC', star: false },\n    203143: { fn: 'Pablo', ln: 'Prigioni', offSpeed: 4.46, team: 'LAC', star: false },\n    2037: { fn: 'Jamal', ln: 'Crawford', offSpeed: 3.72, team: 'LAC', star: false },\n    201601: { fn: 'Luc', ln: 'Mbah a Moute', offSpeed: 4.08, team: 'LAC', star: false },\n    203085: { fn: 'Austin', ln: 'Rivers', offSpeed: 4.13, team: 'LAC', star: false },\n    201933: { fn: 'Blake', ln: 'Griffin', offSpeed: 3.56, team: 'LAC', star: false },\n    202325: { fn: 'Wesley', ln: 'Johnson', offSpeed: 4.06, team: 'LAC', star: false },\n    1718: { fn: 'Paul', ln: 'Pierce', offSpeed: 3.54, team: 'LAC', star: false },\n    202332: { fn: 'Cole', ln: 'Aldrich', offSpeed: 3.96, team: 'LAC', star: false },\n} as const\n\n\nexport const PLAYER_RANDOM_FACTOR = Object.entries(PLAYER_META)\n    .reduce((o, [pId, _]) => {\n        o[+pId as PlayerID] = Math.random() * 0.6\n        return o\n    }, {} as Record<PlayerID, number>)","export const GAZE_R = 20\n\n// lnSync threshold in ms, if you are not watching all the key players at least EXPLORE_MODE_THRESHOLD ms, the system will show you the next highlight\nexport const NEXT_BALL_HOLDER_TIME_RANGE = 1.8\nexport const LV_INTEREST_THRESHOLD = { off: 0.03, on: 0.6 }\n// // for lvSync\n// export const EXPLORE_MODE_THRESHOLD = 1500 // ms\n// // the highlight triggered by lvSync will exist for EXPLORE_STAY_THRESHOLD ms\nexport const EXPLORE_STAY_THRESHOLD = 1500\n// the min distance for an empty player, which means that if the distance between an offensor\n// and his closet defender is larger than EMPTY_SPACE_THRESHOLD, the system will think the offensor is an empty player\nexport const EMPTY_SPACE_THRESHOLD = 8\nexport const MAX_HIGHLIGHTED = 4 //{ S1: 2, S2: 3 }[LV_SYNC]\nexport const FOCUS = { min: 10, max: 630, mina: 0.2, maxa: 0.75 }","\nexport const miniMapSize: [number, number] = [720, 720 * 50 / 94]\nexport const COLORS = {\n    offense_inner_border: '#f5f5f5',\n    offense_bg_fill: '#f5f5f577',\n    offense_outer_border: 'rgba(220, 220, 220, 0.1)',\n    defense_bg_fill: `rgba(255, 255, 255, 0.15)`,\n    defense_fg_fill: `#f5f5f5`,\n    player_name: '#f5f5f5',\n    BG_MASK_ALPHA: 0.3,\n    FG_MASK_ALPHA: 0.2,\n    off_df_link: '255, 255, 255',\n    star_name: 'rgb(255, 243, 194)',\n    star_star: 'rgb(255, 243, 194)', // 'rgb(255,215,120)'\n} as const","export * from './players'\nexport * from './gaze'\nexport * from './style'\n\n// video players\nexport const VIDEO_ID_GROUPS = {\n    game2_unit0: [],\n    game1_unit0: [\n        // '0_,',\n        // '1_c,t',\n        // '2_c,l',\n        // '3_c,t',\n        '4_,',\n        '5_c,t',\n        '6_,',\n    ],\n    game1_unit1: [\n        '4_,',\n        '5_c,t',\n        '6_,',\n        '7_c,t',\n        '8_c,',\n        '9_c,t',\n        '10_,',\n        '11_c,t',\n        '12_,',\n        '13_c,t',\n        '14_c,',\n        '15_c,t',\n    ],\n    game1_unit2: [\n        '16_,',\n        '17_c,t',\n        '18_,l',\n        '19_c,t',\n        '20_,',\n        '21_c,t',\n        '22_,',\n        '23_c,t',\n        '24_,l',\n        '25_c,t',\n        '26_,l',\n        '27_,l',\n        '28_,l',\n        '30_,'\n    ],\n    game2_unit1: [\n        '0_,',\n        '1_c,t',\n        '2_,t',\n        '3_c,',\n        '4_c,t',\n        '5_c,',\n        '6_c,t',\n        '7_c,l',\n        '8_c,t',\n        '9_c,',\n        '10_c,t'\n    ],\n    game2_unit2: [\n        '11_,t',\n        '12_c,l',\n        '13_c,',\n        '14_c,t',\n        '15_c,',\n        '16_c,t',\n        '17_,l',\n        '18_c,t',\n        '19_,t',\n        '20_c,',\n        '21_c,t',\n        '22_c,l',\n        '23_c,t',\n        '24_,l',\n        '25_c,t',\n        '26_,',\n        '27_c,t',\n        '28_,',\n        '29_c,t',\n        '30_,t',\n        '31_c,',\n        '32_c,t',\n        '33_,t',\n        '34_c,',\n        '35_c,t',\n    ]\n} as const\n","/**\n * Basic geometry data type\n */\nexport interface Point {\n    readonly x: number\n    readonly y: number\n}\nexport type Route = [Point, Point, Point, Point]\n\nexport interface BBox {\n    readonly x: number;\n    readonly y: number;\n    readonly w: number;\n    readonly h: number\n}\n\nexport enum Side {\n    MIDDLE = 'MIDDLE',\n    LEFT = 'LEFT',\n    RIGHT = 'RIGHT'\n}\n\nexport enum Direction {\n    N = 'NORTH',\n    S = 'SOUTH',\n    E = 'EAST',\n    W = 'WEST',\n    NE = 'NORTH_EAST',\n    NW = 'NORTH_WEST',\n    SE = 'SOUTH_EAST',\n    SW = 'SOUTH_WEST'\n}\n","export * from './basic'\nexport * from './data'\nexport * from './ui'\nexport * from './database'\nexport * from './draw'\n\n// iball\nexport type Overwrite<T, U> = Pick<T, Exclude<keyof T, keyof U>> & U;\n\n/**\nCreate a type that requires exactly one of the given keys and disallows more. The remaining keys are kept as is.\nUse-cases:\n- Creating interfaces for components that only need one of the keys to display properly.\n- Declaring generic keys in a single place for a single use-case that gets narrowed down via `RequireExactlyOne`.\nThe caveat with `RequireExactlyOne` is that TypeScript doesn't always know at compile time every key that will exist at runtime. Therefore `RequireExactlyOne` can't do anything to prevent extra keys it doesn't know about.\n@example\n```\nimport {RequireExactlyOne} from 'type-fest';\ntype Responder = {\n    text: () => string;\n    json: () => string;\n    secure: boolean;\n};\nconst responder: RequireExactlyOne<Responder, 'text' | 'json'> = {\n    // Adding a `text` key here would cause a compile error.\n    json: () => '{\"message\": \"ok\"}',\n    secure: true\n};\n```\n@category Object\n*/\nexport type RequireExactlyOne<ObjectType, KeysType extends keyof ObjectType = keyof ObjectType> =\n    { [Key in KeysType]: (\n        Required<Pick<ObjectType, Key>> &\n        Partial<Record<Exclude<KeysType, Key>, never>>\n    ) }[KeysType] & Omit<ObjectType, KeysType>;\n\nexport enum TPlayerOption {\n    Far = 1,\n    Near = 0,\n    Both = -1\n}\n","export const DEBUG = {\n    OVERLAY: false,\n    COURT: false,\n    GAZE: false,\n    BBOX: false,\n    LINE: false,\n    ATTENTIONS: false,\n    TIMELINE: true,\n    MOUSE_GAZE: true,\n    DEBUG_MEM: false\n}","\nexport const COLORS = {\n    offense_inner_border: '#f5f5f5',\n    offense_bg_fill: '#f5f5f577',\n    offense_outer_border: 'rgba(220, 220, 220, 0.1)',\n    defense_bg_fill: `rgba(255, 255, 255, 0.15)`,\n    defense_fg_fill: `#f5f5f5`,\n    player_name: '#f5f5f5',\n    BG_MASK_ALPHA: 0.25,\n    FG_MASK_ALPHA: 0.2,\n    off_df_link: '255, 255, 255',\n    star_name: 'rgb(255, 243, 194)',\n    star_star: 'rgb(255, 243, 194)', // 'rgb(255,215,120)'\n} as const","export const extent = (d: number[]) => {\n  return [\n    Math.min(...d),\n    Math.max(...d)\n  ] as [number, number]\n}\n\nexport function standardDeviation(array?: number[]) {\n  if (!array || array.length === 0) return 0\n  const n = array.length\n  const mean = array.reduce((a, b) => a + b) / n\n  return Math.sqrt(array.map(x => Math.pow(x - mean, 2)).reduce((a, b) => a + b) / n)\n}\n\nexport function ArrayToDict<T, K extends keyof T>(arr: T[], key: K) {\n  return arr.reduce((o, f) => {\n    o[f[key] as any] = f\n    return o\n  }, {} as Record<string | number | symbol, T>)\n}\n\nexport function union<T>(setA: Set<T>, setB: Set<T>) {\n  const _union = new Set(setA);\n  for (const elem of setB) {\n    _union.add(elem);\n  }\n  return _union;\n}\n\n\nif (process.env.NODE_ENV !== 'production') {\n  (global as any).$RefreshReg$ = () => { };\n  (global as any).$RefreshSig$ = () => () => { };\n}","export async function wait(ms: number) {\n  return new Promise((resolve, reject) => {\n    setTimeout(resolve, ms)\n  })\n}\n\nexport async function waitUntil(checkFun: () => boolean, interval = 70) {\n  return new Promise(resolve => {\n    setInterval(() => {\n      if (checkFun())\n        resolve(null)\n    }, interval)\n  })\n}","function bytesToMB(bytes: number) {\n  return (bytes / 1024 / 1024).toFixed(2)\n}\n\nexport function debugMem() {\n  const memory: any = (performance as any).memory\n  console.debug(`Used / Total: ${bytesToMB(memory.usedJSHeapSize)}mb / ${bytesToMB(memory.totalJSHeapSize)}mb`)\n}\n\nexport function debugLog() {\n  return (target: any, prop: string, descriptior: PropertyDescriptor = Object.getOwnPropertyDescriptor(target, prop)!) => {\n    const originalMethod = descriptior.value;\n\n    if (descriptior.value[Symbol.toStringTag] === 'AsyncFunction') {\n      //editing the descriptor/value parameter\n      descriptior.value = async function (...args: any[]) {\n        // note usage of originalMethod here\n        console.group(`%c>>>>> Call:${prop}`, 'background: #222; color: #bada55');\n        const ret = await originalMethod.apply(this, args);\n        console.groupEnd()\n        // console.groupEnd(`%c<<<< End:${prop}`, 'background: #222; color: #bada55');\n        return ret\n      };\n\n    } else {\n      //editing the descriptor/value parameter\n      descriptior.value = function (...args: any[]) {\n        // note usage of originalMethod here\n        console.log(`%c>>>>> Call:${prop}`, 'background: #222; color: #bada55');\n        const ret = originalMethod.apply(this, args);\n        console.log(`%c<<<< End:${prop}`, 'background: #222; color: #bada55');\n        return ret\n      };\n    }\n\n    // return edited descriptor as opposed to overwriting the descriptor\n    return descriptior;\n  }\n}\n","import { Point } from \"../@types/basic\"\n\n/**\n * type grauding\n */\n// export function isEnitity(t: SpacyRet) {\n//     return t.ent_type !== '' || ['NOUN', 'VERB', 'AUX'].includes(t.pos) || t.tag.startsWith('VB') || t.coref?.some(r => r.ent_type)\n// }\n\nexport const isPoint = (p: any): p is Point => typeof p === 'object' &&\n    'x' in p &&\n    'y' in p &&\n    typeof p['x'] === 'number' &&\n    typeof p['y'] === 'number' ","let _intervalIdGen = 0\nexport function intervalIdGen() {\n    return ++_intervalIdGen\n}\n\nexport function getHash(input: string) {\n    let hash = 0, len = input.length;\n    for (var i = 0; i < len; i++) {\n        hash = ((hash << 5) - hash) + input.charCodeAt(i);\n        hash |= 0; // to 32bit integer\n    }\n    return hash;\n}","import { BaseVideo } from \"../@types\"\n\nexport async function getImg(src: string) {\n  const img = new Image()\n  img.src = src\n  await new Promise(resolve => {\n    img.onload = e => {\n      URL.revokeObjectURL(src)\n      resolve(undefined)\n    }\n  })\n  return img\n}\n\nexport function globalFIdxToLocal<GameID extends string, VideoID extends string>(globalFrameIdx: number, videos: BaseVideo<GameID, VideoID>[]) {\n  let accFrame = 0\n  let videoIdx = 0\n  for (videoIdx = 0; videoIdx < videos.length; ++videoIdx) {\n    const video = videos[videoIdx]\n    if (globalFrameIdx >= accFrame && globalFrameIdx < accFrame + video.maxFrame) {\n      break\n    } else {\n      accFrame += video.maxFrame\n    }\n  }\n  const newCurFrameIdx = globalFrameIdx - accFrame\n  return { videoIdx, frameIdx: newCurFrameIdx }\n}\n\nexport function localFIdxToGlobalFIdx<GameID extends string, VideoID extends string>(videoIdx: number, localFIdx: number, videos: BaseVideo<GameID, VideoID>[]) {\n  let accFrameIdx = 0\n  for (let i = 0; i < videoIdx; ++i)\n    accFrameIdx += videos[i].maxFrame\n  return accFrameIdx + localFIdx\n}\n","import { Point } from \"../@types\"\n\nexport const arr2Point = (arr: [number, number]): Point => ({ x: arr[0], y: arr[1] })\n\nexport const distPoints = (p1: Point, p2: Point) => {\n\n    const dx = p1.x - p2.x\n    const dy = p1.y - p2.y\n\n    return Math.sqrt(dx * dx + dy * dy)\n}\n\nexport const diffPoints = (p1: Point, p2: Point) => ({ x: p1.x - p2.x, y: p1.y - p2.y })\nexport const addPoints = (p1: Point, p2: Point) => ({ x: p1.x + p2.x, y: p1.y + p2.y })\nexport const centerOfPoints = (points: Point[] | Array<[number, number]>): Point => {\n    if (typeof points[0] === 'object') {\n        const oPoints: Point[] = points as Point[]\n        return {\n            x: oPoints.reduce((o, p) => o + p.x, 0) / oPoints.length,\n            y: oPoints.reduce((o, p) => o + p.y, 0) / oPoints.length,\n        }\n    }\n    const aPoints: Array<[number, number]> = points as Array<[number, number]>\n    return {\n        x: aPoints.reduce((o, p) => o + p[0], 0) / aPoints.length,\n        y: aPoints.reduce((o, p) => o + p[1], 0) / aPoints.length,\n    }\n}\n\nexport const extendCrossLine = (from: Point, to: Point, extend: number = 0): Point => {\n    let k = (to.y - from.y) / (to.x - from.x)\n    k = -1 / k\n\n    const center = centerOfPoints([from, to])\n\n    const theta = Math.atan(k)\n    const dy = Math.abs(extend * Math.sin(theta))\n    const dx = Math.abs(extend * Math.cos(theta))\n\n    const direc = (extend / Math.abs(extend)) || 0\n\n    return { x: center.x + direc * dx, y: center.y + direc * dy }\n}\n\nexport const extendLine = (from: Point, to: Point, extend: number = 0): Point => {\n\n    const k = (to.y - from.y) / (to.x - from.x)\n\n    const theta = Math.atan(k)\n    const dy = Math.abs(extend * Math.sin(theta))\n    const dx = Math.abs(extend * Math.cos(theta))\n\n    const direcX = (extend / Math.abs(extend)) || 0 //((to.x - from.x) / Math.abs(to.x - from.x)) || 0\n    const direcY = direcX //((to.y - from.y) / Math.abs(to.y - from.y)) || 0\n\n    return { x: to.x + direcX * dx, y: to.y + direcY * dy }\n}\n// perpendicular line\nexport const crossLine = (from: Point, to: Point, extend: number = 0): Point => {\n    const k = (to.y - from.y) / (to.x - from.x)\n    const k2 = -1 / k\n    const theta = Math.atan(k2)\n    const cP = centerOfPoints([from, to])\n\n    const dy = Math.abs(extend * Math.sin(theta))\n    const dx = Math.abs(extend * Math.cos(theta))\n\n    const direcX = ((to.x - from.x) / Math.abs(to.x - from.x)) || 0\n    const direcY = ((to.y - from.y) / Math.abs(to.y - from.y)) || 0\n\n    return { x: cP.x + direcX * dx, y: cP.y + -direcY * dy }\n\n}\n\nconst getLineFromPoints = (line: [Point, Point]) => {\n    const k = (line[1].y - line[0].y) / (line[1].x - line[0].x)\n    const b = line[0].y - k * line[0].x\n\n    return { k, b }\n}\n\n\nexport const intersectionOf2Lin = (line1: [Point, Point], line2: [Point, Point]): Point => {\n    const { k: k1, b: b1 } = getLineFromPoints(line1)\n    const { k: k2, b: b2 } = getLineFromPoints(line2)\n\n    // console.debug(`\n    //   ${line1[0].y} = ${k1 * line1[0].x + b1}\n    //   ${line1[1].y} = ${k1 * line1[1].x + b1}\n\n    //   ${line2[0].y} = ${k2 * line2[0].x + b2}\n    //   ${line2[1].y} = ${k2 * line2[1].x + b2}\n    // `)\n\n    const xi = (b2 - b1) / (k1 - k2)\n    const yi = k1 * xi + b1\n\n    // console.debug(`\n    //   line1: (${line1[0].x},${line1[0].y}) (${line1[1].x},${line1[1].y})\n    //   line2: (${line2[0].x},${line2[0].y}) (${line2[1].x},${line2[1].y})\n    // `)\n    // console.debug(`\n    //   xi: ${xi}, yi: ${yi}\n    // `)\n\n    return { x: xi, y: yi }\n}\n\n\nexport const atan2Normalized = (y: number, x: number) => {\n    var result = Math.atan2(y, x);\n    if (result < 0) {\n        result += (2 * Math.PI);\n    }\n    return result;\n}\n\nexport function getAngle(x1: number, y1: number, x2: number, y2: number) {\n    const [dx, dy] = [x2 - x1, y2 - y1]\n    let radians = (dx || dy)\n        ? Math.atan2(dy, dx)\n        : 0\n    if (radians < 0) radians += 2 * Math.PI\n    return radians * (180 / Math.PI)\n}\n\n// Return: Close approximation of the length of a Cubic Bezier curve\n//\n// Ax,Ay,Bx,By,Cx,Cy,Dx,Dy: the 4 control points of the curve\n// sampleCount [optional, default=40]: how many intervals to calculate\n// Requires: cubicQxy (included below)\n//\nexport function cubicBezierLength(A: Point, B: Point, C: Point, D: Point, sampleCount = 40) {\n    var ptCount = sampleCount;\n    var totDist = 0;\n    var lastX = A.x;\n    var lastY = A.y;\n    var dx, dy;\n    for (var i = 1; i < ptCount; i++) {\n        var pt = cubicQxy(i / ptCount, A.x, A.y, B.x, B.y, C.x, C.y, D.x, D.y);\n        dx = pt.x - lastX;\n        dy = pt.y - lastY;\n        totDist += Math.sqrt(dx * dx + dy * dy);\n        lastX = pt.x;\n        lastY = pt.y;\n    }\n    dx = D.x - lastX;\n    dy = D.y - lastY;\n    totDist += Math.sqrt(dx * dx + dy * dy);\n    return Math.floor(totDist);\n}\n\n\n// Return: an [x,y] point along a cubic Bezier curve at interval T\n//\n// Attribution: Stackoverflow's @Blindman67\n// Cite: http://stackoverflow.com/questions/36637211/drawing-a-curved-line-in-css-or-canvas-and-moving-circle-along-it/36827074#36827074\n// As modified from the above citation\n// \n// t: an interval along the curve (0<=t<=1)\n// ax,ay,bx,by,cx,cy,dx,dy: control points defining the curve\n//\nfunction cubicQxy(t: number, ax: number, ay: number, bx: number, by: number, cx: number, cy: number, dx: number, dy: number) {\n    ax += (bx - ax) * t;\n    bx += (cx - bx) * t;\n    cx += (dx - cx) * t;\n    ax += (bx - ax) * t;\n    bx += (cx - bx) * t;\n    ay += (by - ay) * t;\n    by += (cy - by) * t;\n    cy += (dy - cy) * t;\n    ay += (by - ay) * t;\n    by += (cy - by) * t;\n    return ({\n        x: ax + (bx - ax) * t,\n        y: ay + (by - ay) * t\n    });\n}\n\n// cubic bezier percent is 0-1\nexport function getCubicBezierXYatPercent(startPt: Point, controlPt1: Point,\n    controlPt2: Point, endPt: Point, percent: number) {\n    const x = CubicN(percent, startPt.x, controlPt1.x, controlPt2.x, endPt.x);\n    const y = CubicN(percent, startPt.y, controlPt1.y, controlPt2.y, endPt.y);\n    return ({ x: x, y: y });\n}\n\n// cubic helper formula at percent distance\nfunction CubicN(pct: number, a: number, b: number, c: number, d: number) {\n    var t2 = pct * pct;\n    var t3 = t2 * pct;\n    return a + (-a * 3 + pct * (3 * a - a * pct)) * pct\n        + (3 * b + pct * (-6 * b + b * 3 * pct)) * pct\n        + (c * 3 - c * 3 * pct) * t2\n        + d * t3;\n}","export function wrapWorker<In extends unknown[], Out>(\n  workerFunc: { new(): Worker },\n  key: string,\n  cb?: (...args: any[]) => void): (...args: In) => Promise<Out> {\n  const worker = new workerFunc()\n  return async (...args: In) => {\n    worker.postMessage([key, ...args])\n\n    return await new Promise<Out>(resolve => {\n      const handler = (e: MessageEvent<any>) => {\n        if (e.data[0] !== key) {\n          cb?.(e.data)\n          return\n        }\n        worker.removeEventListener('message', handler)\n        resolve(e.data[1])\n      }\n      worker.addEventListener('message', handler)\n    })\n  }\n}","import { Overwrite } from \"common/@types\"\nimport type { PlayerID, VideoID } from \"./index\"\n\nexport enum PLAYER_STATUS {\n  offensive = 'in_offensive',\n  defensive = 'in_defensive',\n  other = 'in_other'\n}\nexport interface OffensivePkg {\n  mode: PLAYER_STATUS.offensive\n  region: string\n  diff: number\n  eDiff: number\n  freq: number\n  regionRate: number\n  regionExp: number\n  smoothRegionExp: number\n  inOffsensiveCourt: boolean\n}\nexport interface DefensivePkg {\n  mode: PLAYER_STATUS.defensive\n  defendingPlayer: PlayerID\n  tangle: number\n  tdist: number\n  diff: number\n  smoothDFdiff: number\n  speed: number\n  freq: number\n}\nexport type DataPkg = OffensivePkg | DefensivePkg\n\nexport interface FrameStamp {\n  videoId: VideoID\n  fIdx: number\n  ts: number\n}\n\nexport interface Gaze extends FrameStamp {\n  x: number,\n  y: number\n}\n\nexport type AttentionWeights = { att: number, looked: boolean, on: boolean }\n\n// Partial<Record<PlayerId, { att: number, looked: boolean, on: boolean }>>\nexport interface Attentions {\n  lastTs: number\n  fIdx: number\n  videoId?: VideoID\n  players: Partial<Record<PlayerID, AttentionWeights>>\n}\n\nexport type HighlightWeights = Partial<Record<PlayerID, { lostTs: number, sync: boolean }>>\nexport interface Highlights {\n  lastTs: number\n  players: HighlightWeights\n}\n\nexport interface DefenseRecord {\n  PLAYER_ID: PlayerID\n  DEFENSE_CATEGORY: string,\n  FREQ: number,\n  D_FGM: number,\n  D_FGA: number,\n  D_FG_PCT: number,\n  NORMAL_FG_PCT: number,\n  PCT_PLUSMINUS: number,\n  AVG_DEF_SPEED: number\n}\n\nexport enum KeyPlayerType {\n  BALL_HOLDER = 0,\n  NEXT_BALL_HOLDER = 1,\n  EMPTY_PLAYER = 2,\n  STAR = 3,\n}\nexport interface KeyPlayer {\n  id: PlayerID\n  last: { progress: number, status: 'enter' | 'update' | 'exit' } // in frames, exist when NEXT_BALL_HOLDER\n  type: KeyPlayerType\n}\nexport enum Lv2PlayerType {\n  Interest = 1,\n  Normal = 2,\n  Normal_Interest = 3,\n}\nexport interface Lv2Player extends Partial<AttentionWeights> {\n  id: PlayerID\n  type: Set<Lv2PlayerType>\n}\n\nexport type CachePlayerBin = Overwrite<PlayerShotBin, {\n  region: { AREA: string, BASIC: string, RANGE: string }\n}>\n\nexport interface ShotRecord {\n  // shot_id: string\n  // ACTION_TYPE: string\n  // EVENT_TYPE: string // \"Missed Shot\"\n  GAME_EVENT_ID: string // \"555\"\n  GAME_ID: string // \"21500030\"\n  // GRID_TYPE: string //\"Shot Chart Detail\"\n  // HTM: string //\"HOU\"\n  LOC_X: number //\"-68\"\n  LOC_Y: number // \"242\"\n  // MINUTES_REMAINING: number //\"3\"\n  // PERIOD: number //\"4\"\n  PLAYER_ID: PlayerID //\"203546\"\n  // PLAYER_NAME: string //\"Ian Clark\"\n  // SECONDS_REMAINING: number // \"18\"\n  // SHOT_ATTEMPTED_FLAG: string // \"1\"\n  // SHOT_DISTANCE: number // \"25\"\n  made: number // \"0\"\n  // SHOT_TYPE: string //\"3PT Field Goal\"\n  SHOT_ZONE: { AREA: string, BASIC: string, RANGE: string }\n  // _AREA: string //\"Center(C)\"\n  // SHOT_ZONE_BASIC: string // \"Above the Break 3\"\n  // SHOT_ZONE_RANGE: string //\"24+ ft.\"\n  // TEAM_ID: number //\"1610612744\"\n  // VTM: string //\"GSW\"\n}\n\nexport type PlayerShotBin = {\n  region: string\n  regionRate: number\n  regionFreq: number // freq in this bin by region\n  regionExp: number // expect point value\n  diff: number // ergion diff to league average\n  eDiff: number\n  x: number\n  y: number\n}","import { COLORS } from \"../@const/draw\";\nimport { Layer } from \"../@types\";\n\nfunction drawRawFrame(layer: Layer, frame: CanvasImageSource, darkenAlpha = 0.1) {\n    const { width, height } = layer.canvas\n    layer.ctx.drawImage(frame, 0, 0, width, height);\n\n    if (darkenAlpha !== 0) {\n        drawOverlay(layer, darkenAlpha)\n    }\n}\n\nfunction drawOverlay(layer: Layer, alpha: number = COLORS.BG_MASK_ALPHA) {\n    const { ctx, canvas } = layer\n    const { width, height } = canvas\n\n    ctx.save()\n    ctx.fillStyle = `rgba(0, 0, 0, ${alpha})`;\n    ctx.fillRect(0, 0, width, height);\n    ctx.restore()\n}\n\nfunction fadeOutLayer(layer: Layer, alpha: number) {\n    layer.ctx.save()\n    layer.ctx.globalAlpha = alpha\n    layer.ctx.globalCompositeOperation = 'copy';\n    layer.ctx.drawImage(layer.canvas, 0, 0)\n    layer.ctx.restore()\n}\n\n\nexport {\n    drawRawFrame as bg,\n    drawOverlay as overlay,\n    fadeOutLayer as fadeOutFrame\n}","import type { Layer } from \"../@types/draw\";\nimport type { BasePlayer } from \"../@types/data\";\nimport type { Point } from \"../@types/basic\";\nimport { fadeOutFrame } from './frame'\n\nfunction drawBall(layer: Layer, ball?: Point, trail = false) {\n\n  const { width, height } = layer.canvas\n  if (trail) {\n    fadeOutFrame(layer, 0.9)\n  } else {\n    layer.ctx.clearRect(0, 0, width, height)\n  }\n\n  if (ball) {\n    const { x: cx, y: cy } = ball\n    layer.ctx.beginPath()\n    layer.ctx.lineWidth = 3\n    layer.ctx.strokeStyle = 'steelblue'\n    layer.ctx.fillStyle = 'rgba(236, 240, 241, 1)'\n    layer.ctx.arc(cx, cy, 5, 0, 2 * Math.PI)\n    layer.ctx.fill()\n    layer.ctx.stroke()\n  }\n}\n\nconst internalCanvas = document.createElement('canvas')\nconst internalCtx = internalCanvas.getContext('2d')!\nfunction drawFullBrightPlayers<PlayerID extends number>(layer: Layer,\n  frame: CanvasImageSource,\n  mask: CanvasImageSource,\n  players: BasePlayer<PlayerID>[],\n  glow: boolean = true\n) {\n  const { ctx } = layer\n  const { width, height } = layer.canvas\n\n  // mask get full bright players\n  internalCanvas.width = width\n  internalCanvas.height = height\n  internalCtx.save()\n  internalCtx.drawImage(mask, 0, 0)\n  internalCtx.globalCompositeOperation = 'source-in'\n  internalCtx.drawImage(frame, 0, 0)\n  internalCtx.restore()\n\n  ctx.save()\n  if (glow) {\n    ctx.shadowBlur = 30\n    ctx.shadowColor = 'rgba(255, 255, 255, 0.5)';\n  }\n  players\n    .forEach(player => {\n      const { x, y, w, h } = player.bbox\n      ctx.drawImage(internalCanvas,\n        x, y, w, h,\n        x, y, w, h)\n    })\n  ctx.restore()\n\n}\n\nexport {\n  drawBall as ball,\n  drawFullBrightPlayers as fullbrightPlayers,\n}\n","import type { Point, Route } from \"../@types\"\n\ninterface Style {\n  fillStyle?: string | CanvasGradient | CanvasPattern | { pattern: CanvasPattern, opacity: number }\n  lineWidth?: number\n  strokeStyle?: string\n  font?: string\n  textBaseline?: CanvasTextBaseline\n  lineCap?: CanvasLineCap\n  lineJoin?: CanvasLineJoin\n}\ntype Entries<T> = {\n  [K in keyof T]: [K, T[K]]\n}[keyof T][]\n\n// type Style = Partial<Pick<CanvasRenderingContext2D, 'fillStyle' | 'strokeStyle' | 'lineWidth' | 'font' | 'textBaseline'>>\n\nfunction entries<T extends {}>(obj: T): Entries<T> {\n  return Object.entries(obj) as any;\n}\n\nfunction applyStyle(ctx: CanvasRenderingContext2D, style: Style = {}) {\n  entries(style).forEach((e) => {\n    if (e?.[0] === 'lineWidth' && e[1] !== undefined) {\n      ctx.lineWidth = e[1] // value\n    }\n    if (e?.[0] === 'strokeStyle' && e[1] !== undefined) {\n      ctx.strokeStyle = e[1]//value\n    }\n    if (e?.[0] === 'font' && e[1]) {\n      ctx.font = e[1]\n    }\n    if (e?.[0] === 'textBaseline' && e[1]) {\n      ctx.textBaseline = e[1]\n    }\n    if (e?.[0] === 'lineCap' && e[1]) {\n      ctx.lineCap = e[1]\n    }\n    if (e?.[0] === 'lineJoin' && e[1]) {\n      ctx.lineJoin = e[1]\n    }\n  })\n\n  if (style.fillStyle) {\n    const value = style.fillStyle\n    if (typeof value === 'object' && 'pattern' in value && 'opacity' in value) {\n      ctx.fillStyle = value.pattern\n      ctx.globalAlpha = value.opacity;\n    } else {\n      ctx.fillStyle = value\n    }\n  }\n}\n\nfunction drawLine(ctx: CanvasRenderingContext2D, sx: number, sy: number, dx: number, dy: number, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n  ctx.beginPath()\n  ctx.moveTo(sx, sy)\n  ctx.lineTo(dx, dy)\n  ctx.stroke()\n}\n\nfunction drawHLine(ctx: CanvasRenderingContext2D, sx: number, sy: number, dx: number, style: Style = {}) {\n  drawLine(ctx, sx, sy, dx, sy, style)\n}\n\nfunction drawPolygon(ctx: CanvasRenderingContext2D, points: Point[], style?: Style): void;\nfunction drawPolygon(ctx: CanvasRenderingContext2D, points: [number, number][], style?: Style): void;\nfunction drawPolygon(ctx: CanvasRenderingContext2D, points: [number, number][] | Point[], style: Style = {}): void {\n\n  if (points.length === 0) return\n  const pointsToDraw: [number, number][] = Array.isArray(points[0])\n    ? points as [number, number][]\n    : (points as Point[]).map(p => ([p.x, p.y])) as [number, number][]\n\n  let [x, y] = pointsToDraw[0]\n\n  ctx.save()\n  applyStyle(ctx, style)\n\n  ctx.beginPath()\n  ctx.moveTo(x, y)\n  for (let i = 1, len = pointsToDraw.length; i < len; ++i) {\n    ([x, y] = pointsToDraw[i]);\n    ctx.lineTo(x, y)\n  }\n  ctx.closePath();\n  ctx.stroke()\n\n  ctx.fill();\n  ctx.restore()\n}\n\n\nfunction drawPolyline(ctx: CanvasRenderingContext2D, points: [number, number][] | Point[], style: Style = {}): void {\n\n  if (points.length === 0) return\n  const pointsToDraw: [number, number][] = Array.isArray(points[0])\n    ? points as [number, number][]\n    : (points as Point[]).map(p => ([p.x, p.y])) as [number, number][]\n\n  let [x, y] = pointsToDraw[0]\n\n  ctx.save()\n  applyStyle(ctx, style)\n\n  ctx.beginPath()\n  ctx.moveTo(x, y)\n  for (let i = 1, len = pointsToDraw.length; i < len; ++i) {\n    ([x, y] = pointsToDraw[i]);\n    ctx.lineTo(x, y)\n  }\n  // ctx.closePath();\n  ctx.stroke()\n\n  // ctx.fill();\n  ctx.restore()\n}\n\n\nfunction drawCurve(ctx: CanvasRenderingContext2D, route: Route, style: Style = {}) {\n\n  ctx.save()\n  applyStyle(ctx, style)\n\n  ctx.beginPath();\n  ctx.moveTo(route[0].x, route[0].y)\n  ctx.bezierCurveTo(\n    route[1].x, route[1].y,\n    route[2].x, route[2].y,\n    route[3].x, route[3].y\n  )\n  ctx.stroke()\n  // ctx.fill();\n  ctx.restore()\n  // ctx.fillStyle = ctx.strokeStyle\n  // triangleAt(ctx, route[2], route[3], 10)\n}\n\nfunction triangleAt(ctx: CanvasRenderingContext2D, from: Point, center: Point, r: number, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n\n  // draw arrow\n  let x_center = center.x;\n  let y_center = center.y;\n\n  let angle, x, y\n  ctx.beginPath();\n\n  angle = Math.atan2(center.y - from.y, center.x - from.x)\n  x_center -= r * Math.cos(angle);\n  y_center -= r * Math.sin(angle);\n  x = r * Math.cos(angle) + x_center\n  y = r * Math.sin(angle) + y_center\n  ctx.moveTo(x, y);\n\n  angle += (1 / 3) * (2 * Math.PI)\n  x = r * Math.cos(angle) + x_center\n  y = r * Math.sin(angle) + y_center\n  ctx.lineTo(x, y);\n\n  angle += (1 / 3) * (2 * Math.PI)\n  x = r * Math.cos(angle) + x_center\n  y = r * Math.sin(angle) + y_center\n  ctx.lineTo(x, y);\n\n  ctx.closePath();\n\n\n  ctx.fill();\n  ctx.restore()\n}\n\ninterface ArrowParams {\n  from: Point\n  to: Point\n  arrowSize: number\n  z?: boolean\n  double?: boolean\n}\nfunction drawArrow(ctx: CanvasRenderingContext2D, { from, to, arrowSize, z = false, double = false }: ArrowParams, style: Style = {}) {\n  // draw line\n  ctx.save()\n  applyStyle(ctx, style)\n\n  if (z) {\n    ctx.transform(1, 0, -0.2, .8, from.x, from.y);\n  }\n  const nFrom = z ? { x: 0, y: 0 } : from\n  const nTo = z ? { x: to.x - from.x, y: to.y - from.y } : to\n\n  if (double) {\n    triangleAt(ctx, nTo, nFrom, arrowSize, style)\n  }\n\n  ctx.beginPath();\n  const angle = Math.atan2(nTo.y - nFrom.y, nTo.x - nFrom.x)\n  ctx.moveTo(nFrom.x + arrowSize * Math.cos(angle), nFrom.y + arrowSize * Math.sin(angle));\n  ctx.lineTo(nTo.x - arrowSize * Math.cos(angle), nTo.y - arrowSize * Math.sin(angle));\n  ctx.stroke();\n  ctx.fill();\n\n  triangleAt(ctx, nFrom, nTo, arrowSize, style)\n  ctx.restore()\n}\n\ninterface CircleParams {\n  x: number, y: number, r: number, angle?: number, z?: boolean\n}\nfunction drawCircle(ctx: CanvasRenderingContext2D, { x, y, r, angle = 2 * Math.PI, z = false }: CircleParams, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n\n  if (z) {\n    ctx.transform(1, 0, -0.2, .5, x, y);\n  }\n  x = z ? 0 : x\n  y = z ? 0 : y\n\n  ctx.beginPath();\n  ctx.arc(x, y, r, 0, angle)\n  ctx.lineTo(x, y)\n\n  ctx.stroke()\n  ctx.fill();\n\n  ctx.restore()\n}\n\ninterface RingParams extends CircleParams {\n  r2: number\n}\nfunction drawRing(ctx: CanvasRenderingContext2D, { x, y, r, r2, angle = 2 * Math.PI, z = false }: RingParams, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n\n  // draw outer\n  drawCircle(ctx, { x, y, r: r2, angle, z })\n\n  // cut inner\n  ctx.globalCompositeOperation = 'destination-out'\n  drawCircle(ctx, { x, y, r, angle, z })\n\n  ctx.restore()\n}\n\ninterface RoundedRectParams {\n  x: number\n  y: number\n  w: number\n  h: number\n  r: number\n  z?: boolean\n}\nfunction drawRoundedRect(ctx: CanvasRenderingContext2D, { x, y, w, h, r, z = false }: RoundedRectParams, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n\n  if (z) {\n    ctx.transform(1, 0, -0.1, .9, x, y);\n  }\n  x = z ? 0 : x\n  y = z ? 0 : y\n\n  if (w < 2 * r) r = w / 2;\n  if (h < 2 * r) r = h / 2;\n  ctx.beginPath();\n  ctx.moveTo(x + r, y);\n  ctx.arcTo(x + w, y, x + w, y + h, r);\n  ctx.arcTo(x + w, y + h, x, y + h, r);\n  ctx.arcTo(x, y + h, x, y, r);\n  ctx.arcTo(x, y, x + w, y, r);\n  ctx.closePath();\n\n  ctx.stroke()\n  ctx.fill();\n\n  ctx.restore()\n}\n\ninterface TextParams {\n  x: number,\n  y: number,\n  text: string\n  z?: boolean\n}\n/**\n * use top left as the default baseline\n * @param ctx \n * @param param1 \n * @param style \n */\nfunction drawText(ctx: CanvasRenderingContext2D, { x, y, text, z = false }: TextParams, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n  ctx.textBaseline = 'top'\n\n  if (z) {\n    ctx.transform(1, 0, -0.1, .9, x, y);\n  }\n  x = z ? 0 : x\n  y = z ? 0 : y\n\n  ctx.strokeText(text, x, y)\n  ctx.fillText(text, x, y)\n  ctx.restore()\n}\n\ninterface ConeParams {\n  x: number\n  y: number\n  r: number\n  h: number\n  r1?: number\n}\ntype Point3D = [number, number, number]\nfunction drawCone(ctx: CanvasRenderingContext2D, { x, y, r, h, r1 = 0 }: ConeParams, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n\n  const dAlpha = 0.1;\n\n  const nodes: Point3D[] = [\n    // [0, -h, 0]\n  ];\n  const uNodes: Point3D[] = []\n\n  const faces: [Point3D, Point3D, Point3D, Point3D][] = [];\n  //creating nodes\n  let alpha = 0;\n  // let i = 1;\n  for (let i = 0; alpha <= 2 * Math.PI + dAlpha; ++i) {\n    // while () {\n    let x = r * Math.cos(alpha);\n    let z = r * Math.sin(alpha);\n    nodes[i] = [x, 0, z];\n    alpha += dAlpha;\n\n    x = r1 * Math.cos(alpha);\n    z = r1 * Math.sin(alpha);\n    uNodes[i] = [x, -(1 - r1 / r) * h, z];\n  }\n\n  //creating faces\n  let p = 0;\n  for (let n = 0; n < nodes.length - 1; n++) {\n    let face: [Point3D, Point3D, Point3D, Point3D] = [uNodes[p], nodes[p], nodes[p + 1], uNodes[p + 1]];\n    faces[n] = face;\n    p += 1;\n  }\n\n  // Rotate shape around the x-axis\n  function rotateX3D(theta: number) {\n    const sinTheta = Math.sin(-theta);\n    const cosTheta = Math.cos(-theta);\n\n    for (let n = 0; n < nodes.length; n++) {\n      let node = nodes[n];\n      let y = node[1];\n      let z = node[2];\n      node[1] = y * cosTheta - z * sinTheta;\n      node[2] = z * cosTheta + y * sinTheta;\n\n      node = uNodes[n];\n      y = node[1];\n      z = node[2];\n      node[1] = y * cosTheta - z * sinTheta;\n      node[2] = z * cosTheta + y * sinTheta;\n    }\n  }\n\n  //rotateZ3D(10 * Math.PI / 180);\n  rotateX3D((20 * Math.PI) / 180);\n\n  ctx.translate(x, y);\n\n  // Draw faces\n  for (let i = 0; i < faces.length; i++) {\n    const [v0, v1, v2, v3] = faces[i]\n    ctx.beginPath();\n    ctx.moveTo(v0[0], v0[1]);\n    ctx.lineTo(v1[0], v1[1]);\n    ctx.lineTo(v2[0], v2[1]);\n    ctx.lineTo(v3[0], v3[1]);\n    ctx.lineTo(v0[0], v0[1]);\n    ctx.fill();\n    // ctx.stroke();\n    ctx.closePath();\n  }\n\n  ctx.restore()\n}\n\ninterface LabelParams {\n  x: number,\n  y: number,\n  w: number, h: number,\n  text: string\n}\nfunction drawLabel(ctx: CanvasRenderingContext2D, { x, y, w, h, text }: LabelParams, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n\n  ctx.beginPath()\n  ctx.moveTo(x, y);\n  ctx.lineTo(x + 100, y - 50)\n  ctx.stroke()\n\n  ctx.rect(x + 100, y - 50, w, h)\n  ctx.stroke()\n  ctx.fillStyle = '#fff'\n  ctx.fill()\n  applyStyle(ctx, style)\n\n  // ctx.strokeText(text, x + 110, y - 50)\n  ctx.fillText(text, x + 105, y - 50 + 5)\n  ctx.restore()\n}\n\n\nexport {\n  drawLine as line,\n  drawHLine as hLine,\n  drawPolygon as polygon,\n  drawPolyline as polyline,\n  drawArrow as arrow,\n  drawCurve as curve,\n  drawCircle as circle,\n  drawRing as ring,\n  drawRoundedRect as roundedRect,\n  drawText as text,\n  drawCone as cone,\n  drawLabel as label,\n}\n\n/**\n * Draws a cardinal spline through given point array. Points must be arranged\n * as: [x1, y1, x2, y2, ..., xn, yn]. It adds the points to the current path.\n *\n * The method continues previous path of the context. If you don't want that\n * then you need to use moveTo() with the first point from the input array.\n *\n * The points for the cardinal spline are returned as a new array.\n *\n * @param {CanvasRenderingContext2D} ctx - context to use\n * @param {Array} points - point array\n * @param {Number} [tension=0.5] - tension. Typically between [0.0, 1.0] but can be exceeded\n * @param {Number} [numOfSeg=20] - number of segments between two points (line resolution)\n * @param {Boolean} [close=false] - Close the ends making the line continuous\n * @returns {Float32Array} New array with the calculated points that was added to the path\n */\nexport function _curve(ctx: CanvasRenderingContext2D, _points: Point[], tension: number = 0.5, numOfSeg: number = 20, close: boolean = false) {\n  const points = _points.flatMap(p => ([p.x, p.y]))\n\n  // let i = 1,\n  let l = points.length,\n    rPos = 0,\n    rLen = (l - 2) * numOfSeg + 2 + (close ? 2 * numOfSeg : 0),\n    res = new Float32Array(rLen);\n\n  let pts = [...points];\n  if (close) {\n    pts.unshift(points[l - 1]);\t\t\t\t// insert end point as first point\n    pts.unshift(points[l - 2]);\n    pts.push(points[0], points[1]); \t\t// first point as last point\n  } else {\n    pts.unshift(points[1]);\t\t\t\t\t// copy 1. point and insert at beginning\n    pts.unshift(points[0]);\n    pts.push(points[l - 2], points[l - 1]);\t// duplicate end-points\n  }\n\n  // cache inner-loop calculations as they are based on t alone\n  const cache = new Float32Array((numOfSeg + 2) * 4)\n  let cachePtr = 4;\n  cache[0] = 1;\t\t\t\t\t\t\t\t// 1,0,0,0\n  for (let i = 1; i < numOfSeg; i++) {\n    let st = i / numOfSeg,\n      st2 = st * st,\n      st3 = st2 * st,\n      st23 = st3 * 2,\n      st32 = st2 * 3;\n\n    cache[cachePtr++] = st23 - st32 + 1;\t// c1\n    cache[cachePtr++] = st32 - st23;\t\t// c2\n    cache[cachePtr++] = st3 - 2 * st2 + st;\t// c3\n    cache[cachePtr++] = st3 - st2;\t\t\t// c4\n  }\n  cache[++cachePtr] = 1;\t\t\t\t\t\t// 0,1,0,0\n\n  // calc. points\n  parse(pts, cache, points.length);\n\n  if (close) {\n    //l = points.length;\n    pts = [];\n    pts.push(points[l - 4], points[l - 3], points[l - 2], points[l - 1]); // second last and last\n    pts.push(points[0], points[1], points[2], points[3]); // first and second\n    parse(pts, cache, 4);\n  }\n\n  function parse(pts: number[], cache: Float32Array, l: number) {\n\n    for (let i = 2, t; i < l; i += 2) {\n\n      let pt1 = pts[i],\n        pt2 = pts[i + 1],\n        pt3 = pts[i + 2],\n        pt4 = pts[i + 3],\n\n        t1x = (pt3 - pts[i - 2]) * tension,\n        t1y = (pt4 - pts[i - 1]) * tension,\n        t2x = (pts[i + 4] - pt1) * tension,\n        t2y = (pts[i + 5] - pt2) * tension;\n\n      for (t = 0; t < numOfSeg; t++) {\n\n        var c = t << 2, //t * 4;\n\n          c1 = cache[c],\n          c2 = cache[c + 1],\n          c3 = cache[c + 2],\n          c4 = cache[c + 3];\n\n        res[rPos++] = c1 * pt1 + c2 * pt3 + c3 * t1x + c4 * t2x;\n        res[rPos++] = c1 * pt2 + c2 * pt4 + c3 * t1y + c4 * t2y;\n      }\n    }\n  }\n\n  // add last point\n  l = close ? 0 : points.length - 2;\n  res[rPos++] = points[l];\n  res[rPos] = points[l + 1];\n\n  // add lines to path\n  ctx.moveTo(points[0], points[1]);\n  for (let i = 0, len = res.length; i < len; i += 2) {\n    ctx.lineTo(res[i], res[i + 1]);\n  }\n  // stroke path\n  ctx.stroke();\n\n  return res;\n}","import { Point } from 'common/@types'\nimport { getAngle } from \"common/@utils\";\n\nimport { PLAYER_META, COLORS, FOCUS, LV_INTEREST_THRESHOLD } from \"@const\";\nimport { PlayerID, KeyPlayer, KeyPlayerType, Lv2Player, Lv2PlayerType, Player } from \"@types\";\n\nimport * as _draw from 'common/@draw'\n\nexport interface VisCircle {\n  cx: number,\n  cy: number,\n  fill: string,\n  size: number,\n  inOffsensiveCourt: boolean\n}\n\nfunction drawVisCircles(visCtx: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D, circles: VisCircle[]) {\n  // 0 draw vis circle\n  visCtx.save()\n  const [a, b, c, d, e, f] = [1.75257350e+00, 5.98341402e-02, -8.91780472e-01, 2.49200452e-01, 0, 0]\n  visCtx.setTransform(a, b, c, d, e, f);\n  const circleTXY = circles.map(({ cx, cy }) => {\n    const tx = (cx - (c / d) * cy + (c / d) * f - e) / (a - (c / d) * b)\n    const ty = (cx - e - a * tx) / c\n    return { tx, ty }\n  })\n\n  const in_r = 10\n  const max_out_r = 22\n  // draw outer\n  circles\n    .filter(c => c.inOffsensiveCourt)\n    .forEach((_, cIdx) => {\n      const { tx, ty } = circleTXY[cIdx]\n      const out_r = in_r + max_out_r //25\n      visCtx.fillStyle = COLORS.offense_outer_border\n      visCtx.beginPath()\n      visCtx.arc(tx, ty, out_r, 0, 2 * Math.PI);\n      visCtx.fill();\n    })\n\n  // draw middle\n  circles.forEach(({ size, fill }, cIdx) => {\n    const { tx, ty } = circleTXY[cIdx]\n    const out_r = in_r + max_out_r * size //25\n    visCtx.fillStyle = fill\n    visCtx.beginPath()\n    visCtx.arc(tx, ty, out_r, 0, 2 * Math.PI);\n    visCtx.fill();\n  })\n\n  // cut innner\n  visCtx.globalCompositeOperation = 'destination-out'\n  circles.forEach(({ fill }, cIdx) => {\n    const { tx, ty } = circleTXY[cIdx]\n    visCtx.beginPath()\n    visCtx.arc(tx, ty, in_r, 0, 2 * Math.PI)\n    visCtx.fill()\n  })\n\n  // draw outer borders\n  visCtx.globalCompositeOperation = 'source-over'\n\n  visCtx.lineWidth = 1;\n  visCtx.strokeStyle = COLORS.offense_bg_fill\n  circles\n    .filter(c => c.inOffsensiveCourt)\n    .forEach((_, cIdx) => {\n      const { tx, ty } = circleTXY[cIdx]\n      const out_r = in_r + max_out_r //25\n      visCtx.beginPath()\n      visCtx.arc(tx, ty, out_r, 0, 2 * Math.PI);\n      visCtx.stroke()\n    })\n\n  // draw inner borders\n  visCtx.strokeStyle = COLORS.offense_inner_border //\"#313131\"\n  circles.forEach(({ inOffsensiveCourt }, cIdx) => {\n    const { tx, ty } = circleTXY[cIdx]\n    visCtx.lineWidth = inOffsensiveCourt ? 1 : 3;\n    visCtx.beginPath()\n    visCtx.arc(tx, ty, in_r, 0, 2 * Math.PI)\n    visCtx.stroke()\n  })\n\n  visCtx.restore()\n}\n\nexport interface VisSheild {\n  // fillColor: string,\n  diff: number,\n  smoothDFdiff: number\n  speed: number,\n  cx: number,\n  cy: number,\n  dx: number\n  dy: number\n  tangle: number\n  tdist: number\n  // right: boolean\n}\n\nconst roundTo2PI = (r: number) => (r + 2) % 2\n\nfunction drawVisSheilds(visCtx: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D, sheilds: VisSheild[], debugCtx?: CanvasRenderingContext2D) {\n  visCtx.save()\n  // const [a, b, c, d, e, f] = [1.75257350e+00, 5.98341402e-02, -8.91780472e-01, 5.49200452e-01, 0, 0]\n  const [a, b, c, d, e, f] = [1.75257350e+00, 0.0000001, 0.0000001, 5.49200452e-01, 0, 0]\n  visCtx.setTransform(a, b, c, d, e, f);\n\n  const invertTXY = (x: number, y: number) => {\n    const tx = (x - (c / d) * y + (c / d) * f - e) / (a - (c / d) * b)\n    const ty = (x - e - a * tx) / c\n    return { x: tx, y: ty }\n  }\n\n  // const convertTXY = (x: number, y: number) => {\n  //   const nx = a * x + c * y + e - 800\n  //   const ny = b * x + d * y + f - 0\n  //   return { x: nx, y: ny }\n  // }\n\n  const getA1A2 = (tangle: number, tdist: number) => {\n    const base = 0.02\n    const range = 0.13\n    let a1 = roundTo2PI(tangle - base\n      - range * Math.max(0, Math.min(1, 1 - (tdist - MIN_DIST) / MAX_DIST))\n    )\n    let a2 = roundTo2PI(tangle + base\n      + range * Math.max(0, Math.min(1, 1 - (tdist - MIN_DIST) / MAX_DIST)))\n\n    // swap\n    // if (a2 < a1 && !(a1 > 1.5 && a2 < 0.5)) [a2, a1] = [a1, a2]\n    if ((a2 < a1 && !(a1 > 1.5 && a2 < 0.5)) || (a1 < .5 && a2 > 1.5)) [a2, a1] = [a1, a2]\n    return [a1, a2]\n  }\n\n  // draw lines\n  const MAX_DIST = 12\n  const MIN_DIST = 3.5\n  visCtx.save()\n  for (const sheild of sheilds) {\n    const { cx, cy, dx, dy, tdist } = sheild\n\n    if (tdist >= MAX_DIST || tdist <= MIN_DIST) continue\n\n    const theta = getAngle(cx, cy, dx, dy) / 180\n    // console.debug(`cx:${cx}, cy:${cy}, dx:${dx}, dy:${dy}, theta:${theta}`)\n\n    visCtx.beginPath()\n    visCtx.lineWidth = 2\n    const { x: ox, y: oy } = invertTXY(cx + 40 * Math.cos(theta * Math.PI), cy + 40 * Math.sin(theta * Math.PI))\n    const { x, y } = invertTXY(dx - 50 * Math.cos(theta * Math.PI), dy - 50 * Math.sin(theta * Math.PI))\n\n    const grd = visCtx.createLinearGradient(ox, oy, x, y);\n    grd.addColorStop(0, `rgba(${COLORS.off_df_link}, 0.1)`);\n    grd.addColorStop(0.1, `rgba(${COLORS.off_df_link}, ${0.3 + 0.5 * ((MAX_DIST - tdist) / MAX_DIST)})`);\n    grd.addColorStop(0.9, `rgba(${COLORS.off_df_link}, ${0.3 + 0.5 * ((MAX_DIST - tdist) / MAX_DIST)})`);\n    grd.addColorStop(1, `rgba(${COLORS.off_df_link}, 0.1)`);\n\n    visCtx.strokeStyle = grd\n    visCtx.shadowColor = `rgb(${COLORS.off_df_link})`\n    visCtx.shadowBlur = 5\n    visCtx.moveTo(ox, oy)\n    visCtx.lineTo(x, y)\n    visCtx.stroke()\n  }\n  visCtx.restore()\n\n  const in_r = 100\n  for (const sheild of sheilds) {\n    let { cx, cy, dx, dy, tdist, smoothDFdiff } = sheild\n\n    // r\n    const out_r = in_r + 4 + Math.max(0, smoothDFdiff) * 15\n    visCtx.lineWidth = out_r - in_r;\n\n    // 2d angle\n    const theta = getAngle(cx, cy, dx, dy) / 180\n    const dist = Math.max(0,\n      - 30 + in_r * Math.sqrt(1 / (Math.pow(Math.cos(theta * Math.PI) / a, 2) + Math.pow(Math.sin(theta * Math.PI) / d, 2)))\n    )\n\n    cx = cx - dist * Math.cos(theta * Math.PI)\n    cy = cy - dist * Math.sin(theta * Math.PI)\n    const { x: tx, y: ty } = invertTXY(cx, cy)\n\n    // cal start and end angle\n    // 3d angle\n    let tangle = Math.atan(a * Math.tan(theta * Math.PI) / d) / Math.PI\n    // opposite\n    if (theta > 0.5 && theta <= 1.5) tangle = (tangle + 1) % 2\n\n    const [a1, a2] = getA1A2(tangle, tdist)\n    const [ma1, ma2] = getA1A2(tangle, MIN_DIST)\n\n    // visCtx.beginPath()\n    // visCtx.strokeStyle = 'rgba(125, 0, 0, 1)'\n    // visCtx.arc(tx, ty, in_r + (out_r - in_r) / 2,0 * Math.PI, 2 * Math.PI);\n    // visCtx.stroke()\n\n    // bg first\n    visCtx.strokeStyle = COLORS.defense_bg_fill\n    // visCtx.shadowColor = `#f5f5f599`\n    // visCtx.shadowBlur = 5\n    visCtx.beginPath()\n    visCtx.arc(tx, ty, in_r + (out_r - in_r) / 2, ma1 * Math.PI, ma2 * Math.PI);\n    visCtx.stroke()\n    // fill\n    visCtx.strokeStyle = COLORS.defense_fg_fill\n    visCtx.beginPath()\n    visCtx.arc(tx, ty, in_r + (out_r - in_r) / 2, a1 * Math.PI, a2 * Math.PI);\n    visCtx.stroke();\n  }\n\n  visCtx.restore()\n}\n\n\n\nfunction drawVis(visCtx: CanvasRenderingContext2D, circles: VisCircle[], sheilds: VisSheild[], debugCtx?: CanvasRenderingContext2D) {\n  drawVisCircles(visCtx, circles)\n  drawVisSheilds(visCtx, sheilds, debugCtx)\n}\n\n\nconst internalCanvas = document.createElement('canvas')\nconst internalCtx = internalCanvas.getContext('2d')!\n/**\n * Highlight levels:\n * - full brights: all lv1 and lv2 players\n * =========== Focus layer ====== \n * - glow effect: lv2 interested\n * - spotlight_white: lv1 key players's full bright should be above the focus mask\n * - spotlight_green: lv1 empty players\n */\nfunction drawHL(ctx: CanvasRenderingContext2D, \n  frame: CanvasImageSource, \n  mask: CanvasImageSource,\n  players: Player[],\n  lv1Players: Array<Player & KeyPlayer> = [],\n  lv2Players: Array<Player & Lv2Player> = [],\n  ballHolder?: PlayerID | null,\n  focus?: { pos: Point }) {\n  const { width, height } = ctx.canvas\n\n  const lv2PlayerLooked = lv2Players\n    .filter(p => p.id !== ballHolder &&\n      p.type.has(Lv2PlayerType.Interest) && p.looked && (p.att ?? 0) > LV_INTEREST_THRESHOLD.off)\n  const lv2PlayerNotLooked = lv2Players\n    .filter(p => !(lv2PlayerLooked.find(lp => lp.id === p.id)))\n\n  const unImportantPlayers = players.filter(p => !lv2Players.find(lv2 => lv2.id === p.id) && !lv1Players.find(lv1 => lv1.id === p.id))\n\n  // mask get fg\n  internalCanvas.width = width\n  internalCanvas.height = height\n  internalCtx.save()\n  internalCtx.drawImage(mask, 0, 0)\n  internalCtx.globalCompositeOperation = 'source-in'\n  internalCtx.drawImage(frame, 0, 0)\n  internalCtx.restore()\n\n  // draw fg with mask\n  // ctx.save()\n  ctx.drawImage(internalCanvas, 0, 0)\n  // ctx.globalCompositeOperation = 'source-atop'\n  // ctx.fillStyle = `rgba(0, 0, 0, ${COLORS.FG_MASK_ALPHA})`\n  // ctx.fillRect(0, 0, width, height);\n  // ctx.restore()\n\n  // focus mask\n  if (focus) {\n    const { pos } = focus\n    ctx.save()\n    const grd = ctx.createRadialGradient(pos.x, pos.y, FOCUS.min, pos.x, pos.y, FOCUS.max);\n    grd.addColorStop(0, `rgba(0, 0, 0, ${FOCUS.mina})`);\n    grd.addColorStop(1, `rgba(0, 0, 0, ${FOCUS.maxa})`);\n    ctx.fillStyle = grd;\n    ctx.globalCompositeOperation = 'source-atop'\n    ctx.fillRect(0, 0, width, height);\n    ctx.restore()\n\n    //unimportant players\n    ctx.save()\n    unImportantPlayers.forEach(p => {\n      const { x, y, w, h } = p.bbox\n      ctx.drawImage(internalCtx.canvas,\n        x, y, w, h,\n        x, y, w, h)\n    })\n    ctx.fillStyle = `rgba(0, 0, 0, ${COLORS.FG_MASK_ALPHA})`\n    ctx.globalCompositeOperation = 'source-atop'\n    ctx.fillRect(0, 0, width, height);\n    ctx.restore()\n  }\n\n  // need this for the focus mask\n  // basic hilight, full bright\n  lv2PlayerNotLooked.forEach(player => {\n    const { x, y, w, h } = player.bbox\n    ctx.drawImage(internalCtx.canvas,\n      x, y, w, h,\n      x, y, w, h)\n  })\n\n  // only looked, will show glow\n  ctx.save()\n  ctx.shadowColor = 'rgba(255, 255, 255, 0.5)';\n  lv2PlayerLooked\n    .forEach(player => {\n      const { x, y, w, h } = player.bbox\n      ctx.shadowBlur = player.on ? 10 : 40 * (player.att ?? 0 - LV_INTEREST_THRESHOLD.off);\n      ctx.drawImage(internalCtx.canvas,\n        x, y, w, h,\n        x, y, w, h)\n    })\n  ctx.restore()\n\n  // spot light \n  lv1Players\n    ?.forEach(player => {\n      const { progress: frames } = player.last\n      const { x, y, w, h } = player.bbox\n      let r1 = player.type === KeyPlayerType.EMPTY_PLAYER\n        ? 30\n        : player.type === KeyPlayerType.STAR\n          ? 30\n          : 20\n\n      // full bright image\n      ctx.drawImage(internalCtx.canvas,\n        x, y, w, h,\n        x, y, w, h)\n\n      _draw.cone(ctx,\n        {\n          x: x + w * 0.5,\n          y: y + h,\n          r: 50 * (frames / 6),\n          r1: r1 * (frames / 6),\n          h: player.type === KeyPlayerType.EMPTY_PLAYER\n            ? 800\n            : player.type === KeyPlayerType.STAR\n              ? 800\n              : 1000\n        },\n        {\n          lineWidth: 1, strokeStyle: \"rgba(220, 220, 220, 0.05)\",\n          fillStyle: player.type === KeyPlayerType.EMPTY_PLAYER\n            ? 'rgba(50, 220, 128, 0.1)'\n            : player.type === KeyPlayerType.STAR\n              ? 'rgba(255,215,120, 0.08)'\n              : 'rgba(220, 220, 220, 0.1)',\n          lineCap: 'round', lineJoin: 'round'\n        }\n      )\n    })\n}\n\n/**\n * For draw star\n */\nfunction rotate2D(vecArr: Array<[number, number]>, byRads: number) {\n  const mat = [\n    [Math.cos(byRads), -Math.sin(byRads)],\n    [Math.sin(byRads), Math.cos(byRads)]\n  ];\n  const result: Array<[number, number]> = [];\n  for (let i = 0; i < vecArr.length; ++i) {\n    result[i] = [\n      mat[0][0] * vecArr[i][0] + mat[0][1] * vecArr[i][1],\n      mat[1][0] * vecArr[i][0] + mat[1][1] * vecArr[i][1]\n    ];\n  }\n  return result;\n}\n\nfunction generateStarTriangles(numPoints: number, r: number) {\n  const triangleBase = r * Math.tan(Math.PI / numPoints);\n  // console.log(\"Base: \" + triangleBase);\n  const triangle: Array<[number, number]> = [\n    [0, r],\n    [triangleBase / 2, 0],\n    [-triangleBase / 2, 0], [0, r]\n  ];\n  const result = [];\n  for (let i = 0; i < numPoints; ++i) {\n    result[i] = rotate2D(triangle, i * (2 * Math.PI / numPoints));\n  }\n  return result;\n}\n\nfunction drawStar(ctx: CanvasRenderingContext2D, r: number, offset: [number, number], flipVert: boolean) {\n  const sign = flipVert ? -1 : 1;\n  const obj = generateStarTriangles(5, r);\n\n  ctx.save()\n  ctx.fillStyle = COLORS.star_star\n  for (let objIdx = 0; objIdx < obj.length; ++objIdx) {\n    const elem = obj[objIdx];\n    ctx.moveTo(elem[0][0] + offset[0], sign * elem[0][1] + offset[1]);\n    ctx.beginPath();\n    for (let vert = 1; vert < elem.length; ++vert) {\n      ctx.lineTo(elem[vert][0] + offset[0], sign * elem[vert][1] + offset[1]);\n    }\n    ctx.fill();\n  }\n  ctx.beginPath()\n  ctx.arc(offset[0], offset[1], r, 0, 2 * Math.PI)\n  ctx.strokeStyle = COLORS.star_star\n  ctx.stroke()\n  ctx.restore()\n}\n\n\nconst shooterIcon = new Image()\nshooterIcon.src = `${process.env.PUBLIC_URL}/shooter.png`\nconst defenderIcon = new Image()\ndefenderIcon.src = `${process.env.PUBLIC_URL}/defender.png`\nconst starIcon = new Image()\nstarIcon.src = `${process.env.PUBLIC_URL}/star.png`\nconst ICONS = {\n  shooter: shooterIcon,\n  defender: defenderIcon,\n  star: starIcon\n}\n\n\n// shooterIcon.style.filter = `invert(80%) sepia(77%) saturate(366%) hue-rotate(328deg) brightness(102%) contrast(101%);`\nfunction drawIcon(ctx: CanvasRenderingContext2D, iconHeight: number, offset: [number, number], icon: keyof typeof ICONS) {\n  if (icon === 'star') {\n    //   drawStar(ctx, iconHeight / 2, offset, true)\n    drawIcon(ctx, iconHeight, [offset[0] - iconHeight, offset[1]], 'shooter')\n    drawIcon(ctx, iconHeight, offset, 'defender')\n  } else {\n    const iconWidth = iconHeight * ICONS[icon].width / ICONS[icon].height\n    internalCanvas.width = iconWidth\n    internalCanvas.height = iconHeight\n    internalCtx.save()\n    internalCtx.drawImage(ICONS[icon],\n      0, 0, ICONS[icon].width, ICONS[icon].height,\n      0, 0, iconWidth, iconHeight)\n    internalCtx.globalCompositeOperation = 'source-in'\n    internalCtx.fillStyle = COLORS.star_star\n    internalCtx.fillRect(0, 0, iconWidth, iconHeight)\n    internalCtx.restore()\n    ctx.drawImage(internalCanvas, offset[0] - iconWidth * 0.5, offset[1] - iconHeight * 0.5)\n  }\n}\n\nfunction drawName(ctx: CanvasRenderingContext2D, player?: Player) {\n  if (!player) return\n\n  const { id, namePos } = player\n  const textheight = 18\n  const lastname = PLAYER_META[id].ln\n\n  ctx.save()\n  ctx.fillStyle = PLAYER_META[id].star ? COLORS.star_name : COLORS.player_name\n  ctx.font = `bold ${textheight}px Arial`;\n  ctx.textAlign = \"center\";\n  const textwidth = ctx.measureText(lastname).width\n  const x = PLAYER_META[id].star === 'star' ? namePos.x + textheight / 2 : namePos.x\n  ctx.fillText(lastname, x, namePos.y)\n  ctx.restore()\n\n  if (PLAYER_META[id].star) {\n    const starR = Math.floor(textheight / 2) - 1\n    const starPadding = 5\n    const iconHeight = textheight\n    drawIcon(ctx, iconHeight, [\n      x - (textwidth + starR) * 0.5 - starPadding,\n      namePos.y - textheight / 2 + 2],\n      PLAYER_META[id].star as any)\n  }\n}\n\nexport {\n  // drawFG as fg,\n\n  drawVisCircles as circles,\n  drawVisSheilds as sheilds,\n  drawHL as HL,\n  drawVis as Vis,\n  drawStar as Star,\n  drawName as Name,\n}","import \"./style.scss\"\nimport React from 'react'\n\nimport { Layer } from 'common/@types'\nimport {\n  Attentions,\n  DefensivePkg,\n  Gaze, KeyPlayer,\n  Lv2Player, Lv2PlayerType, OffensivePkg, PLAYER_STATUS,\n  PlayerID, Player,\n  Video\n} from '@types'\n\nimport * as _draw from 'common/@draw'\nimport * as draw from './visualizeData'\nimport { videoEnv } from '../../App'\nimport { VisCircle, VisSheild } from \"./visualizeData\"\nimport { PLAYER_META, PLAYER_RANDOM_FACTOR } from \"@const\"\nimport { params } from \"param\"\n\nconst layerIds = ['0_bg', '1_vis', '2_fg', '3_annot', '4_debug'] as const\n\n// 0bg --> raw frame\n// 1vis --> vis\n// 2fg --> fg + dark mask\n// 3annot --> highlighted players\n\nexport type LayerId = typeof layerIds[number]\n\ninterface Props {\n  currentVideo: Video\n  currentFrameIdx: number\n  currentFrame?: HTMLVideoElement\n  // currentFrameData?: Frame\n\n  gaze?: Gaze\n  attentions?: Attentions\n  gazePlayers?: Player[]\n\n  onPickPlayers?: (fIdx: number, lv1Players: Record<PlayerID, KeyPlayer>, lv2Players: Record<PlayerID, Lv2Player>) => void\n}\n\nexport class Visualizer extends React.Component<Props, {}> {\n\n  public readonly layers: Record<LayerId, Layer | null> = layerIds.reduce((o, l) => {\n    o[l] = null\n    return o\n  }, {} as Record<LayerId, Layer | null>)\n\n  get2DPos(id: PlayerID, players: Player[]) {\n    const { bbox, keypoints } = players?.find(p => p.id === id)!\n    const team = PLAYER_META[id].team\n    const { y, h } = bbox\n    const { left_hip, right_hip, left_ankle, right_ankle } = keypoints\n\n    // calculate cx and cy\n    const cx = (left_hip.x + right_hip.x) / 2\n    const cy = (y + h + Math.max(left_ankle.y, right_ankle.y)) / 2\n\n    return { cx, cy, team }\n  }\n\n  isOnLv2Player = (p: Player, lv2Players: Record<PlayerID, Lv2Player>) => p.id in lv2Players\n    && (\n      (lv2Players[p.id].type.has(Lv2PlayerType.Interest) && lv2Players[p.id].on)\n      || lv2Players[p.id].type.has(Lv2PlayerType.Normal)\n      // || lv2Players[p.id].type === Lv2PlayerType.Normal_Interest\n    )\n\n  async componentDidUpdate(preProps: Props) {\n    if (preProps.currentFrameIdx !== this.props.currentFrameIdx) {\n      const {\n        currentFrameIdx,\n        currentVideo,\n        currentFrame,\n        // currentFrameData,\n      } = this.props\n      if (!currentFrame) return\n\n      this.cleanAllExcept('0_bg')\n      _draw.bg(this.layers['0_bg']!, currentFrame)\n      // dark overlay\n      _draw.overlay(this.layers['1_vis']!, 0.18)\n      if (currentVideo.isTransit || params.MODE === 'RAW') return\n\n      const currentFrameData = videoEnv.frames?.[currentFrameIdx]\n      if (!currentFrameData) return\n\n      const { players, ball } = currentFrameData\n      if (!players) return\n\n      // // Step1. detect the players to show\n      const focus = params.LV_FOCUS ? videoEnv.fetchFocus() : undefined\n      const { lv1Players, lv2Players } = videoEnv.pickPlayers(currentFrameIdx, focus)\n      if (!lv1Players && !lv2Players) return\n\n      // DEBUG.TIMELINE && this.props.onPickPlayers?.(currentFrameIdx, lv1Players, lv2Players)\n\n      // Step2 Decide the data to show for each player\n      const dataToVis = players!.filter(p => this.isOnLv2Player(p, lv2Players))\n\n      // Step3 Visualization & Render\n      const offensiveRings: VisCircle[] = dataToVis\n        .filter(p => p.dataPkg?.mode === PLAYER_STATUS.offensive)\n        .map(({ dataPkg, id }) => {\n          // console.log('Offensive circle', id, PLAYER_META[id].ln)\n          let { smoothRegionExp, inOffsensiveCourt } = dataPkg as OffensivePkg\n          const { cx, cy } = this.get2DPos(id, players)\n\n          if (params.UNIT_ID === 'unit0') {\n            smoothRegionExp = PLAYER_RANDOM_FACTOR[id] * 2\n          }\n          const fill = videoEnv.scales.regionExp(smoothRegionExp)\n          return { cx, cy, fill, size: Math.min(1, smoothRegionExp / 2), inOffsensiveCourt }\n        })\n\n      const defensiveSheilds: VisSheild[] = dataToVis\n        .filter(p => p.dataPkg?.mode === PLAYER_STATUS.defensive)\n        .map(({ dataPkg, id }) => {\n          let { diff, speed, tangle, tdist, defendingPlayer, smoothDFdiff } = dataPkg as DefensivePkg\n          const { cx, cy } = this.get2DPos(id, players)\n          const { cx: dx, cy: dy } = this.get2DPos(defendingPlayer, players)\n\n          if (params.UNIT_ID === 'unit0') {\n            smoothDFdiff = PLAYER_RANDOM_FACTOR[id]\n          }\n\n          return {\n            cx, cy,\n            dx, dy,\n            diff, tangle, tdist,\n            smoothDFdiff,\n            speed,\n          }\n        })\n      draw.Vis(this.layers['1_vis']!.ctx, offensiveRings, defensiveSheilds, this.layers['4_debug']?.ctx)\n\n      // draw fg\n      // draw.fg(this.layers['2_fg']?.ctx!, this.layers['0_bg']!.canvas, currentFrameData.mask!)\n      draw.HL(this.layers['3_annot']?.ctx!, this.layers['0_bg']!.canvas, currentFrameData.mask!,\n        players,\n        players?.filter(p => p.id in lv1Players)\n          .map(p => ({ ...p, ...lv1Players[p.id] })),\n        players.filter(p => p.id in lv2Players)\n          .map(p => ({ ...p, ...lv2Players[p.id] })),\n        ball?.playerId,\n        focus\n      )\n\n      // 3. text annotations\n      draw.Name(this.layers['3_annot']?.ctx!, players.find(p => p.id === ball?.playerId))\n      // only on, will show the name\n      Object.values(lv2Players)\n        .filter(p => p.type.has(Lv2PlayerType.Interest) && p.on)\n        .forEach(ip => {\n          draw.Name(this.layers['3_annot']?.ctx!, players.find(p => p.id === ip.id))\n        })\n    }\n  }\n\n  render() {\n    const { currentVideo } = this.props\n    const { width = 0, height = 0 } = currentVideo ?? {}\n\n    return (<div className='visualizationContainer'\n\n      style={{\n        marginLeft: '30px',\n        justifyContent: 'center' //DEBUG ? 'flex-start' : 'center'\n      }}\n    >\n      <div id=\"canvasWrapper\" className=\"canvasWrapper\">\n        <img alt=\"www\" src=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\"\n          style={{ height: `${width / height * 100}%` }}\n        ></img>\n        {layerIds.map((l, idx) =>\n          <canvas id={l}\n            key={idx}\n            width={width}\n            height={height}\n            ref={ref => {\n              if (!ref) return\n              this.layers[l] = { canvas: ref, ctx: ref.getContext('2d')! }\n            }}\n          />)}\n        {this.props.children}\n      </div>\n    </div>)\n  }\n\n  public cleanAllExcept(layerId: LayerId) {\n    Object.keys(this.layers)\n      .filter(lId => lId !== layerId)\n      .forEach((lId) => {\n        const l = this.layers[lId as LayerId]\n        l?.ctx.clearRect(0, 0, l.canvas.width, l.canvas.height)\n      })\n  }\n}","import { useEffect, useRef } from \"react\";\n\nimport { axisBottom, axisLeft } from \"d3-axis\";\nimport { ScaleBand, scaleBand, ScaleLinear, scaleLinear } from \"d3-scale\";\nimport { select } from 'd3-selection'\nimport { line, curveMonotoneX } from 'd3-shape'\n\nimport { extent } from \"common/@utils\";\ninterface AxisBottomProps {\n  scale: ScaleBand<string> | ScaleLinear<number, number>;\n  transform: string;\n}\n\nexport function AxisBottom({ scale, transform }: AxisBottomProps) {\n  const ref = useRef<SVGGElement>(null);\n\n  useEffect(() => {\n    if (ref.current) {\n      select(ref.current).call(axisBottom(scale as any));\n    }\n  }, [scale]);\n\n  return <g ref={ref} transform={transform} />;\n}\n\nexport interface AxisLeftProps {\n  scale: ScaleLinear<number, number, never>;\n}\n\nfunction AxisLeft({ scale }: AxisLeftProps) {\n  const ref = useRef<SVGGElement>(null);\n\n  useEffect(() => {\n    if (ref.current) {\n      select(ref.current).call(axisLeft(scale));\n    }\n  }, [scale]);\n\n  return <g ref={ref} />;\n}\n\ninterface ChartProps {\n  width?: number\n  height?: number\n}\n\ninterface BarChartProps extends ChartProps {\n  fixY?: boolean\n  maxY?: number\n  data: Array<{ id: string, value: number, fill: string }>\n}\n\nexport function BarChart({ fixY: normalizeY = false, maxY = 1, data = [], width: w = 400, height: h = 200 }: BarChartProps) {\n\n  const margin = { top: 10, right: 10, bottom: 20, left: 50 };\n  const width = w - margin.left - margin.right;\n  const height = h - margin.top - margin.bottom;\n\n  const scaleX = scaleBand()\n    .domain(new Set(data.map(d => d.id)))\n    .range([0, width]);\n\n  const scaleY = scaleLinear()\n    .domain([0, normalizeY ? maxY : Math.max(...data.map(d => d.value))])\n    .range([height, 0]);\n  return <svg\n    width={width + margin.left + margin.right}\n    height={height + margin.top + margin.bottom}\n  >\n    <g transform={`translate(${margin.left}, ${margin.top})`}>\n      <AxisBottom scale={scaleX} transform={`translate(0, ${height})`} />\n      <AxisLeft scale={scaleY} />\n\n      {data\n        .map(({ id, value, fill }, idx) => (\n          <rect\n            key={`${id}_${idx}`}\n            x={scaleX(id)}\n            y={scaleY(value)}\n            width={scaleX.bandwidth()}\n            height={height - scaleY(value)}\n            fill={fill}\n          // fill={value.on ? \"teal\" : \"lightpink\"}\n          />\n        ))}\n\n    </g>\n  </svg>\n}\n\n\ninterface LineChartProps extends ChartProps {\n  data: Array<{ fIdx: number, videoIdx: number, value: number }>\n}\n\nexport function LineChart({ data, width: w = 400, height: h = 200 }: LineChartProps) {\n\n  const margin = { top: 10, right: 10, bottom: 20, left: 50 };\n  const width = w - margin.left - margin.right;\n  const height = h - margin.top - margin.bottom;\n\n  const [minFIdx, maxFIdx] = extent(data.map(d => d.fIdx))\n\n  const videos = Object.entries(data.reduce((o, d) => {\n    if (!(d.videoIdx in o)) o[d.videoIdx] = []\n    o[d.videoIdx].push(d.fIdx)\n    return o\n  }, {} as Record<number, number[]>))\n    .sort((a, b) => +a[0] - +b[0])\n    .map(([_, fIdxs]) => {\n      const [minIdx, maxIdx] = extent(fIdxs)\n      return { x: minIdx, w: maxIdx - minIdx }\n    })\n\n  // merge data points\n  const points = Object.values(\n    data.reduce((o, d) => {\n      const key = `${d.fIdx}_${d.value}`\n      if(!(key in o)) o[key] = d\n      return o\n    }, {} as Record<string, any>)\n  )\n\n  const scaleX = scaleLinear()\n    .domain([minFIdx, maxFIdx])\n    .range([0, width]);\n\n  const scaleY = scaleLinear()\n    .domain([0, 0.6])\n    .range([height, 0]);\n\n  const lineGenerator = line<{ fIdx: number, value: number }>()\n    .x(d => scaleX(d.fIdx))\n    .y(d => scaleY(d.value))\n    .curve(curveMonotoneX);\n\n  return <svg\n    width={width + margin.left + margin.right}\n    height={height + margin.top + margin.bottom}\n  >\n    <g transform={`translate(${margin.left}, ${margin.top})`}>\n      <AxisBottom scale={scaleX} transform={`translate(0, ${height})`} />\n      <AxisLeft scale={scaleY} />\n\n      {videos.map(({ x, w }, idx) => <rect\n        key={`${idx}`}\n        x={scaleX(x)}\n        y={scaleY(0.6)}\n        width={scaleX(w)}\n        height={height - scaleY(0.6)}\n        fill={'rgba(30, 30, 30, 0.1)'}\n      />\n      )}\n\n      <path\n        stroke=\"black\"\n        strokeWidth={2}\n        fill=\"none\"\n        d={lineGenerator(points) ?? ''}\n      >\n      </path>\n    </g>\n  </svg>\n}","import React from \"react\";\nimport clsx from 'clsx';\n\nimport { Interval as TInterval } from '../../@types'\n\ntype Direction = 'e' | 'w'\n\ninterface Props extends TInterval {\n  id: number\n  focused: boolean\n  initializing: boolean\n  x: number\n  w: number\n  style?: React.CSSProperties\n  onMoving: (id: number, updateInterval: { x: number, w: number }) => void\n  onAdjusting: (id: number, updateInterval: { x: number, w: number }) => void\n  onAdjustingEnd: (id: number, resizeIntervalEnd: { x: number, w: number }, end_?: boolean) => void\n  getEW: (id: number) => { ex: number, wx: number } | undefined\n  onClickInterval: (id: number) => void\n}\n\ninterface State {\n  isMoving: { ox: number } | null\n  isAdjusting: {\n    direction: Direction,\n    oBBox: { x: number, w: number },\n    ox: number\n  } | null\n  cursorStatus: 'movable' | 'resizable' | null\n}\n\nexport class Interval extends React.Component<Props, State> {\n\n  state: State = {\n    isMoving: null,\n    isAdjusting: null,\n    cursorStatus: null, //鼠标指针状态\n  }\n\n  componentDidMount() {\n    window.addEventListener('mousemove', this.onMoving)\n    window.addEventListener('mouseup', this.onMoveEnd)\n    window.addEventListener('mousemove', this.onResizing)\n    window.addEventListener('mouseup', this.onResizeEnd)\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('mousemove', this.onMoving)\n    window.removeEventListener('mouseup', this.onMoveEnd)\n    window.removeEventListener('mousemove', this.onResizing)\n    window.removeEventListener('mouseup', this.onResizeEnd)\n  }\n\n  /** Resizing the bbox */\n  onResizeStart = (e: React.MouseEvent<HTMLDivElement, MouseEvent>, direction: Direction) => {\n    if (e.button !== 0) return\n    e.stopPropagation()\n    const { x, w } = this.props\n    // 全局坐标\n    const mx = e.clientX\n\n    this.setState({\n      isAdjusting: {\n        direction,\n        oBBox: { x, w },\n        ox: mx // 记录初始鼠标位置, 全局坐标\n      },\n      cursorStatus: 'resizable'\n    })\n    document.body.classList.add('adjusting', direction)\n  }\n\n  onResizing = (e: MouseEvent) => {\n    const { isAdjusting } = this.state\n    if (isAdjusting === null || e.button !== 0) return\n    e.preventDefault()\n    e.stopImmediatePropagation()\n\n    let { x, w, id } = this.props\n    const { direction, oBBox, ox } = isAdjusting\n    const mx = e.clientX\n    const dx = mx - ox\n\n    const { wx, ex } = this.props.getEW(id)!\n    switch (direction) {\n      case 'w':\n        // 如果在左, 更新x和w\n        x = Math.min(oBBox.x + oBBox.w, oBBox.x + dx) // 上限为原来的右边\n        x = Math.max(wx, x) // 下限\n        w = Math.min(oBBox.x + oBBox.w - wx, oBBox.w - dx)   // 上限\n        w = Math.max(0, w) // 下限\n        break\n      case 'e':\n        // 如果在右, 只更新w, 下限为0\n        w = Math.max(0, oBBox.w + dx)\n        w = Math.min(ex - x, w)  // 上限\n        break\n    }\n\n    this.props.onAdjusting?.(this.props.id, { x, w })\n  }\n\n  onResizeEnd = (e: MouseEvent) => {\n    const { isAdjusting } = this.state\n    if (isAdjusting === null || e.button !== 0) return\n    e.preventDefault()\n    e.stopImmediatePropagation()\n\n    let { x, w, id } = this.props\n    this.props.onAdjustingEnd?.(id, { x, w }, true)\n\n    this.setState({\n      isAdjusting: null\n    })\n    document.body.classList.remove('adjusting', 'w', 'e', 's', 'n')\n  }\n\n  /** Dragging the bbox */\n  onMoveStart = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    // not left click\n    if (e.button !== 0) return\n    e.stopPropagation()\n    e.preventDefault()\n\n    const { x } = this.props\n    const mx = e.clientX;\n    this.setState({\n      isMoving: { ox: mx - x },\n      cursorStatus: 'movable'\n    })\n  }\n\n  onMoving = (e: MouseEvent) => {\n    const { isMoving } = this.state\n    if (isMoving === null) return\n    e.preventDefault()\n    e.stopImmediatePropagation()\n\n    const mx = e.clientX\n    let { w, id } = this.props\n    const { wx, ex } = this.props.getEW(id)!\n    let newx = Math.max(wx, mx - isMoving.ox)\n    newx = Math.min(newx, ex - w)\n\n    this.props.onMoving?.(this.props.id, { x: newx, w })\n  }\n\n  onMoveEnd = (e: MouseEvent) => {\n    const { isMoving } = this.state\n    if (isMoving === null || e.button !== 0) return\n    e.preventDefault()\n    e.stopImmediatePropagation()\n\n    this.setState({ isMoving: null })\n  }\n\n  render() {\n    const { x, w, focused, initializing, style = {} } = this.props\n    const { isAdjusting, isMoving, cursorStatus } = this.state\n    return <div className={clsx('interval-container', { focused })}\n      style={{ left: x }}\n    >\n      <div\n        className={clsx('interval', cursorStatus)}\n        style={{ width: w, ...style }}\n        onMouseDown={e => {\n          const parentDim = e.currentTarget.parentElement!.getBoundingClientRect()\n          // local coordinate\n          const mx = e.clientX - parentDim.x\n\n          // detect if left or right edge\n          if (Math.abs(mx) < 3) {\n            this.onResizeStart(e, 'w')\n          } else if (Math.abs(mx - w) < 3) {\n            this.onResizeStart(e, 'e')\n          } else {\n            // not on the edge\n            this.onMoveStart(e)\n          }\n        }}\n        onMouseMove={e => {\n          if (isAdjusting || isMoving) return\n          // icon for the cursor status\n          const { w } = this.props\n          const parentDim = e.currentTarget.parentElement!.getBoundingClientRect()\n          // local coordinate in parent\n          const mx = e.clientX - parentDim.x\n\n          // detect if left or right edge\n          if (Math.abs(mx) < 3 || Math.abs(mx - w) < 3) {\n            this.setState({ cursorStatus: 'resizable' })\n          } else {\n            // not on the edge\n            this.setState({ cursorStatus: 'movable' })\n          }\n        }}\n        onClick={e => this.props.onClickInterval(this.props.id)}\n      >\n      </div>\n    </div>\n  }\n}","import \"./style.scss\";\nimport React from \"react\";\n\nimport { Interval, Clip, BaseVideo } from '../../@types'\nimport { intervalIdGen, localFIdxToGlobalFIdx } from '../../@utils'\n\nimport { Interval as CInterval } from './Interval'\n\nfunction pad(num: number) {\n  return (\"0\" + num).slice(-2);\n}\nfunction hhmmss(secs: number) {\n  const t = Math.floor(secs * 1000);\n  // const ms = t % 1000;\n  secs = Math.floor(t / 1000);\n  let minutes = Math.floor(secs / 60);\n  secs = secs % 60;\n  minutes = minutes % 60;\n  return `${pad(minutes)}:${pad(secs)}`;\n}\n\ninterface BaseProps<GameID extends string, VideoID extends string> {\n  mode?: 'S' | 'M' | 'L'\n\n  videos: BaseVideo<GameID, VideoID>[];\n  currentVideoIdx: number;\n  currentFrameIdx: number\n\n  // style\n  containerHeightPadding?: number\n\n  // encodedData?: TDataOption[]\n  children?: (globalTrackWidth: number, globalMaxFrames: number) => React.ReactNode\n  onClickInterval?: (clipId: number, globalFrameIdx: number) => void;  // 给父组件上传起止帧\n}\n\nexport type TimelineProps<GameID extends string, VideoID extends string> = BaseProps<GameID, VideoID> & ({\n  enableClips: false\n} | {\n  enableClips: true\n  clips: Clip<VideoID>[]\n  focusedClipId: number\n\n  onUpsertClip?: (id: number, interval: Partial<Interval> | null) => void\n})\n\n// interface xProps {\n  // showEvents: boolean\n  // handlers\n  // onParse: (id: number, rawtext: string, visFunc: (entities: Entity[]) => void) => void\n  // onChangeText?: (id: number, rawtext: string) => void\n// }\n\ninterface State {\n  isDrawing: { intervalId: number, ox: number, omx: number } | null;  // omx: 全局用于dx ox: 本地坐标系\n}\n\nexport class Timeline<GameID extends string, VideoID extends string> extends React.Component<TimelineProps<GameID, VideoID>, State> {\n\n  get globalMaxFrames() { return this.props.videos.reduce((o, v) => o + v.maxFrame, -1) }\n  get trackWidthFactor() {\n    return this.globalMaxFrames < 500 ? 4 : 1\n  }\n  get totalTrackWidth() {\n    return this.globalMaxFrames * this.trackWidthFactor\n  }\n  get globalCurFrameIdx() {\n    const { currentFrameIdx, currentVideoIdx, videos } = this.props\n    return localFIdxToGlobalFIdx(currentVideoIdx, currentFrameIdx, videos)\n  }\n  get maxTime() { return this.props.videos.reduce((o, v) => o + v.maxFrame / v.frameRate, 0) }\n  get numberOfImg() { return Math.ceil(this.maxTime) * 2 }\n  get intervalSelectorHeight() {\n    const { mode = 'M' } = this.props\n    return mode === 'M'\n      ? 60\n      : mode === 'S'\n        ? 30\n        : 90\n  }\n  get containerHeight() {\n    const { containerHeightPadding = 60 } = this.props\n    return this.intervalSelectorHeight + containerHeightPadding\n  }\n\n  #pointer = React.createRef<HTMLDivElement>()\n  imgWidth = (this.intervalSelectorHeight * 1920) / 1080\n  parentOffsetx: number = 0\n  state: State = {\n    isDrawing: null,\n  }\n\n  canvas?: HTMLCanvasElement\n  ctx?: CanvasRenderingContext2D\n\n  componentDidMount() {\n    const { enableClips } = this.props\n\n    if (enableClips) {\n      window.addEventListener('mousemove', this.onDrawing)\n      window.addEventListener('mouseup', this.onDrawEnd)\n    }\n  }\n\n  componentDidUpdate(prevProps: Readonly<TimelineProps<GameID, VideoID>>): void {\n    if (prevProps.currentFrameIdx !== this.props.currentFrameIdx) {\n      if (this.#pointer.current) {\n        const bbox = this.#pointer.current.getBoundingClientRect()\n        if (bbox.left > (window.innerWidth || document.documentElement.clientWidth) || bbox.right < 0) {\n          this.#pointer.current.scrollIntoView({ behavior: \"smooth\", block: \"nearest\", inline: \"center\" })\n        }\n        // ;(this.#pointer.current as any).scrollIntoViewIfNeeded(true)\n      }\n    }\n\n    // const { pickedPlayers } = this.props\n    // if (Object.keys(preProps.pickedPlayers).length < Object.keys(pickedPlayers).length) {\n    //   const { ctx, globalCurFrameIdx } = this\n    //   const maxFIdx = Math.max(...Object.keys(pickedPlayers).map(f => +f))\n    //   const { lv1Players, lv2Players } = pickedPlayers[maxFIdx]\n    //   const maxY = 40\n\n    //   const playersOn = Object.values(lv2Players).filter(p => p.on)\n    //   let y1 = maxY - playersOn.length * 5\n    //   ctx!.lineWidth = 1\n    //   ctx!.strokeStyle = 'red'\n    //   ctx!.beginPath()\n    //   ctx?.moveTo(globalCurFrameIdx, y1)\n    //   ctx?.lineTo(globalCurFrameIdx, maxY)\n    //   ctx!.stroke()\n\n    //   const lv1NotOnNotEmpty = Object.keys(lv1Players)\n    //     .filter(pId => !playersOn.find(p => p.id === +pId) && lv1Players[+pId as PlayerId].type !== KeyPlayerType.EMPTY_PLAYER)\n    //   ctx!.strokeStyle = '#f5f5f5'\n    //   let y2 = y1 - lv1NotOnNotEmpty.length * 5\n    //   ctx?.beginPath()\n    //   ctx?.moveTo(globalCurFrameIdx, y2)\n    //   ctx?.lineTo(globalCurFrameIdx, y1)\n    //   ctx!.stroke()\n\n\n    //   const lv1NotOnEmpty = Object.keys(lv1Players)\n    //     .filter(pId => !playersOn.find(p => p.id === +pId) && lv1Players[+pId as PlayerId].type === KeyPlayerType.EMPTY_PLAYER)\n    //   ctx!.strokeStyle = '#f5f5f5'\n    //   let y3 = y2 - lv1NotOnEmpty.length * 5\n    //   ctx?.beginPath()\n    //   ctx?.moveTo(globalCurFrameIdx, y3)\n    //   ctx?.lineTo(globalCurFrameIdx, y2)\n    //   ctx!.stroke()\n    // }\n\n\n    // const { ctx } = this\n    // if (prevProps.videos.length !== this.props.videos.length && ctx) {\n    //   ctx!.lineWidth = 1\n    //   ctx!.strokeStyle = 'green'\n    //   ctx!.beginPath()\n    //   ctx?.moveTo(0, 40 - 5 * 3)\n    //   ctx?.lineTo(this.totalTrackWidth, 40 - 5 * 3)\n    //   ctx!.stroke()\n\n    //   ctx!.beginPath()\n    //   ctx?.moveTo(0, 40 - 5 * 4)\n    //   ctx?.lineTo(this.totalTrackWidth, 40 - 5 * 4)\n    //   ctx!.stroke()\n    // }\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('mousemove', this.onDrawing)\n    window.removeEventListener('mouseup', this.onDrawEnd)\n  }\n\n  /** Draw interval */\n  onDrawStart = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    if (e.button !== 0) return;\n\n    const parentDim = e.currentTarget.parentElement!.getBoundingClientRect()\n    this.parentOffsetx = -parentDim.x + e.currentTarget.scrollLeft\n    const mx = e.clientX // 鼠标点击位置, 全局坐标系\n    const ox = mx + this.parentOffsetx // interval初始位置, 本地坐标系\n\n    // click on progressbar\n    if (e.clientY >= parentDim.bottom - 8) return\n\n    if (!this.props.enableClips) {\n      const globalFrameIdx = this.pos2frame(ox)\n      this.props.onClickInterval?.(-1, globalFrameIdx)\n    } else {\n      const { clips } = this.props\n      // if click within an interval\n      if (clips.find(i => this.frame2pos(i.interval.start) <= ox && ox <= this.frame2pos(i.interval.end))) {\n        const curFrame = this.pos2frame(ox)\n        this.props.onClickInterval?.(-1, curFrame)\n      } else {\n        // 获取一个新的id\n        const newIntervalId = intervalIdGen()\n        // 新建一个interval 维护interval起始点从小到大\n        let i = 0;\n        for (; i < clips.length; i++) {\n          if (this.frame2pos(clips[i].interval.start) > ox) {\n            break;\n          }\n        }\n\n        const startFrame = this.pos2frame(ox)\n        const endFrame = this.pos2frame(ox + 0)\n        const newInterval: Interval = {\n          // x: ox,\n          // w: 0,\n          start: startFrame,\n          end: endFrame\n        }\n        this.props.onUpsertClip?.(newIntervalId, newInterval)\n\n        this.setState({\n          isDrawing: { intervalId: newIntervalId, omx: mx, ox: ox },\n        })\n      }\n    }\n  }\n\n  onDrawing = (e: MouseEvent) => {\n    const { isDrawing } = this.state\n    if (e.button !== 0 || isDrawing === null || !this.props.enableClips) return;\n\n    const { clips } = this.props\n    const mx = e.clientX\n    const drawingInterval = clips.find(int => int.id === isDrawing.intervalId) // 浅复制 指针\n    if(!drawingInterval) return\n\n    // 更新这个interval的x和width\n    let dx = mx - isDrawing.omx // 先获取x方向上的差值\n    // 防止重叠\n    const { wx, ex } = this.getEW(drawingInterval.id)!\n    const maxdx = ex - isDrawing.ox\n    const mindx = wx - isDrawing.ox\n    if (dx < mindx) {\n      dx = mindx\n    } else if (dx > maxdx) {\n      dx = maxdx\n    }\n\n    const startFrame = dx > 0 ? drawingInterval.interval.start : this.pos2frame(Math.max(isDrawing.ox + dx, 0))\n    const w = Math.abs(dx)\n    const endFrame = startFrame + this.pos2frame(w)\n    this.props.onUpsertClip?.(drawingInterval.id, { start: startFrame, end: endFrame })\n  }\n\n  onDrawEnd = (e: MouseEvent) => {\n    const { isDrawing } = this.state\n    if (e.button !== 0 || isDrawing === null || !this.props.enableClips) return\n    const { clips } = this.props\n    const drawingIntervalIdx = clips.findIndex(int => int.id === isDrawing.intervalId)\n    if(drawingIntervalIdx === -1) return\n\n    const drawingInterval = clips[drawingIntervalIdx]\n\n    this.setState({ isDrawing: null })\n    const { start, end } = drawingInterval.interval\n    if (end - start <= 2) {\n      this.props.onUpsertClip?.(drawingInterval.id, null)\n    }\n    this.props.onClickInterval?.(drawingInterval.id, start)\n  }\n\n  updateInterval = (clipId: number, newInterval: { x?: number, w?: number }, end_ = false) => {\n    if (!this.props.enableClips) return\n\n    const { clips } = this.props\n    const targetIntervalIdx = clips.findIndex(int => int.id === clipId)\n    const targetInterval = clips[targetIntervalIdx].interval\n\n    const start = newInterval.x ? this.pos2frame(newInterval.x) : targetInterval.start\n    const end = newInterval.w ? (this.pos2frame(newInterval.w) + start) : targetInterval.end\n\n    this.props.onUpsertClip?.(clipId, ((end - start <= 2) && end_) ? null : { start, end })\n  }\n\n  getEW = (intervalIdx: number) => {\n    if (!this.props.enableClips) return\n\n    const { clips } = this.props\n    const { numberOfImg } = this\n\n    const intervalCount = clips.findIndex(int => int.id === intervalIdx)!\n    let ex = 0, wx = 0\n\n    if (intervalCount === 0) {\n      wx = this.parentOffsetx\n    } else {\n      wx = this.frame2pos(clips[intervalCount - 1].interval.end) + 1\n    }\n\n    if (intervalCount === clips.length - 1) {\n      ex = (this.intervalSelectorHeight * 1920) / 1080 * numberOfImg + this.parentOffsetx\n    } else {\n      ex = this.frame2pos(clips[intervalCount + 1].interval.start) - 1\n    }\n\n    return { wx, ex }\n  }\n\n  pos2frame = (pos: number) => {\n    const { totalTrackWidth: trackWidth, globalMaxFrames: maxFrame } = this\n    return Math.round(Math.min(pos, trackWidth) / trackWidth * maxFrame)\n  }\n  frame2pos = (frame: number) => {\n    const { totalTrackWidth: trackWidth, globalMaxFrames: maxFrame } = this\n    return (frame / maxFrame) * (trackWidth)\n  }\n\n  // renderIndicator() {\n  //   const { events, maxFrame, clips, encodedData = [] } = this.props\n  //   const { imgWidth, numberOfImg } = this\n\n  //   const indicators = []\n  //   for (const clip of clips) {\n  //     const { interval } = clip\n  //     const coverEvents = events.filter(evt => evt.to >= interval.start && evt.from <= interval.end)\n  //     for (const coverEvt of coverEvents) {\n  //       if ((coverEvt?.type === EvtType.PlayerHit || coverEvt?.type === EvtType.PlayerMove)\n  //         && encodedData.some(k => toPause.has(k))) {\n  //         indicators.push(coverEvt)\n  //         break\n  //       }\n  //     }\n  //   }\n\n  //   // render indicators\n  //   return indicators.map(evt => {\n  //     return <div key={`${evt.type}_${evt.from}_${evt.to}`} className={'trigger'} style={{\n  //       left: `${imgWidth * numberOfImg * evt.data.hit! / maxFrame}px`,\n  //     }}>\n\n  //     </div>\n  //   })\n  // }\n\n  renderClips() {\n    if (!this.props.enableClips) return\n    const { clips, focusedClipId } = this.props\n    const { isDrawing } = this.state\n\n    return clips.map(({ id: intervalId, interval }, idx) =>\n      <CInterval\n        key={intervalId}\n        id={intervalId}\n        x={this.frame2pos(interval.start)}\n        w={this.frame2pos(interval.end - interval.start)}\n        style={{ height: `${this.intervalSelectorHeight + 10}px` }}\n        focused={focusedClipId === intervalId}\n        onMoving={this.updateInterval}\n        onAdjusting={this.updateInterval}\n        onAdjustingEnd={this.updateInterval}\n        getEW={this.getEW}\n        initializing={isDrawing?.intervalId === intervalId}\n        onClickInterval={(id) => {\n          this.props.onClickInterval?.(intervalId, interval.start)\n        }}\n        {...interval}\n      />\n    )\n  }\n\n  render() {\n    const { currentFrameIdx, videos } = this.props;\n    const { maxTime, globalMaxFrames: maxFrame, intervalSelectorHeight, globalCurFrameIdx, containerHeight } = this\n\n    const currentTime = currentFrameIdx / (videos[0]?.frameRate ?? 30)\n\n    return (\n      <div className=\"timeline-container\" style={{ flex: `0 0 ${containerHeight}px` }}>\n        <div className=\"timeline\"\n          onMouseDown={this.onDrawStart}>\n          <div className=\"time-info\">\n            <span>\n              {\" \"}\n              {hhmmss(currentTime)} ({currentFrameIdx}) / {hhmmss(maxTime)} ({maxFrame})\n            </span>\n          </div>\n          <div className=\"pointer\" ref={this.#pointer}\n            style={{\n              left: `calc(12px + ${this.frame2pos(globalCurFrameIdx)}px)`,\n            }}\n          ></div>\n\n          <div id=\"timeline-progress\" className=\"track-container\">\n            {videos.map(v => <div\n              key={v.id}\n              className=\"track\"\n              style={{\n                width: `${v.maxFrame * this.trackWidthFactor}px`,\n                height: intervalSelectorHeight,\n                backgroundColor: v.isTransit ? '#515151' : 'rgb(116 99 57)',\n                opacity: ((v.isTransit || v.loadedData === 1) && v.loadedVideo === 1) ? 1 : 0.5\n              }}>\n              <span className=\"video-name\">{v.id}</span>\n              {/* {this.renderIndicator()} */}\n              {this.props.children?.(this.totalTrackWidth, this.globalMaxFrames)}\n            </div>\n            )}\n            {/*<div className=\"track\">\n               {Array(numberOfImg).fill(0)\n                .map((_, idx) => (\n                  <img\n                    alt='bg'\n                    key={`img_${idx}`}\n                    className=\"img\"\n                    src={`/assets/${videoId}/reduced_frames/${Math.floor(\n                      (maxFrame * idx) / numberOfImg\n                    )}.jpg`}\n                    // x={idx * imgWidth}\n                    draggable=\"false\"\n                    height={this.intervalSelectorHeight}\n                    width={imgWidth}\n                  />\n                ))} \n            </div>*/}\n            {this.renderClips()}\n          </div>\n\n          {/* <canvas\n            ref={ref => {\n              if (!ref || this.canvas) return\n              this.canvas = ref\n              this.ctx = ref.getContext('2d')!\n            }}\n            className=\"debug-timeline\"\n            width={`${this.totalTrackWidth}px`}\n            height={`${40}px`}>\n          </canvas> */}\n\n        </div>\n      </div>\n    );\n  }\n}\n","import './style.scss'\nimport React from 'react'\n\nimport type { Ball, Frame, BasePlayer, BaseVideo } from '../../@types'\n\nexport interface SVGLayerProps<GameID extends string, VideoID extends string, PlayerID extends number> {\n  // width: number\n  // height: number\n  currentVideo: BaseVideo<GameID, VideoID>\n  currentFrameData?: Frame<PlayerID>\n  activeBBoxes?: Array<PlayerID | 'ball'>\n\n  // animatedFrameIdx: number\n  onContextMenu?: (e: React.MouseEvent<SVGSVGElement, MouseEvent>) => void\n  onClickBG?: () => void\n  onClickPlayer?: (player: BasePlayer<PlayerID>, idx: number) => void\n  onClickBall?: (ball: Ball) => void\n  onDBClick?: () => void\n}\n\nfunction convertRemToPixels(rem: number) {\n  return rem * parseFloat(getComputedStyle(document.documentElement).fontSize);\n}\n\nexport class SVGLayer<GameID extends string, VideoID extends string, PlayerID extends number> extends React.Component<SVGLayerProps<GameID, VideoID, PlayerID>> {\n\n  render() {\n    const {\n      currentVideo,\n      currentFrameData,\n      activeBBoxes\n    } = this.props\n    const { height = 0, width = 0 } = currentVideo ?? {}\n\n    const players = currentFrameData?.players ?? []\n    const ball = currentFrameData?.ball ?? null\n\n    return <svg className=\"overlay\" height={height} width={width}\n      viewBox={`0 0 ${width} ${height}`}\n      preserveAspectRatio='xMinYMin meet'\n      onClick={(e) => {\n        if (e.target === e.currentTarget)\n          this.props.onClickBG?.()\n      }}\n      onContextMenu={this.props.onContextMenu}\n      onDoubleClick={e => {\n        if (e.target === e.currentTarget)\n          this.props.onDBClick?.()\n      }}\n    >\n      <defs>\n        <filter x=\"0\" y=\"0\" width=\"1\" height=\"1\" id=\"solid\">\n          <feFlood floodColor=\"yellow\" result=\"bg\" />\n          <feMerge>\n            <feMergeNode in=\"bg\" />\n            <feMergeNode in=\"SourceGraphic\" />\n          </feMerge>\n        </filter>\n      </defs>\n\n      {players.map((player, idx) => <rect key={idx}\n        className={`bbox ${activeBBoxes?.includes(player.id) ? 'active' : ''}`}\n        x={player.bbox.x}\n        y={player.bbox.y}\n        width={player.bbox.w}\n        height={player.bbox.h}\n\n        onContextMenu={e => {\n          e.preventDefault()\n          e.stopPropagation()\n          // this.props.onClickPersonBBox(idx, b)\n        }}\n        onClick={e => {\n          e.stopPropagation()\n          this.props.onClickPlayer?.(player, idx)\n        }}\n      />)}\n\n      {ball && <circle\n        className={`ball ${activeBBoxes?.includes('ball') ? 'active' : ''}`}\n        cx={ball.screenPos.x}\n        cy={ball.screenPos.y}\n        r={5} // hardcode value\n        onClick={e => {\n          e.stopPropagation()\n          this.props.onClickBall?.(ball)\n        }}\n      >\n      </circle>}\n      {this.props.children}\n    </svg>\n  }\n}","import React from 'react'\n\nimport { SVGLayer, SVGLayerProps } from 'common/@components'\nimport { GameID, Gaze, Player, PlayerID, PLAYER_STATUS, VideoID } from '@types'\nimport { GAZE_R, PLAYER_META } from '@const'\nimport { Frame } from 'common/@types'\n\ninterface Props extends SVGLayerProps<GameID, VideoID, PlayerID> {\n  currentFrameData?: Frame<PlayerID>\n\n  gazePlayers?: Player[]\n  gaze?: Gaze\n  // sync?: boolean\n  bbox?: boolean\n}\n\nexport class Overlay extends React.Component<Props> {\n\n  render() {\n    const {\n      gaze,\n      gazePlayers,\n      bbox = true,\n      currentFrameData,\n      ...svgLayerProps\n    } = this.props\n    const { teamWithBall, ball, players } = currentFrameData ?? {}\n    const { isTransit } = svgLayerProps.currentVideo ?? {}\n\n    return <SVGLayer\n      {...svgLayerProps}\n    >\n\n      {/* {gaze && <g transform={`translate(${gaze.x}, ${gaze.y})`}>\n        <circle r={GAZE_R}\n          stroke={'red'}\n          fill={'rgba(255, 0, 0, 0.1)'}></circle>\n        <text\n          textAnchor=\"middle\"\n          // stroke=\"#fff\"\n          fill='#fff'\n          // stroke-width=\"1px\"\n          alignmentBaseline=\"middle\"\n        >\n          {(gaze.x).toFixed(0)}, {(gaze.y).toFixed(0)}\n          fIdx: {gaze.fIdx}\n        </text>\n      </g>\n      } */}\n\n      {!isTransit && <text x={10} y={20} fill={'#fff'}>Team w/ ball: {teamWithBall}</text>}\n      {!isTransit && <text x={150} y={20} fill={'#fff'}>Ballholder: {ball?.playerId ? PLAYER_META[ball!.playerId].ln : null}</text>}\n      {/* {!isTransit && <text x={350} y={20} fill={'#fff'}>FrameIdx: {frameIdx}</text>} */}\n\n      {!isTransit && bbox && players\n        ?.filter(({ dataPkg }) => dataPkg)\n        .map(({ bbox, id, dataPkg }) => {\n          return <g\n            key={id}\n            className={`bbox ${gazePlayers?.some(p => p.id === id) ? 'active' : ''}`}\n            transform={`translate(${bbox.x}, ${bbox.y})`}>\n            <rect\n              width={bbox.w}\n              height={bbox.h}\n            />\n            {dataPkg && <text\n              fill='#fff'\n              alignmentBaseline=\"middle\"\n            >\n              {`${dataPkg.mode}, v: ${(dataPkg?.mode === PLAYER_STATUS.defensive\n                ? dataPkg.diff\n                : dataPkg.regionExp).toFixed(1)}`}\n            </text>\n            }\n          </g>\n        }\n        )}\n    </SVGLayer>\n  }\n}\n","import { Hexbin, HexbinBin, hexbin as d3Hexbin } from 'd3-hexbin';\n\nimport type { Point } from \"common/@types\"\nimport { distPoints } from \"common/@utils\"\n\nimport { PLAYER_META } from \"@const\"\nimport type { GameID } from '@types'\nimport type { PlayerID, CachePlayerBin, ShotRecord } from '@types';\n\nif (process.env.NODE_ENV !== 'production') {\n  (global as any).$RefreshReg$ = () => { };\n  (global as any).$RefreshSig$ = () => () => { };\n}\n\nconst getArea = (area: string) => area.match(/\\((\\w+)\\)/)?.[1]\nconst getRegionKey = (r: { AREA: string, BASIC: string, RANGE: string }) =>\n  getArea(r.AREA) + \"_\" +\n  r.RANGE\n\nconst mapRegionToPoint = (region: string) => {\n  return region && (region.endsWith(\"24+ ft.\") || region.endsWith(\"Back Court Shot\")) ? 3 : 2\n}\n\nexport const hRadius = 7\nexport const hexbin = d3Hexbin<ShotRecord>()\n  .x(d => d.LOC_X)\n  .y(d => d.LOC_Y)\n  .radius(hRadius)\n\nexport const leagueAvgByRegion = [\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Above the Break 3\",\n    \"SHOT_ZONE_AREA\": \"Back Court(BC)\",\n    \"SHOT_ZONE_RANGE\": \"Back Court Shot\",\n    \"FGA\": 59,\n    \"FGM\": 4,\n    \"FG_PCT\": 0.068\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Above the Break 3\",\n    \"SHOT_ZONE_AREA\": \"Center(C)\",\n    \"SHOT_ZONE_RANGE\": \"24+ ft.\",\n    \"FGA\": 10885,\n    \"FGM\": 3746,\n    \"FG_PCT\": 0.344\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Above the Break 3\",\n    \"SHOT_ZONE_AREA\": \"Left Side Center(LC)\",\n    \"SHOT_ZONE_RANGE\": \"24+ ft.\",\n    \"FGA\": 16648,\n    \"FGM\": 5802,\n    \"FG_PCT\": 0.349\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Above the Break 3\",\n    \"SHOT_ZONE_AREA\": \"Right Side Center(RC)\",\n    \"SHOT_ZONE_RANGE\": \"24+ ft.\",\n    \"FGA\": 15837,\n    \"FGM\": 5597,\n    \"FG_PCT\": 0.353\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Backcourt\",\n    \"SHOT_ZONE_AREA\": \"Back Court(BC)\",\n    \"SHOT_ZONE_RANGE\": \"Back Court Shot\",\n    \"FGA\": 440,\n    \"FGM\": 17,\n    \"FG_PCT\": 0.039\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"In The Paint (Non-RA)\",\n    \"SHOT_ZONE_AREA\": \"Center(C)\",\n    \"SHOT_ZONE_RANGE\": \"Less Than 8 ft.\",\n    \"FGA\": 19352,\n    \"FGM\": 7561,\n    \"FG_PCT\": 0.391\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"In The Paint (Non-RA)\",\n    \"SHOT_ZONE_AREA\": \"Center(C)\",\n    \"SHOT_ZONE_RANGE\": \"8-16 ft.\",\n    \"FGA\": 6851,\n    \"FGM\": 2889,\n    \"FG_PCT\": 0.422\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"In The Paint (Non-RA)\",\n    \"SHOT_ZONE_AREA\": \"Left Side(L)\",\n    \"SHOT_ZONE_RANGE\": \"8-16 ft.\",\n    \"FGA\": 2089,\n    \"FGM\": 842,\n    \"FG_PCT\": 0.403\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"In The Paint (Non-RA)\",\n    \"SHOT_ZONE_AREA\": \"Right Side(R)\",\n    \"SHOT_ZONE_RANGE\": \"8-16 ft.\",\n    \"FGA\": 1932,\n    \"FGM\": 799,\n    \"FG_PCT\": 0.414\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Left Corner 3\",\n    \"SHOT_ZONE_AREA\": \"Left Side(L)\",\n    \"SHOT_ZONE_RANGE\": \"24+ ft.\",\n    \"FGA\": 7864,\n    \"FGM\": 2939,\n    \"FG_PCT\": 0.374\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Center(C)\",\n    \"SHOT_ZONE_RANGE\": \"16-24 ft.\",\n    \"FGA\": 7324,\n    \"FGM\": 2897,\n    \"FG_PCT\": 0.396\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Center(C)\",\n    \"SHOT_ZONE_RANGE\": \"8-16 ft.\",\n    \"FGA\": 2265,\n    \"FGM\": 987,\n    \"FG_PCT\": 0.436\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Left Side Center(LC)\",\n    \"SHOT_ZONE_RANGE\": \"16-24 ft.\",\n    \"FGA\": 7754,\n    \"FGM\": 3066,\n    \"FG_PCT\": 0.395\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Left Side(L)\",\n    \"SHOT_ZONE_RANGE\": \"8-16 ft.\",\n    \"FGA\": 7639,\n    \"FGM\": 3005,\n    \"FG_PCT\": 0.393\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Left Side(L)\",\n    \"SHOT_ZONE_RANGE\": \"16-24 ft.\",\n    \"FGA\": 5452,\n    \"FGM\": 2173,\n    \"FG_PCT\": 0.399\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Right Side Center(RC)\",\n    \"SHOT_ZONE_RANGE\": \"16-24 ft.\",\n    \"FGA\": 8145,\n    \"FGM\": 3249,\n    \"FG_PCT\": 0.399\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Right Side(R)\",\n    \"SHOT_ZONE_RANGE\": \"8-16 ft.\",\n    \"FGA\": 7630,\n    \"FGM\": 3011,\n    \"FG_PCT\": 0.395\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Right Side(R)\",\n    \"SHOT_ZONE_RANGE\": \"16-24 ft.\",\n    \"FGA\": 4924,\n    \"FGM\": 1996,\n    \"FG_PCT\": 0.405\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Restricted Area\",\n    \"SHOT_ZONE_AREA\": \"Center(C)\",\n    \"SHOT_ZONE_RANGE\": \"Less Than 8 ft.\",\n    \"FGA\": 67443,\n    \"FGM\": 40634,\n    \"FG_PCT\": 0.602\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Right Corner 3\",\n    \"SHOT_ZONE_AREA\": \"Right Side(R)\",\n    \"SHOT_ZONE_RANGE\": \"24+ ft.\",\n    \"FGA\": 7360,\n    \"FGM\": 2803,\n    \"FG_PCT\": 0.381\n  }\n].reduce((o, d) => {\n  const key = getRegionKey({ AREA: d.SHOT_ZONE_AREA, BASIC: d.SHOT_ZONE_BASIC, RANGE: d.SHOT_ZONE_RANGE })\n  o[key] = {\n    FGA: d.FGA,\n    FGM: d.FGM,\n    rate: d.FG_PCT,\n    exp: mapRegionToPoint(key) * d.FG_PCT\n  }\n  return o\n}, {} as Record<string, { FGA: number, FGM: number, rate: number, exp: number }>)\n\nconst groupShotsByRegion = (shots: ShotRecord[]) => {\n  const byRegion = shots\n    .reduce((o, r) => {\n      const key = getRegionKey(r.SHOT_ZONE)\n      if (!(key in o)) {\n        o[key] = []\n      }\n      o[key].push(r)\n      return o\n    }, {} as Record<string, ShotRecord[]>)\n\n  const byRegionAndPercentage: Record<string, {\n    shots: ShotRecord[],\n    rate: number,\n    diff: number,\n    eDiff: number,\n    exp: number,\n    region: { AREA: string, BASIC: string, RANGE: string }\n  }> = {}\n\n  for (const key of Object.keys(byRegion)) {\n    const shots = byRegion[key]\n    const rate = shots.filter(s => +s.made).length / shots.length\n    const diff = rate - leagueAvgByRegion[key].rate\n    const exp = rate * mapRegionToPoint(key)\n\n    byRegionAndPercentage[key] = {\n      shots,\n      region: shots[0].SHOT_ZONE,\n      rate,\n      exp,\n      diff,\n      eDiff: 2 * (-0.5 + 1 / (1 + Math.exp(-5 * diff))),\n    }\n  }\n\n  return byRegionAndPercentage\n}\n\nconst mapLOCTOTracking = (onTheRight: boolean, r: ShotRecord) => ({ //, mapSize: [number, number]) => ({\n  ...r,\n  LOC_X: (onTheRight ? (940 - (r.LOC_Y + 52.5)) : (r.LOC_Y + 52.5)), // / (940 / mapSize[0]),\n  LOC_Y: ((onTheRight ? r.LOC_X : -r.LOC_X) + 250), // / (500 / mapSize[1])\n})\n\n// detect whether at 2 or 3 points region\nconst TwoOrThreePt = ({ x, y }: Point) => {\n  if (x === undefined || y === undefined) return 2\n  const point1 = 14\n  const point2 = 5.25 + 23.75\n  if (x < 47) {\n    // on the left\n    if (x < point1) {\n      // check y\n      return (y > 3 && y < (50 - 3)) ? 2 : 3\n    } else if (x < point2) {\n      // check dist\n      const dist = distPoints({ x, y }, { x: 5.25, y: 25 })\n      return dist > 23.75 ? 3 : 2\n    }\n  } else {\n    // on the right\n    if (x > (94 - point1)) {\n      return (y > 3 && y < (50 - 3)) ? 2 : 3\n    } else if (x > (94 - point2)) {\n      const dist = distPoints({ x, y }, { x: 94 - 5.25, y: 25 })\n      return dist > 23.75 ? 3 : 2\n    }\n  }\n}\n\n\nfunction normalize(v?: number, min?: number, max?: number) {\n  if (v === undefined || min === undefined || max === undefined) return -1\n  return (v - min) / (max - min)\n}\n\nfunction POS_TO_OFF_TEAM(gameId: GameID, x?: number) {\n  if (x === undefined) return undefined\n  return gameId === 'game1'\n    ? x < 47 ? 'CLE' : 'GSW'\n    : x < 47 ? 'OKC' : 'LAC'\n}\n\nexport function GOAL_BASKET_POS(playerId: PlayerID) {\n  const team = PLAYER_META[playerId].team\n  const left = new Set(['CLE', 'OKC'])\n  // const right = new Set(['GSW', 'LAC'])\n\n  return left.has(team) ? { x: 5.8, y: 25 } : { x: 88.2, y: 25 }\n}\n\nfunction PLAYER_ID_TO_OFF_RIGHT(playerId: PlayerID) {\n  return new Set(['GSW', 'LAC']).has(PLAYER_META[playerId].team)\n}\n\nfunction getPlayerBins(hexbin: Hexbin<ShotRecord>, playerId: PlayerID, shotRecords: ShotRecord[]) {\n  const onTheRight = PLAYER_ID_TO_OFF_RIGHT(playerId)\n  const leagueShots = shotRecords\n    .map(r => mapLOCTOTracking(onTheRight, r))\n  const playerShots = leagueShots\n    .filter(r => r.PLAYER_ID === playerId)\n\n  const playerShotsByRegion = groupShotsByRegion(playerShots)\n  const bins = hexbin(leagueShots)\n  const playerShotInBinWithDiff = bins\n    .map(d => {\n      const [region, value] = Object.entries(groupShotsByRegion(d))\n        .reduce((o, d) => (o && o[1].shots.length > d[1].shots.length) ? o : d)\n\n      const dft = leagueAvgByRegion[region]\n      const {\n        rate = dft?.rate ?? 0,\n        diff = 0,\n        eDiff = 0,\n        exp = dft?.exp ?? 0\n      } = playerShotsByRegion[region] ?? {}\n\n      const newD = d as HexbinBin<ShotRecord> & CachePlayerBin\n      newD.region = value.region\n      newD.diff = diff;\n      newD.eDiff = eDiff;\n      newD.regionRate = rate;\n      newD.regionExp = exp\n      return newD\n    })\n\n  // normalize\n  playerShotInBinWithDiff.forEach(d => {\n    ; (d as CachePlayerBin).regionFreq = d.length / Math.max(...playerShotInBinWithDiff.filter(r => r.region === d.region).map(r => r.length))\n  })\n\n  return playerShotInBinWithDiff.map(({ x, y, region, regionExp, regionRate, regionFreq, diff, eDiff }) => ({\n    x, y, region, regionExp, regionRate, regionFreq, diff, eDiff\n  })) as CachePlayerBin[]\n}\n\n/**\n * dirty hack\n */\nexport function getCanvasAbsTopLeft() {\n  const elm = document.getElementById(\"canvasWrapper\")\n  if (!elm) return { x: 0, y: 0 }\n  const { x, y, width, height } = elm?.getBoundingClientRect()\n  return {\n    // x: x + window.screenX,\n    // y: y + window.screenY + window.outerHeight - window.innerHeight,\n    x: x,\n    y: y + window.outerHeight / 50,\n    wScale: 1280 / width,\n    hScale: 720 / height\n  }\n}\n\nexport {\n  mapRegionToPoint, TwoOrThreePt, normalize, getPlayerBins,\n  PLAYER_ID_TO_OFF_RIGHT, POS_TO_OFF_TEAM,\n  getArea, getRegionKey, groupShotsByRegion, mapLOCTOTracking\n}","export default function Worker_fn() {\n  return new Worker(__webpack_public_path__ + \"static/js/loadFrames.worker.204ea63a.js\");\n}\n","import type {\n  Frame,\n  BaseVideo,\n  CacheFrameData\n} from \"../@types\"\nimport { DEBUG } from '../@const';\nimport { getImg, wait, debugMem, ArrayToDict, waitUntil, wrapWorker } from '../@utils';\n\nimport MyWorker from './loadFrames.worker';\n\nexport class DataLoader<GameID extends string, VideoID extends string, PlayerID extends number> {\n\n  // shotRecords: ShotRecord[] = []\n  #Loading: Partial<Record<VideoID, boolean>> = {}\n\n  // video data per frame\n  memVideoData: Partial<Record<VideoID, Record<number, Frame<PlayerID>>>> = {}\n\n  onLoad?: (videoId: VideoID, progress?: number) => void\n  onUnload?: (videoId: VideoID) => void\n\n  #getFrames: (video: BaseVideo<GameID, VideoID>) => Promise<CacheFrameData<PlayerID>[] | undefined>\n  constructor(readonly worker: { new(): Worker } = MyWorker) {\n    this.#getFrames = wrapWorker<[BaseVideo<GameID, VideoID>], CacheFrameData<PlayerID>[] | undefined>(worker, 'Frames', (d) => {\n      if (d[0] === 'Progress') {\n        const [_, vId, progress] = d\n        this.onLoad?.(vId, progress)\n      }\n    })\n  }\n\n  /**\n   * -------------- Game data ----------------\n   */\n  // #playerBins: Partial<Record<PlayerId, PlayerShotBin[]>> = {}\n  // getPlayerBins = (playerId: PlayerId) => this.#playerBins[playerId]\n  // async loadBins() {\n  //   this.#playerBins = await this.worker.getBins();\n  // }\n\n  /**\n   * ----------------- Data Loading --------------------\n   */\n  isLoaded(video: BaseVideo<GameID, VideoID>) {\n    return video.isTransit || video.id in this.memVideoData\n  }\n  getVideoData(videoId: VideoID) {\n    return this.memVideoData[videoId]\n  }\n\n  #pre_load_batch_size = 50\n  async fetch(video: BaseVideo<GameID, VideoID>, shouldWait: boolean = false) {\n\n    if (this.#Loading[video.id]) {\n      // wait until anothe thread finish\n      await waitUntil(() => !this.#Loading[video.id])\n      return\n    }\n\n    this.#Loading[video.id] = true\n    console.debug('preload===>', video)\n    // if not in mem, load from db\n    if (!this.isLoaded(video)) {\n      // step 1, get from db\n      const frames = await this.#getFrames(video)\n      if (!frames) {\n        this.#Loading[video.id] = false\n        return\n      }\n      const progressOffset = 0.6\n      this.onLoad?.(video.id, progressOffset)\n\n      // step2, process to mem\n      console.log(`%cMain thread processing ${video.id} to mem =====>`, 'color:#f5f5f5;background: #00695c; padding: 2px; border-radius:2px')\n      // should not do at once, chunck frames into groups\n      let framesToSave: Frame<PlayerID>[] = []\n      console.debug('===>parsing blob to img...')\n      for (let i = 0; i < Object.keys(frames).length; i += this.#pre_load_batch_size) {\n        const itemsForBatch = frames.slice(i, i + this.#pre_load_batch_size)\n        framesToSave = [\n          ...framesToSave,\n          ...(await Promise.all(itemsForBatch.map(async (frame) => {\n            const mask = await getImg(URL.createObjectURL(frame.mask!))\n            return { ...frame, mask } as any as Frame<PlayerID>\n          })))\n        ]\n        this.onLoad?.(video.id, progressOffset + (0.95 - progressOffset) * i / Object.keys(frames).length)\n\n        if (shouldWait) {\n          await wait(30)\n        }\n      }\n      // sort\n      framesToSave.sort((a, b) => a.idx - b.idx)\n      console.debug(`<=====${video.id} Done!`, framesToSave[0])\n      // Step3. save to mem\n      this.memVideoData[video.id] = ArrayToDict(framesToSave, 'idx')\n      this.onLoad?.(video.id, 1)\n      DEBUG.DEBUG_MEM && debugMem()\n\n      console.log(`%cMain thread done processing ${video.id} to mem<======`, 'color:#f5f5f5;background: #00695c; padding: 2px; border-radius:2px')\n    }\n    this.#Loading[video.id] = false\n  }\n\n  unloadFromMem(video?: BaseVideo<GameID, VideoID>) {\n    if (video === undefined || video.isTransit) return\n    delete this.memVideoData[video.id]\n    this.onUnload?.(video.id)\n    DEBUG.DEBUG_MEM && debugMem()\n  }\n}","\nimport Dexie from 'dexie';\nimport { CacheFrameData, VideoDataVersion } from '../@types'\n\ninterface BaseTables<PID extends number> {\n  frames: CacheFrameData<PID>,\n  videoDataVersions: VideoDataVersion\n}\n\nexport class Database<PID extends number, T extends Record<string, any> = {}, K = T & BaseTables<PID>> extends Dexie {\n  // meta\n  public readonly myTables: { [k in keyof K]: Dexie.Table<K[k]> }\n\n  constructor(stores?: Record<keyof T, string>) {\n    super(\"Database\");\n    this.version(6).stores({\n      frames: \"[gameId+videoId+idx]\",\n      videoDataVersions: \"[gameId+videoId]\",\n      ...(stores ?? {})\n    });\n\n    this.myTables = ['frames', 'videoDataVersions', ...Object.keys(stores ?? {})]\n      .reduce((o, d) => {\n        o[d as keyof K] = this.table(d)\n        return o\n      }, {} as Record<keyof K, Dexie.Table<any>>)\n\n  }\n}","import { DEBUG } from \"../../@const\"\nimport type { BaseVideo } from \"../../@types\"\nimport { debugMem, waitUntil } from \"../../@utils\"\n\n\nexport class VideoLoader<GameID extends string, VideoID extends string> {\n  #Loading: Partial<Record<VideoID, boolean>> = {}\n\n  onLoad?: (videoId: VideoID) => void\n  onUnload?: (videoId: VideoID) => void\n  private memVideos: Partial<Record<VideoID, HTMLVideoElement>> = {}\n\n  getVideo(videoId: VideoID) {\n    return this.memVideos[videoId]\n  }\n\n  isLoaded(video: BaseVideo<GameID, VideoID>) {\n    return video.id in this.memVideos\n  }\n\n  async fetch(video: BaseVideo<GameID, VideoID>) {\n\n    if (this.#Loading[video.id]) {\n      // wait until anothe thread finish\n      await waitUntil(() => !this.#Loading[video.id])\n      return\n    }\n\n    this.#Loading[video.id] = true\n    if (!this.isLoaded(video)) {\n      console.debug('VideoLoader.preLoadToMem', video)\n      const nextVideo = document.createElement('video')\n      nextVideo.src = `${process.env.PUBLIC_URL}/assets/${video.gameId}/${video.id}/${video.id}.mp4`\n      nextVideo.id = video.id\n      nextVideo.load()\n      await new Promise(resolve => {\n        // nextVideo.onloadedmetadata = () => console.log('onloadedmetadata', video.id)\n        nextVideo.onloadeddata = resolve\n      })\n      console.debug('VideoLoader.preLoadToMem ==> Done', video)\n\n      // load to mem\n      this.memVideos[video.id] = nextVideo\n      this.onLoad?.(video.id)\n      DEBUG.DEBUG_MEM && debugMem()\n    }\n    this.#Loading[video.id] = false\n  }\n}\n","import type { BaseVideo } from \"../../@types\"\nimport { VideoLoader } from './VideoLoader'\n\nclass VideoTrack<GameID extends string, VideoID extends string> {\n  private get frameOffset() {\n    // hardcode value, I dont know why\n    return this.#videoMeta?.frameRate === 50 ? 0 : 1\n  }\n\n  #videoMeta?: BaseVideo<GameID, VideoID>\n  #video?: HTMLVideoElement\n  get video() { return this.#video }\n  get id() { return this.#video?.id }\n\n  CallBackHandle: number | null = null\n\n  onPlay: EventListener | null = null\n  onPause: EventListener | null = null\n  setVideo(video: BaseVideo<GameID, VideoID>, videoElm: HTMLVideoElement | undefined) {\n    this.#video = videoElm\n    this.#video?.requestVideoFrameCallback(this.invokeFrameHandlers)\n    this.#videoMeta = video\n  }\n  load(onPlay: EventListener, onPause: EventListener) {\n    this.onPlay = onPlay\n    this.onPause = onPause\n    this.#video?.addEventListener('play', onPlay)\n    this.#video?.addEventListener('pause', onPause)\n  }\n\n  unLoad() {\n    if (this.onPlay)\n      this.#video?.removeEventListener('play', this.onPlay)\n    if (this.onPause)\n      this.#video?.removeEventListener('pause', this.onPause)\n    if (this.CallBackHandle !== null)\n      this.#video?.cancelVideoFrameCallback(this.CallBackHandle)\n    this.#video?.load()\n    this.#video = undefined\n    this.#videoMeta = undefined\n  }\n\n  constructor(public readonly name: string, private readonly videoPlayer: VideoPlayer<GameID, VideoID>) { }\n\n  play() {\n    this.#video?.play()\n  }\n\n  invokeFrameHandlers: VideoFrameRequestCallback = (now, metadata) => {\n  \n    if (this.#video === this.videoPlayer.currentTrack) {\n      const rawFrame = Math.round(metadata.mediaTime * this.#videoMeta!.frameRate) //when play, videoMeta must set\n      const frameIdx = rawFrame - this.frameOffset\n      const videoId = this.videoPlayer.currentTrack!.id\n      for (let i = 0, len = this.videoPlayer.onFrameHandlers.length; i < len; ++i) {\n        this.videoPlayer.onFrameHandlers[i].call(this, videoId, frameIdx, Date.now(), this.videoPlayer.currentTrack!)\n      }\n    }\n\n    if (this.#video) {\n      this.CallBackHandle = this.#video?.requestVideoFrameCallback(this.invokeFrameHandlers)\n    }\n  }\n}\n\nexport class VideoPlayer<GameID extends string, VideoID extends string> {\n  protected _currentTrack?: HTMLVideoElement\n  public get currentTrack() { return this._currentTrack }\n  // video meta\n  #currentVideo: BaseVideo<GameID, VideoID> | null = null\n  protected set currentVideo(v) { this.#currentVideo = v }\n  get currentVideo() { return this.#currentVideo }\n\n  // video sources\n  videoSources = new VideoLoader<GameID, VideoID>()\n\n  /**\n   * A video player has two video track.\n   * It uses one track to preload, and the other track to play\n   */\n  protected ATrack = new VideoTrack<GameID, VideoID>('A', this)\n  protected BTrack = new VideoTrack<GameID, VideoID>('B', this)\n  onFrameHandlers: Array<(vId: string, fIdx: number, ts: number, videoFrame: HTMLVideoElement) => void> = []\n\n  // event handlers\n  onPlay?: (videoId: VideoID) => void\n  onPause?: (videoId: VideoID) => void\n  onLoad?: (videoId: VideoID, type: 'Video' | 'Data', progress?: number) => void\n  onUnload?: (videoId: VideoID, type: 'Video' | 'Data') => void\n  public videos: BaseVideo<GameID, VideoID>[] = []\n\n  constructor() {\n    // auto switch to the next clip\n    this.addOnFrameListener(async (videoId, frameIdx, ts, videoFrame) => {\n      const curVideoIdx = this.videos.findIndex(v => v.id === videoId)\n      if (curVideoIdx === -1) {\n        console.warn('There must be something wrong since it cannot find the video from the videoList in the videoPlayer', videoId, this.videos)\n        return\n      }\n\n      // preload to the other track\n      if (frameIdx + 5 === this.currentVideo?.maxFrame) {\n        // should load next\n        const nextVideoIdx = curVideoIdx + 1\n        if (this.videos[nextVideoIdx] !== undefined) {\n          this.preloadToAnotherTrack(this.videos[nextVideoIdx], true)\n        }\n      }\n\n      // load to the current track\n      if (frameIdx + 1 === this.currentVideo?.maxFrame) {\n        const nextVideoIdx = curVideoIdx + 1\n        if (this.videos[nextVideoIdx] === undefined) {\n          this.pause()\n          return\n        }\n        await this.loadVideo(this.videos[nextVideoIdx], true)\n        // should also load data after extension\n      }\n    })\n\n    // videoSources\n    this.videoSources.onLoad = (videoId: VideoID) => {\n      this.onLoad?.(videoId, 'Video')\n    }\n    this.videoSources.onUnload = (videoId: VideoID) => {\n      this.onUnload?.(videoId, 'Video')\n    }\n  }\n\n  addOnFrameListener(fn: (vId: string, frameIdx: number, ts: number, videoFrame: HTMLVideoElement) => void) {\n    this.onFrameHandlers.splice(this.onFrameHandlers.length - 2, 0, fn)\n  }\n\n  // data control\n  async fetchVideos() {\n    for (const video of this.videos) {\n      await this.videoSources.fetch(video)\n    }\n  }\n  isLoaded(video: BaseVideo<GameID, VideoID>) {\n    return this.videoSources.isLoaded(video)\n  }\n\n  // this is for assertion?\n  private whichOnPause = (ev: Event) => {\n    const v = ev.target as HTMLVideoElement\n    if (v.id === this.currentTrack?.id) {\n      this.onPause?.(v.id as VideoID)\n    }\n  }\n  private whichOnPlay = (ev: Event) => {\n    const v = ev.target as HTMLVideoElement\n    if (v.id === this.currentTrack?.id) {\n      this.onPlay?.(v.id as VideoID)\n    }\n  }\n\n  // video track control\n  async loadVideo(video: BaseVideo<GameID, VideoID>, play = false) {\n    // not load\n    if (this.currentTrack?.id === video.id) return\n    this.currentVideo = video\n\n    // ensure load to preTrack\n    if (this.ATrack.id !== video.id && this.BTrack.id !== video.id) {\n      await this.preloadToAnotherTrack(video, play)\n    }\n\n    const [trackToLoad, trackToUnload] = this.ATrack.id === video.id\n      ? [this.ATrack, this.BTrack]\n      : [this.BTrack, this.ATrack]\n    console.debug(`TrackToLoad: ${trackToLoad.name}_${trackToLoad.id} ${trackToLoad.video?.currentTime}, TrackToUnload: ${trackToUnload.name}_${trackToUnload.id}`)\n\n    // clean the currentTrack\n    trackToUnload.unLoad()\n    trackToLoad.load(this.whichOnPlay, this.whichOnPause)\n    this._currentTrack = trackToLoad.video\n  }\n\n  async preloadToAnotherTrack(newVideo: BaseVideo<GameID, VideoID>, play: boolean) {\n    console.log('%cpreloadToSkip', 'background: #444; color: #bada55; padding: 2px; border-radius:2px', newVideo)\n    await this.videoSources?.fetch(newVideo)\n\n    // load to the ohter track, prefer ATrack\n    const trackToLoad = this.BTrack.id === this.currentTrack?.id\n      ? this.ATrack\n      : this.BTrack\n    console.debug(`Load to track_${trackToLoad.name}`)\n\n    trackToLoad.setVideo(newVideo, this.videoSources?.getVideo(newVideo.id))\n    play && trackToLoad.play()\n  }\n\n  // video control\n  play() {\n    if (!this.currentTrack || !this.currentTrack.paused) return\n    console.debug('play video')\n    // this.currentTrack.playbackRate = 0.75\n    this.currentTrack.play()\n    this.onPlay?.(this.currentTrack?.id as VideoID)\n  }\n\n  pause() {\n    if (this.currentTrack?.paused) return\n    this.currentTrack?.pause()\n    this.onPause?.(this.currentTrack?.id as VideoID)\n  }\n\n  async seekTo(video: BaseVideo<GameID, VideoID>, frameIdx: number) {\n    await this.loadVideo(video)\n\n    this.currentTrack!.currentTime = (frameIdx / video.frameRate) + 0.001\n    console.debug('switch to video:', video, 'set currentTime to frameIdx', frameIdx)\n  }\n}\n","import { Frame, BaseVideo } from '../@types'\n\nimport { DataLoader } from '../DataLoader'\nimport { VideoPlayer } from './VideoPlayer'\n\nexport class VideoEnv<\n  GameID extends string,\n  VideoID extends string,\n  PlayerID extends number\n> extends VideoPlayer<GameID, VideoID> {\n\n  /**\n   * add a dataLoader to the VideoPlayer\n   */\n  // dataLoader: DataLoader\n\n  // data\n  #frames: Record<number, Frame<PlayerID>> | undefined\n  get frames() { return this.#frames }\n  set frames(v) { this.#frames = v }\n\n  // combine event\n  constructor(readonly dataLoader: DataLoader<GameID, VideoID, PlayerID> = new DataLoader()) {\n    super()\n    // this.dataLoader = new DataLoader(postProcessingData)\n    // combine event\n    this.dataLoader.onLoad = (videoId: VideoID, progres?: number) => {\n      this.onLoad?.(videoId, 'Data', progres)\n    }\n    this.dataLoader.onUnload = (videoId: VideoID) => {\n      this.onUnload?.(videoId, 'Data')\n    }\n  }\n\n  async fetchVideos() {\n    super.fetchVideos()\n    for (const video of this.videos) {\n      await this.dataLoader.fetch(video)\n    }\n  }\n\n  isLoaded(video: BaseVideo<GameID, VideoID>) {\n    return this.dataLoader.isLoaded(video) && super.isLoaded(video)\n  }\n\n  async loadVideo(video: BaseVideo<GameID, VideoID>, play = false) {\n    // not load\n    if (this.currentTrack?.id === video.id) return\n    super.loadVideo(video, play)\n    // load data\n    await this.dataLoader.fetch(video)\n    this.frames = this.dataLoader.getVideoData(video.id)\n  }\n\n  // one off data load\n  // async loadBins() {\n  //   return this.dataLoader.loadBins()\n  // }\n}","export default function Worker_fn() {\n  return new Worker(__webpack_public_path__ + \"static/js/loadData.worker.47de9307.js\");\n}\n","import \"./App.scss\";\nimport 'react-circular-progressbar/dist/styles.css';\n\nimport { CircularProgressbar, buildStyles } from 'react-circular-progressbar';\nimport React from \"react\";\nimport { IoPlaySharp, IoPauseSharp } from 'react-icons/io5'\nimport { AiOutlineLoading } from 'react-icons/ai'\n\nimport type {\n  Attentions, Gaze, KeyPlayer, Lv2Player,\n  PlayerID, Player,\n  VideoID, Video\n} from '@types'\n\nimport { DEBUG } from 'common/@const'\nimport { standardDeviation, globalFIdxToLocal, localFIdxToGlobalFIdx } from \"common/@utils\";\n\nimport {\n  BarChart,\n  LineChart,\n  Visualizer,\n  Overlay\n} from './components'\nimport { Timeline } from 'common/@components'\n\nimport { params } from \"param\";\nimport { IBallVideoEnv } from \"VideoEnv\";\n\nexport const videoEnv = new IBallVideoEnv()\n\ninterface State {\n  videos: Video[]\n  pauseLoading: VideoID | undefined\n  currentVideoIdx: number\n  currentFrameIdx: number\n  currentGaze: Gaze | undefined\n  currentFrame?: HTMLVideoElement\n  // player status\n  gazePlayers?: Player[]\n  attentions?: Attentions\n  attentionsOverTime?: Attentions[]\n  pickedPlayers: Record<number, { lv1Players: Record<PlayerID, KeyPlayer>, lv2Players: Record<PlayerID, Lv2Player> }>\n\n  playing: boolean\n}\n\nexport class App extends React.Component<{}, State> {\n\n  state: State = {\n    // playing\n    pauseLoading: undefined,\n    videos: [],\n    currentVideoIdx: 0,\n    currentFrameIdx: 0,\n    currentFrame: undefined,\n    currentGaze: undefined,\n    gazePlayers: undefined,\n    attentions: undefined,\n    attentionsOverTime: undefined,\n    pickedPlayers: {},\n    //\n    playing: false,\n  }\n\n  #visualizer: React.RefObject<Visualizer> = React.createRef()\n\n  get currentVideo() { return this.state.videos[this.state.currentVideoIdx] }\n\n  async componentDidMount() {\n    // should load parameters here\n\n    // get the data from the server and construct a data tower for this video\n    const videos = await Promise.all(params.VIDEO_IDS.map(async (videoId: string) => {\n\n      try {\n        const { max_frame: maxFrame, start_frame = 0, fps, h, w, version } = (await fetch(`${process.env.PUBLIC_URL}/assets/${params.GAME_ID}/${videoId}/${videoId}-meta.json`).then(r => r.json()))\n        const isTransit = videoId.endsWith(',t')\n\n        return {\n          gameId: params.GAME_ID,\n          id: videoId as VideoID,\n          maxFrame,\n          startFame: start_frame,\n          isTransit,\n          frameRate: fps, //params.GAME_ID === 'game1' ? 29.97 : 29.81,\n          loadedData: 0,\n          loadedVideo: 0,\n          width: w,\n          height: h,\n          version,\n        }\n      } catch (e) {\n        console.log('Something wrong with maxjson', videoId)\n        throw e\n      }\n    }))\n    this.setState({ videos })\n\n    // set up videoEnv\n    videoEnv.videos = videos\n\n    // dataTower.onGaze = (currentGaze, gazePlayers) => this.setState({ currentGaze, gazePlayers })\n    // dataTower.onUpdateLvInt = attentions => this.setState({ attentions })\n    videoEnv.onLoad = (videoId: VideoID, type: 'Data' | 'Video', progress) => {\n      const { videos } = this.state\n      const videoIdx = videos.findIndex(v => v.id === videoId)\n      if (videoIdx !== -1) {\n        videos[videoIdx] = {\n          ...videos[videoIdx],\n          [`loaded${type}`]: progress === undefined ? 1 : progress\n          // loaded: videoEnv.isLoaded(videos[videoIdx])\n        }\n        this.setState({ videos: [...videos] })\n      }\n    }\n    videoEnv.onUnload = (videoId: VideoID, type: 'Data' | 'Video') => {\n      const { videos } = this.state\n      const videoIdx = videos.findIndex(v => v.id === videoId)\n      if (videoIdx !== -1) {\n        videos[videoIdx] = {\n          ...videos[videoIdx],\n          [`loaded${type}`]: 0\n          // loaded: videoEnv.isLoaded(videos[videoIdx])\n        }\n        this.setState({ videos: [...videos] })\n      }\n    }\n\n    videoEnv.onPause = (videoId) => this.setState({ playing: false })\n    videoEnv.onPlay = (videoId) => this.setState({ playing: true, pauseLoading: undefined })\n\n    // setup videoEngine\n    // invoke the handler for each frame\n    // this.videoEngine.addOnFrameListener(this.pushFrameHistory)\n    videoEnv.addOnFrameListener(async (videoId, frameIdx, ts, videoFrame) => {\n      const { videos } = this.state\n      const newCurVideoIdx = videos.findIndex(v => v.id === videoId)\n      this.setState({\n        currentFrameIdx: frameIdx,\n        currentVideoIdx: newCurVideoIdx,\n        currentFrame: videoFrame\n      })\n    })\n\n    // load the frames\n    const { currentVideoIdx } = this.state\n    await videoEnv.fetchVideos()\n    // preload videos\n    await videoEnv.loadVideo(videos[currentVideoIdx])\n  }\n\n  componentWillUnmount() {\n    // dataTower.onGaze = undefined\n    // dataTower.onUpdateLvInt = undefined\n    // dataTower.onUpdateLvSync = undefined\n    // dataTower.onLoadToMem = undefined\n    // dataTower.onUnloadToMem = undefined\n    // videoEngine.clean()\n    // videoEngine.onLoadToMem = undefined\n    // videoEngine.onPause = undefined\n    // videoEngine.onPlay = undefined\n  }\n\n  // pushFrameHistory = (videoId: string, localFrameIdx: number, ts: number) => {\n  //   const { videos } = this.state\n  //   const videoIdx = videos.findIndex(v => v.id === videoId)\n\n  //   if (videoIdx === -1) {\n  //     this.videoEngine.pause()\n  //     return\n  //   }\n\n  //   const video = videos[videoIdx]\n  //   dataTower.pushFrameHistory({ videoId: video.id, fIdx: localFrameIdx, ts })\n  // }\n\n  onClickInterval = async (clipId: number, globalFrameIdx: number) => {\n    // 直接给videoFrame设帧\n    const { videos } = this.state\n    const { videoIdx, frameIdx } = globalFIdxToLocal(globalFrameIdx, videos)\n    videoEnv!.pause();\n    await videoEnv!.seekTo(videos[videoIdx], frameIdx)\n  }\n\n  onPlayVideo = async () => {\n    const { playing } = this.state\n    if (playing) {\n      videoEnv!.pause()\n    } else {\n      videoEnv!.play()\n    }\n  }\n\n  loadedPrecentage() {\n    const { videos } = this.state\n    // assuming loading data takes 2x times than loading videos\n    const value = videos.reduce((o, d) => o += d.loadedData * 2 + d.loadedVideo, 0) / videos.reduce((o, v) => o + (v.isTransit ? 1 : 3), 0)\n    return value\n  }\n\n  renderProgressbar() {\n    const value = this.loadedPrecentage() * 100\n    return value === 100 ? null : <div style={{\n      position: 'fixed',\n      left: '50%',\n      top: '50%',\n      transform: 'translate(-50%, -50%)'\n    }}>\n      <CircularProgressbar\n        value={value}\n        text={`${value | 0}%`}\n        styles={buildStyles({\n          pathColor: `rgb(62, 152, 199)`,\n          textColor: '#f88',\n          trailColor: '#d6d6d6',\n          backgroundColor: '#3e98c7',\n        })}\n      />\n    </div>\n  }\n\n  render() {\n    const {\n      currentVideoIdx,\n      currentFrameIdx,\n\n      currentGaze,\n      currentFrame,\n      gazePlayers,\n\n      pauseLoading,\n      attentions,\n      attentionsOverTime,\n      pickedPlayers,\n      // sync,\n      playing,\n      videos,\n    } = this.state;\n    const currentFrameData = videoEnv.frames?.[currentFrameIdx]\n\n    return (\n      <>\n        {/* <LoadingBar\n          color='#f11946'\n          height={3}\n          progress={100 * videos.filter(v => v.loaded).length / videos.length}\n        /> */}\n        {this.renderProgressbar()}\n\n        <div className=\"up\">\n          <div className=\"full\">\n            <Visualizer ref={this.#visualizer}\n              // video\n              currentVideo={this.currentVideo}\n              currentFrameIdx={currentFrameIdx}\n              currentFrame={currentFrame}\n              // gaze\n              gaze={currentGaze}\n              gazePlayers={gazePlayers}\n              onPickPlayers={(fIdx, lv1Players, lv2Players) => {\n                const vIdx = videos.findIndex(v => v.id === this.currentVideo.id)\n                if (vIdx === -1) return\n\n                const globalFIdx = localFIdxToGlobalFIdx(vIdx, fIdx, videos)\n                this.setState({\n                  pickedPlayers: { ...pickedPlayers, [globalFIdx]: { lv1Players, lv2Players } }\n                })\n              }}\n            >\n\n              <Overlay\n                currentVideo={this.currentVideo}\n                currentFrameData={currentFrameData}\n                bbox={false}\n              />\n\n              {/* {DEBUG.OVERLAY &&\n                <Overlay\n                  width={videoWidth}\n                  height={videoHeight}\n                  frameIdx={currentFrameIdx}\n                  gazePlayers={gazePlayers}\n                  gaze={DEBUG.GAZE ? currentGaze : undefined}\n                  bbox={DEBUG.BBOX}\n                  isTransit={this.currentVideo?.isTransit}\n                />\n              } */}\n            </Visualizer>\n            {DEBUG && <div className=\"debug\">\n              {/* {DEBUG.COURT && <Court\n                currentFrameIdx={currentFrameIdx}\n              />} */}\n              {DEBUG.ATTENTIONS &&\n                <div className=\"chart\">\n                  <BarChart\n                    fixY={true}\n                    data={attentions?.players\n                      ? Object.entries(attentions?.players).map(([playerId, { att, on }]) => {\n                        return { id: playerId, value: att, fill: on ? \"teal\" : \"lightpink\" }\n                      }, {} as Record<string, { value: number, fill: string }>) : []}\n                  />\n                </div>\n              }\n              {DEBUG.LINE &&\n                <div className=\"chart\">\n                  <LineChart\n                    width={600}\n                    data={attentionsOverTime\n                      ?.filter(({ videoId }) => videoId !== undefined)\n                      .map(({ fIdx, players: playerAttentions, videoId }) => {\n\n                        const { players } = videoEnv!.frames?.[currentFrameIdx] ?? {}\n                        const std = standardDeviation(players?.map(p => playerAttentions[p.id]?.att ?? 0))\n                        const videoIdx = videos.findIndex(v => v.id === videoId)!\n                        const globalFIdx = localFIdxToGlobalFIdx(videoIdx, fIdx, videos)\n                        return { fIdx: globalFIdx, videoIdx, value: std }\n                      }) ?? []}\n                  />\n                </div>\n              }\n            </div>\n            }\n            <div className=\"controls\">\n              <button\n                id=\"playpause\"\n                className=\"play button is-outlined\"\n                type=\"button\"\n                disabled={pauseLoading !== undefined || this.loadedPrecentage() !== 1}\n                onClick={() => this.onPlayVideo()}\n              >\n                {playing\n                  ? <IoPauseSharp style={{ transform: 'scale(1.5)' }} />\n                  : pauseLoading !== undefined\n                    ? <AiOutlineLoading style={{ transform: 'scale(1.5)' }} />\n                    : <IoPlaySharp style={{ transform: 'scale(1.5)' }} />}\n              </button>\n            </div>\n          </div>\n          <div className=\"divide\"> </div>\n        </div>\n\n        {DEBUG.TIMELINE &&\n          <Timeline\n            mode=\"S\"\n            videos={videos}\n            currentVideoIdx={currentVideoIdx}\n            currentFrameIdx={currentFrameIdx}\n            enableClips={false}\n            // pickedPlayers={pickedPlayers}\n            onClickInterval={this.onClickInterval}\n          />\n        }\n      </>)\n  }\n}","import { scaleSequential, scaleSqrt, scaleOrdinal } from 'd3-scale'\nimport { interpolateReds, interpolateYlGnBu, schemeSet3 } from 'd3-scale-chromatic'\n\nimport type { Ball, Point } from 'common/@types'\nimport {\n  PlayerID, TeamID,\n  Attentions, AttentionWeights,\n  FrameStamp, Gaze, Highlights,\n  KeyPlayer,\n  KeyPlayerType,\n  Lv2Player,\n  Lv2PlayerType,\n  OffensivePkg,\n  VideoID,\n  GameID, Player\n} from \"@types\"\n\nimport { distPoints, union } from 'common/@utils';\nimport { getCanvasAbsTopLeft, GOAL_BASKET_POS, hRadius } from '@utils';\n\nimport { DEBUG } from 'common/@const'\nimport {\n  PLAYER_META,\n  EMPTY_SPACE_THRESHOLD, GAZE_R, LV_INTEREST_THRESHOLD, MAX_HIGHLIGHTED, NEXT_BALL_HOLDER_TIME_RANGE,\n} from '@const';\nimport { params } from 'param';\n\nimport { VideoEnv } from 'common/VideoEnv';\nimport { DataLoader } from 'common/DataLoader';\nimport IBallWorker from './loadData.worker'\n\nexport class IBallVideoEnv extends VideoEnv<GameID, VideoID, PlayerID> {\n\n  // @deprecated\n  // shotRecords: ShotRecord[] = []\n\n  // gaze events\n  onGaze?: (p: Gaze, player?: Player[]) => void\n  onUpdateLvInt?: (att: Attentions) => void\n  onUpdateLvSync?: (sync: boolean, hilights: Highlights) => void\n\n  #gazeQueue: Gaze[] = []\n  #frameQueue: FrameStamp[] = []\n  #mousePos: Point = { x: 0, y: 0 }\n  constructor(dataLoader = new DataLoader<GameID, VideoID, PlayerID>(IBallWorker)) {\n    super(dataLoader)\n\n    let ox: number | undefined = undefined\n    let oy: number | undefined = undefined\n    if (DEBUG.MOUSE_GAZE) {\n      document.body.addEventListener('mousemove', e => {\n        if (ox === undefined && oy === undefined) {\n          const bbox = document.getElementById('canvasWrapper')?.getBoundingClientRect()\n          if (bbox === undefined) return\n          ox = bbox.x\n          oy = bbox.y\n        }\n        //console.log('mousepos', e.clientX, e.clientY)\n        const { wScale = 1, hScale = 1 } = getCanvasAbsTopLeft()\n        this.#mousePos = { x: (e.clientX - ox!) * wScale, y: (e.clientY - oy!) * hScale }\n      })\n    }\n\n    // console.log('Gaze init----')\n    // const socket = new WebSocket('ws://localhost:5000/echo');\n    // socket.addEventListener('message', this.onSocket);\n  }\n\n  /**\n   * -------------- Gaze data ----------------\n   */\n  onSocket = (ev: any) => {\n    const rawGaze = JSON.parse(ev.data) as [[number, number], number]\n    const ts = Math.round(rawGaze[1] * 1000)\n    // get the closetFrame\n    const closetFrame = this.getClosetFrame(ts)\n    // console.warn('Cannot find closetframe of gaze', rawGaze)\n    if (!closetFrame) {\n      // maybe should find frame in lazy mode?\n      return\n    }\n\n    const { x: ox, y: oy, wScale = 1, hScale = 1 } = getCanvasAbsTopLeft()\n    const wOutToIn = window.innerWidth / window.outerWidth\n    const hOutToIn = window.innerHeight / window.outerHeight\n    const x = DEBUG.MOUSE_GAZE\n      ? this.#mousePos.x\n      : (rawGaze[0][0] * wOutToIn - ox) * wScale\n    const y = DEBUG.MOUSE_GAZE\n      ? this.#mousePos.y\n      : ((rawGaze[0][1] + 20) * hOutToIn - oy) * hScale\n\n    const gaze: Gaze = {\n      x, y,\n      ts,\n      fIdx: closetFrame?.fIdx,\n      videoId: closetFrame?.videoId\n    }\n    this.#gazeQueue.push(gaze)\n\n    // get lookat\n    const attendPlayers = this.getLookAt(gaze)\n    this.onGaze?.(gaze, attendPlayers)\n\n    // calculate inteLv\n    // save inteLv\n    this.updateInteLv(gaze, attendPlayers)\n  }\n\n  pushFrameHistory(data: FrameStamp) {\n    this.#frameQueue.push(data)\n  }\n  getClosetFrame(gTs: number) {\n    let minDist = Infinity\n    let minFrame = undefined\n    for (const frame of [...this.#frameQueue].reverse()) {\n      const dist = Math.abs(frame.ts - gTs)\n      if (dist < minDist) {\n        minDist = dist\n        minFrame = frame\n      }\n      // if not decrease anymore, stop\n      else break\n    }\n    return minFrame\n  }\n\n  get latestGaze() { return this.#gazeQueue[this.#gazeQueue.length - 1] }\n  getClosetGaze(fTs: number) {\n    let minDist = Infinity\n    let minGaze = undefined\n    for (const gaze of [...this.#gazeQueue].reverse()) {\n      const dist = Math.abs(gaze.ts - fTs)\n      if (dist < minDist) {\n        minDist = dist\n        minGaze = gaze\n      }\n      // if not decrease anymore, stop\n      else break\n    }\n    return minGaze\n  }\n\n  getLookAt(gaze: Gaze) {\n    const { x: gx, y: gy, videoId } = gaze\n    // frame data\n    // @TODO, can be error since the frame maybe not loaded in cur memory\n    if (videoId !== this.currentVideo?.id) return\n    const cf = this.frames?.[gaze.fIdx]\n    if (!cf?.players) return\n\n    const radius = GAZE_R\n    const attendedPlayers = cf.players.filter(({ bbox }) => {\n      return gx > (bbox.x - radius) &&\n        gy > (bbox.y - radius) &&\n        gx < (bbox.x + bbox.w + radius) &&\n        gy < (bbox.y + bbox.h + radius)\n    })\n    return attendedPlayers\n  }\n\n  #playerAttentions: Attentions = { lastTs: -1, fIdx: -1, videoId: undefined, players: {} }\n  updateInteLv(gaze: Gaze, attendPlayers?: Player[]) {\n    const { ts, fIdx } = gaze\n    const { lastTs, players } = this.#playerAttentions\n    const T = 1000 // ms\n    const decayRate = 1 / 5\n    // const maxAttention = incrRate * 19.144 * 0.96\n\n    /**\n     * Generalized weight increase algorithm.\n     * @param initialValue The starting weight of the player.\n     * @param dt The amount of time elapsed since the last update.\n     * @returns The new weight of the player.\n     */\n    function increaseFunction(initialValue: number, dt: number) {\n      return 1 - decayRate ** ((dt - (T * Math.log(1 - initialValue) / Math.log(5))) / T)\n    }\n\n    const newAttentions = lastTs === -1 ? players : Object.keys(players)\n      .reduce((o, pId) => {\n        const playerId = +pId as PlayerID\n        const base = players[playerId]?.att ?? 0\n        const att = base * Math.pow(decayRate, (ts - lastTs) / T)\n        const on = players[playerId]?.on ?? false\n        o[playerId] = {\n          on: att < LV_INTEREST_THRESHOLD.off ? false : on, // turn to false if less than threshold\n          att, looked: false\n        }\n        return o\n      }, {} as Record<PlayerID, AttentionWeights>)\n\n    if (attendPlayers) {\n      attendPlayers.forEach(({ id }) => {\n        if (!(id in newAttentions)) newAttentions[id] = { on: false, att: 0, looked: true }\n        const oldAttention = players[id]?.att ?? 0\n        const att = increaseFunction(oldAttention, ts - lastTs)\n        const on = att > LV_INTEREST_THRESHOLD.on\n          ? true\n          : newAttentions[id]!.on\n        newAttentions[id] = {\n          att, on, looked: true\n        }\n      })\n    }\n\n    this.#playerAttentions = {\n      lastTs: ts,\n      fIdx,\n      videoId: gaze.videoId,\n      players: newAttentions\n    }\n    this.onUpdateLvInt?.(this.#playerAttentions)\n  }\n\n  /**\n   * ----------------- Visualization Management\n   */\n  #keyPlayers: Array<{\n    fIdx: number,\n    videoId: string,\n    players: KeyPlayer[],\n  }> = []\n  #keyPlayer_buffer_size = 100\n\n  /**\n   * \n   * @param currentFIdx \n   * @param timeRange in sec\n   * @param ball \n   * @returns \n   */\n  getNextBallHolder(currentFIdx: number, timeRange: number, ball?: Ball, teamWithBall?: TeamID) {\n    timeRange *=  this.currentVideo?.frameRate! //params.VIDEO_FRAME_RATE\n    for (let i = currentFIdx; i < currentFIdx + timeRange; ++i) {\n      const nextFrame = this.frames?.[i]\n      if (!nextFrame) continue\n\n      const { ball: nextBall } = nextFrame\n      if (!nextBall?.playerId) continue\n\n      if (!ball?.playerId) {// now is empty\n        return PLAYER_META[nextBall.playerId].team === teamWithBall ? nextBall.playerId : undefined\n      } else { // now is not empty\n        if (nextBall.playerId !== ball.playerId && PLAYER_META[nextBall.playerId].team === PLAYER_META[ball.playerId].team) { // should be the same team\n          return nextBall.playerId\n        }\n      }\n    }\n  }\n\n  getEmptyPlayer(players?: Player[], ballHolderId?: PlayerID | null, teamWithBall?: TeamID) {\n    if (players === undefined || teamWithBall === undefined) return\n    const trackedPlayers = players.filter(({ tracking }) => tracking.x !== undefined && tracking.y !== undefined)\n    const defenders = trackedPlayers.filter(p => PLAYER_META[p.id].team !== teamWithBall)\n    const offensors = trackedPlayers.filter(p => PLAYER_META[p.id].team === teamWithBall)\n\n    const emptyOffensors: Array<[Player, number]> = []\n    for (const p of offensors) {\n      const { dataPkg, id } = p\n      if (id === ballHolderId) continue\n      if (!(dataPkg as OffensivePkg).inOffsensiveCourt) continue\n\n      const dists = defenders.map(d => distPoints(d.tracking, p.tracking))\n      if (dists.every(d => d > EMPTY_SPACE_THRESHOLD)) {\n        // TODO, dist to the basket\n        // dist to the ballholder\n        const { x: bx, y: by } = GOAL_BASKET_POS(p.id)\n        const distToBasket = distPoints(p.tracking, { x: bx, y: by })\n        emptyOffensors.push([p, distToBasket])\n      }\n    }\n    return emptyOffensors.sort((a, b) => a[1] - b[1]).map(d => d[0])\n  }\n\n  private lastFocus: { pos: Point } = { pos: { x: 0, y: 0 } }\n  fetchFocus() {\n    const gaze = this.latestGaze\n    if (!gaze) return this.lastFocus\n\n    let { pos } = this.lastFocus\n    const dx = Math.min(600, gaze.x - pos.x)\n    const dy = Math.min(600, gaze.y - pos.y)\n    pos = {\n      x: pos.x + dx,\n      y: pos.y + dy\n    }\n\n    this.lastFocus = { pos }\n    return this.lastFocus\n  }\n\n  // helper function  \n  #getPlayerTeam = (playerId?: PlayerID) => playerId ? PLAYER_META[playerId].team : undefined\n  pickPlayers(currentFIdx: number, focus?: { pos: Point; }) {\n    if (Object.keys(this.#keyPlayers).length > this.#keyPlayer_buffer_size) {\n      this.#keyPlayers.pop()\n    }\n\n    const currentFrame = this.frames?.[currentFIdx]\n    if (!currentFrame) return {}\n    const {\n      ball,\n      players,\n      teamWithBall = this.#getPlayerTeam(players?.find(p => p.id === ball?.playerId)?.id)\n    } = currentFrame\n\n    // attend players\n    const { players: playerAttentions } = this.#playerAttentions\n\n    // collect current\n    let currentlv1Players: Omit<KeyPlayer, 'last'>[] = []\n    let lv2Players: Lv2Player[] = []\n    // ball holder first\n    if (ball?.playerId) {\n      currentlv1Players.push({ id: ball.playerId, type: KeyPlayerType.BALL_HOLDER })\n      // should add to lv2 if sync\n      lv2Players.push({ id: ball.playerId, type: new Set([Lv2PlayerType.Normal]) })\n\n      // add the defender of the ball holder\n      // @Note, the defending field stores the defender of the ball holder, and the defending of defenders\n      const ballHolder = players?.find(p => p.id === ball.playerId)\n      ballHolder?.tracking.defending && lv2Players.push({\n        id: ballHolder?.tracking.defending as PlayerID,\n        type: new Set([Lv2PlayerType.Normal])\n      })\n      players?.filter(p => p.tracking.defending === ball.playerId).forEach(p => lv2Players.push({\n        id: p.id,\n        type: new Set([Lv2PlayerType.Normal])\n      }))\n    }\n\n    // who will get the ball in the next Xsec\n    const nextBallHolder = this.getNextBallHolder(currentFIdx, NEXT_BALL_HOLDER_TIME_RANGE, ball)\n    if (nextBallHolder && currentlv1Players.length < MAX_HIGHLIGHTED) {\n      currentlv1Players.push({ id: nextBallHolder, type: KeyPlayerType.NEXT_BALL_HOLDER })\n      lv2Players.push({ id: nextBallHolder, type: new Set([Lv2PlayerType.Normal]) })\n    }\n\n    const emptyPlayers = this.getEmptyPlayer(players?.filter(p => !currentlv1Players.some(d => d.id === p.id)), ball?.playerId, teamWithBall)\n    emptyPlayers\n      ?.filter(({ bbox }) => {\n        if (!focus) return true\n        const radius = 60\n        const { x: gx, y: gy } = focus.pos\n        return gx > (bbox.x - radius) &&\n          gy > (bbox.y - radius) &&\n          gx < (bbox.x + bbox.w + radius) &&\n          gy < (bbox.y + bbox.h + radius)\n      })\n      .forEach(p => {\n        if ((currentlv1Players.length + 1) < MAX_HIGHLIGHTED) {\n          currentlv1Players.push({ id: p.id, type: KeyPlayerType.EMPTY_PLAYER })\n          lv2Players.push({ id: p.id, type: new Set([Lv2PlayerType.Normal]) })\n        }\n      })\n\n    // management\n    let { players: lastLv1Players = [], fIdx: lastFIdx = 0, videoId: lastVideoId } = this.#keyPlayers?.[0] ?? {}\n    lastLv1Players = lastLv1Players\n      .filter(p => lastVideoId === this.currentVideo?.id) // && PLAYER_META[p.id].team === teamWithBall)\n    // exit\n    const exitPlayers = lastLv1Players\n      .filter(p =>  //p.last.status === 'exit' || \n        !currentlv1Players.find(cp => p.id === cp.id))\n      // update exist player's values\n      .map(p => {\n        p.last.status = 'exit'\n        p.last.progress -= currentFIdx - lastFIdx\n        return p\n      })\n\n    const updatePlayers = lastLv1Players\n      // U - E\n      .filter(p => !exitPlayers.find(ep => ep.id === p.id))\n      // .filter(p => currentlv1Players.find(cp => cp.id === p.id))\n      .map(p => {\n        // 6 / 30 s === 200ms\n        p.last.progress = Math.min(6, p.last.progress + currentFIdx - lastFIdx)\n        p.last.status = p.last.progress === 6 ? 'update' : 'enter'\n        return p\n      })\n\n    // enter\n    const enterPlayers = currentlv1Players\n      .filter(cp => !lastLv1Players.find(p => p.id === cp.id))\n      .map(p => {\n        ; (p as KeyPlayer).last = { status: 'enter', progress: 0 }\n        return p as KeyPlayer\n      })\n\n    // control here\n    const lv1Players: KeyPlayer[] = [\n      ...enterPlayers,\n      ...updatePlayers,\n      ...exitPlayers.filter(p => p.last.progress > 0)\n    ]\n\n    if (lv1Players.length >= MAX_HIGHLIGHTED) {\n      console.warn('More than the upper limit')\n    }\n\n    lv2Players = [\n      ...lv2Players,\n      ...lv1Players.map(p => ({\n        id: p.id,\n        type: new Set([Lv2PlayerType.Normal])\n      }))\n    ]\n\n    // Step2 find the interested players\n    if (params.LV_INTRE) {\n      Object.entries(playerAttentions)\n        .forEach(([pId, { att, on, looked }]) => {\n          lv2Players.push({ id: +pId as PlayerID, att, on, looked, type: new Set([Lv2PlayerType.Interest]) })\n        })\n    }\n\n    // cache the keyplayers\n    this.#keyPlayers.unshift({\n      fIdx: currentFIdx,\n      videoId: this.currentVideo!.id,\n      players: lv1Players\n    })\n\n    return {\n      lv1Players: lv1Players.reduce((o, p) => {\n        if (!(p.id in o)) {\n          o[p.id] = p\n        }\n        // use the higher rank\n        if (p.type < o[p.id].type) {\n          o[p.id].type = p.type\n        }\n\n        return o\n      }, {} as Record<PlayerID, KeyPlayer>),\n      //\n      lv2Players: lv2Players.reduce((o, p) => {\n        if (!(p.id in o)) o[p.id] = p\n        else {\n          o[p.id] = { ...o[p.id], ...p, type: union(p.type, o[p.id].type) }\n        }\n        return o\n      }, {} as Record<PlayerID, Lv2Player>),\n      teamWithBall,\n      ballHolder: players?.find(p => p.id === ball?.playerId)\n    }\n  }\n\n  /**\n   * -------------- Game data ----------------\n   */\n  scales = {\n    regionScale: scaleOrdinal<string>(schemeSet3),\n    twoPTColor: scaleSequential<string>(interpolateYlGnBu)\n      // .domain([-0.4, 0.4]),\n      .domain([0.2, 0.8]),\n    twoPT: scaleSequential<number>()\n      .domain([0, 0.4])\n      .range([0, 1]),\n    threePTColor: scaleSequential<string>(interpolateYlGnBu)\n      // .domain([-0.27, 0.27]),\n      .domain([0.2, 0.8]),\n    threePT: scaleSequential<number>()\n      .domain([0, 0.27])\n      .range([0, 1]),\n    radiusScale: scaleSqrt()\n      .domain([0, 1])\n      .range([1, hRadius]),\n    regionExp: scaleSequential<string>(interpolateReds)\n      .domain([0.1, params.GAME_ID === 'game1' ? 2 : 2.5])\n  } as const\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { App } from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n"],"sourceRoot":""}