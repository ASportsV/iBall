{"version":3,"sources":["../common/src/@types/index.ts","../common/src/@const/ui.ts","../common/src/@const/draw.ts","../common/src/@utils/array.ts","../common/src/@utils/async.ts","../common/src/@utils/debug.ts","../common/src/@utils/type.ts","../common/src/@utils/hash.ts","../common/src/@utils/video.ts","../common/src/@utils/geometry.ts","../common/src/@utils/worker.ts","@types/gameData.ts","../common/src/@draw/frame.ts","../common/src/@draw/object.ts","../common/src/@draw/geometry.ts","components/Visualizer/visualizeData.ts","@utils.ts","components/Visualizer/index.tsx","components/DebugCourt/index.tsx","../common/src/@components/Timeline/Interval.tsx","../common/src/@components/Timeline/index.tsx","../common/src/@components/SVGOverlay/index.tsx","components/SVGOverlay/index.tsx","components/CommentBox/index.tsx","components/Danmu/index.tsx","components/Onboarding/fig_dataVis.jpg","components/Onboarding/index.tsx","components/Contact/index.tsx","../common/src/DataLoader/loadFrames.worker.ts","../common/src/DataLoader/DataLoader.ts","../common/src/DataLoader/Database.ts","../common/src/VideoEnv/VideoPlayer/VideoLoader.ts","../common/src/VideoEnv/VideoPlayer/VideoPlayer.ts","../common/src/VideoEnv/index.ts","VideoEnv/loadData.worker.ts","VideoEnv/DataLoader.ts","VideoEnv/index.ts","filebase.ts","App.tsx","index.tsx","@const/players.ts","@const/gaze.ts","@const/style.ts","@const/index.ts","param.ts","../common/src/@types/basic.ts"],"names":["TPlayerOption","DEBUG","COLORS","ArrayToDict","arr","key","reduce","o","f","union","setA","setB","_union","Set","elem","add","wait","ms","a","Promise","resolve","reject","setTimeout","waitUntil","checkFun","interval","setInterval","bytesToMB","bytes","toFixed","debugMem","memory","performance","console","debug","usedJSHeapSize","totalJSHeapSize","_intervalIdGen","intervalIdGen","getImg","src","img","Image","onload","e","URL","revokeObjectURL","undefined","globalFIdxToLocal","globalFrameIdx","videos","accFrame","videoIdx","length","video","maxFrame","frameIdx","distPoints","p1","p2","dx","x","dy","y","Math","sqrt","getAngle","x1","y1","x2","y2","radians","atan2","PI","wrapWorker","workerFunc","cb","worker","args","postMessage","addEventListener","handler","data","removeEventListener","PLAYER_STATUS","KeyPlayerType","Lv2PlayerType","drawRawFrame","layer","frame","darkenAlpha","canvas","width","height","ctx","drawImage","drawOverlay","alpha","save","fillStyle","fillRect","restore","internalCanvas","document","createElement","getContext","entries","obj","Object","applyStyle","style","forEach","lineWidth","strokeStyle","font","textBaseline","lineCap","lineJoin","value","pattern","globalAlpha","opacity","roundTo2PI","r","drawVis","visCtx","circles","sheilds","debugCtx","b","c","d","setTransform","circleTXY","map","cx","cy","tx","ty","filter","inOffsensiveCourt","_","cIdx","offense_outer_border","beginPath","arc","in_r","fill","size","out_r","globalCompositeOperation","offense_bg_fill","stroke","offense_inner_border","drawVisRings","invertTXY","getA1A2","tangle","tdist","a1","max","min","MIN_DIST","MAX_DIST","a2","sheild","theta","cos","sin","ox","oy","grd","createLinearGradient","addColorStop","off_df_link","shadowColor","shadowBlur","moveTo","lineTo","smoothDFdiff","dist","pow","atan","tan","ma1","ma2","defense_bg_fill","defense_fg_fill","drawVisSheilds","drawGlows","players","savedFG","player","bbox","w","h","on","att","LV_INTEREST_THRESHOLD","off","drawSpotLights","frames","last","progress","r1","type","EMPTY_PLAYER","STAR","dAlpha","nodes","uNodes","faces","i","z","p","n","face","rotateX3D","sinTheta","cosTheta","node","translate","v0","v1","v2","v3","closePath","_draw","TEXT_HILIGHT","internalCtx","drawHL","mask","lv1Players","lv2Players","features","ballHolder","filter_focus","pos","createRadialGradient","FOCUS","mina","maxa","unImportantPlayers","find","lv2","id","lv1","lv2PlayerLooked","has","Interest","looked","lv2PlayerNotLooked","lp","vis_key_player","shooterIcon","process","defenderIcon","starIcon","ICONS","shooter","defender","star","drawIcon","iconHeight","offset","icon","iconWidth","star_star","drawName","namePos","lastname","PLAYER_META","ln","star_name","player_name","textAlign","textwidth","measureText","textheight","fillText","floor","getRegionKey","area","match","getArea","AREA","RANGE","mapRegionToPoint","region","endsWith","hexbin","d3Hexbin","LOC_X","LOC_Y","radius","SHOT_ZONE_AREA","BASIC","SHOT_ZONE_BASIC","SHOT_ZONE_RANGE","FGA","FGM","rate","FG_PCT","exp","getCanvasAbsTopLeft","elm","getElementById","getBoundingClientRect","window","outerHeight","wScale","hScale","Scales","regionScale","scaleOrdinal","schemeSet3","twoPTColor","scaleSequential","interpolateYlGnBu","domain","twoPT","range","threePTColor","threePT","radiusScale","scaleSqrt","regionExp","interpolateReds","params","GAME_ID","layerIds","Visualizer","layers","l","isOnLv2Player","Normal","keypoints","team","left_hip","right_hip","left_ankle","right_ankle","preProps","currentFrameIdx","this","props","currentFrame","playerFlags","cleanAllExcept","currentFrameData","videoEnv","ball","gaze_filter","fetchFocus","pickPlayers","onPickPlayers","dataToVis","offensiveRings","dataPkg","mode","offensive","vis_off_ring","smoothRegionExp","get2DPos","defensiveSheilds","defensive","vis_def_sheild","diff","speed","defendingPlayer","draw","playerId","values","ip","currentVideo","className","alt","idx","ref","children","layerId","keys","lId","clearRect","React","Component","scaleT2Minimap","miniMapSize","HexaBin","memo","isIn","strokeWidth","hexagon","Hexagon","playerBins","currentBin","position","overflow","transform","Court","playerMarkers","tracking","mIdx","top","left","backgroundColor","includes","color","fontSize","push","playerWithBall","getCurrentBin","getPlayerBins","displayName","Interval","state","isMoving","isAdjusting","cursorStatus","onResizeStart","direction","button","stopPropagation","mx","clientX","setState","oBBox","body","classList","onResizing","preventDefault","stopImmediatePropagation","getEW","wx","ex","onAdjusting","onResizeEnd","onAdjustingEnd","remove","onMoveStart","onMoving","newx","onMoveEnd","focused","initializing","clsx","onMouseDown","parentDim","currentTarget","parentElement","abs","onMouseMove","onClick","onClickInterval","pad","num","slice","hhmmss","secs","t","minutes","Timeline","createRef","imgWidth","intervalSelectorHeight","parentOffsetx","isDrawing","onDrawStart","scrollLeft","clientY","bottom","enableClips","clips","frame2pos","start","end","curFrame","pos2frame","newIntervalId","newInterval","onUpsertClip","intervalId","omx","onDrawing","drawingInterval","int","maxdx","mindx","startFrame","endFrame","onDrawEnd","drawingIntervalIdx","findIndex","updateInterval","clipId","end_","targetIntervalIdx","targetInterval","intervalIdx","numberOfImg","intervalCount","trackWidth","totalTrackWidth","globalMaxFrames","round","v","trackWidthFactor","localFIdx","accFrameIdx","localFIdxToGlobalFIdx","currentVideoIdx","frameRate","ceil","maxTime","containerHeightPadding","prevProps","current","innerWidth","documentElement","clientWidth","right","log","scrollTo","behavior","focusedClipId","globalCurFrameIdx","containerHeight","currentTime","flex","isTransit","loadedData","loadedVideo","renderClips","SVGLayer","activeBBoxes","viewBox","preserveAspectRatio","target","onClickBG","onContextMenu","onDoubleClick","onDBClick","floodColor","result","in","onClickPlayer","screenPos","onClickBall","Overlay","gaze","gazePlayers","svgLayerProps","GAZE_R","textAnchor","alignmentBaseline","fIdx","some","CommentBox","text","activeIndex","matches","triggleUpdatePlayerEntities","names","namesToSearch","toInsert","newText","replace","playerEntities","Array","from","query","name","toLowerCase","RegExp","onUpdatePlayerEntity","onChange","lastIndex","search","startsWith","m","onKeyDown","event","trim","onSend","existPlayers","pId","flatMap","fn","placeholder","index","href","Message","random","onUpdateStatus","getDuration","content","status","transitionDuration","Danmu","danmuQueue","s","targetDanmu","prevState","snapshot","comments","queue","toLoad","videoId","every","danmu","OnBoard","showProgress","showSkipButton","continuous","styles","tooltip","fontFamily","tooltipTitle","fontWeight","steps","title","fig_vis","placement","options","autoPlay","loop","disableBeacon","disableScrolling","Contact","rel","Worker_fn","Worker","DataLoader","MyWorker","memVideoData","onLoad","onUnload","vId","shouldWait","isLoaded","progressOffset","framesToSave","itemsForBatch","all","createObjectURL","sort","Dexie","VideoLoader","memVideos","nextVideo","gameId","load","onloadeddata","VideoTrack","videoPlayer","CallBackHandle","onPlay","onPause","invokeFrameHandlers","now","metadata","currentTrack","mediaTime","frameOffset","len","onFrameHandlers","call","Date","requestVideoFrameCallback","videoElm","cancelVideoFrameCallback","play","VideoPlayer","_currentTrack","videoSources","ATrack","BTrack","whichOnPause","ev","whichOnPlay","addOnFrameListener","ts","videoFrame","curVideoIdx","warn","nextVideoIdx","preloadToAnotherTrack","pause","loadVideo","splice","fetch","trackToLoad","trackToUnload","unLoad","newVideo","setVideo","getVideo","paused","VideoEnv","dataLoader","progres","getVideoData","IBallDataLoader","IBallWorker","playerIds","IBallVideoEnv","onGaze","onUpdateLvInt","onUpdateLvSync","onSocket","rawGaze","JSON","parse","closetFrame","getClosetFrame","wOutToIn","outerWidth","hOutToIn","innerHeight","attendPlayers","getLookAt","updateInteLv","lastTs","lastFocus","stringify","gTs","minDist","Infinity","minFrame","reverse","fTs","minGaze","gx","gy","cf","newAttentions","initialValue","dt","oldAttention","currentFIdx","timeRange","teamWithBall","nextFrame","nextBall","ballHolderId","trackedPlayers","defenders","offensors","emptyOffensors","EMPTY_SPACE_THRESHOLD","GOAL_BASKET_POS","bx","by","distToBasket","latestGaze","filter_center","pop","playerAttentions","currentlv1Players","BALL_HOLDER","defending","nextBallHolder","getNextBallHolder","NEXT_BALL_HOLDER_TIME_RANGE","MAX_HIGHLIGHTED","NEXT_BALL_HOLDER","emptyPlayers","vis_empty_player","getEmptyPlayer","lastLv1Players","lastFIdx","lastVideoId","exitPlayers","cp","updatePlayers","ep","enterPlayers","gaze_focus","unshift","loadBins","app","initializeApp","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","db","getFirestore","COLLECTION_NAME","postComment","meta","pickedPlayers","rest","addDoc","collection","serverTimestamp","docRef","error","getComment","getDocs","querySnapshot","commentsGroupBy","doc","seconds","subscribe","q","onSnapshot","docChanges","change","enabledFeatures","vis_top_view","App","pauseLoading","currentGaze","attentions","attentionsOverTime","playerFlag","playing","pushFrameHistory","localFrameIdx","seekTo","onPlayVideo","VIDEO_IDS","then","json","max_frame","start_frame","fps","version","startFame","newCurVideoIdx","fetchVideos","inGamePlayerIds","newComments","loadedPrecentage","buildStyles","pathColor","textColor","trailColor","k","checked","split","join","teamA","teamB","localeCompare","disabled","renderProgressbar","pIds","clean","renderToggle","renderPlayerToggle","ReactDOM","render","StrictMode","2760","offSpeed","2738","101106","201575","203110","203105","203084","203546","203949","1626172","202691","2571","201578","2733","201939","201574","101112","2563","202697","2747","2592","203099","203925","203895","201567","202681","2544","203521","2590","2210","201619","202389","202684","201566","201627","203079","2555","202713","200779","201586","202683","203500","201571","203460","1626166","201142","202362","101108","200755","2746","201599","203143","2037","201601","203085","201933","202325","1718","202332","miniMapWidth","BG_MASK_ALPHA","FG_MASK_ALPHA","VIDEO_ID_GROUPS","game2_unit0","game1_unit0","game1_unit1","game1_unit2","game2_unit1","game2_unit2","Parameters","UNIT_ID","global","location","URLSearchParams","get","alert","unitId","toUpperCase","initParams","Side","Direction"],"mappings":"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","file":"static/js/main.00fd672e.chunk.js","sourcesContent":["export * from './basic'\nexport * from './data'\nexport * from './ui'\nexport * from './database'\nexport * from './draw'\n\n// iball\nexport type Overwrite<T, U> = Pick<T, Exclude<keyof T, keyof U>> & U;\n\n/**\nCreate a type that requires exactly one of the given keys and disallows more. The remaining keys are kept as is.\nUse-cases:\n- Creating interfaces for components that only need one of the keys to display properly.\n- Declaring generic keys in a single place for a single use-case that gets narrowed down via `RequireExactlyOne`.\nThe caveat with `RequireExactlyOne` is that TypeScript doesn't always know at compile time every key that will exist at runtime. Therefore `RequireExactlyOne` can't do anything to prevent extra keys it doesn't know about.\n@example\n```\nimport {RequireExactlyOne} from 'type-fest';\ntype Responder = {\n    text: () => string;\n    json: () => string;\n    secure: boolean;\n};\nconst responder: RequireExactlyOne<Responder, 'text' | 'json'> = {\n    // Adding a `text` key here would cause a compile error.\n    json: () => '{\"message\": \"ok\"}',\n    secure: true\n};\n```\n@category Object\n*/\nexport type RequireExactlyOne<ObjectType, KeysType extends keyof ObjectType = keyof ObjectType> =\n    { [Key in KeysType]: (\n        Required<Pick<ObjectType, Key>> &\n        Partial<Record<Exclude<KeysType, Key>, never>>\n    ) }[KeysType] & Omit<ObjectType, KeysType>;\n\nexport enum TPlayerOption {\n    Far = 1,\n    Near = 0,\n    Both = -1\n}\n","export const DEBUG = {\n    OVERLAY: false,\n    COURT: true,\n    GAZE: false,\n    BBOX: false,\n    LINE: false,\n    ATTENTIONS: false,\n    TIMELINE: true,\n    MOUSE_GAZE: true,\n    DEBUG_MEM: false\n}","\nexport const COLORS = {\n    offense_inner_border: '#f5f5f5',\n    offense_bg_fill: '#f5f5f577',\n    offense_outer_border: 'rgba(220, 220, 220, 0.1)',\n    defense_bg_fill: `rgba(255, 255, 255, 0.15)`,\n    defense_fg_fill: `#f5f5f5`,\n    player_name: '#f5f5f5',\n    BG_MASK_ALPHA: 0.25,\n    FG_MASK_ALPHA: 0.2,\n    off_df_link: '255, 255, 255',\n    star_name: 'rgb(255, 243, 194)',\n    star_star: 'rgb(255, 243, 194)', // 'rgb(255,215,120)'\n} as const","export const extent = (d: number[]) => {\n  return [\n    Math.min(...d),\n    Math.max(...d)\n  ] as [number, number]\n}\n\nexport function standardDeviation(array?: number[]) {\n  if (!array || array.length === 0) return 0\n  const n = array.length\n  const mean = array.reduce((a, b) => a + b) / n\n  return Math.sqrt(array.map(x => Math.pow(x - mean, 2)).reduce((a, b) => a + b) / n)\n}\n\nexport function ArrayToDict<T, K extends keyof T>(arr: T[], key: K) {\n  return arr.reduce((o, f) => {\n    o[f[key] as any] = f\n    return o\n  }, {} as Record<string | number | symbol, T>)\n}\n\nexport function union<T>(setA: Set<T>, setB: Set<T>) {\n  const _union = new Set(setA);\n  for (const elem of setB) {\n    _union.add(elem);\n  }\n  return _union;\n}\n\n\nif (process.env.NODE_ENV !== 'production') {\n  (global as any).$RefreshReg$ = () => { };\n  (global as any).$RefreshSig$ = () => () => { };\n}","export async function wait(ms: number) {\n  return new Promise((resolve, reject) => {\n    setTimeout(resolve, ms)\n  })\n}\n\nexport async function waitUntil(checkFun: () => boolean, interval = 70) {\n  return new Promise(resolve => {\n    setInterval(() => {\n      if (checkFun())\n        resolve(null)\n    }, interval)\n  })\n}","function bytesToMB(bytes: number) {\n  return (bytes / 1024 / 1024).toFixed(2)\n}\n\nexport function debugMem() {\n  const memory: any = (performance as any).memory\n  console.debug(`Used / Total: ${bytesToMB(memory.usedJSHeapSize)}mb / ${bytesToMB(memory.totalJSHeapSize)}mb`)\n}\n\nexport function debugLog() {\n  return (target: any, prop: string, descriptior: PropertyDescriptor = Object.getOwnPropertyDescriptor(target, prop)!) => {\n    const originalMethod = descriptior.value;\n\n    if (descriptior.value[Symbol.toStringTag] === 'AsyncFunction') {\n      //editing the descriptor/value parameter\n      descriptior.value = async function (...args: any[]) {\n        // note usage of originalMethod here\n        console.group(`%c>>>>> Call:${prop}`, 'background: #222; color: #bada55');\n        const ret = await originalMethod.apply(this, args);\n        console.groupEnd()\n        // console.groupEnd(`%c<<<< End:${prop}`, 'background: #222; color: #bada55');\n        return ret\n      };\n\n    } else {\n      //editing the descriptor/value parameter\n      descriptior.value = function (...args: any[]) {\n        // note usage of originalMethod here\n        console.log(`%c>>>>> Call:${prop}`, 'background: #222; color: #bada55');\n        const ret = originalMethod.apply(this, args);\n        console.log(`%c<<<< End:${prop}`, 'background: #222; color: #bada55');\n        return ret\n      };\n    }\n\n    // return edited descriptor as opposed to overwriting the descriptor\n    return descriptior;\n  }\n}\n","import { Point } from \"../@types/basic\"\n\n/**\n * type grauding\n */\n// export function isEnitity(t: SpacyRet) {\n//     return t.ent_type !== '' || ['NOUN', 'VERB', 'AUX'].includes(t.pos) || t.tag.startsWith('VB') || t.coref?.some(r => r.ent_type)\n// }\n\nexport const isPoint = (p: any): p is Point => typeof p === 'object' &&\n    'x' in p &&\n    'y' in p &&\n    typeof p['x'] === 'number' &&\n    typeof p['y'] === 'number' ","let _intervalIdGen = 0\nexport function intervalIdGen() {\n    return ++_intervalIdGen\n}\n\nexport function getHash(input: string) {\n    let hash = 0, len = input.length;\n    for (var i = 0; i < len; i++) {\n        hash = ((hash << 5) - hash) + input.charCodeAt(i);\n        hash |= 0; // to 32bit integer\n    }\n    return hash;\n}","import { BaseVideo } from \"../@types\"\n\nexport async function getImg(src: string) {\n  const img = new Image()\n  img.src = src\n  await new Promise(resolve => {\n    img.onload = e => {\n      URL.revokeObjectURL(src)\n      resolve(undefined)\n    }\n  })\n  return img\n}\n\nexport function globalFIdxToLocal<GameID extends string, VideoID extends string>(globalFrameIdx: number, videos: BaseVideo<GameID, VideoID>[]) {\n  let accFrame = 0\n  let videoIdx = 0\n  for (videoIdx = 0; videoIdx < videos.length; ++videoIdx) {\n    const video = videos[videoIdx]\n    if (globalFrameIdx >= accFrame && globalFrameIdx < accFrame + video.maxFrame) {\n      break\n    } else {\n      accFrame += video.maxFrame\n    }\n  }\n  const newCurFrameIdx = globalFrameIdx - accFrame\n  return { videoIdx, frameIdx: newCurFrameIdx }\n}\n\nexport function localFIdxToGlobalFIdx<GameID extends string, VideoID extends string>(videoIdx: number, localFIdx: number, videos: BaseVideo<GameID, VideoID>[]) {\n  let accFrameIdx = 0\n  for (let i = 0; i < videoIdx; ++i)\n    accFrameIdx += videos[i].maxFrame\n  return accFrameIdx + localFIdx\n}\n","import { Point } from \"../@types\"\n\nexport const arr2Point = (arr: [number, number]): Point => ({ x: arr[0], y: arr[1] })\n\nexport const distPoints = (p1: Point, p2: Point) => {\n\n    const dx = p1.x - p2.x\n    const dy = p1.y - p2.y\n\n    return Math.sqrt(dx * dx + dy * dy)\n}\n\nexport const diffPoints = (p1: Point, p2: Point) => ({ x: p1.x - p2.x, y: p1.y - p2.y })\nexport const addPoints = (p1: Point, p2: Point) => ({ x: p1.x + p2.x, y: p1.y + p2.y })\nexport const centerOfPoints = (points: Point[] | Array<[number, number]>): Point => {\n    if (typeof points[0] === 'object') {\n        const oPoints: Point[] = points as Point[]\n        return {\n            x: oPoints.reduce((o, p) => o + p.x, 0) / oPoints.length,\n            y: oPoints.reduce((o, p) => o + p.y, 0) / oPoints.length,\n        }\n    }\n    const aPoints: Array<[number, number]> = points as Array<[number, number]>\n    return {\n        x: aPoints.reduce((o, p) => o + p[0], 0) / aPoints.length,\n        y: aPoints.reduce((o, p) => o + p[1], 0) / aPoints.length,\n    }\n}\n\nexport const extendCrossLine = (from: Point, to: Point, extend: number = 0): Point => {\n    let k = (to.y - from.y) / (to.x - from.x)\n    k = -1 / k\n\n    const center = centerOfPoints([from, to])\n\n    const theta = Math.atan(k)\n    const dy = Math.abs(extend * Math.sin(theta))\n    const dx = Math.abs(extend * Math.cos(theta))\n\n    const direc = (extend / Math.abs(extend)) || 0\n\n    return { x: center.x + direc * dx, y: center.y + direc * dy }\n}\n\nexport const extendLine = (from: Point, to: Point, extend: number = 0): Point => {\n\n    const k = (to.y - from.y) / (to.x - from.x)\n\n    const theta = Math.atan(k)\n    const dy = Math.abs(extend * Math.sin(theta))\n    const dx = Math.abs(extend * Math.cos(theta))\n\n    const direcX = (extend / Math.abs(extend)) || 0 //((to.x - from.x) / Math.abs(to.x - from.x)) || 0\n    const direcY = direcX //((to.y - from.y) / Math.abs(to.y - from.y)) || 0\n\n    return { x: to.x + direcX * dx, y: to.y + direcY * dy }\n}\n// perpendicular line\nexport const crossLine = (from: Point, to: Point, extend: number = 0): Point => {\n    const k = (to.y - from.y) / (to.x - from.x)\n    const k2 = -1 / k\n    const theta = Math.atan(k2)\n    const cP = centerOfPoints([from, to])\n\n    const dy = Math.abs(extend * Math.sin(theta))\n    const dx = Math.abs(extend * Math.cos(theta))\n\n    const direcX = ((to.x - from.x) / Math.abs(to.x - from.x)) || 0\n    const direcY = ((to.y - from.y) / Math.abs(to.y - from.y)) || 0\n\n    return { x: cP.x + direcX * dx, y: cP.y + -direcY * dy }\n\n}\n\nconst getLineFromPoints = (line: [Point, Point]) => {\n    const k = (line[1].y - line[0].y) / (line[1].x - line[0].x)\n    const b = line[0].y - k * line[0].x\n\n    return { k, b }\n}\n\n\nexport const intersectionOf2Lin = (line1: [Point, Point], line2: [Point, Point]): Point => {\n    const { k: k1, b: b1 } = getLineFromPoints(line1)\n    const { k: k2, b: b2 } = getLineFromPoints(line2)\n\n    // console.debug(`\n    //   ${line1[0].y} = ${k1 * line1[0].x + b1}\n    //   ${line1[1].y} = ${k1 * line1[1].x + b1}\n\n    //   ${line2[0].y} = ${k2 * line2[0].x + b2}\n    //   ${line2[1].y} = ${k2 * line2[1].x + b2}\n    // `)\n\n    const xi = (b2 - b1) / (k1 - k2)\n    const yi = k1 * xi + b1\n\n    // console.debug(`\n    //   line1: (${line1[0].x},${line1[0].y}) (${line1[1].x},${line1[1].y})\n    //   line2: (${line2[0].x},${line2[0].y}) (${line2[1].x},${line2[1].y})\n    // `)\n    // console.debug(`\n    //   xi: ${xi}, yi: ${yi}\n    // `)\n\n    return { x: xi, y: yi }\n}\n\n\nexport const atan2Normalized = (y: number, x: number) => {\n    var result = Math.atan2(y, x);\n    if (result < 0) {\n        result += (2 * Math.PI);\n    }\n    return result;\n}\n\nexport function getAngle(x1: number, y1: number, x2: number, y2: number) {\n    const [dx, dy] = [x2 - x1, y2 - y1]\n    let radians = (dx || dy)\n        ? Math.atan2(dy, dx)\n        : 0\n    if (radians < 0) radians += 2 * Math.PI\n    return radians * (180 / Math.PI)\n}\n\n// Return: Close approximation of the length of a Cubic Bezier curve\n//\n// Ax,Ay,Bx,By,Cx,Cy,Dx,Dy: the 4 control points of the curve\n// sampleCount [optional, default=40]: how many intervals to calculate\n// Requires: cubicQxy (included below)\n//\nexport function cubicBezierLength(A: Point, B: Point, C: Point, D: Point, sampleCount = 40) {\n    var ptCount = sampleCount;\n    var totDist = 0;\n    var lastX = A.x;\n    var lastY = A.y;\n    var dx, dy;\n    for (var i = 1; i < ptCount; i++) {\n        var pt = cubicQxy(i / ptCount, A.x, A.y, B.x, B.y, C.x, C.y, D.x, D.y);\n        dx = pt.x - lastX;\n        dy = pt.y - lastY;\n        totDist += Math.sqrt(dx * dx + dy * dy);\n        lastX = pt.x;\n        lastY = pt.y;\n    }\n    dx = D.x - lastX;\n    dy = D.y - lastY;\n    totDist += Math.sqrt(dx * dx + dy * dy);\n    return Math.floor(totDist);\n}\n\n\n// Return: an [x,y] point along a cubic Bezier curve at interval T\n//\n// Attribution: Stackoverflow's @Blindman67\n// Cite: http://stackoverflow.com/questions/36637211/drawing-a-curved-line-in-css-or-canvas-and-moving-circle-along-it/36827074#36827074\n// As modified from the above citation\n// \n// t: an interval along the curve (0<=t<=1)\n// ax,ay,bx,by,cx,cy,dx,dy: control points defining the curve\n//\nfunction cubicQxy(t: number, ax: number, ay: number, bx: number, by: number, cx: number, cy: number, dx: number, dy: number) {\n    ax += (bx - ax) * t;\n    bx += (cx - bx) * t;\n    cx += (dx - cx) * t;\n    ax += (bx - ax) * t;\n    bx += (cx - bx) * t;\n    ay += (by - ay) * t;\n    by += (cy - by) * t;\n    cy += (dy - cy) * t;\n    ay += (by - ay) * t;\n    by += (cy - by) * t;\n    return ({\n        x: ax + (bx - ax) * t,\n        y: ay + (by - ay) * t\n    });\n}\n\n// cubic bezier percent is 0-1\nexport function getCubicBezierXYatPercent(startPt: Point, controlPt1: Point,\n    controlPt2: Point, endPt: Point, percent: number) {\n    const x = CubicN(percent, startPt.x, controlPt1.x, controlPt2.x, endPt.x);\n    const y = CubicN(percent, startPt.y, controlPt1.y, controlPt2.y, endPt.y);\n    return ({ x: x, y: y });\n}\n\n// cubic helper formula at percent distance\nfunction CubicN(pct: number, a: number, b: number, c: number, d: number) {\n    var t2 = pct * pct;\n    var t3 = t2 * pct;\n    return a + (-a * 3 + pct * (3 * a - a * pct)) * pct\n        + (3 * b + pct * (-6 * b + b * 3 * pct)) * pct\n        + (c * 3 - c * 3 * pct) * t2\n        + d * t3;\n}","export function wrapWorker<In extends unknown[], Out>(\n  workerFunc: { new(): Worker },\n  key: string,\n  cb?: (...args: any[]) => void): (...args: In) => Promise<Out> {\n  const worker = new workerFunc()\n  return async (...args: In) => {\n    worker.postMessage([key, ...args])\n\n    return await new Promise<Out>(resolve => {\n      const handler = (e: MessageEvent<any>) => {\n        if (e.data[0] !== key) {\n          cb?.(e.data)\n          return\n        }\n        worker.removeEventListener('message', handler)\n        resolve(e.data[1])\n      }\n      worker.addEventListener('message', handler)\n    })\n  }\n}","import { Overwrite } from \"common/@types\"\nimport type { PlayerID, VideoID } from \"./index\"\n\nexport enum PLAYER_STATUS {\n  offensive = 'in_offensive',\n  defensive = 'in_defensive',\n  other = 'in_other'\n}\nexport interface OffensivePkg {\n  mode: PLAYER_STATUS.offensive\n  region: string\n  diff: number\n  eDiff: number\n  freq: number\n  regionRate: number\n  regionExp: number\n  smoothRegionExp: number\n  inOffsensiveCourt: boolean\n}\nexport interface DefensivePkg {\n  mode: PLAYER_STATUS.defensive\n  defendingPlayer: PlayerID\n  tangle: number\n  tdist: number\n  diff: number\n  smoothDFdiff: number\n  speed: number\n  freq: number\n}\nexport type DataPkg = OffensivePkg | DefensivePkg\n\nexport interface FrameStamp {\n  videoId: VideoID\n  fIdx: number\n  ts: number\n}\n\nexport interface Gaze extends FrameStamp {\n  x: number,\n  y: number\n}\n\nexport type AttentionWeights = { att: number, looked: boolean, on: boolean }\n\n// Partial<Record<PlayerId, { att: number, looked: boolean, on: boolean }>>\nexport interface Attentions {\n  lastTs: number\n  fIdx: number\n  videoId?: VideoID\n  players: Partial<Record<PlayerID, AttentionWeights>>\n}\n\nexport type HighlightWeights = Partial<Record<PlayerID, { lostTs: number, sync: boolean }>>\nexport interface Highlights {\n  lastTs: number\n  players: HighlightWeights\n}\n\nexport interface DefenseRecord {\n  PLAYER_ID: PlayerID\n  DEFENSE_CATEGORY: string,\n  FREQ: number,\n  D_FGM: number,\n  D_FGA: number,\n  D_FG_PCT: number,\n  NORMAL_FG_PCT: number,\n  PCT_PLUSMINUS: number,\n  AVG_DEF_SPEED: number\n}\n\nexport enum KeyPlayerType {\n  BALL_HOLDER = 0,\n  NEXT_BALL_HOLDER = 1,\n  EMPTY_PLAYER = 2,\n  STAR = 3,\n  TEXT_HILIGHT = 4\n}\nexport interface KeyPlayer {\n  id: PlayerID\n  last: { progress: number, status: 'enter' | 'update' | 'exit' } // in frames, exist when NEXT_BALL_HOLDER\n  type: KeyPlayerType\n}\nexport enum Lv2PlayerType {\n  Interest = 1,\n  Normal = 2,\n  Normal_Interest = 3,\n}\nexport interface Lv2Player extends Partial<AttentionWeights> {\n  id: PlayerID\n  type: Set<Lv2PlayerType>\n}\n\nexport type CachePlayerBin = Overwrite<PlayerShotBin, {\n  region: { AREA: string, BASIC: string, RANGE: string }\n}>\n\nexport interface ShotRecord {\n  // shot_id: string\n  // ACTION_TYPE: string\n  // EVENT_TYPE: string // \"Missed Shot\"\n  GAME_EVENT_ID: string // \"555\"\n  GAME_ID: string // \"21500030\"\n  // GRID_TYPE: string //\"Shot Chart Detail\"\n  // HTM: string //\"HOU\"\n  LOC_X: number //\"-68\"\n  LOC_Y: number // \"242\"\n  // MINUTES_REMAINING: number //\"3\"\n  // PERIOD: number //\"4\"\n  PLAYER_ID: PlayerID //\"203546\"\n  // PLAYER_NAME: string //\"Ian Clark\"\n  // SECONDS_REMAINING: number // \"18\"\n  // SHOT_ATTEMPTED_FLAG: string // \"1\"\n  // SHOT_DISTANCE: number // \"25\"\n  made: number // \"0\"\n  // SHOT_TYPE: string //\"3PT Field Goal\"\n  SHOT_ZONE: { AREA: string, BASIC: string, RANGE: string }\n  // _AREA: string //\"Center(C)\"\n  // SHOT_ZONE_BASIC: string // \"Above the Break 3\"\n  // SHOT_ZONE_RANGE: string //\"24+ ft.\"\n  // TEAM_ID: number //\"1610612744\"\n  // VTM: string //\"GSW\"\n}\n\nexport type PlayerShotBin = {\n  region: string\n  regionRate: number\n  regionFreq: number // freq in this bin by region\n  regionExp: number // expect point value\n  diff: number // ergion diff to league average\n  eDiff: number\n  x: number\n  y: number\n}","import { COLORS } from \"../@const/draw\";\nimport { Layer } from \"../@types\";\n\nfunction drawRawFrame(layer: Layer, frame: CanvasImageSource, darkenAlpha = 0.1) {\n    const { width, height } = layer.canvas\n    layer.ctx.drawImage(frame, 0, 0, width, height);\n\n    if (darkenAlpha !== 0) {\n        drawOverlay(layer, darkenAlpha)\n    }\n}\n\nfunction drawOverlay(layer: Layer, alpha: number = COLORS.BG_MASK_ALPHA) {\n    const { ctx, canvas } = layer\n    const { width, height } = canvas\n\n    ctx.save()\n    ctx.fillStyle = `rgba(0, 0, 0, ${alpha})`;\n    ctx.fillRect(0, 0, width, height);\n    ctx.restore()\n}\n\nfunction fadeOutLayer(layer: Layer, alpha: number) {\n    layer.ctx.save()\n    layer.ctx.globalAlpha = alpha\n    layer.ctx.globalCompositeOperation = 'copy';\n    layer.ctx.drawImage(layer.canvas, 0, 0)\n    layer.ctx.restore()\n}\n\n\nexport {\n    drawRawFrame as bg,\n    drawOverlay as overlay,\n    fadeOutLayer as fadeOutFrame\n}","import type { Layer } from \"../@types/draw\";\nimport type { BasePlayer } from \"../@types/data\";\nimport type { Point } from \"../@types/basic\";\nimport { fadeOutFrame } from './frame'\n\nfunction drawBall(layer: Layer, ball?: Point, trail = false) {\n\n  const { width, height } = layer.canvas\n  if (trail) {\n    fadeOutFrame(layer, 0.9)\n  } else {\n    layer.ctx.clearRect(0, 0, width, height)\n  }\n\n  if (ball) {\n    const { x: cx, y: cy } = ball\n    layer.ctx.beginPath()\n    layer.ctx.lineWidth = 3\n    layer.ctx.strokeStyle = 'steelblue'\n    layer.ctx.fillStyle = 'rgba(236, 240, 241, 1)'\n    layer.ctx.arc(cx, cy, 5, 0, 2 * Math.PI)\n    layer.ctx.fill()\n    layer.ctx.stroke()\n  }\n}\n\nconst internalCanvas = document.createElement('canvas')\nconst internalCtx = internalCanvas.getContext('2d')!\nfunction drawFullBrightPlayers<PlayerID extends number>(layer: Layer,\n  frame: CanvasImageSource,\n  mask: CanvasImageSource,\n  players: BasePlayer<PlayerID>[],\n  glow: boolean = true\n) {\n  const { ctx } = layer\n  const { width, height } = layer.canvas\n\n  // mask get full bright players\n  internalCanvas.width = width\n  internalCanvas.height = height\n  internalCtx.save()\n  internalCtx.drawImage(mask, 0, 0)\n  internalCtx.globalCompositeOperation = 'source-in'\n  internalCtx.drawImage(frame, 0, 0)\n  internalCtx.restore()\n\n  ctx.save()\n  if (glow) {\n    ctx.shadowBlur = 30\n    ctx.shadowColor = 'rgba(255, 255, 255, 0.5)';\n  }\n  players\n    .forEach(player => {\n      const { x, y, w, h } = player.bbox\n      ctx.drawImage(internalCanvas,\n        x, y, w, h,\n        x, y, w, h)\n    })\n  ctx.restore()\n\n}\n\nexport {\n  drawBall as ball,\n  drawFullBrightPlayers as fullbrightPlayers,\n}\n","import type { Point, Route } from \"../@types\"\n\ninterface Style {\n  fillStyle?: string | CanvasGradient | CanvasPattern | { pattern: CanvasPattern, opacity: number }\n  lineWidth?: number\n  strokeStyle?: string\n  font?: string\n  textBaseline?: CanvasTextBaseline\n  lineCap?: CanvasLineCap\n  lineJoin?: CanvasLineJoin\n}\ntype Entries<T> = {\n  [K in keyof T]: [K, T[K]]\n}[keyof T][]\n\n// type Style = Partial<Pick<CanvasRenderingContext2D, 'fillStyle' | 'strokeStyle' | 'lineWidth' | 'font' | 'textBaseline'>>\n\nfunction entries<T extends {}>(obj: T): Entries<T> {\n  return Object.entries(obj) as any;\n}\n\nfunction applyStyle(ctx: CanvasRenderingContext2D, style: Style = {}) {\n  entries(style).forEach((e) => {\n    if (e?.[0] === 'lineWidth' && e[1] !== undefined) {\n      ctx.lineWidth = e[1] // value\n    }\n    if (e?.[0] === 'strokeStyle' && e[1] !== undefined) {\n      ctx.strokeStyle = e[1]//value\n    }\n    if (e?.[0] === 'font' && e[1]) {\n      ctx.font = e[1]\n    }\n    if (e?.[0] === 'textBaseline' && e[1]) {\n      ctx.textBaseline = e[1]\n    }\n    if (e?.[0] === 'lineCap' && e[1]) {\n      ctx.lineCap = e[1]\n    }\n    if (e?.[0] === 'lineJoin' && e[1]) {\n      ctx.lineJoin = e[1]\n    }\n  })\n\n  if (style.fillStyle) {\n    const value = style.fillStyle\n    if (typeof value === 'object' && 'pattern' in value && 'opacity' in value) {\n      ctx.fillStyle = value.pattern\n      ctx.globalAlpha = value.opacity;\n    } else {\n      ctx.fillStyle = value\n    }\n  }\n}\n\nfunction drawLine(ctx: CanvasRenderingContext2D, sx: number, sy: number, dx: number, dy: number, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n  ctx.beginPath()\n  ctx.moveTo(sx, sy)\n  ctx.lineTo(dx, dy)\n  ctx.stroke()\n}\n\nfunction drawHLine(ctx: CanvasRenderingContext2D, sx: number, sy: number, dx: number, style: Style = {}) {\n  drawLine(ctx, sx, sy, dx, sy, style)\n}\n\nfunction drawPolygon(ctx: CanvasRenderingContext2D, points: Point[], style?: Style): void;\nfunction drawPolygon(ctx: CanvasRenderingContext2D, points: [number, number][], style?: Style): void;\nfunction drawPolygon(ctx: CanvasRenderingContext2D, points: [number, number][] | Point[], style: Style = {}): void {\n\n  if (points.length === 0) return\n  const pointsToDraw: [number, number][] = Array.isArray(points[0])\n    ? points as [number, number][]\n    : (points as Point[]).map(p => ([p.x, p.y])) as [number, number][]\n\n  let [x, y] = pointsToDraw[0]\n\n  ctx.save()\n  applyStyle(ctx, style)\n\n  ctx.beginPath()\n  ctx.moveTo(x, y)\n  for (let i = 1, len = pointsToDraw.length; i < len; ++i) {\n    ([x, y] = pointsToDraw[i]);\n    ctx.lineTo(x, y)\n  }\n  ctx.closePath();\n  ctx.stroke()\n\n  ctx.fill();\n  ctx.restore()\n}\n\n\nfunction drawPolyline(ctx: CanvasRenderingContext2D, points: [number, number][] | Point[], style: Style = {}): void {\n\n  if (points.length === 0) return\n  const pointsToDraw: [number, number][] = Array.isArray(points[0])\n    ? points as [number, number][]\n    : (points as Point[]).map(p => ([p.x, p.y])) as [number, number][]\n\n  let [x, y] = pointsToDraw[0]\n\n  ctx.save()\n  applyStyle(ctx, style)\n\n  ctx.beginPath()\n  ctx.moveTo(x, y)\n  for (let i = 1, len = pointsToDraw.length; i < len; ++i) {\n    ([x, y] = pointsToDraw[i]);\n    ctx.lineTo(x, y)\n  }\n  // ctx.closePath();\n  ctx.stroke()\n\n  // ctx.fill();\n  ctx.restore()\n}\n\n\nfunction drawCurve(ctx: CanvasRenderingContext2D, route: Route, style: Style = {}) {\n\n  ctx.save()\n  applyStyle(ctx, style)\n\n  ctx.beginPath();\n  ctx.moveTo(route[0].x, route[0].y)\n  ctx.bezierCurveTo(\n    route[1].x, route[1].y,\n    route[2].x, route[2].y,\n    route[3].x, route[3].y\n  )\n  ctx.stroke()\n  // ctx.fill();\n  ctx.restore()\n  // ctx.fillStyle = ctx.strokeStyle\n  // triangleAt(ctx, route[2], route[3], 10)\n}\n\nfunction triangleAt(ctx: CanvasRenderingContext2D, from: Point, center: Point, r: number, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n\n  // draw arrow\n  let x_center = center.x;\n  let y_center = center.y;\n\n  let angle, x, y\n  ctx.beginPath();\n\n  angle = Math.atan2(center.y - from.y, center.x - from.x)\n  x_center -= r * Math.cos(angle);\n  y_center -= r * Math.sin(angle);\n  x = r * Math.cos(angle) + x_center\n  y = r * Math.sin(angle) + y_center\n  ctx.moveTo(x, y);\n\n  angle += (1 / 3) * (2 * Math.PI)\n  x = r * Math.cos(angle) + x_center\n  y = r * Math.sin(angle) + y_center\n  ctx.lineTo(x, y);\n\n  angle += (1 / 3) * (2 * Math.PI)\n  x = r * Math.cos(angle) + x_center\n  y = r * Math.sin(angle) + y_center\n  ctx.lineTo(x, y);\n\n  ctx.closePath();\n\n\n  ctx.fill();\n  ctx.restore()\n}\n\ninterface ArrowParams {\n  from: Point\n  to: Point\n  arrowSize: number\n  z?: boolean\n  double?: boolean\n}\nfunction drawArrow(ctx: CanvasRenderingContext2D, { from, to, arrowSize, z = false, double = false }: ArrowParams, style: Style = {}) {\n  // draw line\n  ctx.save()\n  applyStyle(ctx, style)\n\n  if (z) {\n    ctx.transform(1, 0, -0.2, .8, from.x, from.y);\n  }\n  const nFrom = z ? { x: 0, y: 0 } : from\n  const nTo = z ? { x: to.x - from.x, y: to.y - from.y } : to\n\n  if (double) {\n    triangleAt(ctx, nTo, nFrom, arrowSize, style)\n  }\n\n  ctx.beginPath();\n  const angle = Math.atan2(nTo.y - nFrom.y, nTo.x - nFrom.x)\n  ctx.moveTo(nFrom.x + arrowSize * Math.cos(angle), nFrom.y + arrowSize * Math.sin(angle));\n  ctx.lineTo(nTo.x - arrowSize * Math.cos(angle), nTo.y - arrowSize * Math.sin(angle));\n  ctx.stroke();\n  ctx.fill();\n\n  triangleAt(ctx, nFrom, nTo, arrowSize, style)\n  ctx.restore()\n}\n\ninterface CircleParams {\n  x: number, y: number, r: number, angle?: number, z?: boolean\n}\nfunction drawCircle(ctx: CanvasRenderingContext2D, { x, y, r, angle = 2 * Math.PI, z = false }: CircleParams, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n\n  if (z) {\n    ctx.transform(1, 0, -0.2, .5, x, y);\n  }\n  x = z ? 0 : x\n  y = z ? 0 : y\n\n  ctx.beginPath();\n  ctx.arc(x, y, r, 0, angle)\n  ctx.lineTo(x, y)\n\n  ctx.stroke()\n  ctx.fill();\n\n  ctx.restore()\n}\n\ninterface RingParams extends CircleParams {\n  r2: number\n}\nfunction drawRing(ctx: CanvasRenderingContext2D, { x, y, r, r2, angle = 2 * Math.PI, z = false }: RingParams, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n\n  // draw outer\n  drawCircle(ctx, { x, y, r: r2, angle, z })\n\n  // cut inner\n  ctx.globalCompositeOperation = 'destination-out'\n  drawCircle(ctx, { x, y, r, angle, z })\n\n  ctx.restore()\n}\n\ninterface RoundedRectParams {\n  x: number\n  y: number\n  w: number\n  h: number\n  r: number\n  z?: boolean\n}\nfunction drawRoundedRect(ctx: CanvasRenderingContext2D, { x, y, w, h, r, z = false }: RoundedRectParams, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n\n  if (z) {\n    ctx.transform(1, 0, -0.1, .9, x, y);\n  }\n  x = z ? 0 : x\n  y = z ? 0 : y\n\n  if (w < 2 * r) r = w / 2;\n  if (h < 2 * r) r = h / 2;\n  ctx.beginPath();\n  ctx.moveTo(x + r, y);\n  ctx.arcTo(x + w, y, x + w, y + h, r);\n  ctx.arcTo(x + w, y + h, x, y + h, r);\n  ctx.arcTo(x, y + h, x, y, r);\n  ctx.arcTo(x, y, x + w, y, r);\n  ctx.closePath();\n\n  ctx.stroke()\n  ctx.fill();\n\n  ctx.restore()\n}\n\ninterface TextParams {\n  x: number,\n  y: number,\n  text: string\n  z?: boolean\n}\n/**\n * use top left as the default baseline\n * @param ctx \n * @param param1 \n * @param style \n */\nfunction drawText(ctx: CanvasRenderingContext2D, { x, y, text, z = false }: TextParams, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n  ctx.textBaseline = 'top'\n\n  if (z) {\n    ctx.transform(1, 0, -0.1, .9, x, y);\n  }\n  x = z ? 0 : x\n  y = z ? 0 : y\n\n  ctx.strokeText(text, x, y)\n  ctx.fillText(text, x, y)\n  ctx.restore()\n}\n\ninterface ConeParams {\n  x: number\n  y: number\n  r: number\n  h: number\n  r1?: number\n}\ntype Point3D = [number, number, number]\nfunction drawCone(ctx: CanvasRenderingContext2D, { x, y, r, h, r1 = 0 }: ConeParams, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n\n  const dAlpha = 0.1;\n\n  const nodes: Point3D[] = [\n    // [0, -h, 0]\n  ];\n  const uNodes: Point3D[] = []\n\n  const faces: [Point3D, Point3D, Point3D, Point3D][] = [];\n  //creating nodes\n  let alpha = 0;\n  // let i = 1;\n  for (let i = 0; alpha <= 2 * Math.PI + dAlpha; ++i) {\n    // while () {\n    let x = r * Math.cos(alpha);\n    let z = r * Math.sin(alpha);\n    nodes[i] = [x, 0, z];\n    alpha += dAlpha;\n\n    x = r1 * Math.cos(alpha);\n    z = r1 * Math.sin(alpha);\n    uNodes[i] = [x, -(1 - r1 / r) * h, z];\n  }\n\n  //creating faces\n  let p = 0;\n  for (let n = 0; n < nodes.length - 1; n++) {\n    let face: [Point3D, Point3D, Point3D, Point3D] = [uNodes[p], nodes[p], nodes[p + 1], uNodes[p + 1]];\n    faces[n] = face;\n    p += 1;\n  }\n\n  // Rotate shape around the x-axis\n  function rotateX3D(theta: number) {\n    const sinTheta = Math.sin(-theta);\n    const cosTheta = Math.cos(-theta);\n\n    for (let n = 0; n < nodes.length; n++) {\n      let node = nodes[n];\n      let y = node[1];\n      let z = node[2];\n      node[1] = y * cosTheta - z * sinTheta;\n      node[2] = z * cosTheta + y * sinTheta;\n\n      node = uNodes[n];\n      y = node[1];\n      z = node[2];\n      node[1] = y * cosTheta - z * sinTheta;\n      node[2] = z * cosTheta + y * sinTheta;\n    }\n  }\n\n  //rotateZ3D(10 * Math.PI / 180);\n  rotateX3D((20 * Math.PI) / 180);\n\n  ctx.translate(x, y);\n\n  // Draw faces\n  for (let i = 0; i < faces.length; i++) {\n    const [v0, v1, v2, v3] = faces[i]\n    ctx.beginPath();\n    ctx.moveTo(v0[0], v0[1]);\n    ctx.lineTo(v1[0], v1[1]);\n    ctx.lineTo(v2[0], v2[1]);\n    ctx.lineTo(v3[0], v3[1]);\n    ctx.lineTo(v0[0], v0[1]);\n    ctx.fill();\n    // ctx.stroke();\n    ctx.closePath();\n  }\n\n  ctx.restore()\n}\n\ninterface LabelParams {\n  x: number,\n  y: number,\n  w: number, h: number,\n  text: string\n}\nfunction drawLabel(ctx: CanvasRenderingContext2D, { x, y, w, h, text }: LabelParams, style: Style = {}) {\n  ctx.save()\n  applyStyle(ctx, style)\n\n  ctx.beginPath()\n  ctx.moveTo(x, y);\n  ctx.lineTo(x + 100, y - 50)\n  ctx.stroke()\n\n  ctx.rect(x + 100, y - 50, w, h)\n  ctx.stroke()\n  ctx.fillStyle = '#fff'\n  ctx.fill()\n  applyStyle(ctx, style)\n\n  // ctx.strokeText(text, x + 110, y - 50)\n  ctx.fillText(text, x + 105, y - 50 + 5)\n  ctx.restore()\n}\n\n\nexport {\n  drawLine as line,\n  drawHLine as hLine,\n  drawPolygon as polygon,\n  drawPolyline as polyline,\n  drawArrow as arrow,\n  drawCurve as curve,\n  drawCircle as circle,\n  drawRing as ring,\n  drawRoundedRect as roundedRect,\n  drawText as text,\n  drawCone as cone,\n  drawLabel as label,\n}\n\n/**\n * Draws a cardinal spline through given point array. Points must be arranged\n * as: [x1, y1, x2, y2, ..., xn, yn]. It adds the points to the current path.\n *\n * The method continues previous path of the context. If you don't want that\n * then you need to use moveTo() with the first point from the input array.\n *\n * The points for the cardinal spline are returned as a new array.\n *\n * @param {CanvasRenderingContext2D} ctx - context to use\n * @param {Array} points - point array\n * @param {Number} [tension=0.5] - tension. Typically between [0.0, 1.0] but can be exceeded\n * @param {Number} [numOfSeg=20] - number of segments between two points (line resolution)\n * @param {Boolean} [close=false] - Close the ends making the line continuous\n * @returns {Float32Array} New array with the calculated points that was added to the path\n */\nexport function _curve(ctx: CanvasRenderingContext2D, _points: Point[], tension: number = 0.5, numOfSeg: number = 20, close: boolean = false) {\n  const points = _points.flatMap(p => ([p.x, p.y]))\n\n  // let i = 1,\n  let l = points.length,\n    rPos = 0,\n    rLen = (l - 2) * numOfSeg + 2 + (close ? 2 * numOfSeg : 0),\n    res = new Float32Array(rLen);\n\n  let pts = [...points];\n  if (close) {\n    pts.unshift(points[l - 1]);\t\t\t\t// insert end point as first point\n    pts.unshift(points[l - 2]);\n    pts.push(points[0], points[1]); \t\t// first point as last point\n  } else {\n    pts.unshift(points[1]);\t\t\t\t\t// copy 1. point and insert at beginning\n    pts.unshift(points[0]);\n    pts.push(points[l - 2], points[l - 1]);\t// duplicate end-points\n  }\n\n  // cache inner-loop calculations as they are based on t alone\n  const cache = new Float32Array((numOfSeg + 2) * 4)\n  let cachePtr = 4;\n  cache[0] = 1;\t\t\t\t\t\t\t\t// 1,0,0,0\n  for (let i = 1; i < numOfSeg; i++) {\n    let st = i / numOfSeg,\n      st2 = st * st,\n      st3 = st2 * st,\n      st23 = st3 * 2,\n      st32 = st2 * 3;\n\n    cache[cachePtr++] = st23 - st32 + 1;\t// c1\n    cache[cachePtr++] = st32 - st23;\t\t// c2\n    cache[cachePtr++] = st3 - 2 * st2 + st;\t// c3\n    cache[cachePtr++] = st3 - st2;\t\t\t// c4\n  }\n  cache[++cachePtr] = 1;\t\t\t\t\t\t// 0,1,0,0\n\n  // calc. points\n  parse(pts, cache, points.length);\n\n  if (close) {\n    //l = points.length;\n    pts = [];\n    pts.push(points[l - 4], points[l - 3], points[l - 2], points[l - 1]); // second last and last\n    pts.push(points[0], points[1], points[2], points[3]); // first and second\n    parse(pts, cache, 4);\n  }\n\n  function parse(pts: number[], cache: Float32Array, l: number) {\n\n    for (let i = 2, t; i < l; i += 2) {\n\n      let pt1 = pts[i],\n        pt2 = pts[i + 1],\n        pt3 = pts[i + 2],\n        pt4 = pts[i + 3],\n\n        t1x = (pt3 - pts[i - 2]) * tension,\n        t1y = (pt4 - pts[i - 1]) * tension,\n        t2x = (pts[i + 4] - pt1) * tension,\n        t2y = (pts[i + 5] - pt2) * tension;\n\n      for (t = 0; t < numOfSeg; t++) {\n\n        var c = t << 2, //t * 4;\n\n          c1 = cache[c],\n          c2 = cache[c + 1],\n          c3 = cache[c + 2],\n          c4 = cache[c + 3];\n\n        res[rPos++] = c1 * pt1 + c2 * pt3 + c3 * t1x + c4 * t2x;\n        res[rPos++] = c1 * pt2 + c2 * pt4 + c3 * t1y + c4 * t2y;\n      }\n    }\n  }\n\n  // add last point\n  l = close ? 0 : points.length - 2;\n  res[rPos++] = points[l];\n  res[rPos] = points[l + 1];\n\n  // add lines to path\n  ctx.moveTo(points[0], points[1]);\n  for (let i = 0, len = res.length; i < len; i += 2) {\n    ctx.lineTo(res[i], res[i + 1]);\n  }\n  // stroke path\n  ctx.stroke();\n\n  return res;\n}","import { Point } from 'common/@types'\nimport { getAngle } from \"common/@utils\";\n\nimport { PLAYER_META, COLORS, FOCUS, LV_INTEREST_THRESHOLD } from \"@const\";\nimport { PlayerID, KeyPlayer, KeyPlayerType, Lv2Player, Lv2PlayerType, Player } from \"@types\";\n\nimport * as _draw from 'common/@draw'\nimport { EnabledFeatures } from 'App';\n\nexport interface VisRing {\n  cx: number,\n  cy: number,\n  fill: string,\n  size: number,\n  inOffsensiveCourt: boolean\n}\n\nfunction drawVisRings(visCtx: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D, circles: VisRing[]) {\n  // 0 draw vis circle\n  visCtx.save()\n  const [a, b, c, d, e, f] = [1.75257350e+00, 5.98341402e-02, -8.91780472e-01, 2.49200452e-01, 0, 0]\n  visCtx.setTransform(a, b, c, d, e, f);\n  const circleTXY = circles.map(({ cx, cy }) => {\n    const tx = (cx - (c / d) * cy + (c / d) * f - e) / (a - (c / d) * b)\n    const ty = (cx - e - a * tx) / c\n    return { tx, ty }\n  })\n\n  const in_r = 10\n  const max_out_r = 22\n  // draw outer\n  circles\n    .filter(c => c.inOffsensiveCourt)\n    .forEach((_, cIdx) => {\n      const { tx, ty } = circleTXY[cIdx]\n      const out_r = in_r + max_out_r //25\n      visCtx.fillStyle = COLORS.offense_outer_border\n      visCtx.beginPath()\n      visCtx.arc(tx, ty, out_r, 0, 2 * Math.PI);\n      visCtx.fill();\n    })\n\n  // draw middle\n  circles.forEach(({ size, fill }, cIdx) => {\n    const { tx, ty } = circleTXY[cIdx]\n    const out_r = in_r + max_out_r * size //25\n    visCtx.fillStyle = fill\n    visCtx.beginPath()\n    visCtx.arc(tx, ty, out_r, 0, 2 * Math.PI);\n    visCtx.fill();\n  })\n\n  // cut innner\n  visCtx.globalCompositeOperation = 'destination-out'\n  circles.forEach(({ fill }, cIdx) => {\n    const { tx, ty } = circleTXY[cIdx]\n    visCtx.beginPath()\n    visCtx.arc(tx, ty, in_r, 0, 2 * Math.PI)\n    visCtx.fill()\n  })\n\n  // draw outer borders\n  visCtx.globalCompositeOperation = 'source-over'\n\n  visCtx.lineWidth = 1;\n  visCtx.strokeStyle = COLORS.offense_bg_fill\n  circles\n    .filter(c => c.inOffsensiveCourt)\n    .forEach((_, cIdx) => {\n      const { tx, ty } = circleTXY[cIdx]\n      const out_r = in_r + max_out_r //25\n      visCtx.beginPath()\n      visCtx.arc(tx, ty, out_r, 0, 2 * Math.PI);\n      visCtx.stroke()\n    })\n\n  // draw inner borders\n  visCtx.strokeStyle = COLORS.offense_inner_border //\"#313131\"\n  circles.forEach(({ inOffsensiveCourt }, cIdx) => {\n    const { tx, ty } = circleTXY[cIdx]\n    visCtx.lineWidth = inOffsensiveCourt ? 1 : 3;\n    visCtx.beginPath()\n    visCtx.arc(tx, ty, in_r, 0, 2 * Math.PI)\n    visCtx.stroke()\n  })\n\n  visCtx.restore()\n}\n\nexport interface VisSheild {\n  // fillColor: string,\n  diff: number,\n  smoothDFdiff: number\n  speed: number,\n  cx: number,\n  cy: number,\n  dx: number\n  dy: number\n  tangle: number\n  tdist: number\n  // right: boolean\n}\n\nconst roundTo2PI = (r: number) => (r + 2) % 2\n\nfunction drawVisSheilds(visCtx: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D, sheilds: VisSheild[], debugCtx?: CanvasRenderingContext2D) {\n  visCtx.save()\n  // const [a, b, c, d, e, f] = [1.75257350e+00, 5.98341402e-02, -8.91780472e-01, 5.49200452e-01, 0, 0]\n  const [a, b, c, d, e, f] = [1.75257350e+00, 0.0000001, 0.0000001, 5.49200452e-01, 0, 0]\n  visCtx.setTransform(a, b, c, d, e, f);\n\n  const invertTXY = (x: number, y: number) => {\n    const tx = (x - (c / d) * y + (c / d) * f - e) / (a - (c / d) * b)\n    const ty = (x - e - a * tx) / c\n    return { x: tx, y: ty }\n  }\n\n  // const convertTXY = (x: number, y: number) => {\n  //   const nx = a * x + c * y + e - 800\n  //   const ny = b * x + d * y + f - 0\n  //   return { x: nx, y: ny }\n  // }\n\n  const getA1A2 = (tangle: number, tdist: number) => {\n    const base = 0.02\n    const range = 0.13\n    let a1 = roundTo2PI(tangle - base\n      - range * Math.max(0, Math.min(1, 1 - (tdist - MIN_DIST) / MAX_DIST))\n    )\n    let a2 = roundTo2PI(tangle + base\n      + range * Math.max(0, Math.min(1, 1 - (tdist - MIN_DIST) / MAX_DIST)))\n\n    // swap\n    // if (a2 < a1 && !(a1 > 1.5 && a2 < 0.5)) [a2, a1] = [a1, a2]\n    if ((a2 < a1 && !(a1 > 1.5 && a2 < 0.5)) || (a1 < .5 && a2 > 1.5)) [a2, a1] = [a1, a2]\n    return [a1, a2]\n  }\n\n  // draw lines\n  const MAX_DIST = 12\n  const MIN_DIST = 3.5\n  visCtx.save()\n  for (const sheild of sheilds) {\n    const { cx, cy, dx, dy, tdist } = sheild\n\n    if (tdist >= MAX_DIST || tdist <= MIN_DIST) continue\n\n    const theta = getAngle(cx, cy, dx, dy) / 180\n    // console.debug(`cx:${cx}, cy:${cy}, dx:${dx}, dy:${dy}, theta:${theta}`)\n\n    visCtx.beginPath()\n    visCtx.lineWidth = 2\n    const { x: ox, y: oy } = invertTXY(cx + 40 * Math.cos(theta * Math.PI), cy + 40 * Math.sin(theta * Math.PI))\n    const { x, y } = invertTXY(dx - 50 * Math.cos(theta * Math.PI), dy - 50 * Math.sin(theta * Math.PI))\n\n    const grd = visCtx.createLinearGradient(ox, oy, x, y);\n    grd.addColorStop(0, `rgba(${COLORS.off_df_link}, 0.1)`);\n    grd.addColorStop(0.1, `rgba(${COLORS.off_df_link}, ${0.3 + 0.5 * ((MAX_DIST - tdist) / MAX_DIST)})`);\n    grd.addColorStop(0.9, `rgba(${COLORS.off_df_link}, ${0.3 + 0.5 * ((MAX_DIST - tdist) / MAX_DIST)})`);\n    grd.addColorStop(1, `rgba(${COLORS.off_df_link}, 0.1)`);\n\n    visCtx.strokeStyle = grd\n    visCtx.shadowColor = `rgb(${COLORS.off_df_link})`\n    visCtx.shadowBlur = 5\n    visCtx.moveTo(ox, oy)\n    visCtx.lineTo(x, y)\n    visCtx.stroke()\n  }\n  visCtx.restore()\n\n  const in_r = 100\n  for (const sheild of sheilds) {\n    let { cx, cy, dx, dy, tdist, smoothDFdiff } = sheild\n\n    // r\n    const out_r = in_r + 4 + Math.max(0, smoothDFdiff) * 15\n    visCtx.lineWidth = out_r - in_r;\n\n    // 2d angle\n    const theta = getAngle(cx, cy, dx, dy) / 180\n    const dist = Math.max(0,\n      - 30 + in_r * Math.sqrt(1 / (Math.pow(Math.cos(theta * Math.PI) / a, 2) + Math.pow(Math.sin(theta * Math.PI) / d, 2)))\n    )\n\n    cx = cx - dist * Math.cos(theta * Math.PI)\n    cy = cy - dist * Math.sin(theta * Math.PI)\n    const { x: tx, y: ty } = invertTXY(cx, cy)\n\n    // cal start and end angle\n    // 3d angle\n    let tangle = Math.atan(a * Math.tan(theta * Math.PI) / d) / Math.PI\n    // opposite\n    if (theta > 0.5 && theta <= 1.5) tangle = (tangle + 1) % 2\n\n    const [a1, a2] = getA1A2(tangle, tdist)\n    const [ma1, ma2] = getA1A2(tangle, MIN_DIST)\n\n    // visCtx.beginPath()\n    // visCtx.strokeStyle = 'rgba(125, 0, 0, 1)'\n    // visCtx.arc(tx, ty, in_r + (out_r - in_r) / 2,0 * Math.PI, 2 * Math.PI);\n    // visCtx.stroke()\n\n    // bg first\n    visCtx.strokeStyle = COLORS.defense_bg_fill\n    // visCtx.shadowColor = `#f5f5f599`\n    // visCtx.shadowBlur = 5\n    visCtx.beginPath()\n    visCtx.arc(tx, ty, in_r + (out_r - in_r) / 2, ma1 * Math.PI, ma2 * Math.PI);\n    visCtx.stroke()\n    // fill\n    visCtx.strokeStyle = COLORS.defense_fg_fill\n    visCtx.beginPath()\n    visCtx.arc(tx, ty, in_r + (out_r - in_r) / 2, a1 * Math.PI, a2 * Math.PI);\n    visCtx.stroke();\n  }\n\n  visCtx.restore()\n}\n\nfunction drawVis(visCtx: CanvasRenderingContext2D, circles: VisRing[], sheilds: VisSheild[], debugCtx?: CanvasRenderingContext2D) {\n  drawVisRings(visCtx, circles)\n  drawVisSheilds(visCtx, sheilds, debugCtx)\n}\n\n\n\nfunction drawGlows(ctx: CanvasRenderingContext2D, players: Array<Player & Lv2Player>, savedFG: CanvasRenderingContext2D) {\n  ctx.save()\n  ctx.shadowColor = 'rgba(255, 255, 255, 0.5)';\n  players\n    .forEach(player => {\n      const { x, y, w, h } = player.bbox\n      ctx.shadowBlur = player.on ? 10 : 40 * (player.att ?? 0 - LV_INTEREST_THRESHOLD.off);\n      ctx.drawImage(savedFG.canvas,\n        x, y, w, h,\n        x, y, w, h)\n    })\n  ctx.restore()\n}\n\nfunction drawSpotLights(ctx: CanvasRenderingContext2D, players: Array<Player & KeyPlayer>, savedFG: CanvasRenderingContext2D) {\n  players\n    ?.forEach(player => {\n      const { progress: frames } = player.last\n      const { x, y, w, h } = player.bbox\n      let r1 = player.type === KeyPlayerType.EMPTY_PLAYER\n        ? 30\n        : player.type === KeyPlayerType.STAR\n          ? 30\n          : 20\n\n      // full bright image\n      ctx.drawImage(savedFG.canvas,\n        x, y, w, h,\n        x, y, w, h)\n\n      _draw.cone(ctx,\n        {\n          x: x + w * 0.5,\n          y: y + h,\n          r: 50 * (frames / 6),\n          r1: r1 * (frames / 6),\n          h: player.type === KeyPlayerType.EMPTY_PLAYER\n            ? 800\n            : player.type === KeyPlayerType.STAR\n              ? 800\n              : 1000\n        },\n        {\n          lineWidth: 1, strokeStyle: \"rgba(220, 220, 220, 0.05)\",\n          fillStyle: player.type === KeyPlayerType.EMPTY_PLAYER\n            ? 'rgba(50, 220, 128, 0.1)'\n            : player.type === KeyPlayerType.STAR\n              ? 'rgba(255,215,120, 0.08)'\n              : player.type === KeyPlayerType.TEXT_HILIGHT\n                ? 'rgba(51, 181, 229, 0.08)'\n                : 'rgba(220, 220, 220, 0.1)',\n          lineCap: 'round', lineJoin: 'round'\n        }\n      )\n    })\n}\n\nconst internalCanvas = document.createElement('canvas')\nconst internalCtx = internalCanvas.getContext('2d')!\n/**\n * Highlight levels:\n * - full brights: all lv1 and lv2 players\n * =========== Focus layer ====== \n * - glow effect: lv2 interested\n * - spotlight_white: lv1 key players's full bright should be above the focus mask\n * - spotlight_green: lv1 empty players\n */\nfunction drawHL(ctx: CanvasRenderingContext2D,\n  frame: CanvasImageSource,\n  mask: CanvasImageSource,\n  players: Player[],\n  lv1Players: Array<Player & KeyPlayer> = [],\n  lv2Players: Array<Player & Lv2Player> = [],\n  features: EnabledFeatures,\n  ballHolder?: PlayerID | null,\n  filter_focus?: { pos: Point }) {\n  const { width, height } = ctx.canvas\n\n  // mask get fg\n  internalCanvas.width = width\n  internalCanvas.height = height\n  internalCtx.save()\n  internalCtx.drawImage(mask, 0, 0)\n  internalCtx.globalCompositeOperation = 'source-in'\n  internalCtx.drawImage(frame, 0, 0)\n  internalCtx.restore()\n\n  // draw fg with mask\n  // ctx.save()\n  ctx.drawImage(internalCanvas, 0, 0)\n  // ctx.globalCompositeOperation = 'source-atop'\n  // ctx.fillStyle = `rgba(0, 0, 0, ${COLORS.FG_MASK_ALPHA})`\n  // ctx.fillRect(0, 0, width, height);\n  // ctx.restore()\n\n  // focus mask\n  if (filter_focus) {\n    const { pos } = filter_focus\n    ctx.save()\n    const grd = ctx.createRadialGradient(pos.x, pos.y, FOCUS.min, pos.x, pos.y, FOCUS.max);\n    grd.addColorStop(0, `rgba(0, 0, 0, ${FOCUS.mina})`);\n    grd.addColorStop(1, `rgba(0, 0, 0, ${FOCUS.maxa})`);\n    ctx.fillStyle = grd;\n    ctx.globalCompositeOperation = 'source-atop'\n    ctx.fillRect(0, 0, width, height);\n    ctx.restore()\n\n    //unimportant players\n    const unImportantPlayers = players.filter(p =>\n      !lv2Players.find(lv2 => lv2.id === p.id) &&\n      !lv1Players.find(lv1 => lv1.id === p.id))\n\n    ctx.save()\n    unImportantPlayers.forEach(p => {\n      const { x, y, w, h } = p.bbox\n      ctx.drawImage(internalCtx.canvas,\n        x, y, w, h,\n        x, y, w, h)\n    })\n    // ctx.fillStyle = `rgba(0, 0, 0, ${COLORS.FG_MASK_ALPHA})`\n    // ctx.globalCompositeOperation = 'source-atop'\n    // ctx.fillRect(0, 0, width, height);\n    ctx.restore()\n  }\n\n  // need this for the focus mask\n  // basic hilight, full bright\n  const lv2PlayerLooked = lv2Players\n    .filter(p => p.id !== ballHolder &&\n      p.type.has(Lv2PlayerType.Interest) && p.looked && (p.att ?? 0) > LV_INTEREST_THRESHOLD.off)\n  const lv2PlayerNotLooked = lv2Players\n    .filter(p => !(lv2PlayerLooked.find(lp => lp.id === p.id)))\n  lv2PlayerNotLooked.forEach(player => {\n    const { x, y, w, h } = player.bbox\n    ctx.drawImage(internalCtx.canvas,\n      x, y, w, h,\n      x, y, w, h)\n  })\n\n  // only looked, will show glow\n  drawGlows(ctx, lv2PlayerLooked, internalCtx)\n\n  // spot light \n  if (features.vis_key_player) {\n    drawSpotLights(ctx, lv1Players, internalCtx)\n  }\n}\n\n/**\n * For draw star\n */\nfunction rotate2D(vecArr: Array<[number, number]>, byRads: number) {\n  const mat = [\n    [Math.cos(byRads), -Math.sin(byRads)],\n    [Math.sin(byRads), Math.cos(byRads)]\n  ];\n  const result: Array<[number, number]> = [];\n  for (let i = 0; i < vecArr.length; ++i) {\n    result[i] = [\n      mat[0][0] * vecArr[i][0] + mat[0][1] * vecArr[i][1],\n      mat[1][0] * vecArr[i][0] + mat[1][1] * vecArr[i][1]\n    ];\n  }\n  return result;\n}\n\nfunction generateStarTriangles(numPoints: number, r: number) {\n  const triangleBase = r * Math.tan(Math.PI / numPoints);\n  // console.log(\"Base: \" + triangleBase);\n  const triangle: Array<[number, number]> = [\n    [0, r],\n    [triangleBase / 2, 0],\n    [-triangleBase / 2, 0], [0, r]\n  ];\n  const result = [];\n  for (let i = 0; i < numPoints; ++i) {\n    result[i] = rotate2D(triangle, i * (2 * Math.PI / numPoints));\n  }\n  return result;\n}\n\nfunction drawStar(ctx: CanvasRenderingContext2D, r: number, offset: [number, number], flipVert: boolean) {\n  const sign = flipVert ? -1 : 1;\n  const obj = generateStarTriangles(5, r);\n\n  ctx.save()\n  ctx.fillStyle = COLORS.star_star\n  for (let objIdx = 0; objIdx < obj.length; ++objIdx) {\n    const elem = obj[objIdx];\n    ctx.moveTo(elem[0][0] + offset[0], sign * elem[0][1] + offset[1]);\n    ctx.beginPath();\n    for (let vert = 1; vert < elem.length; ++vert) {\n      ctx.lineTo(elem[vert][0] + offset[0], sign * elem[vert][1] + offset[1]);\n    }\n    ctx.fill();\n  }\n  ctx.beginPath()\n  ctx.arc(offset[0], offset[1], r, 0, 2 * Math.PI)\n  ctx.strokeStyle = COLORS.star_star\n  ctx.stroke()\n  ctx.restore()\n}\n\n\nconst shooterIcon = new Image()\nshooterIcon.src = `${process.env.PUBLIC_URL}/shooter.png`\nconst defenderIcon = new Image()\ndefenderIcon.src = `${process.env.PUBLIC_URL}/defender.png`\nconst starIcon = new Image()\nstarIcon.src = `${process.env.PUBLIC_URL}/star.png`\nconst ICONS = {\n  shooter: shooterIcon,\n  defender: defenderIcon,\n  star: starIcon\n}\n\n\n// shooterIcon.style.filter = `invert(80%) sepia(77%) saturate(366%) hue-rotate(328deg) brightness(102%) contrast(101%);`\nfunction drawIcon(ctx: CanvasRenderingContext2D, iconHeight: number, offset: [number, number], icon: keyof typeof ICONS) {\n  if (icon === 'star') {\n    //   drawStar(ctx, iconHeight / 2, offset, true)\n    drawIcon(ctx, iconHeight, [offset[0] - iconHeight, offset[1]], 'shooter')\n    drawIcon(ctx, iconHeight, offset, 'defender')\n  } else {\n    const iconWidth = iconHeight * ICONS[icon].width / ICONS[icon].height\n    internalCanvas.width = iconWidth\n    internalCanvas.height = iconHeight\n    internalCtx.save()\n    internalCtx.drawImage(ICONS[icon],\n      0, 0, ICONS[icon].width, ICONS[icon].height,\n      0, 0, iconWidth, iconHeight)\n    internalCtx.globalCompositeOperation = 'source-in'\n    internalCtx.fillStyle = COLORS.star_star\n    internalCtx.fillRect(0, 0, iconWidth, iconHeight)\n    internalCtx.restore()\n    ctx.drawImage(internalCanvas, offset[0] - iconWidth * 0.5, offset[1] - iconHeight * 0.5)\n  }\n}\n\nfunction drawName(ctx: CanvasRenderingContext2D, player?: Player) {\n  if (!player) return\n\n  const { id, namePos } = player\n  const textheight = 18\n  const lastname = PLAYER_META[id].ln\n\n  ctx.save()\n  ctx.fillStyle = PLAYER_META[id].star ? COLORS.star_name : COLORS.player_name\n  ctx.font = `bold ${textheight}px Arial`;\n  ctx.textAlign = \"center\";\n  const textwidth = ctx.measureText(lastname).width\n  const x = PLAYER_META[id].star === 'star' ? namePos.x + textheight / 2 : namePos.x\n  ctx.fillText(lastname, x, namePos.y)\n  ctx.restore()\n\n  if (PLAYER_META[id].star) {\n    const starR = Math.floor(textheight / 2) - 1\n    const starPadding = 5\n    const iconHeight = textheight\n    drawIcon(ctx, iconHeight, [\n      x - (textwidth + starR) * 0.5 - starPadding,\n      namePos.y - textheight / 2 + 2],\n      PLAYER_META[id].star as any)\n  }\n}\n\nexport {\n  // drawFG as fg,\n\n  drawVisRings as circles,\n  drawVisSheilds as sheilds,\n  drawHL as HL,\n  drawVis as Vis,\n  drawStar as Star,\n  drawName as Name,\n}","import { Hexbin, HexbinBin, hexbin as d3Hexbin } from 'd3-hexbin';\nimport { scaleSequential, scaleSqrt, scaleOrdinal } from 'd3-scale'\nimport { interpolateReds, interpolateYlGnBu, schemeSet3 } from 'd3-scale-chromatic'\n\nimport type { Point } from \"common/@types\"\nimport { distPoints } from \"common/@utils\"\n\nimport { PLAYER_META } from \"@const\"\nimport type { GameID } from '@types'\nimport type { PlayerID, CachePlayerBin, ShotRecord } from '@types';\nimport { params } from 'param';\n\nif (process.env.NODE_ENV !== 'production') {\n  (global as any).$RefreshReg$ = () => { };\n  (global as any).$RefreshSig$ = () => () => { };\n}\n\nconst getArea = (area: string) => area.match(/\\((\\w+)\\)/)?.[1]\nconst getRegionKey = (r: { AREA: string, BASIC: string, RANGE: string }) =>\n  getArea(r.AREA) + \"_\" +\n  r.RANGE\n\nconst mapRegionToPoint = (region: string) => {\n  return region && (region.endsWith(\"24+ ft.\") || region.endsWith(\"Back Court Shot\")) ? 3 : 2\n}\n\nexport const hRadius = 7\nexport const hexbin = d3Hexbin<ShotRecord>()\n  .x(d => d.LOC_X)\n  .y(d => d.LOC_Y)\n  .radius(hRadius)\n\nexport const leagueAvgByRegion = [\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Above the Break 3\",\n    \"SHOT_ZONE_AREA\": \"Back Court(BC)\",\n    \"SHOT_ZONE_RANGE\": \"Back Court Shot\",\n    \"FGA\": 59,\n    \"FGM\": 4,\n    \"FG_PCT\": 0.068\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Above the Break 3\",\n    \"SHOT_ZONE_AREA\": \"Center(C)\",\n    \"SHOT_ZONE_RANGE\": \"24+ ft.\",\n    \"FGA\": 10885,\n    \"FGM\": 3746,\n    \"FG_PCT\": 0.344\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Above the Break 3\",\n    \"SHOT_ZONE_AREA\": \"Left Side Center(LC)\",\n    \"SHOT_ZONE_RANGE\": \"24+ ft.\",\n    \"FGA\": 16648,\n    \"FGM\": 5802,\n    \"FG_PCT\": 0.349\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Above the Break 3\",\n    \"SHOT_ZONE_AREA\": \"Right Side Center(RC)\",\n    \"SHOT_ZONE_RANGE\": \"24+ ft.\",\n    \"FGA\": 15837,\n    \"FGM\": 5597,\n    \"FG_PCT\": 0.353\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Backcourt\",\n    \"SHOT_ZONE_AREA\": \"Back Court(BC)\",\n    \"SHOT_ZONE_RANGE\": \"Back Court Shot\",\n    \"FGA\": 440,\n    \"FGM\": 17,\n    \"FG_PCT\": 0.039\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"In The Paint (Non-RA)\",\n    \"SHOT_ZONE_AREA\": \"Center(C)\",\n    \"SHOT_ZONE_RANGE\": \"Less Than 8 ft.\",\n    \"FGA\": 19352,\n    \"FGM\": 7561,\n    \"FG_PCT\": 0.391\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"In The Paint (Non-RA)\",\n    \"SHOT_ZONE_AREA\": \"Center(C)\",\n    \"SHOT_ZONE_RANGE\": \"8-16 ft.\",\n    \"FGA\": 6851,\n    \"FGM\": 2889,\n    \"FG_PCT\": 0.422\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"In The Paint (Non-RA)\",\n    \"SHOT_ZONE_AREA\": \"Left Side(L)\",\n    \"SHOT_ZONE_RANGE\": \"8-16 ft.\",\n    \"FGA\": 2089,\n    \"FGM\": 842,\n    \"FG_PCT\": 0.403\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"In The Paint (Non-RA)\",\n    \"SHOT_ZONE_AREA\": \"Right Side(R)\",\n    \"SHOT_ZONE_RANGE\": \"8-16 ft.\",\n    \"FGA\": 1932,\n    \"FGM\": 799,\n    \"FG_PCT\": 0.414\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Left Corner 3\",\n    \"SHOT_ZONE_AREA\": \"Left Side(L)\",\n    \"SHOT_ZONE_RANGE\": \"24+ ft.\",\n    \"FGA\": 7864,\n    \"FGM\": 2939,\n    \"FG_PCT\": 0.374\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Center(C)\",\n    \"SHOT_ZONE_RANGE\": \"16-24 ft.\",\n    \"FGA\": 7324,\n    \"FGM\": 2897,\n    \"FG_PCT\": 0.396\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Center(C)\",\n    \"SHOT_ZONE_RANGE\": \"8-16 ft.\",\n    \"FGA\": 2265,\n    \"FGM\": 987,\n    \"FG_PCT\": 0.436\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Left Side Center(LC)\",\n    \"SHOT_ZONE_RANGE\": \"16-24 ft.\",\n    \"FGA\": 7754,\n    \"FGM\": 3066,\n    \"FG_PCT\": 0.395\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Left Side(L)\",\n    \"SHOT_ZONE_RANGE\": \"8-16 ft.\",\n    \"FGA\": 7639,\n    \"FGM\": 3005,\n    \"FG_PCT\": 0.393\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Left Side(L)\",\n    \"SHOT_ZONE_RANGE\": \"16-24 ft.\",\n    \"FGA\": 5452,\n    \"FGM\": 2173,\n    \"FG_PCT\": 0.399\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Right Side Center(RC)\",\n    \"SHOT_ZONE_RANGE\": \"16-24 ft.\",\n    \"FGA\": 8145,\n    \"FGM\": 3249,\n    \"FG_PCT\": 0.399\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Right Side(R)\",\n    \"SHOT_ZONE_RANGE\": \"8-16 ft.\",\n    \"FGA\": 7630,\n    \"FGM\": 3011,\n    \"FG_PCT\": 0.395\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Mid-Range\",\n    \"SHOT_ZONE_AREA\": \"Right Side(R)\",\n    \"SHOT_ZONE_RANGE\": \"16-24 ft.\",\n    \"FGA\": 4924,\n    \"FGM\": 1996,\n    \"FG_PCT\": 0.405\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Restricted Area\",\n    \"SHOT_ZONE_AREA\": \"Center(C)\",\n    \"SHOT_ZONE_RANGE\": \"Less Than 8 ft.\",\n    \"FGA\": 67443,\n    \"FGM\": 40634,\n    \"FG_PCT\": 0.602\n  },\n  {\n    \"GRID_TYPE\": \"League Averages\",\n    \"SHOT_ZONE_BASIC\": \"Right Corner 3\",\n    \"SHOT_ZONE_AREA\": \"Right Side(R)\",\n    \"SHOT_ZONE_RANGE\": \"24+ ft.\",\n    \"FGA\": 7360,\n    \"FGM\": 2803,\n    \"FG_PCT\": 0.381\n  }\n].reduce((o, d) => {\n  const key = getRegionKey({ AREA: d.SHOT_ZONE_AREA, BASIC: d.SHOT_ZONE_BASIC, RANGE: d.SHOT_ZONE_RANGE })\n  o[key] = {\n    FGA: d.FGA,\n    FGM: d.FGM,\n    rate: d.FG_PCT,\n    exp: mapRegionToPoint(key) * d.FG_PCT\n  }\n  return o\n}, {} as Record<string, { FGA: number, FGM: number, rate: number, exp: number }>)\n\nconst groupShotsByRegion = (shots: ShotRecord[]) => {\n  const byRegion = shots\n    .reduce((o, r) => {\n      const key = getRegionKey(r.SHOT_ZONE)\n      if (!(key in o)) {\n        o[key] = []\n      }\n      o[key].push(r)\n      return o\n    }, {} as Record<string, ShotRecord[]>)\n\n  const byRegionAndPercentage: Record<string, {\n    shots: ShotRecord[],\n    rate: number,\n    diff: number,\n    eDiff: number,\n    exp: number,\n    region: { AREA: string, BASIC: string, RANGE: string }\n  }> = {}\n\n  for (const key of Object.keys(byRegion)) {\n    const shots = byRegion[key]\n    const rate = shots.filter(s => +s.made).length / shots.length\n    const diff = rate - leagueAvgByRegion[key].rate\n    const exp = rate * mapRegionToPoint(key)\n\n    byRegionAndPercentage[key] = {\n      shots,\n      region: shots[0].SHOT_ZONE,\n      rate,\n      exp,\n      diff,\n      eDiff: 2 * (-0.5 + 1 / (1 + Math.exp(-5 * diff))),\n    }\n  }\n\n  return byRegionAndPercentage\n}\n\nconst mapLOCTOTracking = (onTheRight: boolean, r: ShotRecord) => ({ //, mapSize: [number, number]) => ({\n  ...r,\n  LOC_X: (onTheRight ? (940 - (r.LOC_Y + 52.5)) : (r.LOC_Y + 52.5)), // / (940 / mapSize[0]),\n  LOC_Y: ((onTheRight ? r.LOC_X : -r.LOC_X) + 250), // / (500 / mapSize[1])\n})\n\n// detect whether at 2 or 3 points region\nconst TwoOrThreePt = ({ x, y }: Point) => {\n  if (x === undefined || y === undefined) return 2\n  const point1 = 14\n  const point2 = 5.25 + 23.75\n  if (x < 47) {\n    // on the left\n    if (x < point1) {\n      // check y\n      return (y > 3 && y < (50 - 3)) ? 2 : 3\n    } else if (x < point2) {\n      // check dist\n      const dist = distPoints({ x, y }, { x: 5.25, y: 25 })\n      return dist > 23.75 ? 3 : 2\n    }\n  } else {\n    // on the right\n    if (x > (94 - point1)) {\n      return (y > 3 && y < (50 - 3)) ? 2 : 3\n    } else if (x > (94 - point2)) {\n      const dist = distPoints({ x, y }, { x: 94 - 5.25, y: 25 })\n      return dist > 23.75 ? 3 : 2\n    }\n  }\n}\n\n\nfunction normalize(v?: number, min?: number, max?: number) {\n  if (v === undefined || min === undefined || max === undefined) return -1\n  return (v - min) / (max - min)\n}\n\nfunction POS_TO_OFF_TEAM(gameId: GameID, x?: number) {\n  if (x === undefined) return undefined\n  return gameId === 'game1'\n    ? x < 47 ? 'CLE' : 'GSW'\n    : x < 47 ? 'OKC' : 'LAC'\n}\n\nexport function GOAL_BASKET_POS(playerId: PlayerID) {\n  const team = PLAYER_META[playerId].team\n  const left = new Set(['CLE', 'OKC'])\n  // const right = new Set(['GSW', 'LAC'])\n\n  return left.has(team) ? { x: 5.8, y: 25 } : { x: 88.2, y: 25 }\n}\n\nfunction PLAYER_ID_TO_OFF_RIGHT(playerId: PlayerID) {\n  return new Set(['GSW', 'LAC']).has(PLAYER_META[playerId].team)\n}\n\nfunction getPlayerBins(hexbin: Hexbin<ShotRecord>, playerId: PlayerID, shotRecords: ShotRecord[]) {\n  const onTheRight = PLAYER_ID_TO_OFF_RIGHT(playerId)\n  const leagueShots = shotRecords\n    .map(r => mapLOCTOTracking(onTheRight, r))\n  const playerShots = leagueShots\n    .filter(r => r.PLAYER_ID === playerId)\n\n  const playerShotsByRegion = groupShotsByRegion(playerShots)\n  const bins = hexbin(leagueShots)\n  const playerShotInBinWithDiff = bins\n    .map(d => {\n      const [region, value] = Object.entries(groupShotsByRegion(d))\n        .reduce((o, d) => (o && o[1].shots.length > d[1].shots.length) ? o : d)\n\n      const dft = leagueAvgByRegion[region]\n      const {\n        rate = dft?.rate ?? 0,\n        diff = 0,\n        eDiff = 0,\n        exp = dft?.exp ?? 0\n      } = playerShotsByRegion[region] ?? {}\n\n      const newD = d as HexbinBin<ShotRecord> & CachePlayerBin\n      newD.region = value.region\n      newD.diff = diff;\n      newD.eDiff = eDiff;\n      newD.regionRate = rate;\n      newD.regionExp = exp\n      return newD\n    })\n\n  // normalize\n  playerShotInBinWithDiff.forEach(d => {\n    ; (d as CachePlayerBin).regionFreq = d.length / Math.max(...playerShotInBinWithDiff.filter(r => r.region === d.region).map(r => r.length))\n  })\n\n  return playerShotInBinWithDiff.map(({ x, y, region, regionExp, regionRate, regionFreq, diff, eDiff }) => ({\n    x, y, region, regionExp, regionRate, regionFreq, diff, eDiff\n  })) as CachePlayerBin[]\n}\n\n/**\n * dirty hack\n */\nexport function getCanvasAbsTopLeft() {\n  const elm = document.getElementById(\"canvasWrapper\")\n  if (!elm) return { x: 0, y: 0 }\n  const { x, y, width, height } = elm?.getBoundingClientRect()\n  return {\n    // x: x + window.screenX,\n    // y: y + window.screenY + window.outerHeight - window.innerHeight,\n    x: x,\n    y: y + window.outerHeight / 50,\n    wScale: 1280 / width,\n    hScale: 720 / height\n  }\n}\n\nconst Scales = {\n  regionScale: scaleOrdinal<string>(schemeSet3),\n  twoPTColor: scaleSequential<string>(interpolateYlGnBu)\n    // .domain([-0.4, 0.4]),\n    .domain([0.2, 0.8]),\n  twoPT: scaleSequential<number>()\n    .domain([0, 0.4])\n    .range([0, 1]),\n  threePTColor: scaleSequential<string>(interpolateYlGnBu)\n    // .domain([-0.27, 0.27]),\n    .domain([0.2, 0.8]),\n  threePT: scaleSequential<number>()\n    .domain([0, 0.27])\n    .range([0, 1]),\n  radiusScale: scaleSqrt()\n    .domain([0, 1])\n    .range([1, hRadius]),\n  regionExp: scaleSequential<string>(interpolateReds)\n    .domain([0.1, params.GAME_ID === 'game1' ? 2 : 2.5])\n} as const\n\nexport {\n  Scales,\n  mapRegionToPoint, TwoOrThreePt, normalize, getPlayerBins,\n  PLAYER_ID_TO_OFF_RIGHT, POS_TO_OFF_TEAM,\n  getArea, getRegionKey, groupShotsByRegion, mapLOCTOTracking\n}","import \"./style.scss\"\nimport React from 'react'\n\nimport { Layer } from 'common/@types'\nimport {\n  Attentions,\n  DefensivePkg,\n  Gaze, KeyPlayer,\n  Lv2Player, Lv2PlayerType, OffensivePkg, PLAYER_STATUS,\n  PlayerID, Player,\n  Video, PlayerFlag\n} from '@types'\n\nimport * as _draw from 'common/@draw'\nimport * as draw from './visualizeData'\nimport { EnabledFeatures, videoEnv } from '../../App'\nimport { VisRing, VisSheild } from \"./visualizeData\"\nimport { PLAYER_META } from \"@const\"\nimport { Scales } from \"@utils\"\n\nconst layerIds = ['0_bg', '1_vis', '2_fg', '3_annot', '4_debug'] as const\n\n// 0bg --> raw frame\n// 1vis --> vis\n// 2fg --> fg + dark mask\n// 3annot --> highlighted players\n\nexport type LayerId = typeof layerIds[number]\n\ninterface Props {\n  currentVideo: Video\n  currentFrameIdx: number\n  currentFrame?: HTMLVideoElement\n  // currentFrameData?: Frame\n\n  gaze?: Gaze\n  attentions?: Attentions\n  gazePlayers?: Player[]\n\n  features: EnabledFeatures\n  playerFlags: Partial<Record<PlayerID, PlayerFlag>>\n\n  onPickPlayers?: (fIdx: number, lv1Players: Record<PlayerID, KeyPlayer>, lv2Players: Record<PlayerID, Lv2Player>) => void\n}\n\nexport class Visualizer extends React.Component<Props, {}> {\n\n  public readonly layers: Record<LayerId, Layer | null> = layerIds.reduce((o, l) => {\n    o[l] = null\n    return o\n  }, {} as Record<LayerId, Layer | null>)\n\n  get2DPos(id: PlayerID, players: Player[]) {\n    const { bbox, keypoints } = players?.find(p => p.id === id)!\n    const team = PLAYER_META[id].team\n    const { y, h } = bbox\n    const { left_hip, right_hip, left_ankle, right_ankle } = keypoints\n\n    // calculate cx and cy\n    const cx = (left_hip.x + right_hip.x) / 2\n    const cy = (y + h + Math.max(left_ankle.y, right_ankle.y)) / 2\n\n    return { cx, cy, team }\n  }\n\n  isOnLv2Player = (p: Player, lv2Players: Record<PlayerID, Lv2Player>) => p.id in lv2Players\n    && (\n      (lv2Players[p.id].type.has(Lv2PlayerType.Interest) && lv2Players[p.id].on)\n      || lv2Players[p.id].type.has(Lv2PlayerType.Normal)\n      // || lv2Players[p.id].type === Lv2PlayerType.Normal_Interest\n    )\n\n  async componentDidUpdate(preProps: Props) {\n    if (preProps.currentFrameIdx !== this.props.currentFrameIdx) {\n      const {\n        currentFrameIdx,\n        currentFrame,\n        features,\n        playerFlags\n      } = this.props\n      if (!currentFrame) return\n\n      this.cleanAllExcept('0_bg')\n      _draw.bg(this.layers['0_bg']!, currentFrame)\n      // dark overlay\n      _draw.overlay(this.layers['1_vis']!, 0.18)\n      // if (currentVideo.isTransit || params.MODE === 'RAW') return\n\n      const currentFrameData = videoEnv.frames?.[currentFrameIdx]\n      if (!currentFrameData) return\n\n      const { players, ball } = currentFrameData\n      if (!players) return\n\n      // // Step1. detect the players to show\n      const filter_focus = features.gaze_filter ? videoEnv.fetchFocus() : undefined\n      const { lv1Players, lv2Players } = videoEnv.pickPlayers(currentFrameIdx, features, playerFlags, filter_focus)\n      if (!lv1Players && !lv2Players) return\n\n      // DEBUG.TIMELINE && \n      this.props.onPickPlayers?.(currentFrameIdx, lv1Players, lv2Players)\n\n      // Step2 Decide the data to show for each player\n      const dataToVis = players!.filter(p => this.isOnLv2Player(p, lv2Players))\n\n      // Step3 Visualization & Render\n\n      const offensiveRings: VisRing[] = dataToVis\n        .filter(p => p.dataPkg?.mode === PLAYER_STATUS.offensive && features.vis_off_ring)\n        .map(({ dataPkg, id }) => {\n          // console.log('Offensive circle', id, PLAYER_META[id].ln)\n          let { smoothRegionExp, inOffsensiveCourt } = dataPkg as OffensivePkg\n          const { cx, cy } = this.get2DPos(id, players)\n          const fill = Scales.regionExp(smoothRegionExp)\n          return { cx, cy, fill, size: Math.min(1, smoothRegionExp / 2), inOffsensiveCourt }\n        })\n\n      const defensiveSheilds: VisSheild[] = dataToVis\n        .filter(p => p.dataPkg?.mode === PLAYER_STATUS.defensive && features.vis_def_sheild)\n        .map(({ dataPkg, id }) => {\n          let { diff, speed, tangle, tdist, defendingPlayer, smoothDFdiff } = dataPkg as DefensivePkg\n          const { cx, cy } = this.get2DPos(id, players)\n          const { cx: dx, cy: dy } = this.get2DPos(defendingPlayer, players)\n\n          return {\n            cx, cy,\n            dx, dy,\n            diff, tangle, tdist,\n            smoothDFdiff,\n            speed,\n          }\n        })\n      draw.Vis(this.layers['1_vis']!.ctx, offensiveRings, defensiveSheilds, this.layers['4_debug']?.ctx)\n\n      // draw fg\n      // draw.fg(this.layers['2_fg']?.ctx!, this.layers['0_bg']!.canvas, currentFrameData.mask!)\n      draw.HL(this.layers['3_annot']?.ctx!, this.layers['0_bg']!.canvas, currentFrameData.mask!,\n        players,\n        // \n        players?.filter(p => p.id in lv1Players)\n          .map(p => ({ ...p, ...lv1Players[p.id] })),\n        players.filter(p => p.id in lv2Players)\n          .map(p => ({ ...p, ...lv2Players[p.id] })),\n        features,\n        ball?.playerId,\n        filter_focus\n      )\n\n      // 3. text annotations\n      draw.Name(this.layers['3_annot']?.ctx!, players.find(p => p.id === ball?.playerId))\n      // only on, will show the name\n      Object.values(lv2Players)\n        .filter(p => p.type.has(Lv2PlayerType.Interest) && p.on)\n        .forEach(ip => {\n          draw.Name(this.layers['3_annot']?.ctx!, players.find(p => p.id === ip.id))\n        })\n    }\n  }\n\n  render() {\n    const { currentVideo } = this.props\n    const { width = 0, height = 0 } = currentVideo ?? {}\n\n    return (<div className='visualizationContainer'\n\n      style={{\n        // marginLeft: '20px',\n        // justifyContent: 'center' //DEBUG ? 'flex-start' : 'center'\n      }}\n    >\n      <div id=\"canvasWrapper\" className=\"canvasWrapper\">\n        <img alt=\"www\" src=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\"\n          style={{ height: `${width / height * 100}%` }}\n        ></img>\n        {layerIds.map((l, idx) =>\n          <canvas id={l}\n            key={idx}\n            width={width}\n            height={height}\n            ref={ref => {\n              if (!ref) return\n              this.layers[l] = { canvas: ref, ctx: ref.getContext('2d')! }\n            }}\n          />)}\n        {this.props.children}\n      </div>\n    </div>)\n  }\n\n  public cleanAllExcept(layerId: LayerId) {\n    Object.keys(this.layers)\n      .filter(lId => lId !== layerId)\n      .forEach((lId) => {\n        const l = this.layers[lId as LayerId]\n        l?.ctx.clearRect(0, 0, l.canvas.width, l.canvas.height)\n      })\n  }\n}","import \"./style.scss\"\n\nimport React, { memo } from 'react'\nimport type { Frame } from 'common/@types';\n\nimport type { PlayerID, PlayerShotBin, ShotRecord } from '@types'\nimport { miniMapSize, PLAYER_META } from '@const';\n\nimport { hexbin, Scales } from \"@utils\";\nimport { HexbinBin } from 'd3-hexbin';\nimport { videoEnv } from 'App';\n\n\nconst scaleT2Minimap = miniMapSize[0] / 94;\n\nconst HexaBin = memo(function HexaBin(props: { isIn: boolean, d: PlayerShotBin }) {\n  const { isIn, d } = props\n  return <path\n    // fill={mapRegionToPoint(d.region) === 2\n    //   ? dataTower.scales.twoPTColor(d.regionRate)\n    //   : dataTower.scales.threePTColor(d.regionRate)}\n    // fill={dataTower.scales.regionScale(d.region)}\n    className=\"court_bin\"\n    fill={Scales.regionExp(d.regionExp)}\n    strokeWidth={isIn ? 2 : 0}\n    d={`M${d.x},${d.y}${hexbin.hexagon()}`}\n  ></path>;\n  //dataTower.scales.radiusScale(d.freqByRegion)\n})\n\ninterface HexaProps {\n  currentBin?: HexbinBin<ShotRecord>\n  playerBins?: PlayerShotBin[]\n}\nconst Hexagon = memo(function Hexagon(props: HexaProps) {\n  const { playerBins, currentBin } = props\n\n  return <svg width={miniMapSize[0]} height={`${scaleT2Minimap * 50}px`}\n    style={{ position: 'absolute', overflow: 'visible' }}>\n    <g transform={`scale(${miniMapSize[0] / 940})`}>\n      {playerBins?.map(d => {\n        const isIn = d.x === currentBin?.x && d.y === currentBin?.y;\n        return <HexaBin key={`${d.x}_${d.y}`} d={d} isIn={isIn} />\n      })}\n    </g>\n  </svg>;\n})\n\ninterface CourtProps {\n  currentFrameData?: Frame<PlayerID>\n}\nexport const Court = memo(function Court(props: CourtProps) {\n  const { currentFrameData } = props;\n\n  if (!currentFrameData)\n    return <></>\n\n  const { players, ball } = currentFrameData; // \n\n  const playerMarkers = players\n    ?.filter(({ tracking }) => tracking.x !== undefined && tracking.y !== undefined)\n    .map(({ tracking, id }, mIdx) => {\n      const { x: tx, y: ty } = tracking\n      const team = PLAYER_META[id].team\n\n      return <div key={id}\n        className=\"marker\"\n        style={{\n          top: ty! * scaleT2Minimap,\n          left: tx! * scaleT2Minimap,\n          backgroundColor: ['GSW', 'LAC'].includes(team) ? 'steelblue' : '#ff6347',\n          color: ball?.playerId === id ? 'red' : '#000',\n          fontSize: ball?.playerId === id ? '15px' : '12px'\n        }}\n      >{PLAYER_META[id]?.ln}</div>;\n    });\n\n  if (ball) {\n    playerMarkers?.push(<div key={'ball'}\n      className=\"marker\"\n      style={{\n        top: ball.tracking.y * scaleT2Minimap,\n        left: ball.tracking.x * scaleT2Minimap,\n        backgroundColor: 'orange'\n      }}\n    ></div>);\n  }\n\n  // id 201939\n  const playerId = ball?.playerId;\n  const playerWithBall = players?.find(p => p.id === playerId);\n\n  const currentBin = videoEnv.getCurrentBin(playerWithBall)\n  const playerBins = videoEnv.getPlayerBins(playerWithBall?.id)\n\n  return <div className=\"court\">\n    {playerId && <Hexagon\n      currentBin={currentBin}\n      playerBins={playerBins}\n    ></Hexagon>}\n    {playerMarkers}\n    <img\n      className=\"court-img\"\n      style={{ width: miniMapSize[0] }}\n      src={`${process.env.PUBLIC_URL}/court.png`}\n    >\n    </img>\n  </div>;\n\n})\nCourt.displayName = 'Court'\n","import React from \"react\";\nimport clsx from 'clsx';\n\nimport { Interval as TInterval } from '../../@types'\n\ntype Direction = 'e' | 'w'\n\ninterface Props extends TInterval {\n  id: number\n  focused: boolean\n  initializing: boolean\n  x: number\n  w: number\n  style?: React.CSSProperties\n  onMoving: (id: number, updateInterval: { x: number, w: number }) => void\n  onAdjusting: (id: number, updateInterval: { x: number, w: number }) => void\n  onAdjustingEnd: (id: number, resizeIntervalEnd: { x: number, w: number }, end_?: boolean) => void\n  getEW: (id: number) => { ex: number, wx: number } | undefined\n  onClickInterval: (id: number) => void\n}\n\ninterface State {\n  isMoving: { ox: number } | null\n  isAdjusting: {\n    direction: Direction,\n    oBBox: { x: number, w: number },\n    ox: number\n  } | null\n  cursorStatus: 'movable' | 'resizable' | null\n}\n\nexport class Interval extends React.Component<Props, State> {\n\n  state: State = {\n    isMoving: null,\n    isAdjusting: null,\n    cursorStatus: null, //鼠标指针状态\n  }\n\n  componentDidMount() {\n    window.addEventListener('mousemove', this.onMoving)\n    window.addEventListener('mouseup', this.onMoveEnd)\n    window.addEventListener('mousemove', this.onResizing)\n    window.addEventListener('mouseup', this.onResizeEnd)\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('mousemove', this.onMoving)\n    window.removeEventListener('mouseup', this.onMoveEnd)\n    window.removeEventListener('mousemove', this.onResizing)\n    window.removeEventListener('mouseup', this.onResizeEnd)\n  }\n\n  /** Resizing the bbox */\n  onResizeStart = (e: React.MouseEvent<HTMLDivElement, MouseEvent>, direction: Direction) => {\n    if (e.button !== 0) return\n    e.stopPropagation()\n    const { x, w } = this.props\n    // 全局坐标\n    const mx = e.clientX\n\n    this.setState({\n      isAdjusting: {\n        direction,\n        oBBox: { x, w },\n        ox: mx // 记录初始鼠标位置, 全局坐标\n      },\n      cursorStatus: 'resizable'\n    })\n    document.body.classList.add('adjusting', direction)\n  }\n\n  onResizing = (e: MouseEvent) => {\n    const { isAdjusting } = this.state\n    if (isAdjusting === null || e.button !== 0) return\n    e.preventDefault()\n    e.stopImmediatePropagation()\n\n    let { x, w, id } = this.props\n    const { direction, oBBox, ox } = isAdjusting\n    const mx = e.clientX\n    const dx = mx - ox\n\n    const { wx, ex } = this.props.getEW(id)!\n    switch (direction) {\n      case 'w':\n        // 如果在左, 更新x和w\n        x = Math.min(oBBox.x + oBBox.w, oBBox.x + dx) // 上限为原来的右边\n        x = Math.max(wx, x) // 下限\n        w = Math.min(oBBox.x + oBBox.w - wx, oBBox.w - dx)   // 上限\n        w = Math.max(0, w) // 下限\n        break\n      case 'e':\n        // 如果在右, 只更新w, 下限为0\n        w = Math.max(0, oBBox.w + dx)\n        w = Math.min(ex - x, w)  // 上限\n        break\n    }\n\n    this.props.onAdjusting?.(this.props.id, { x, w })\n  }\n\n  onResizeEnd = (e: MouseEvent) => {\n    const { isAdjusting } = this.state\n    if (isAdjusting === null || e.button !== 0) return\n    e.preventDefault()\n    e.stopImmediatePropagation()\n\n    let { x, w, id } = this.props\n    this.props.onAdjustingEnd?.(id, { x, w }, true)\n\n    this.setState({\n      isAdjusting: null\n    })\n    document.body.classList.remove('adjusting', 'w', 'e', 's', 'n')\n  }\n\n  /** Dragging the bbox */\n  onMoveStart = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    // not left click\n    if (e.button !== 0) return\n    e.stopPropagation()\n    e.preventDefault()\n\n    const { x } = this.props\n    const mx = e.clientX;\n    this.setState({\n      isMoving: { ox: mx - x },\n      cursorStatus: 'movable'\n    })\n  }\n\n  onMoving = (e: MouseEvent) => {\n    const { isMoving } = this.state\n    if (isMoving === null) return\n    e.preventDefault()\n    e.stopImmediatePropagation()\n\n    const mx = e.clientX\n    let { w, id } = this.props\n    const { wx, ex } = this.props.getEW(id)!\n    let newx = Math.max(wx, mx - isMoving.ox)\n    newx = Math.min(newx, ex - w)\n\n    this.props.onMoving?.(this.props.id, { x: newx, w })\n  }\n\n  onMoveEnd = (e: MouseEvent) => {\n    const { isMoving } = this.state\n    if (isMoving === null || e.button !== 0) return\n    e.preventDefault()\n    e.stopImmediatePropagation()\n\n    this.setState({ isMoving: null })\n  }\n\n  render() {\n    const { x, w, focused, initializing, style = {} } = this.props\n    const { isAdjusting, isMoving, cursorStatus } = this.state\n    return <div className={clsx('interval-container', { focused })}\n      style={{ left: x }}\n    >\n      <div\n        className={clsx('interval', cursorStatus)}\n        style={{ width: w, ...style }}\n        onMouseDown={e => {\n          const parentDim = e.currentTarget.parentElement!.getBoundingClientRect()\n          // local coordinate\n          const mx = e.clientX - parentDim.x\n\n          // detect if left or right edge\n          if (Math.abs(mx) < 3) {\n            this.onResizeStart(e, 'w')\n          } else if (Math.abs(mx - w) < 3) {\n            this.onResizeStart(e, 'e')\n          } else {\n            // not on the edge\n            this.onMoveStart(e)\n          }\n        }}\n        onMouseMove={e => {\n          if (isAdjusting || isMoving) return\n          // icon for the cursor status\n          const { w } = this.props\n          const parentDim = e.currentTarget.parentElement!.getBoundingClientRect()\n          // local coordinate in parent\n          const mx = e.clientX - parentDim.x\n\n          // detect if left or right edge\n          if (Math.abs(mx) < 3 || Math.abs(mx - w) < 3) {\n            this.setState({ cursorStatus: 'resizable' })\n          } else {\n            // not on the edge\n            this.setState({ cursorStatus: 'movable' })\n          }\n        }}\n        onClick={e => this.props.onClickInterval(this.props.id)}\n      >\n      </div>\n    </div>\n  }\n}","import \"./style.scss\";\nimport React from \"react\";\n\nimport { Interval, Clip, BaseVideo } from '../../@types'\nimport { intervalIdGen, localFIdxToGlobalFIdx } from '../../@utils'\n\nimport { Interval as CInterval } from './Interval'\n\nfunction pad(num: number) {\n  return (\"0\" + num).slice(-2);\n}\nfunction hhmmss(secs: number) {\n  const t = Math.floor(secs * 1000);\n  // const ms = t % 1000;\n  secs = Math.floor(t / 1000);\n  let minutes = Math.floor(secs / 60);\n  secs = secs % 60;\n  minutes = minutes % 60;\n  return `${pad(minutes)}:${pad(secs)}`;\n}\n\ninterface BaseProps<GameID extends string, VideoID extends string> {\n  mode?: 'S' | 'M' | 'L'\n\n  videos: BaseVideo<GameID, VideoID>[];\n  currentVideoIdx: number;\n  currentFrameIdx: number\n\n  // style\n  containerHeightPadding?: number\n\n  // encodedData?: TDataOption[]\n  children?: (globalTrackWidth: number, globalMaxFrames: number) => React.ReactNode\n  onClickInterval?: (clipId: number, globalFrameIdx: number) => void;  // 给父组件上传起止帧\n}\n\nexport type TimelineProps<GameID extends string, VideoID extends string> = BaseProps<GameID, VideoID> & ({\n  enableClips: false\n} | {\n  enableClips: true\n  clips: Clip<VideoID>[]\n  focusedClipId: number\n\n  onUpsertClip?: (id: number, interval: Partial<Interval> | null) => void\n})\n\n// interface xProps {\n// showEvents: boolean\n// handlers\n// onParse: (id: number, rawtext: string, visFunc: (entities: Entity[]) => void) => void\n// onChangeText?: (id: number, rawtext: string) => void\n// }\n\ninterface State {\n  isDrawing: { intervalId: number, ox: number, omx: number } | null;  // omx: 全局用于dx ox: 本地坐标系\n}\n\nexport class Timeline<GameID extends string, VideoID extends string> extends React.Component<TimelineProps<GameID, VideoID>, State> {\n\n  get globalMaxFrames() { return this.props.videos.reduce((o, v) => o + v.maxFrame, -1) }\n  get trackWidthFactor() {\n    return this.globalMaxFrames < 500 ? 4 : 1\n  }\n  get totalTrackWidth() {\n    return this.globalMaxFrames * this.trackWidthFactor\n  }\n  get globalCurFrameIdx() {\n    const { currentFrameIdx, currentVideoIdx, videos } = this.props\n    return localFIdxToGlobalFIdx(currentVideoIdx, currentFrameIdx, videos)\n  }\n  get maxTime() { return this.props.videos.reduce((o, v) => o + v.maxFrame / v.frameRate, 0) }\n  get numberOfImg() { return Math.ceil(this.maxTime) * 2 }\n  get intervalSelectorHeight() {\n    const { mode = 'M' } = this.props\n    return mode === 'M'\n      ? 60\n      : mode === 'S'\n        ? 30\n        : 90\n  }\n  get containerHeight() {\n    const { containerHeightPadding = 60 } = this.props\n    return this.intervalSelectorHeight + containerHeightPadding\n  }\n\n  #pointer = React.createRef<HTMLDivElement>()\n  imgWidth = (this.intervalSelectorHeight * 1920) / 1080\n  parentOffsetx: number = 0\n  state: State = {\n    isDrawing: null,\n  }\n\n  canvas?: HTMLCanvasElement\n  ctx?: CanvasRenderingContext2D\n\n  componentDidMount() {\n    const { enableClips } = this.props\n\n    if (enableClips) {\n      window.addEventListener('mousemove', this.onDrawing)\n      window.addEventListener('mouseup', this.onDrawEnd)\n    }\n  }\n\n  componentDidUpdate(prevProps: Readonly<TimelineProps<GameID, VideoID>>): void {\n    if (prevProps.currentFrameIdx !== this.props.currentFrameIdx) {\n      if (this.#pointer.current) {\n        const bbox = this.#pointer.current.getBoundingClientRect()\n        if (bbox.left > (window.innerWidth || document.documentElement.clientWidth) || bbox.right < 0) {\n          console.log(bbox, window.innerWidth, document.documentElement.clientWidth)\n          this.#pointer.current.parentElement?.scrollTo({ behavior: 'smooth', left: bbox.left + 400 })\n          // .scrollIntoView({ behavior: \"smooth\", block: \"nearest\", inline: \"center\" })\n        }\n        // ;(this.#pointer.current as any).scrollIntoViewIfNeeded(true)\n      }\n    }\n\n    // const { pickedPlayers } = this.props\n    // if (Object.keys(preProps.pickedPlayers).length < Object.keys(pickedPlayers).length) {\n    //   const { ctx, globalCurFrameIdx } = this\n    //   const maxFIdx = Math.max(...Object.keys(pickedPlayers).map(f => +f))\n    //   const { lv1Players, lv2Players } = pickedPlayers[maxFIdx]\n    //   const maxY = 40\n\n    //   const playersOn = Object.values(lv2Players).filter(p => p.on)\n    //   let y1 = maxY - playersOn.length * 5\n    //   ctx!.lineWidth = 1\n    //   ctx!.strokeStyle = 'red'\n    //   ctx!.beginPath()\n    //   ctx?.moveTo(globalCurFrameIdx, y1)\n    //   ctx?.lineTo(globalCurFrameIdx, maxY)\n    //   ctx!.stroke()\n\n    //   const lv1NotOnNotEmpty = Object.keys(lv1Players)\n    //     .filter(pId => !playersOn.find(p => p.id === +pId) && lv1Players[+pId as PlayerId].type !== KeyPlayerType.EMPTY_PLAYER)\n    //   ctx!.strokeStyle = '#f5f5f5'\n    //   let y2 = y1 - lv1NotOnNotEmpty.length * 5\n    //   ctx?.beginPath()\n    //   ctx?.moveTo(globalCurFrameIdx, y2)\n    //   ctx?.lineTo(globalCurFrameIdx, y1)\n    //   ctx!.stroke()\n\n\n    //   const lv1NotOnEmpty = Object.keys(lv1Players)\n    //     .filter(pId => !playersOn.find(p => p.id === +pId) && lv1Players[+pId as PlayerId].type === KeyPlayerType.EMPTY_PLAYER)\n    //   ctx!.strokeStyle = '#f5f5f5'\n    //   let y3 = y2 - lv1NotOnEmpty.length * 5\n    //   ctx?.beginPath()\n    //   ctx?.moveTo(globalCurFrameIdx, y3)\n    //   ctx?.lineTo(globalCurFrameIdx, y2)\n    //   ctx!.stroke()\n    // }\n\n\n    // const { ctx } = this\n    // if (prevProps.videos.length !== this.props.videos.length && ctx) {\n    //   ctx!.lineWidth = 1\n    //   ctx!.strokeStyle = 'green'\n    //   ctx!.beginPath()\n    //   ctx?.moveTo(0, 40 - 5 * 3)\n    //   ctx?.lineTo(this.totalTrackWidth, 40 - 5 * 3)\n    //   ctx!.stroke()\n\n    //   ctx!.beginPath()\n    //   ctx?.moveTo(0, 40 - 5 * 4)\n    //   ctx?.lineTo(this.totalTrackWidth, 40 - 5 * 4)\n    //   ctx!.stroke()\n    // }\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('mousemove', this.onDrawing)\n    window.removeEventListener('mouseup', this.onDrawEnd)\n  }\n\n  /** Draw interval */\n  onDrawStart = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    if (e.button !== 0) return;\n\n    const parentDim = e.currentTarget.parentElement!.getBoundingClientRect()\n    this.parentOffsetx = -parentDim.x + e.currentTarget.scrollLeft\n    const mx = e.clientX // 鼠标点击位置, 全局坐标系\n    const ox = mx + this.parentOffsetx // interval初始位置, 本地坐标系\n\n    // click on progressbar\n    if (e.clientY >= parentDim.bottom - 8) return\n\n    if (!this.props.enableClips) {\n      const globalFrameIdx = this.pos2frame(ox)\n      this.props.onClickInterval?.(-1, globalFrameIdx)\n    } else {\n      const { clips } = this.props\n      // if click within an interval\n      if (clips.find(i => this.frame2pos(i.interval.start) <= ox && ox <= this.frame2pos(i.interval.end))) {\n        const curFrame = this.pos2frame(ox)\n        this.props.onClickInterval?.(-1, curFrame)\n      } else {\n        // 获取一个新的id\n        const newIntervalId = intervalIdGen()\n        // 新建一个interval 维护interval起始点从小到大\n        let i = 0;\n        for (; i < clips.length; i++) {\n          if (this.frame2pos(clips[i].interval.start) > ox) {\n            break;\n          }\n        }\n\n        const startFrame = this.pos2frame(ox)\n        const endFrame = this.pos2frame(ox + 0)\n        const newInterval: Interval = {\n          // x: ox,\n          // w: 0,\n          start: startFrame,\n          end: endFrame\n        }\n        this.props.onUpsertClip?.(newIntervalId, newInterval)\n\n        this.setState({\n          isDrawing: { intervalId: newIntervalId, omx: mx, ox: ox },\n        })\n      }\n    }\n  }\n\n  onDrawing = (e: MouseEvent) => {\n    const { isDrawing } = this.state\n    if (e.button !== 0 || isDrawing === null || !this.props.enableClips) return;\n\n    const { clips } = this.props\n    const mx = e.clientX\n    const drawingInterval = clips.find(int => int.id === isDrawing.intervalId) // 浅复制 指针\n    if (!drawingInterval) return\n\n    // 更新这个interval的x和width\n    let dx = mx - isDrawing.omx // 先获取x方向上的差值\n    // 防止重叠\n    const { wx, ex } = this.getEW(drawingInterval.id)!\n    const maxdx = ex - isDrawing.ox\n    const mindx = wx - isDrawing.ox\n    if (dx < mindx) {\n      dx = mindx\n    } else if (dx > maxdx) {\n      dx = maxdx\n    }\n\n    const startFrame = dx > 0 ? drawingInterval.interval.start : this.pos2frame(Math.max(isDrawing.ox + dx, 0))\n    const w = Math.abs(dx)\n    const endFrame = startFrame + this.pos2frame(w)\n    this.props.onUpsertClip?.(drawingInterval.id, { start: startFrame, end: endFrame })\n  }\n\n  onDrawEnd = (e: MouseEvent) => {\n    const { isDrawing } = this.state\n    if (e.button !== 0 || isDrawing === null || !this.props.enableClips) return\n    const { clips } = this.props\n    const drawingIntervalIdx = clips.findIndex(int => int.id === isDrawing.intervalId)\n    if (drawingIntervalIdx === -1) return\n\n    const drawingInterval = clips[drawingIntervalIdx]\n\n    this.setState({ isDrawing: null })\n    const { start, end } = drawingInterval.interval\n    if (end - start <= 2) {\n      this.props.onUpsertClip?.(drawingInterval.id, null)\n    }\n    this.props.onClickInterval?.(drawingInterval.id, start)\n  }\n\n  updateInterval = (clipId: number, newInterval: { x?: number, w?: number }, end_ = false) => {\n    if (!this.props.enableClips) return\n\n    const { clips } = this.props\n    const targetIntervalIdx = clips.findIndex(int => int.id === clipId)\n    const targetInterval = clips[targetIntervalIdx].interval\n\n    const start = newInterval.x ? this.pos2frame(newInterval.x) : targetInterval.start\n    const end = newInterval.w ? (this.pos2frame(newInterval.w) + start) : targetInterval.end\n\n    this.props.onUpsertClip?.(clipId, ((end - start <= 2) && end_) ? null : { start, end })\n  }\n\n  getEW = (intervalIdx: number) => {\n    if (!this.props.enableClips) return\n\n    const { clips } = this.props\n    const { numberOfImg } = this\n\n    const intervalCount = clips.findIndex(int => int.id === intervalIdx)!\n    let ex = 0, wx = 0\n\n    if (intervalCount === 0) {\n      wx = this.parentOffsetx\n    } else {\n      wx = this.frame2pos(clips[intervalCount - 1].interval.end) + 1\n    }\n\n    if (intervalCount === clips.length - 1) {\n      ex = (this.intervalSelectorHeight * 1920) / 1080 * numberOfImg + this.parentOffsetx\n    } else {\n      ex = this.frame2pos(clips[intervalCount + 1].interval.start) - 1\n    }\n\n    return { wx, ex }\n  }\n\n  pos2frame = (pos: number) => {\n    const { totalTrackWidth: trackWidth, globalMaxFrames: maxFrame } = this\n    return Math.round(Math.min(pos, trackWidth) / trackWidth * maxFrame)\n  }\n  frame2pos = (frame: number) => {\n    const { totalTrackWidth: trackWidth, globalMaxFrames: maxFrame } = this\n    return (frame / maxFrame) * (trackWidth)\n  }\n\n  // renderIndicator() {\n  //   const { events, maxFrame, clips, encodedData = [] } = this.props\n  //   const { imgWidth, numberOfImg } = this\n\n  //   const indicators = []\n  //   for (const clip of clips) {\n  //     const { interval } = clip\n  //     const coverEvents = events.filter(evt => evt.to >= interval.start && evt.from <= interval.end)\n  //     for (const coverEvt of coverEvents) {\n  //       if ((coverEvt?.type === EvtType.PlayerHit || coverEvt?.type === EvtType.PlayerMove)\n  //         && encodedData.some(k => toPause.has(k))) {\n  //         indicators.push(coverEvt)\n  //         break\n  //       }\n  //     }\n  //   }\n\n  //   // render indicators\n  //   return indicators.map(evt => {\n  //     return <div key={`${evt.type}_${evt.from}_${evt.to}`} className={'trigger'} style={{\n  //       left: `${imgWidth * numberOfImg * evt.data.hit! / maxFrame}px`,\n  //     }}>\n\n  //     </div>\n  //   })\n  // }\n\n  renderClips() {\n    if (!this.props.enableClips) return\n    const { clips, focusedClipId } = this.props\n    const { isDrawing } = this.state\n\n    return clips.map(({ id: intervalId, interval }, idx) =>\n      <CInterval\n        key={intervalId}\n        id={intervalId}\n        x={this.frame2pos(interval.start)}\n        w={this.frame2pos(interval.end - interval.start)}\n        style={{ height: `${this.intervalSelectorHeight + 10}px` }}\n        focused={focusedClipId === intervalId}\n        onMoving={this.updateInterval}\n        onAdjusting={this.updateInterval}\n        onAdjustingEnd={this.updateInterval}\n        getEW={this.getEW}\n        initializing={isDrawing?.intervalId === intervalId}\n        onClickInterval={(id) => {\n          this.props.onClickInterval?.(intervalId, interval.start)\n        }}\n        {...interval}\n      />\n    )\n  }\n\n  render() {\n    const { currentFrameIdx, videos } = this.props;\n    const { maxTime, globalMaxFrames: maxFrame, intervalSelectorHeight, globalCurFrameIdx, containerHeight } = this\n\n    const currentTime = currentFrameIdx / (videos[0]?.frameRate ?? 30)\n\n    return (\n      <div className=\"timeline-container\" style={{ flex: `0 0 ${containerHeight}px` }}>\n        <div className=\"timeline\"\n          onMouseDown={this.onDrawStart}>\n          <div className=\"time-info\">\n            <span>\n              {\" \"}\n              {hhmmss(currentTime)} ({currentFrameIdx}) / {hhmmss(maxTime)} ({maxFrame})\n            </span>\n          </div>\n          <div className=\"pointer\" ref={this.#pointer}\n            style={{\n              left: `calc(12px + ${this.frame2pos(globalCurFrameIdx)}px)`,\n            }}\n          ></div>\n\n          <div id=\"timeline-progress\" className=\"track-container\">\n            {videos.map(v => <div\n              key={v.id}\n              className=\"track\"\n              style={{\n                width: `${v.maxFrame * this.trackWidthFactor}px`,\n                height: intervalSelectorHeight,\n                backgroundColor: v.isTransit ? '#515151' : 'rgb(116 99 57)',\n                opacity: ((v.isTransit || v.loadedData === 1) && v.loadedVideo === 1) ? 1 : 0.5\n              }}>\n              <span className=\"video-name\">{v.id}</span>\n              {/* {this.renderIndicator()} */}\n              {this.props.children?.(this.totalTrackWidth, this.globalMaxFrames)}\n            </div>\n            )}\n            {/*<div className=\"track\">\n               {Array(numberOfImg).fill(0)\n                .map((_, idx) => (\n                  <img\n                    alt='bg'\n                    key={`img_${idx}`}\n                    className=\"img\"\n                    src={`/assets/${videoId}/reduced_frames/${Math.floor(\n                      (maxFrame * idx) / numberOfImg\n                    )}.jpg`}\n                    // x={idx * imgWidth}\n                    draggable=\"false\"\n                    height={this.intervalSelectorHeight}\n                    width={imgWidth}\n                  />\n                ))} \n            </div>*/}\n            {this.renderClips()}\n          </div>\n\n          {/* <canvas\n            ref={ref => {\n              if (!ref || this.canvas) return\n              this.canvas = ref\n              this.ctx = ref.getContext('2d')!\n            }}\n            className=\"debug-timeline\"\n            width={`${this.totalTrackWidth}px`}\n            height={`${40}px`}>\n          </canvas> */}\n\n        </div>\n      </div>\n    );\n  }\n}\n","import './style.scss'\nimport React from 'react'\n\nimport type { Ball, Frame, BasePlayer, BaseVideo } from '../../@types'\n\nexport interface SVGLayerProps<GameID extends string, VideoID extends string, PlayerID extends number> {\n  // width: number\n  // height: number\n  currentVideo: BaseVideo<GameID, VideoID>\n  currentFrameData?: Frame<PlayerID>\n  activeBBoxes?: Array<PlayerID | 'ball'>\n\n  // animatedFrameIdx: number\n  onContextMenu?: (e: React.MouseEvent<SVGSVGElement, MouseEvent>) => void\n  onClickBG?: () => void\n  onClickPlayer?: (player: BasePlayer<PlayerID>, idx: number) => void\n  onClickBall?: (ball: Ball) => void\n  onDBClick?: () => void\n}\n\nfunction convertRemToPixels(rem: number) {\n  return rem * parseFloat(getComputedStyle(document.documentElement).fontSize);\n}\n\nexport class SVGLayer<GameID extends string, VideoID extends string, PlayerID extends number> extends React.Component<SVGLayerProps<GameID, VideoID, PlayerID>> {\n\n  render() {\n    const {\n      currentVideo,\n      currentFrameData,\n      activeBBoxes\n    } = this.props\n    const { height = 0, width = 0 } = currentVideo ?? {}\n\n    const players = currentFrameData?.players ?? []\n    const ball = currentFrameData?.ball ?? null\n\n    return <svg className=\"overlay\" height={height} width={width}\n      viewBox={`0 0 ${width} ${height}`}\n      preserveAspectRatio='xMinYMin meet'\n      onClick={(e) => {\n        if (e.target === e.currentTarget)\n          this.props.onClickBG?.()\n      }}\n      onContextMenu={this.props.onContextMenu}\n      onDoubleClick={e => {\n        if (e.target === e.currentTarget)\n          this.props.onDBClick?.()\n      }}\n    >\n      <defs>\n        <filter x=\"0\" y=\"0\" width=\"1\" height=\"1\" id=\"solid\">\n          <feFlood floodColor=\"yellow\" result=\"bg\" />\n          <feMerge>\n            <feMergeNode in=\"bg\" />\n            <feMergeNode in=\"SourceGraphic\" />\n          </feMerge>\n        </filter>\n      </defs>\n\n      {players.map((player, idx) => <rect key={idx}\n        className={`bbox ${activeBBoxes?.includes(player.id) ? 'active' : ''}`}\n        x={player.bbox.x}\n        y={player.bbox.y}\n        width={player.bbox.w}\n        height={player.bbox.h}\n\n        onContextMenu={e => {\n          e.preventDefault()\n          e.stopPropagation()\n          // this.props.onClickPersonBBox(idx, b)\n        }}\n        onClick={e => {\n          e.stopPropagation()\n          this.props.onClickPlayer?.(player, idx)\n        }}\n      />)}\n\n      {ball && <circle\n        className={`ball ${activeBBoxes?.includes('ball') ? 'active' : ''}`}\n        cx={ball.screenPos.x}\n        cy={ball.screenPos.y}\n        r={5} // hardcode value\n        onClick={e => {\n          e.stopPropagation()\n          this.props.onClickBall?.(ball)\n        }}\n      >\n      </circle>}\n      {this.props.children}\n    </svg>\n  }\n}","import React from 'react'\n\nimport { SVGLayer, SVGLayerProps } from 'common/@components'\nimport { GameID, Gaze, Player, PlayerID, PLAYER_STATUS, VideoID } from '@types'\nimport { GAZE_R, PLAYER_META } from '@const'\nimport { Frame } from 'common/@types'\n\ninterface Props extends SVGLayerProps<GameID, VideoID, PlayerID> {\n  currentFrameData?: Frame<PlayerID>\n\n  gazePlayers?: Player[]\n  gaze?: Gaze\n  // sync?: boolean\n  bbox?: boolean\n}\n\nexport class Overlay extends React.Component<Props> {\n\n  render() {\n    const {\n      gaze,\n      gazePlayers,\n      bbox = true,\n      currentFrameData,\n      ...svgLayerProps\n    } = this.props\n    const { players } = currentFrameData ?? {}\n    const { isTransit } = svgLayerProps.currentVideo ?? {}\n\n    return <SVGLayer\n      {...svgLayerProps}\n    >\n\n      {gaze && <g transform={`translate(${gaze.x}, ${gaze.y})`}>\n        <circle r={GAZE_R}\n          stroke={'red'}\n          fill={'rgba(255, 0, 0, 0.1)'}></circle>\n        <text\n          textAnchor=\"middle\"\n          // stroke=\"#fff\"\n          fill='#fff'\n          // stroke-width=\"1px\"\n          alignmentBaseline=\"middle\"\n        >\n          {(gaze.x).toFixed(0)}, {(gaze.y).toFixed(0)}\n          fIdx: {gaze.fIdx}\n        </text>\n      </g>\n      }\n\n      {/* {!isTransit && <text x={10} y={20} fill={'#fff'}>Team w/ ball: {teamWithBall}</text>}\n      {!isTransit && <text x={150} y={20} fill={'#fff'}>Ballholder: {ball?.playerId ? PLAYER_META[ball!.playerId].ln : null}</text>} */}\n      {/* {!isTransit && <text x={350} y={20} fill={'#fff'}>FrameIdx: {frameIdx}</text>} */}\n\n      {!isTransit && bbox && players\n        ?.filter(({ dataPkg }) => dataPkg)\n        .map(({ bbox, id, dataPkg }) => {\n          return <g\n            key={id}\n            className={`bbox ${gazePlayers?.some(p => p.id === id) ? 'active' : ''}`}\n            transform={`translate(${bbox.x}, ${bbox.y})`}>\n            <rect\n              width={bbox.w}\n              height={bbox.h}\n            />\n            {dataPkg && <text\n              fill='#fff'\n              alignmentBaseline=\"middle\"\n            >\n              {`${dataPkg.mode}, v: ${(dataPkg?.mode === PLAYER_STATUS.defensive\n                ? dataPkg.diff\n                : dataPkg.regionExp).toFixed(1)}`}\n            </text>\n            }\n          </g>\n        }\n        )}\n    </SVGLayer>\n  }\n}\n","import \"./style.scss\"\n\nimport React from 'react'\nimport { IoSendSharp } from 'react-icons/io5'\nimport { MdComment } from 'react-icons/md'\nimport { PLAYER_META } from \"@const\"\nimport { PlayerID } from \"@types\"\n\ninterface State {\n  text: string\n  activeIndex: number\n  matches: string[]\n  // current Player entities\n  // playerEntities: PlayerID[]\n}\n\ninterface Props {\n  existPlayers: PlayerID[]\n  onSend?: (text: string) => void\n  onUpdatePlayerEntity?: (matches: PlayerID[]) => void\n}\n\nexport class CommentBox extends React.Component<Props, State> {\n\n  state: Readonly<State> = {\n    text: '',\n    activeIndex: 0,\n    matches: [],\n  }\n\n  get namesToSearch() {\n    // check player's name\n    const { existPlayers } = this.props\n    const names = existPlayers\n      .map(pId => ({ id: pId, data: PLAYER_META[pId] }))\n      .flatMap(({ id, data }) => [{ name: data.ln, id }, { name: data.fn, id }])\n    return names\n  }\n\n  clean() {\n    this.setState({ text: '' })\n  }\n\n  triggleUpdatePlayerEntities = () => {\n    const names = this.namesToSearch\n    const { text, activeIndex, matches } = this.state;\n    const toInsert = matches[activeIndex]\n    const newText = toInsert ? text.replace(/#([^#]*)$/, `#${toInsert}`) : text\n\n    // check existing\n    const playerEntities = Array.from(new Set(names.filter(n => {\n      const query = `#${n.name.toLowerCase()}`\n      return newText.toLowerCase().match(new RegExp(query, 'g'))\n    }).map(n => n.id)))\n    this.props.onUpdatePlayerEntity?.(playerEntities)\n  }\n\n  onChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    \n\n    const names = this.namesToSearch\n    const text = e.target.value;\n    const lastIndex = text.search(/#([^#\\s]*)$/)\n    const query = lastIndex === -1 ? '' : text.slice(lastIndex)\n    const matches = query !== '' ? names.filter(n => n.name.toLowerCase().startsWith(query.slice(1).toLowerCase())) : []\n    this.setState({\n      matches: matches.map(m => m.name),\n      text: text,\n    }, this.triggleUpdatePlayerEntities);\n  }\n\n  onKeyDown = (event: React.KeyboardEvent<HTMLInputElement>) => {\n    const { text, activeIndex, matches } = this.state;\n\n    switch (event.key) {\n      case 'Tab':\n      case 'Enter': // Enter key\n        if (matches.length) {\n          const toInsert = matches[activeIndex]\n\n          this.setState({\n            activeIndex: 0,\n            matches: [],\n            text: text.replace(/#([^#]*)$/, `#${toInsert}`),\n          }, this.triggleUpdatePlayerEntities);\n          event.stopPropagation()\n          event.preventDefault()\n        }\n        // send\n        else if (event.target === event.currentTarget && text.trim() !== '') {\n          this.props.onSend?.(text)\n        }\n        break;\n      case 'ArrowUp': // Up arrow\n        if (matches.length) {\n          event.stopPropagation()\n          event.preventDefault()\n          this.setState({\n            activeIndex: activeIndex >= 1 ? activeIndex - 1 : 0\n          }, this.triggleUpdatePlayerEntities);\n        }\n        break;\n      case 'ArrowDown': // Down arrow\n        if (matches.length) {\n          event.stopPropagation()\n          event.preventDefault()\n          this.setState({\n            activeIndex:\n              activeIndex < matches.length - 1\n                ? activeIndex + 1\n                : matches.length - 1\n          }, this.triggleUpdatePlayerEntities);\n        }\n        break;\n      default:\n        break;\n    }\n  }\n\n  render(): React.ReactNode {\n    const { text, matches, activeIndex } = this.state\n\n    return <div className=\"comment-box\">\n      <div className=\"control\">\n        <div className={`dropdown ${matches.length > 0 ? \"is-active\" : \"\"}`} style={{ width: '100%' }}>\n          <div className=\"dropdown-trigger\" style={{ width: '100%' }}>\n            <div className=\"control has-icons-left has-icons-right\">\n              <input className=\"input\" type=\"text\"\n                placeholder=\"Any thoughts? Enter to send..\"\n                value={text}\n                onChange={this.onChange}\n                onKeyDown={this.onKeyDown}\n              />\n              <span className=\"icon is-left\">\n                <MdComment style={{ transform: 'scale(1.5)' }}></MdComment>\n              </span>\n              <span className=\"icon is-right\">\n                <IoSendSharp style={{ transform: 'scale(1.5)' }} />\n              </span>\n            </div>\n          </div>\n          <div className=\"dropdown-menu\"\n            style={{\n              left: `${text.length * 9.5 + 40}px` // hardcode for the text width\n            }}\n          >\n            {matches.length > 0 && (\n              <div className=\"dropdown-content\">\n                {matches.map((match, index) => (\n                  <a\n                    className={`dropdown-item ${index === activeIndex ? \"is-active\" : \"\"\n                      }`}\n                    href=\"/\"\n                    key={`${match}_${index}`}\n                  // onClick={event => this.handleSelection(event, match)}\n                  >\n                    {match}\n                  </a>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  }\n}","import './style.scss'\n\nimport React from 'react'\nimport { VideoID, IComment } from '@types'\n// import randomColor from 'randomcolor'\n\nconst PUSH = 'PUSH' as const\nconst READY = 'READY' as const\nconst PLAYING = 'PLAYING' as const\nconst OVER = 'OVER' as const\ntype DanmuStatus = typeof PUSH | 'READY' | 'PLAYING' | 'OVER'\n\n\nconst DEFAULT_DURATION = 7500 // ms\nconst DEFAULT_FONT_SIZE = 24\n\ninterface MessageProps {\n  id: string\n  content: string,\n  status: DanmuStatus\n  onUpdateStatus: (id: string, status: DanmuStatus) => void\n  // screen: { width: number, height: number }\n  speed?: number,\n  color?: string\n}\n\nclass Message extends React.Component<MessageProps> {\n\n  state = {\n    y: 30 + Math.random() * 150\n  }\n\n  componentDidMount() {\n    const delay = 100\n    const { id, onUpdateStatus } = this.props\n\n    setTimeout(() => {\n      onUpdateStatus(id, PLAYING)\n    }, delay)\n\n    setTimeout(() => {\n      onUpdateStatus(id, OVER)\n    }, delay + this.getDuration())\n  }\n\n  getDuration() {\n    const { speed = 1 } = this.props\n    return DEFAULT_DURATION / speed\n  }\n\n  render() {\n    const { content, color = '#fff', status } = this.props\n    const { y } = this.state\n    const fontSize = DEFAULT_FONT_SIZE * (status === 'PUSH' ? 1.5 : 1)\n\n    const style = {\n      transitionDuration: this.getDuration() + 'ms',\n      top: `${y}px`,\n      fontSize,\n      color,\n    }\n\n    return <div\n      className={`danmu-message ${status.toLowerCase()}`}\n      style={style}>\n      {content}\n    </div>\n  }\n}\n\n\ninterface DanmuProps {\n  videoId: VideoID\n  frameIdx: number\n  comments: IComment[]\n}\ninterface DanmuState {\n  danmuQueue: Array<{ id: string, state: DanmuStatus, content: string }>\n}\n\nexport class Danmu extends React.Component<DanmuProps, DanmuState> {\n  state: Readonly<DanmuState> = {\n    danmuQueue: []\n  }\n\n  componentDidUpdate(prevProps: Readonly<DanmuProps>, prevState: Readonly<DanmuState>, snapshot?: any): void {\n    // ignore the update of videos here, can be a problem\n    if (prevProps.frameIdx !== this.props.frameIdx) {\n      // update queue\n      const { comments } = this.props\n      const { danmuQueue: queue } = this.state\n      const toLoad = comments\n        .filter(c => c.frameIdx === this.props.frameIdx && c.videoId === this.props.videoId)\n        .filter(c => queue.every(d => d.id !== c.id))\n      this.setState({\n        danmuQueue: [\n          // remove old\n          ...queue.filter(c => c.state !== 'OVER'),\n          // add new\n          ...toLoad.map(({ id, content }) => ({ id, content, state: READY }))\n        ]\n      })\n    }\n  }\n\n  push({ id, content }: IComment) {\n    const { danmuQueue } = this.state\n    this.setState({\n      danmuQueue: [...danmuQueue, { id, content, state: PUSH }]\n    })\n  }\n\n  onUpdateStatus = (id: string, s: DanmuStatus) => {\n    const { danmuQueue } = this.state\n    const targetDanmu = danmuQueue.find(d => d.id === id)\n    if (targetDanmu) {\n      targetDanmu.state = s\n      this.setState({\n        danmuQueue: [...danmuQueue]\n      })\n    }\n  }\n\n  render() {\n    const { danmuQueue } = this.state\n    return <div className=\"danmu\">\n      <div className=\"danmu-screen\">\n        {danmuQueue\n          .filter(danmu => danmu.state !== 'OVER')\n          .map(({ id, state, content }) => <Message\n            key={id}\n            id={id}\n            status={state}\n            content={content}\n            color={state === 'PUSH' ? '#1E90FF' : '#fff'}\n            onUpdateStatus={this.onUpdateStatus}\n          />)}\n      </div>\n    </div>\n  }\n\n}\n","export default __webpack_public_path__ + \"static/media/fig_dataVis.bf02bedb.jpg\";","import React from \"react\";\nimport Joyride from 'react-joyride';\n\nimport fig_vis from './fig_dataVis.jpg'\n\nexport function OnBoard() {\n\n  return <Joyride\n    showProgress={true}\n    showSkipButton={true}\n    continuous={true}\n    styles={{\n      tooltip: {\n        fontSize: 24,\n        fontFamily: 'Comic Sans MS'\n      },\n      tooltipTitle: {\n        fontSize: 28,\n        fontWeight: 500,\n      },\n    }}\n    steps={[\n      {\n        target: '.visualizationContainer',\n        title: 'Visualizing the player\\'s in-game data',\n        content: <img alt=\"The intro of the vis\" src={fig_vis}></img>,\n        placement: 'center',\n        styles: {\n          options: {\n            width: 1200\n          }\n        }\n      },\n      {\n        target: '.visualizationContainer',\n        title: 'Use your mouse to hover on the players to interact with them!',\n        content: <video autoPlay loop src={`${process.env.PUBLIC_URL}/intro_mouse hover.mp4`}></video>,\n        placement: 'center',\n        styles: {\n          options: {\n            width: 1000\n          }\n        }\n      },\n      {\n        target: '.comment-box',\n        content: 'Type your comments here!',\n        disableBeacon: true,\n      },\n      {\n        target: '.comment-box',\n        title: 'You can use `#` to auto-complete player names, and highlight them in the video!',\n        content: <video autoPlay loop src={`${process.env.PUBLIC_URL}/intro_text highlight.mp4`}></video>,\n        placement: 'center',\n        disableScrolling: true,\n        styles: {\n          options: { width: 1100 }\n        },\n        disableBeacon: true\n      },\n      {\n        target: '.featurePanel',\n        content: 'Use this panel to toggle on/off features.',\n        placement: 'auto',\n        disableBeacon: true\n      },\n      {\n        target: '.playerPanel',\n        content: 'Use this panel to specify how to highlight players.',\n        placement: 'auto',\n        disableBeacon: true\n      },\n      {\n        target: '#playpause',\n        content: 'Now let\\'s play the game!',\n        disableBeacon: true\n      }\n    ]}></Joyride>\n}","import './style.scss'\n\nimport React from 'react'\nimport { AiFillGithub, AiFillMail, AiFillHome } from 'react-icons/ai'\n\nexport function Contact() {\n\n    return <div className='contact'>\n        <h4>Contact</h4>\n        <div className='links'>\n            <a className='item' href='https://github.com/ASportsV/iBall/tree/main' target=\"_blank\" rel=\"noreferrer\">\n                <AiFillGithub style={{ transform: 'scale(1.5)' }}></AiFillGithub>\n            </a>\n            <a className='item' href='mailto:ztchen@seas.harvard.edu' target='_blank' rel='noreferrer'>\n                <AiFillMail style={{ transform: 'scale(1.5)' }}></AiFillMail>\n            </a>\n            <a className='item' href='https://chenzhutian.org' target=\"_blank\" rel=\"noreferrer\">\n                <AiFillHome style={{ transform: 'scale(1.5)' }}></AiFillHome>\n            </a>\n        </div>\n    </div>\n}","export default function Worker_fn() {\n  return new Worker(__webpack_public_path__ + \"static/js/loadFrames.worker.69f2df45.js\");\n}\n","import type {\n  Frame,\n  BaseVideo,\n  CacheFrameData\n} from \"../@types\"\nimport { DEBUG } from '../@const';\nimport { getImg, wait, debugMem, ArrayToDict, waitUntil, wrapWorker } from '../@utils';\n\nimport MyWorker from './loadFrames.worker';\n\nexport class DataLoader<GameID extends string, VideoID extends string, PlayerID extends number> {\n\n  // shotRecords: ShotRecord[] = []\n  #Loading: Partial<Record<VideoID, boolean>> = {}\n\n  // video data per frame\n  memVideoData: Partial<Record<VideoID, Record<number, Frame<PlayerID>>>> = {}\n\n  onLoad?: (videoId: VideoID, progress?: number) => void\n  onUnload?: (videoId: VideoID) => void\n\n  #getFrames: (video: BaseVideo<GameID, VideoID>) => Promise<CacheFrameData<PlayerID>[] | undefined>\n  constructor(readonly worker: { new(): Worker } = MyWorker) {\n    this.#getFrames = wrapWorker<[BaseVideo<GameID, VideoID>], CacheFrameData<PlayerID>[] | undefined>(worker, 'Frames', (d) => {\n      if (d[0] === 'Progress') {\n        const [_, vId, progress] = d\n        this.onLoad?.(vId, progress)\n      }\n    })\n  }\n\n  /**\n   * ----------------- Data Loading --------------------\n   */\n  isLoaded(video: BaseVideo<GameID, VideoID>) {\n    return video.isTransit || video.id in this.memVideoData\n  }\n  getVideoData(videoId: VideoID) {\n    return this.memVideoData[videoId]\n  }\n\n  #pre_load_batch_size = 50\n  async fetch(video: BaseVideo<GameID, VideoID>, shouldWait: boolean = false) {\n\n    if (this.#Loading[video.id]) {\n      // wait until anothe thread finish\n      await waitUntil(() => !this.#Loading[video.id])\n      return\n    }\n\n    this.#Loading[video.id] = true\n    console.debug('preload===>', video)\n    // if not in mem, load from db\n    if (!this.isLoaded(video)) {\n      // step 1, get from db\n      const frames = await this.#getFrames(video)\n      if (!frames) {\n        this.#Loading[video.id] = false\n        return\n      }\n      const progressOffset = 0.6\n      this.onLoad?.(video.id, progressOffset)\n\n      // step2, process to mem\n      console.log(`%cMain thread processing ${video.id} to mem =====>`, 'color:#f5f5f5;background: #00695c; padding: 2px; border-radius:2px')\n      // should not do at once, chunck frames into groups\n      let framesToSave: Frame<PlayerID>[] = []\n      console.debug('===>parsing blob to img...')\n      for (let i = 0; i < Object.keys(frames).length; i += this.#pre_load_batch_size) {\n        const itemsForBatch = frames.slice(i, i + this.#pre_load_batch_size)\n        framesToSave = [\n          ...framesToSave,\n          ...(await Promise.all(itemsForBatch.map(async (frame) => {\n            const mask = await getImg(URL.createObjectURL(frame.mask!))\n            return { ...frame, mask } as any as Frame<PlayerID>\n          })))\n        ]\n        this.onLoad?.(video.id, progressOffset + (0.95 - progressOffset) * i / Object.keys(frames).length)\n\n        if (shouldWait) {\n          await wait(30)\n        }\n      }\n      // sort\n      framesToSave.sort((a, b) => a.idx - b.idx)\n      console.debug(`<=====${video.id} Done!`, framesToSave[0])\n      // Step3. save to mem\n      this.memVideoData[video.id] = ArrayToDict(framesToSave, 'idx')\n      this.onLoad?.(video.id, 1)\n      DEBUG.DEBUG_MEM && debugMem()\n\n      console.log(`%cMain thread done processing ${video.id} to mem<======`, 'color:#f5f5f5;background: #00695c; padding: 2px; border-radius:2px')\n    }\n    this.#Loading[video.id] = false\n  }\n\n  unloadFromMem(video?: BaseVideo<GameID, VideoID>) {\n    if (video === undefined || video.isTransit) return\n    delete this.memVideoData[video.id]\n    this.onUnload?.(video.id)\n    DEBUG.DEBUG_MEM && debugMem()\n  }\n}","\nimport Dexie from 'dexie';\nimport { CacheFrameData, VideoDataVersion } from '../@types'\n\ninterface BaseTables<PID extends number> {\n  frames: CacheFrameData<PID>,\n  videoDataVersions: VideoDataVersion\n}\n\nexport class Database<PID extends number, T extends Record<string, any> = {}, K = T & BaseTables<PID>> extends Dexie {\n  // meta\n  public readonly myTables: { [k in keyof K]: Dexie.Table<K[k]> }\n\n  constructor(stores?: Record<keyof T, string>) {\n    super(\"Database\");\n    this.version(6).stores({\n      frames: \"[gameId+videoId+idx]\",\n      videoDataVersions: \"[gameId+videoId]\",\n      ...(stores ?? {})\n    });\n\n    this.myTables = ['frames', 'videoDataVersions', ...Object.keys(stores ?? {})]\n      .reduce((o, d) => {\n        o[d as keyof K] = this.table(d)\n        return o\n      }, {} as Record<keyof K, Dexie.Table<any>>)\n\n  }\n}","import { DEBUG } from \"../../@const\"\nimport type { BaseVideo } from \"../../@types\"\nimport { debugMem, waitUntil } from \"../../@utils\"\n\n\nexport class VideoLoader<GameID extends string, VideoID extends string> {\n  #Loading: Partial<Record<VideoID, boolean>> = {}\n\n  onLoad?: (videoId: VideoID) => void\n  onUnload?: (videoId: VideoID) => void\n  private memVideos: Partial<Record<VideoID, HTMLVideoElement>> = {}\n\n  getVideo(videoId: VideoID) {\n    return this.memVideos[videoId]\n  }\n\n  isLoaded(video: BaseVideo<GameID, VideoID>) {\n    return video.id in this.memVideos\n  }\n\n  async fetch(video: BaseVideo<GameID, VideoID>) {\n\n    if (this.#Loading[video.id]) {\n      // wait until anothe thread finish\n      await waitUntil(() => !this.#Loading[video.id])\n      return\n    }\n\n    this.#Loading[video.id] = true\n    if (!this.isLoaded(video)) {\n      console.debug('VideoLoader.preLoadToMem', video)\n      const nextVideo = document.createElement('video')\n      nextVideo.src = `${process.env.PUBLIC_URL}/assets/${video.gameId}/${video.id}/${video.id}.mp4`\n      nextVideo.id = video.id\n      nextVideo.load()\n      await new Promise(resolve => {\n        // nextVideo.onloadedmetadata = () => console.log('onloadedmetadata', video.id)\n        nextVideo.onloadeddata = resolve\n      })\n      console.debug('VideoLoader.preLoadToMem ==> Done', video)\n\n      // load to mem\n      this.memVideos[video.id] = nextVideo\n      this.onLoad?.(video.id)\n      DEBUG.DEBUG_MEM && debugMem()\n    }\n    this.#Loading[video.id] = false\n  }\n}\n","import type { BaseVideo } from \"../../@types\"\nimport { VideoLoader } from './VideoLoader'\n\nclass VideoTrack<GameID extends string, VideoID extends string> {\n  private get frameOffset() {\n    // hardcode value, I dont know why\n    return this.#videoMeta?.frameRate === 50 ? 0 : 1\n  }\n\n  #videoMeta?: BaseVideo<GameID, VideoID>\n  #video?: HTMLVideoElement\n  get video() { return this.#video }\n  get id() { return this.#video?.id }\n\n  CallBackHandle: number | null = null\n\n  onPlay: EventListener | null = null\n  onPause: EventListener | null = null\n  setVideo(video: BaseVideo<GameID, VideoID>, videoElm: HTMLVideoElement | undefined) {\n    this.#video = videoElm\n    this.#video?.requestVideoFrameCallback(this.invokeFrameHandlers)\n    this.#videoMeta = video\n  }\n  load(onPlay: EventListener, onPause: EventListener) {\n    this.onPlay = onPlay\n    this.onPause = onPause\n    this.#video?.addEventListener('play', onPlay)\n    this.#video?.addEventListener('pause', onPause)\n  }\n\n  unLoad() {\n    if (this.onPlay)\n      this.#video?.removeEventListener('play', this.onPlay)\n    if (this.onPause)\n      this.#video?.removeEventListener('pause', this.onPause)\n    if (this.CallBackHandle !== null)\n      this.#video?.cancelVideoFrameCallback(this.CallBackHandle)\n    this.#video?.load()\n    this.#video = undefined\n    this.#videoMeta = undefined\n  }\n\n  constructor(public readonly name: string, private readonly videoPlayer: VideoPlayer<GameID, VideoID>) { }\n\n  play() {\n    this.#video?.play()\n  }\n\n  invokeFrameHandlers: VideoFrameRequestCallback = (now, metadata) => {\n  \n    if (this.#video === this.videoPlayer.currentTrack) {\n      const rawFrame = Math.round(metadata.mediaTime * this.#videoMeta!.frameRate) //when play, videoMeta must set\n      const frameIdx = rawFrame - this.frameOffset\n      const videoId = this.videoPlayer.currentTrack!.id\n      for (let i = 0, len = this.videoPlayer.onFrameHandlers.length; i < len; ++i) {\n        this.videoPlayer.onFrameHandlers[i].call(this, videoId, frameIdx, Date.now(), this.videoPlayer.currentTrack!)\n      }\n    }\n\n    if (this.#video) {\n      this.CallBackHandle = this.#video?.requestVideoFrameCallback(this.invokeFrameHandlers)\n    }\n  }\n}\n\nexport class VideoPlayer<GameID extends string, VideoID extends string> {\n  protected _currentTrack?: HTMLVideoElement\n  public get currentTrack() { return this._currentTrack }\n  // video meta\n  #currentVideo: BaseVideo<GameID, VideoID> | null = null\n  protected set currentVideo(v) { this.#currentVideo = v }\n  get currentVideo() { return this.#currentVideo }\n\n  // video sources\n  videoSources = new VideoLoader<GameID, VideoID>()\n\n  /**\n   * A video player has two video track.\n   * It uses one track to preload, and the other track to play\n   */\n  protected ATrack = new VideoTrack<GameID, VideoID>('A', this)\n  protected BTrack = new VideoTrack<GameID, VideoID>('B', this)\n  onFrameHandlers: Array<(vId: string, fIdx: number, ts: number, videoFrame: HTMLVideoElement) => void> = []\n\n  // event handlers\n  onPlay?: (videoId: VideoID) => void\n  onPause?: (videoId: VideoID) => void\n  onLoad?: (videoId: VideoID, type: 'Video' | 'Data', progress?: number) => void\n  onUnload?: (videoId: VideoID, type: 'Video' | 'Data') => void\n  public videos: BaseVideo<GameID, VideoID>[] = []\n\n  constructor() {\n    // auto switch to the next clip\n    this.addOnFrameListener(async (videoId, frameIdx, ts, videoFrame) => {\n      const curVideoIdx = this.videos.findIndex(v => v.id === videoId)\n      if (curVideoIdx === -1) {\n        console.warn('There must be something wrong since it cannot find the video from the videoList in the videoPlayer', videoId, this.videos)\n        return\n      }\n\n      // preload to the other track\n      if (frameIdx + 5 === this.currentVideo?.maxFrame) {\n        // should load next\n        const nextVideoIdx = curVideoIdx + 1\n        if (this.videos[nextVideoIdx] !== undefined) {\n          this.preloadToAnotherTrack(this.videos[nextVideoIdx], true)\n        }\n      }\n\n      // load to the current track\n      if (frameIdx + 1 === this.currentVideo?.maxFrame) {\n        const nextVideoIdx = curVideoIdx + 1\n        if (this.videos[nextVideoIdx] === undefined) {\n          this.pause()\n          return\n        }\n        await this.loadVideo(this.videos[nextVideoIdx], true)\n        // should also load data after extension\n      }\n    })\n\n    // videoSources\n    this.videoSources.onLoad = (videoId: VideoID) => {\n      this.onLoad?.(videoId, 'Video')\n    }\n    this.videoSources.onUnload = (videoId: VideoID) => {\n      this.onUnload?.(videoId, 'Video')\n    }\n  }\n\n  addOnFrameListener(fn: (vId: string, frameIdx: number, ts: number, videoFrame: HTMLVideoElement) => void) {\n    this.onFrameHandlers.splice(this.onFrameHandlers.length - 2, 0, fn)\n  }\n\n  // data control\n  async fetchVideos() {\n    for (const video of this.videos) {\n      await this.videoSources.fetch(video)\n    }\n  }\n  isLoaded(video: BaseVideo<GameID, VideoID>) {\n    return this.videoSources.isLoaded(video)\n  }\n\n  // this is for assertion?\n  private whichOnPause = (ev: Event) => {\n    const v = ev.target as HTMLVideoElement\n    if (v.id === this.currentTrack?.id) {\n      this.onPause?.(v.id as VideoID)\n    }\n  }\n  private whichOnPlay = (ev: Event) => {\n    const v = ev.target as HTMLVideoElement\n    if (v.id === this.currentTrack?.id) {\n      this.onPlay?.(v.id as VideoID)\n    }\n  }\n\n  // video track control\n  async loadVideo(video: BaseVideo<GameID, VideoID>, play = false) {\n    // not load\n    if (this.currentTrack?.id === video.id) return\n    this.currentVideo = video\n\n    // ensure load to preTrack\n    if (this.ATrack.id !== video.id && this.BTrack.id !== video.id) {\n      await this.preloadToAnotherTrack(video, play)\n    }\n\n    const [trackToLoad, trackToUnload] = this.ATrack.id === video.id\n      ? [this.ATrack, this.BTrack]\n      : [this.BTrack, this.ATrack]\n    console.debug(`TrackToLoad: ${trackToLoad.name}_${trackToLoad.id} ${trackToLoad.video?.currentTime}, TrackToUnload: ${trackToUnload.name}_${trackToUnload.id}`)\n\n    // clean the currentTrack\n    trackToUnload.unLoad()\n    trackToLoad.load(this.whichOnPlay, this.whichOnPause)\n    this._currentTrack = trackToLoad.video\n  }\n\n  async preloadToAnotherTrack(newVideo: BaseVideo<GameID, VideoID>, play: boolean) {\n    console.log('%cpreloadToSkip', 'background: #444; color: #bada55; padding: 2px; border-radius:2px', newVideo)\n    await this.videoSources?.fetch(newVideo)\n\n    // load to the ohter track, prefer ATrack\n    const trackToLoad = this.BTrack.id === this.currentTrack?.id\n      ? this.ATrack\n      : this.BTrack\n    console.debug(`Load to track_${trackToLoad.name}`)\n\n    trackToLoad.setVideo(newVideo, this.videoSources?.getVideo(newVideo.id))\n    play && trackToLoad.play()\n  }\n\n  // video control\n  play() {\n    if (!this.currentTrack || !this.currentTrack.paused) return\n    console.debug('play video')\n    // this.currentTrack.playbackRate = 0.75\n    this.currentTrack.play()\n    this.onPlay?.(this.currentTrack?.id as VideoID)\n  }\n\n  pause() {\n    if (this.currentTrack?.paused) return\n    this.currentTrack?.pause()\n    this.onPause?.(this.currentTrack?.id as VideoID)\n  }\n\n  async seekTo(video: BaseVideo<GameID, VideoID>, frameIdx: number) {\n    await this.loadVideo(video)\n\n    this.currentTrack!.currentTime = (frameIdx / video.frameRate) + 0.001\n    console.debug('switch to video:', video, 'set currentTime to frameIdx', frameIdx)\n  }\n}\n","import { Frame, BaseVideo } from '../@types'\n\nimport { DataLoader } from '../DataLoader'\nimport { VideoPlayer } from './VideoPlayer'\n\nexport class VideoEnv<\n  GameID extends string,\n  VideoID extends string,\n  PlayerID extends number\n> extends VideoPlayer<GameID, VideoID> {\n\n  /**\n   * add a dataLoader to the VideoPlayer\n   */\n  // dataLoader: DataLoader\n\n  // data\n  #frames: Record<number, Frame<PlayerID>> | undefined\n  get frames() { return this.#frames }\n  set frames(v) { this.#frames = v }\n\n  // combine event\n  constructor(readonly dataLoader: DataLoader<GameID, VideoID, PlayerID> = new DataLoader()) {\n    super()\n    // this.dataLoader = new DataLoader(postProcessingData)\n    // combine event\n    this.dataLoader.onLoad = (videoId: VideoID, progres?: number) => {\n      this.onLoad?.(videoId, 'Data', progres)\n    }\n    this.dataLoader.onUnload = (videoId: VideoID) => {\n      this.onUnload?.(videoId, 'Data')\n    }\n  }\n\n  async fetchVideos() {\n    super.fetchVideos()\n    for (const video of this.videos) {\n      await this.dataLoader.fetch(video)\n    }\n  }\n\n  isLoaded(video: BaseVideo<GameID, VideoID>) {\n    return this.dataLoader.isLoaded(video) && super.isLoaded(video)\n  }\n\n  async loadVideo(video: BaseVideo<GameID, VideoID>, play = false) {\n    // not load\n    if (this.currentTrack?.id === video.id) return\n    super.loadVideo(video, play)\n    // load data\n    await this.dataLoader.fetch(video)\n    this.frames = this.dataLoader.getVideoData(video.id)\n  }\n}","export default function Worker_fn() {\n  return new Worker(__webpack_public_path__ + \"static/js/loadData.worker.a5a6123d.js\");\n}\n","import { GameID, PlayerID, PlayerShotBin, VideoID } from '@types';\nimport { wrapWorker } from 'common/@utils';\nimport { DataLoader } from 'common/DataLoader';\nimport IBallWorker from './loadData.worker'\n\nexport class IBallDataLoader extends DataLoader<GameID, VideoID, PlayerID> {\n\n    #getBins: (playerIds: PlayerID[]) => Promise<Partial<Record<PlayerID, PlayerShotBin[]>>>\n\n    constructor() {\n        super(IBallWorker)\n        this.#getBins = wrapWorker<[PlayerID[]], Partial<Record<PlayerID, PlayerShotBin[]>>>(this.worker, 'Bins')\n    }\n\n    /**\n     * -------------- Game data ----------------\n     */\n    playerBins: Partial<Record<PlayerID, PlayerShotBin[]>> = {}\n    async loadBins(playerIds: PlayerID[] = []) {\n        this.playerBins = await this.#getBins(playerIds);\n    }\n}","import type { Ball, Point } from 'common/@types'\nimport {\n  PlayerID, TeamID,\n  Attentions, AttentionWeights,\n  FrameStamp, Gaze, Highlights,\n  KeyPlayer,\n  KeyPlayerType,\n  Lv2Player,\n  Lv2PlayerType,\n  OffensivePkg,\n  VideoID, PlayerFlag,\n  GameID, Player\n} from \"@types\"\n\nimport { distPoints, union } from 'common/@utils';\nimport { getCanvasAbsTopLeft, GOAL_BASKET_POS, hexbin } from '@utils';\n\nimport { DEBUG } from 'common/@const'\nimport {\n  PLAYER_META,\n  EMPTY_SPACE_THRESHOLD, GAZE_R, LV_INTEREST_THRESHOLD, MAX_HIGHLIGHTED, NEXT_BALL_HOLDER_TIME_RANGE,\n} from '@const';\n\nimport { VideoEnv } from 'common/VideoEnv';\n\nimport { EnabledFeatures } from 'App';\nimport { IBallDataLoader } from './DataLoader';\n\nexport class IBallVideoEnv extends VideoEnv<GameID, VideoID, PlayerID> {\n  // gaze events\n  onGaze?: (p: Gaze, player?: Player[]) => void\n  onUpdateLvInt?: (att: Attentions) => void\n  onUpdateLvSync?: (sync: boolean, hilights: Highlights) => void\n\n  #gazeQueue: Gaze[] = []\n  #frameQueue: FrameStamp[] = []\n  #mousePos: Point = { x: 0, y: 0 }\n  constructor(dataLoader = new IBallDataLoader()) {\n    super(dataLoader)\n\n    if (DEBUG.MOUSE_GAZE) {\n      document.body.addEventListener('mousemove', e => {\n\n        const bbox = document.getElementById('canvasWrapper')?.getBoundingClientRect()\n        if (bbox === undefined) return\n        const ox = bbox.x\n        const oy = bbox.y\n        const { wScale = 1, hScale = 1 } = getCanvasAbsTopLeft()\n        this.#mousePos = { x: (e.clientX - ox!) * wScale, y: (e.clientY - oy!) * hScale }\n      })\n\n      setInterval(() => {\n        this.onSocket({ data: JSON.stringify([[0, 0], Date.now() / 1000]) })\n      }, 1000 / 30)\n    }\n\n    // console.log('Gaze init----')\n    // const socket = new WebSocket('ws://localhost:5000/echo');\n    // socket.addEventListener('message', this.onSocket);\n  }\n\n  /**\n   * -------------- Gaze data ----------------\n   */\n  onSocket = (ev: any) => {\n    const rawGaze = JSON.parse(ev.data) as [[number, number], number]\n    const ts = Math.round(rawGaze[1] * 1000)\n    // get the closetFrame\n    const closetFrame = this.getClosetFrame(ts)\n    // console.warn('Cannot find closetframe of gaze', rawGaze)\n    if (!closetFrame) {\n      // maybe should find frame in lazy mode?\n      return\n    }\n\n    const { x: ox, y: oy, wScale = 1, hScale = 1 } = getCanvasAbsTopLeft()\n    const wOutToIn = window.innerWidth / window.outerWidth\n    const hOutToIn = window.innerHeight / window.outerHeight\n    const x = DEBUG.MOUSE_GAZE\n      ? this.#mousePos.x\n      : (rawGaze[0][0] * wOutToIn - ox) * wScale\n    const y = DEBUG.MOUSE_GAZE\n      ? this.#mousePos.y\n      : ((rawGaze[0][1] + 20) * hOutToIn - oy) * hScale\n\n    const gaze: Gaze = {\n      x, y,\n      ts,\n      fIdx: closetFrame?.fIdx,\n      videoId: closetFrame?.videoId\n    }\n    this.#gazeQueue.push(gaze)\n\n    // get lookat\n    const attendPlayers = this.getLookAt(gaze)\n    this.onGaze?.(gaze, attendPlayers)\n\n    // calculate inteLv\n    // save inteLv\n    this.updateInteLv(gaze, attendPlayers)\n  }\n\n  pushFrameHistory(data: FrameStamp) {\n    this.#frameQueue.push(data)\n  }\n  getClosetFrame(gTs: number) {\n    let minDist = Infinity\n    let minFrame = undefined\n    for (const frame of [...this.#frameQueue].reverse()) {\n      const dist = Math.abs(frame.ts - gTs)\n      if (dist < minDist) {\n        minDist = dist\n        minFrame = frame\n      }\n      // if not decrease anymore, stop\n      else break\n    }\n    return minFrame\n  }\n\n  get latestGaze() { return this.#gazeQueue[this.#gazeQueue.length - 1] }\n  getClosetGaze(fTs: number) {\n    let minDist = Infinity\n    let minGaze = undefined\n    for (const gaze of [...this.#gazeQueue].reverse()) {\n      const dist = Math.abs(gaze.ts - fTs)\n      if (dist < minDist) {\n        minDist = dist\n        minGaze = gaze\n      }\n      // if not decrease anymore, stop\n      else break\n    }\n    return minGaze\n  }\n\n  getLookAt(gaze: Gaze) {\n    const { x: gx, y: gy, videoId } = gaze\n    // frame data\n    // @TODO, can be error since the frame maybe not loaded in cur memory\n    if (videoId !== this.currentVideo?.id) return\n    const cf = this.frames?.[gaze.fIdx]\n    if (!cf?.players) return\n\n    const radius = GAZE_R\n    const attendedPlayers = cf.players.filter(({ bbox }) => {\n      return gx > (bbox.x - radius) &&\n        gy > (bbox.y - radius) &&\n        gx < (bbox.x + bbox.w + radius) &&\n        gy < (bbox.y + bbox.h + radius)\n    })\n    return attendedPlayers\n  }\n\n  #playerAttentions: Attentions = { lastTs: -1, fIdx: -1, videoId: undefined, players: {} }\n  updateInteLv(gaze: Gaze, attendPlayers?: Player[]) {\n    const { ts, fIdx } = gaze\n    const { lastTs, players } = this.#playerAttentions\n    const T = 500 // default 1000ms\n    const decayRate = 1 / 5\n    // const maxAttention = incrRate * 19.144 * 0.96\n\n    /**\n     * Generalized weight increase algorithm.\n     * @param initialValue The starting weight of the player.\n     * @param dt The amount of time elapsed since the last update.\n     * @returns The new weight of the player.\n     */\n    function increaseFunction(initialValue: number, dt: number) {\n      return 1 - decayRate ** ((dt - (T * Math.log(1 - initialValue) / Math.log(5))) / T)\n    }\n\n    const newAttentions = lastTs === -1 ? players : Object.keys(players)\n      .reduce((o, pId) => {\n        const playerId = +pId as PlayerID\n        const base = players[playerId]?.att ?? 0\n        const att = base * Math.pow(decayRate, (ts - lastTs) / T)\n        const on = players[playerId]?.on ?? false\n        o[playerId] = {\n          on: att < LV_INTEREST_THRESHOLD.off ? false : on, // turn to false if less than threshold\n          att, looked: false\n        }\n        return o\n      }, {} as Record<PlayerID, AttentionWeights>)\n\n    if (attendPlayers) {\n      attendPlayers.forEach(({ id }) => {\n        if (!(id in newAttentions)) newAttentions[id] = { on: false, att: 0, looked: true }\n        const oldAttention = players[id]?.att ?? 0\n        const att = increaseFunction(oldAttention, ts - lastTs)\n        const on = att > LV_INTEREST_THRESHOLD.on\n          ? true\n          : newAttentions[id]!.on\n        newAttentions[id] = {\n          att, on, looked: true\n        }\n      })\n    }\n\n    this.#playerAttentions = {\n      lastTs: ts,\n      fIdx,\n      videoId: gaze.videoId,\n      players: newAttentions\n    }\n    this.onUpdateLvInt?.(this.#playerAttentions)\n  }\n\n  /**\n   * ----------------- Visualization Management\n   */\n  #keyPlayers: Array<{\n    fIdx: number,\n    videoId: string,\n    players: KeyPlayer[],\n  }> = []\n  #keyPlayer_buffer_size = 100\n\n  /**\n   * \n   * @param currentFIdx \n   * @param timeRange in sec\n   * @param ball \n   * @returns \n   */\n  getNextBallHolder(currentFIdx: number, timeRange: number, ball?: Ball, teamWithBall?: TeamID) {\n    timeRange *= this.currentVideo?.frameRate!\n    for (let i = currentFIdx; i < currentFIdx + timeRange; ++i) {\n      const nextFrame = this.frames?.[i]\n      if (!nextFrame) continue\n\n      const { ball: nextBall } = nextFrame\n      if (!nextBall?.playerId) continue\n\n      if (!ball?.playerId) {// now is empty\n        return PLAYER_META[nextBall.playerId].team === teamWithBall ? nextBall.playerId : undefined\n      } else { // now is not empty\n        if (nextBall.playerId !== ball.playerId && PLAYER_META[nextBall.playerId].team === PLAYER_META[ball.playerId].team) { // should be the same team\n          return nextBall.playerId\n        }\n      }\n    }\n  }\n\n  getEmptyPlayer(players?: Player[], ballHolderId?: PlayerID | null, teamWithBall?: TeamID) {\n    if (players === undefined || teamWithBall === undefined) return\n    const trackedPlayers = players.filter(({ tracking }) => tracking.x !== undefined && tracking.y !== undefined)\n    const defenders = trackedPlayers.filter(p => PLAYER_META[p.id].team !== teamWithBall)\n    const offensors = trackedPlayers.filter(p => PLAYER_META[p.id].team === teamWithBall)\n\n    const emptyOffensors: Array<[Player, number]> = []\n    for (const p of offensors) {\n      const { dataPkg, id } = p\n      if (id === ballHolderId) continue\n      if (!(dataPkg as OffensivePkg).inOffsensiveCourt) continue\n\n      const dists = defenders.map(d => distPoints(d.tracking, p.tracking))\n      if (dists.every(d => d > EMPTY_SPACE_THRESHOLD)) {\n        // TODO, dist to the basket\n        // dist to the ballholder\n        const { x: bx, y: by } = GOAL_BASKET_POS(p.id)\n        const distToBasket = distPoints(p.tracking, { x: bx, y: by })\n        emptyOffensors.push([p, distToBasket])\n      }\n    }\n    return emptyOffensors.sort((a, b) => a[1] - b[1]).map(d => d[0])\n  }\n\n  private lastFocus: { pos: Point } = { pos: { x: 0, y: 0 } }\n  fetchFocus() {\n    const gaze = this.latestGaze\n    if (!gaze) return this.lastFocus\n\n    let { pos } = this.lastFocus\n    const dx = Math.min(600, gaze.x - pos.x)\n    const dy = Math.min(600, gaze.y - pos.y)\n    pos = {\n      x: pos.x + dx,\n      y: pos.y + dy\n    }\n\n    this.lastFocus = { pos }\n    return this.lastFocus\n  }\n\n  // helper function  \n  #getPlayerTeam = (playerId?: PlayerID) => playerId ? PLAYER_META[playerId].team : undefined\n  pickPlayers(currentFIdx: number,\n    features: EnabledFeatures,\n    playerFlags: Partial<Record<PlayerID, PlayerFlag>>,\n    filter_center?: { pos: Point; }\n  ) {\n\n    if (Object.keys(this.#keyPlayers).length > this.#keyPlayer_buffer_size) {\n      this.#keyPlayers.pop()\n    }\n\n    const currentFrame = this.frames?.[currentFIdx]\n    if (!currentFrame) return {}\n    const {\n      ball,\n      players,\n      teamWithBall = this.#getPlayerTeam(players?.find(p => p.id === ball?.playerId)?.id)\n    } = currentFrame\n\n    // attend players\n    const { players: playerAttentions } = this.#playerAttentions\n\n    // collect current\n    let currentlv1Players: Omit<KeyPlayer, 'last'>[] = []\n    let lv2Players: Lv2Player[] = []\n    // ball holder first\n    if (ball?.playerId) {\n      currentlv1Players.push({ id: ball.playerId, type: KeyPlayerType.BALL_HOLDER })\n      // should add to lv2 if sync\n      lv2Players.push({ id: ball.playerId, type: new Set([Lv2PlayerType.Normal]) })\n\n      // add the defender of the ball holder\n      // @Note, the defending field stores the defender of the ball holder, and the defending of defenders\n      const ballHolder = players?.find(p => p.id === ball.playerId)\n      ballHolder?.tracking.defending && lv2Players.push({\n        id: ballHolder?.tracking.defending as PlayerID,\n        type: new Set([Lv2PlayerType.Normal])\n      })\n      players?.filter(p => p.tracking.defending === ball.playerId).forEach(p => lv2Players.push({\n        id: p.id,\n        type: new Set([Lv2PlayerType.Normal])\n      }))\n    }\n\n    // do playerFlags for Lv1 player\n    Object.entries(playerFlags)\n      .forEach(([pId, v]) => {\n        if (v === 'On') {\n          currentlv1Players.push({ id: +pId as PlayerID, type: KeyPlayerType.BALL_HOLDER })\n        }\n      })\n\n    // who will get the ball in the next Xsec\n    const nextBallHolder = this.getNextBallHolder(currentFIdx, NEXT_BALL_HOLDER_TIME_RANGE, ball)\n    if (nextBallHolder && currentlv1Players.length < MAX_HIGHLIGHTED) {\n      currentlv1Players.push({ id: nextBallHolder, type: KeyPlayerType.NEXT_BALL_HOLDER })\n      lv2Players.push({ id: nextBallHolder, type: new Set([Lv2PlayerType.Normal]) })\n    }\n\n    /*************get the empty players ************/\n    const emptyPlayers = features.vis_empty_player\n      ? this.getEmptyPlayer(\n        players?.filter(p => !currentlv1Players.some(d => d.id === p.id)),\n        ball?.playerId,\n        teamWithBall)\n      : []\n    // do gaze_filter\n    emptyPlayers\n      ?.filter(({ bbox }) => {\n        if (!filter_center) return true\n        const radius = 60\n        const { x: gx, y: gy } = filter_center.pos\n        return gx > (bbox.x - radius) &&\n          gy > (bbox.y - radius) &&\n          gx < (bbox.x + bbox.w + radius) &&\n          gy < (bbox.y + bbox.h + radius)\n      })\n      .forEach(p => {\n        if ((currentlv1Players.length + 1) < MAX_HIGHLIGHTED) {\n          currentlv1Players.push({ id: p.id, type: KeyPlayerType.EMPTY_PLAYER })\n          lv2Players.push({ id: p.id, type: new Set([Lv2PlayerType.Normal]) })\n        }\n      })\n\n    /***************hilight by the text******************/\n    Object.entries(playerFlags)\n      .forEach(([pId, v]) => {\n        if (v === 'TXT') {\n          currentlv1Players.push({ id: +pId as PlayerID, type: KeyPlayerType.TEXT_HILIGHT })\n        }\n      })\n\n    // management\n    let { players: lastLv1Players = [], fIdx: lastFIdx = 0, videoId: lastVideoId } = this.#keyPlayers?.[0] ?? {}\n    lastLv1Players = lastLv1Players\n      .filter(p => lastVideoId === this.currentVideo?.id) // && PLAYER_META[p.id].team === teamWithBall)\n    // exit\n    const exitPlayers = lastLv1Players\n      .filter(p =>  //p.last.status === 'exit' || \n        !currentlv1Players.find(cp => p.id === cp.id))\n      // update exist player's values\n      .map(p => {\n        p.last.status = 'exit'\n        p.last.progress -= currentFIdx - lastFIdx\n        return p\n      })\n\n    const updatePlayers = lastLv1Players\n      // U - E\n      .filter(p => !exitPlayers.find(ep => ep.id === p.id))\n      // .filter(p => currentlv1Players.find(cp => cp.id === p.id))\n      .map(p => {\n        // 6 / 30 s === 200ms\n        p.last.progress = Math.min(6, p.last.progress + currentFIdx - lastFIdx)\n        p.last.status = p.last.progress === 6 ? 'update' : 'enter'\n        return p\n      })\n\n    // enter\n    const enterPlayers = currentlv1Players\n      .filter(cp => !lastLv1Players.find(p => p.id === cp.id))\n      .map(p => {\n        ; (p as KeyPlayer).last = { status: 'enter', progress: 0 }\n        return p as KeyPlayer\n      })\n\n    // control here\n    const lv1Players: KeyPlayer[] = [\n      ...enterPlayers,\n      ...updatePlayers,\n      ...exitPlayers.filter(p => p.last.progress > 0)\n    ]\n\n    if (lv1Players.length >= MAX_HIGHLIGHTED) {\n      console.warn('More than the upper limit')\n    }\n\n    lv2Players = [\n      ...lv2Players,\n      ...lv1Players.map(p => ({\n        id: p.id,\n        type: new Set([Lv2PlayerType.Normal])\n      }))\n    ]\n\n    // Step2 find the interested players, gaze_focus, default to open\n    if (features.gaze_focus) {\n      Object.entries(playerAttentions)\n        .forEach(([pId, { att, on, looked }]) => {\n          lv2Players.push({ id: +pId as PlayerID, att, on, looked, type: new Set([Lv2PlayerType.Interest]) })\n        })\n    }\n    // do playerFlags for Lv2 player\n    Object.entries(playerFlags)\n      .forEach(([pId, v]) => {\n        if (v === 'On') {\n          lv2Players.push({ id: +pId as PlayerID, type: new Set([Lv2PlayerType.Normal]) })\n        }\n      })\n\n    // cache the keyplayers\n    this.#keyPlayers.unshift({\n      fIdx: currentFIdx,\n      videoId: this.currentVideo!.id,\n      players: lv1Players\n    })\n\n    return {\n      lv1Players: lv1Players\n        .filter(p => playerFlags[p.id] !== 'Off')\n        .reduce((o, p) => {\n          if (!(p.id in o)) {\n            o[p.id] = p\n          }\n          // use the higher rank\n          if (p.type < o[p.id].type) {\n            o[p.id].type = p.type\n          }\n\n          return o\n        }, {} as Record<PlayerID, KeyPlayer>),\n      //\n      lv2Players: lv2Players\n        .filter(p => playerFlags[p.id] !== 'Off' || p.type.has(Lv2PlayerType.Interest))\n        .reduce((o, p) => {\n          if (!(p.id in o)) o[p.id] = p\n          else {\n            o[p.id] = { ...o[p.id], ...p, type: union(p.type, o[p.id].type) }\n          }\n          return o\n        }, {} as Record<PlayerID, Lv2Player>),\n      teamWithBall,\n      ballHolder: players?.find(p => p.id === ball?.playerId)\n    }\n  }\n\n  /**\n   * -------------- Game data ----------------\n   */\n  async loadBins(playerIds: PlayerID[] = []) {\n    await (this.dataLoader as IBallDataLoader).loadBins(playerIds)\n  }\n  getPlayerBins(playerId?: PlayerID) {\n    if (!playerId) return\n    return (this.dataLoader as IBallDataLoader).playerBins[playerId]\n  }\n  getCurrentBin(player?: Player) {\n    if (!player) return\n\n    const { x: tx, y: ty } = player.tracking\n    const currentBin = (tx !== undefined && ty !== undefined)\n      ? hexbin([{\n        LOC_X: tx * 10,\n        LOC_Y: ty * 10\n      } as any])[0]\n      : undefined;\n    return currentBin\n  }\n\n}","// Import the functions you need from the SDKs you need\nimport type { GameID, KeyPlayer, Lv2Player, Lv2PlayerType, PlayerID, VideoID, PlayerFlag, IComment } from \"@types\";\nimport { EnabledFeatures } from \"App\";\nimport { initializeApp } from \"firebase/app\";\nimport { addDoc, collection, getDocs, getFirestore, onSnapshot, query, where, serverTimestamp, FieldValue } from 'firebase/firestore'\n// TODO: Add SDKs for Firebase products that you want to use\n// https://firebase.google.com/docs/web/setup#available-libraries\n\n// Your web app's Firebase configuration\n// For Firebase JS SDK v7.20.0 and later, measurementId is optional\nconst firebaseConfig = {\n  apiKey: process.env.REACT_APP_FILEBASE_KEY,\n  authDomain: process.env.REACT_APP_FILEBASE_AUTH_DOMAIN,\n  projectId: process.env.REACT_APP_FILEBASE_PROJECT_ID,\n  storageBucket: process.env.REACT_APP_FILEBASE_STORAGE_BUCKET,\n  messagingSenderId: process.env.REACT_APP_FILEBASE_SENDER_ID,\n  appId: process.env.REACT_APP_FILEBASE_APP_ID,\n  measurementId: process.env.REACT_APP_FILEBASE_MEASUREMENT_ID\n};\n\n// Initialize Firebase\nconst app = initializeApp(firebaseConfig);\n// Initialize Cloud Firestore and get a reference to the service\nexport const db = getFirestore(app);\n\ninterface DocComment {\n  content: string\n  gameId: GameID,\n  videoId: VideoID,\n  frameIdx: number\n  pickedPlayers: {\n    lv1: Partial<Record<PlayerID, KeyPlayer>>,\n    lv2: Partial<Record<PlayerID, Lv2Player>>\n  }\n  features: EnabledFeatures\n  playerFlag: Partial<Record<PlayerID, PlayerFlag>>\n  ts?: FieldValue\n}\n\nconst COLLECTION_NAME = 'comments'\nexport async function postComment(meta: DocComment) {\n  try {\n\n    const { pickedPlayers, ...rest } = meta\n    const { lv1, lv2 } = pickedPlayers\n\n    const docRef = await addDoc(collection(db, COLLECTION_NAME), {\n      ...rest,\n      pickedPlayers: {\n        lv1,\n        lv2: Object.entries(lv2)\n          .reduce((o, [pId, v]) => {\n            o[+pId as PlayerID] = {\n              ...v,\n              id: v.id,\n              type: Array.from(v.type)\n            }\n            return o\n          }, {} as Partial<Record<PlayerID, Omit<Lv2Player, 'type'> & { type: Lv2PlayerType[] }>>)\n      },\n      ts: serverTimestamp()\n    })\n    return docRef.id\n  } catch (e) {\n    console.error(\"Error adding document: \", e);\n  }\n}\n\nexport async function getComment() {\n  const querySnapshot = await getDocs(collection(db, COLLECTION_NAME));\n\n  // group by gameId+videoId+frameIdx, \n  const commentsGroupBy: Record<string, IComment[]> = {}\n  querySnapshot.forEach((doc) => {\n    const { content, gameId, videoId, frameIdx, ts } = doc.data() as DocComment\n    // @ts-ignore, the filed from firebase\n    const seconds = (ts?.seconds ?? 0) * 1000\n    const key = `${gameId}_${videoId}_${frameIdx}`\n    if (!(key in commentsGroupBy)) {\n      commentsGroupBy[key] = []\n    }\n    commentsGroupBy[key].push({\n      id: doc.id,\n      content, gameId, videoId, frameIdx, ts: seconds\n    })\n  });\n\n  // const comments: IComment[] = []\n  // then orderByTime, limitByNum\n  return Object.entries(commentsGroupBy)\n    .flatMap(([key, commentsGroup]) => commentsGroup\n      .sort((a, b) => a.ts! - b.ts!)\n      // limit by num\n      .filter((c, i) => i < 20)\n    )\n}\n\n\nexport function subscribe(cb: (comments: IComment[]) => void) {\n  const q = query(collection(db, COLLECTION_NAME));\n  const unsubscribe = onSnapshot(q, (querySnapshot) => {\n    const comments: IComment[] = []\n    querySnapshot.docChanges().forEach((change) => {\n      if (change.type === \"added\") {\n        const { content, gameId, videoId, frameIdx } = change.doc.data() as DocComment\n\n        comments.push({\n          id: change.doc.id,\n          content, gameId, videoId, frameIdx\n        })\n      }\n    })\n    cb(comments)\n  });\n  return unsubscribe\n}\n\n\n","import \"./App.scss\";\nimport 'react-circular-progressbar/dist/styles.css';\nimport \"react-toggle/style.css\"\n\nimport React from \"react\";\nimport Toggle from 'react-toggle'\nimport { CircularProgressbarWithChildren, buildStyles } from 'react-circular-progressbar';\nimport { IoPlaySharp, IoPauseSharp } from 'react-icons/io5'\nimport { AiOutlineLoading } from 'react-icons/ai'\n\nimport {\n  Attentions, Gaze, KeyPlayer, Lv2Player,\n  PlayerID, Player,\n  VideoID, Video, IComment, PlayerFlag\n} from '@types'\nimport { PLAYER_META } from '@const'\n\nimport { DEBUG } from 'common/@const'\nimport { globalFIdxToLocal } from \"common/@utils\";\n\nimport {\n  Visualizer,\n  Overlay,\n  Court,\n  CommentBox,\n  Danmu,\n  OnBoard,\n  Contact\n} from './components'\nimport { Timeline } from 'common/@components'\n\nimport { params } from \"param\";\nimport { IBallVideoEnv } from \"VideoEnv\";\nimport { getComment, postComment, subscribe } from \"filebase\";\n\nexport const videoEnv = new IBallVideoEnv()\n\n// now this flag is a bit messy, some are applied to pickPlayer, some are applied to rendering\nconst enabledFeatures = {\n  vis_off_ring: true,\n  vis_def_sheild: true,\n  vis_key_player: true,\n  vis_empty_player: false,\n  vis_top_view: false,\n  gaze_focus: true,\n  gaze_filter: false,\n}\nexport type EnabledFeatures = typeof enabledFeatures\n\n\n\ninterface State {\n  videos: Video[]\n  pauseLoading: VideoID | undefined\n  currentVideoIdx: number\n  currentFrameIdx: number\n  currentGaze: Gaze | undefined\n  currentFrame?: HTMLVideoElement\n  // player status\n  gazePlayers?: Player[]\n  attentions?: Attentions\n  attentionsOverTime?: Attentions[]\n  // pickedPlayers: Record<number, { lv1Players: Record<PlayerID, KeyPlayer>, lv2Players: Record<PlayerID, Lv2Player> }>\n  pickedPlayers: {\n    lv1: Partial<Record<PlayerID, KeyPlayer>>,\n    lv2: Partial<Record<PlayerID, Lv2Player>>\n  }\n  comments: IComment[],\n\n  // enable features:\n  features: EnabledFeatures\n  playerFlag: Partial<Record<PlayerID, PlayerFlag>>\n\n  playing: boolean\n}\n\nexport class App extends React.Component<{}, State> {\n\n  state: State = {\n    // playing\n    pauseLoading: undefined,\n    videos: [],\n    currentVideoIdx: 0,\n    currentFrameIdx: 0,\n    currentFrame: undefined,\n    currentGaze: undefined,\n    gazePlayers: undefined,\n    attentions: undefined,\n    attentionsOverTime: undefined,\n    pickedPlayers: { lv1: {}, lv2: {} },\n    comments: [],\n    //\n    features: enabledFeatures,\n    playerFlag: {},\n    //\n    playing: false,\n  }\n\n  #visualizer: React.RefObject<Visualizer> = React.createRef()\n  #commentBox: React.RefObject<CommentBox> = React.createRef()\n  #danmu: React.RefObject<Danmu> = React.createRef()\n\n  get currentVideo() { return this.state.videos[this.state.currentVideoIdx] }\n\n  async componentDidMount() {\n    // should load parameters here\n\n    // get the data from the server and construct a data tower for this video\n    const videos = await Promise.all(params.VIDEO_IDS.map(async (videoId: string) => {\n\n      try {\n        const { max_frame: maxFrame, start_frame = 0, fps, h, w, version } = (await fetch(`${process.env.PUBLIC_URL}/assets/${params.GAME_ID}/${videoId}/${videoId}-meta.json`).then(r => r.json()))\n        const isTransit = videoId.endsWith(',t')\n\n        return {\n          gameId: params.GAME_ID,\n          id: videoId as VideoID,\n          maxFrame,\n          startFame: start_frame,\n          isTransit,\n          frameRate: fps, //params.GAME_ID === 'game1' ? 29.97 : 29.81,\n          loadedData: 0,\n          loadedVideo: 0,\n          width: w,\n          height: h,\n          version,\n        }\n      } catch (e) {\n        console.log('Something wrong with maxjson', videoId)\n        throw e\n      }\n    }))\n    this.setState({ videos })\n\n    // set up videoEnv\n    videoEnv.videos = videos\n\n    videoEnv.onGaze = (currentGaze, gazePlayers) => this.setState({ currentGaze, gazePlayers })\n    videoEnv.onUpdateLvInt = attentions => this.setState({ attentions })\n    videoEnv.onLoad = (videoId: VideoID, type: 'Data' | 'Video', progress) => {\n      const { videos } = this.state\n      const videoIdx = videos.findIndex(v => v.id === videoId)\n      if (videoIdx !== -1) {\n        videos[videoIdx] = {\n          ...videos[videoIdx],\n          [`loaded${type}`]: progress === undefined ? 1 : progress\n          // loaded: videoEnv.isLoaded(videos[videoIdx])\n        }\n        this.setState({ videos: [...videos] })\n      }\n    }\n    videoEnv.onUnload = (videoId: VideoID, type: 'Data' | 'Video') => {\n      const { videos } = this.state\n      const videoIdx = videos.findIndex(v => v.id === videoId)\n      if (videoIdx !== -1) {\n        videos[videoIdx] = {\n          ...videos[videoIdx],\n          [`loaded${type}`]: 0\n          // loaded: videoEnv.isLoaded(videos[videoIdx])\n        }\n        this.setState({ videos: [...videos] })\n      }\n    }\n\n    videoEnv.onPause = (videoId) => this.setState({ playing: false })\n    videoEnv.onPlay = (videoId) => this.setState({ playing: true, pauseLoading: undefined })\n\n    // setup videoEngine\n    // invoke the handler for each frame\n    videoEnv.addOnFrameListener(this.pushFrameHistory)\n    videoEnv.addOnFrameListener(async (videoId, frameIdx, ts, videoFrame) => {\n      const { videos } = this.state\n      const newCurVideoIdx = videos.findIndex(v => v.id === videoId)\n      this.setState({\n        currentFrameIdx: frameIdx,\n        currentVideoIdx: newCurVideoIdx,\n        currentFrame: videoFrame\n      })\n    })\n\n    // load the frames\n    const { currentVideoIdx } = this.state\n    await videoEnv.fetchVideos()\n    // preload videos\n    await videoEnv.loadVideo(videos[currentVideoIdx])\n    const inGamePlayerIds: PlayerID[] = Array.from(new Set(\n      Object.values(videoEnv.frames ?? {}).flatMap(f => f.players?.map(p => p.id))\n    )).filter(p => p !== undefined) as PlayerID[]\n\n    await videoEnv.loadBins(inGamePlayerIds)\n    // init\n    const comments = await getComment()\n    this.setState({ comments })\n    // subscribe\n    subscribe((newComments) => {\n      const { comments } = this.state\n      newComments = newComments.filter(c => comments.every(d => d.id !== c.id))\n\n      this.setState({\n        comments: [\n          ...comments,\n          ...newComments\n        ]\n      })\n      newComments.forEach(c => this.#danmu.current?.push(c))\n    })\n\n    // check players\n    this.setState({\n      playerFlag: inGamePlayerIds\n        .reduce((o, pId) => {\n          if (pId) {\n            o[pId] = 'Auto'\n          }\n          return o\n        }, {} as Partial<Record<PlayerID, 'Auto'>>)\n    })\n  }\n\n  componentWillUnmount() {\n    // dataTower.onGaze = undefined\n    // dataTower.onUpdateLvInt = undefined\n    // dataTower.onUpdateLvSync = undefined\n    // dataTower.onLoadToMem = undefined\n    // dataTower.onUnloadToMem = undefined\n    // videoEngine.clean()\n    // videoEngine.onLoadToMem = undefined\n    // videoEngine.onPause = undefined\n    // videoEngine.onPlay = undefined\n  }\n\n  pushFrameHistory = (videoId: string, localFrameIdx: number, ts: number) => {\n    const { videos } = this.state\n    const videoIdx = videos.findIndex(v => v.id === videoId)\n\n    if (videoIdx === -1) {\n      videoEnv.pause()\n      return\n    }\n\n    const video = videos[videoIdx]\n    videoEnv.pushFrameHistory({ videoId: video.id, fIdx: localFrameIdx, ts })\n  }\n\n  onClickInterval = async (clipId: number, globalFrameIdx: number) => {\n    // 直接给videoFrame设帧\n    const { videos } = this.state\n    const { videoIdx, frameIdx } = globalFIdxToLocal(globalFrameIdx, videos)\n    videoEnv!.pause();\n    await videoEnv!.seekTo(videos[videoIdx], frameIdx)\n  }\n\n  onPlayVideo = async () => {\n    const { playing } = this.state\n    if (playing) {\n      videoEnv!.pause()\n    } else {\n      videoEnv!.play()\n    }\n  }\n\n  loadedPrecentage() {\n    const { videos } = this.state\n    // assuming loading data takes 2x times than loading videos\n    const value = videos.reduce((o, d) => o += d.loadedData * 2 + d.loadedVideo, 0) / videos.reduce((o, v) => o + (v.isTransit ? 1 : 3), 0)\n    return value\n  }\n\n  renderProgressbar() {\n    const value = this.loadedPrecentage() * 100\n    return value === 100 ? null : <div style={{\n      position: 'fixed',\n      left: '50%',\n      top: '50%',\n      transform: 'translate(-50%, -50%)'\n    }}>\n      <CircularProgressbarWithChildren\n        value={value}\n        // text={'test'}\n        styles={buildStyles({\n          pathColor: `rgb(62, 152, 199)`,\n          textColor: '#f88',\n          trailColor: '#d6d6d6',\n          backgroundColor: '#3e98c7',\n        })}\n      >\n        <div style={{ color: '#f88', fontSize: '40px' }}>{`${value | 0}%`}</div>\n        <div style={{ color: '#f88', fontSize: '24px' }} >~1min</div>\n      </CircularProgressbarWithChildren>\n    </div>\n  }\n\n  renderToggle() {\n    const { features } = this.state\n    return <div className=\"featurePanel\">\n      <h4 style={{ textAlign: 'center' }}>Features</h4>\n      {Object.entries(features)\n        .filter(([k, v]) => k !== 'onPlayers' && k !== 'offPlayers')\n        .map(([k, v]) => {\n\n          return <div className=\"featureItem\" key={k}>\n            <Toggle\n              key={k}\n              id='cheese-status'\n              // defaultChecked={v as boolean}\n              checked={v as boolean}\n              onChange={(e) => {\n                ; (features as any)[k] = !v\n                this.setState({ features })\n              }} />\n            <span>{k.split('_').join(' ')}</span>\n          </div>\n        })}\n    </div>\n  }\n\n  renderPlayerToggle() {\n    const { playerFlag } = this.state\n    return <div className=\"playerPanel\">\n      <h4 style={{ textAlign: 'center' }}>Players</h4>\n      <div className=\"btn-group\">\n        {['Auto', 'On', 'Off'].map(v =>\n          <button key={`btn_${v}`}\n            onClick={() => {\n              const { playerFlag } = this.state\n              Object.keys(playerFlag)\n                .forEach(pId => {\n                  playerFlag[+pId as PlayerID] = v as PlayerFlag\n                })\n              this.setState({ playerFlag: { ...playerFlag } })\n            }}>{v} All</button>)}\n      </div>\n      <div className=\"gridContainer\">\n        {Object.entries(playerFlag)\n          .sort((a, b) => {\n            const { team: teamA } = PLAYER_META[+a[0] as PlayerID]\n            const { team: teamB } = PLAYER_META[+b[0] as PlayerID]\n\n            return teamA.localeCompare(teamB)\n          })\n          .map(([pId, v]) => {\n            const { team } = PLAYER_META[+pId as PlayerID]\n\n            return <>\n              <span className=\"gridItem\"\n                key={`${pId}_name`}\n                style={{\n                  color: ['GSW', 'LAC'].includes(team)\n                    ? 'steelblue'\n                    : '#ff6347',\n                  fontWeight: 500\n                }}\n              >\n                {PLAYER_META[+pId as PlayerID].ln}\n              </span>\n              <label className=\"gridItem\" key={`${pId}_select`}>\n                <select name=\"pflag\" id=\"pflag\" value={v}\n                  onChange={e => {\n                    playerFlag[+pId as PlayerID] = e.target.value as PlayerFlag\n                    this.setState({ playerFlag: { ...playerFlag } })\n                  }}\n                >\n                  {['Auto', 'On', 'Off', 'TXT'].map(value =>\n                    <option key={value} value={value} disabled={value === 'TXT'}>{value}</option>\n                  )}\n                </select>\n              </label>\n            </>\n          })}\n      </div>\n    </div>\n  }\n\n  render() {\n    const {\n      currentVideoIdx,\n      currentFrameIdx,\n\n      features,\n      playerFlag,\n\n      currentGaze,\n      currentFrame,\n      gazePlayers,\n\n      pauseLoading,\n      attentions,\n      attentionsOverTime,\n      pickedPlayers,\n      comments,\n      // sync,\n      playing,\n      videos,\n    } = this.state;\n    const currentFrameData = videoEnv.frames?.[currentFrameIdx]\n\n    return (\n      <>\n        <OnBoard></OnBoard>\n        {this.renderProgressbar()}\n        {features.vis_top_view && <Court\n          currentFrameData={currentFrameData}\n        />}\n        <div className=\"up\">\n          <div className=\"left\">\n            <Visualizer ref={this.#visualizer}\n              // video\n              currentVideo={this.currentVideo}\n              currentFrameIdx={currentFrameIdx}\n              currentFrame={currentFrame}\n              // feature\n              features={features}\n              playerFlags={playerFlag}\n              // gaze\n              gaze={currentGaze}\n              gazePlayers={gazePlayers}\n              onPickPlayers={(fIdx, lv1Players, lv2Players) => {\n                const vIdx = videos.findIndex(v => v.id === this.currentVideo.id)\n                if (vIdx === -1) return\n\n                this.setState({ pickedPlayers: { lv1: lv1Players, lv2: lv2Players } })\n                // const globalFIdx = localFIdxToGlobalFIdx(vIdx, fIdx, videos)\n                // this.setState({\n                //   pickedPlayers: { ...pickedPlayers, [globalFIdx]: { lv1Players, lv2Players } }\n                // })\n              }}\n            >\n\n              <Overlay\n                currentVideo={this.currentVideo}\n                currentFrameData={currentFrameData}\n                gaze={DEBUG.GAZE ? currentGaze : undefined}\n                gazePlayers={gazePlayers}\n                bbox={false}\n              />\n              <Danmu\n                ref={this.#danmu}\n                videoId={this.currentVideo?.id}\n                frameIdx={currentFrameIdx}\n                comments={comments}\n              />\n            </Visualizer>\n\n            <div className=\"controls\">\n              <button\n                id=\"playpause\"\n                className=\"play button is-outlined\"\n                type=\"button\"\n                disabled={pauseLoading !== undefined || this.loadedPrecentage() !== 1}\n                onClick={() => this.onPlayVideo()}\n              >\n                {playing\n                  ? <IoPauseSharp style={{ transform: 'scale(1.5)' }} />\n                  : pauseLoading !== undefined\n                    ? <AiOutlineLoading style={{ transform: 'scale(1.5)' }} />\n                    : <IoPlaySharp style={{ transform: 'scale(1.5)' }} />}\n              </button>\n              <CommentBox\n                ref={this.#commentBox}\n                existPlayers={Object.keys(playerFlag).map(p => +p) as PlayerID[]}\n                onUpdatePlayerEntity={pIds => {\n                  const { playerFlag } = this.state\n\n                  Object.keys(playerFlag)\n                    .forEach(pId => {\n                      if (pIds.includes(+pId as PlayerID)) {\n                        playerFlag[+pId as PlayerID] = 'TXT'\n                      } else if (playerFlag[+pId as PlayerID] === 'TXT') {\n                        // switch back to Auto\n                        playerFlag[+pId as PlayerID] = 'Off'\n                      }\n\n                    })\n                  this.setState({ playerFlag: { ...playerFlag } })\n                }}\n                onSend={async (text) => {\n                  const gameId = this.currentVideo.gameId\n                  const videoId = this.currentVideo.id\n                  const frameIdx = currentFrameIdx\n\n                  const docId = await postComment({\n                    content: text.trim(),\n                    gameId,\n                    videoId,\n                    frameIdx,\n                    features,\n                    playerFlag,\n                    pickedPlayers,\n                  })\n                  // will be updated in the subscribe callback\n                  if (docId) {\n                    // const newComment = { id: docId, content: text, gameId, videoId, frameIdx }\n                    // this.setState({\n                    //   comments: [\n                    //     ...comments,\n                    //     newComment\n                    //   ]\n                    // })\n                    // this.#danmu.current?.push(newComment)\n                    this.#commentBox.current?.clean()\n                  }\n                }}\n              ></CommentBox>\n            </div>\n          </div>\n          {/* <div className=\"divide\"> </div> */}\n\n          <div className=\"right\">\n            {this.renderToggle()}\n            {this.renderPlayerToggle()}\n\n            <Contact></Contact>\n          </div>\n        </div>\n\n        {DEBUG.TIMELINE &&\n          <Timeline\n            mode=\"S\"\n            videos={videos}\n            currentVideoIdx={currentVideoIdx}\n            currentFrameIdx={currentFrameIdx}\n            enableClips={false}\n            // pickedPlayers={pickedPlayers}\n            onClickInterval={this.onClickInterval}\n          />\n        }\n      </>)\n  }\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { App } from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n","import type { PlayerID } from \"@types\"\n\nexport const TEAM_META = {\n    GSW: {},\n    CLE: {},\n    OKC: {},\n    LAC: {}\n}\n\n//offSpeed is actually AVG Defense Speed\nexport const PLAYER_META = {\n    2760: { fn: \"Anderson\", ln: \"Varejao\", offSpeed: 4.07, team: 'GSW', star: false },\n    2738: { fn: \"Andre\", ln: \"Iguodala\", offSpeed: 3.78, team: 'GSW', star: false },\n    101106: { fn: \"Andrew\", ln: \"Bogut\", offSpeed: 3.5, team: 'GSW', star: false },\n    201575: { fn: \"Brandon\", ln: \"Rush\", offSpeed: 4.09, team: 'GSW', star: false },\n    203110: { fn: \"Draymond\", ln: \"Green\", offSpeed: 3.49, team: 'GSW', star: 'defender' },\n    203105: { fn: \"Festus\", ln: \"Ezeli\", offSpeed: 3.97, team: 'GSW', star: false },\n    203084: { fn: \"Harrison\", ln: \"Barnes\", offSpeed: 4.02, team: 'GSW', star: false },\n    203546: { fn: \"Ian\", ln: \"Clark\", offSpeed: 4.07, team: 'GSW', star: false },\n    203949: { fn: \"James Michael\", ln: \"McAdoo\", offSpeed: 4.27, team: 'GSW', star: false },\n    1626172: { fn: \"Kevon\", ln: \"Looney\", offSpeed: 4.05, team: 'GSW', star: false },\n    202691: { fn: \"Klay\", ln: \"Thompson\", offSpeed: 3.85, team: 'GSW', star: 'shooter' },\n    2571: { fn: \"Leandro\", ln: \"Barbosa\", offSpeed: 3.88, team: 'GSW', star: false },\n    201578: { fn: \"Marreese\", ln: \"Speights\", offSpeed: 3.67, team: 'GSW', star: false },\n    2733: { fn: \"Shaun\", ln: \"Livingston\", offSpeed: 3.85, team: 'GSW', star: false },\n    201939: { fn: \"Stephen\", ln: \"Curry\", offSpeed: 3.68, team: 'GSW', star: 'shooter' },\n    201574: { fn: \"Jason\", ln: \"Thompson\", offSpeed: 3.68, team: 'GSW', star: false },\n\n    101112: { fn: \"Channing\", ln: \"Frye\", offSpeed: 3.61, team: 'CLE', star: false },\n    2563: { fn: \"Dahntay\", ln: \"Jones\", offSpeed: 4.31, team: 'CLE', star: false },\n    202697: { fn: \"Iman\", ln: \"Shumpert\", offSpeed: 4.08, team: 'CLE', star: false },\n    2747: { fn: \"JR\", ln: \"Smith\", offSpeed: 3.92, team: 'CLE', star: false },\n    2592: { fn: \"James\", ln: \"Jones\", offSpeed: 3.84, team: 'CLE', star: false },\n    203099: { fn: \"Jared\", ln: \"Cunningham\", offSpeed: 4.24, team: 'CLE', star: false },\n    203925: { fn: \"Joe\", ln: \"Harris\", offSpeed: 4.6, team: 'CLE', star: false },\n    203895: { fn: \"Jordan\", ln: \"McRae\", offSpeed: 3.6, team: 'CLE', star: false },\n    201567: { fn: \"Kevin\", ln: \"Love\", offSpeed: 3.86, team: 'CLE', star: false },\n    202681: { fn: \"Kyrie\", ln: \"Irving\", offSpeed: 3.78, team: 'CLE', star: false },\n    2544: { fn: \"LeBron\", ln: \"James\", offSpeed: 3.72, team: 'CLE', star: 'star' },\n    203521: { fn: \"Matthew\", ln: \"Dellavedova\", offSpeed: 3.9, team: 'CLE', star: false },\n    2590: { fn: \"Mo\", ln: \"Williams\", offSpeed: 3.92, team: 'CLE', star: false },\n    2210: { fn: \"Richard\", ln: \"Jefferson\", offSpeed: 3.96, team: 'CLE', star: false },\n    201619: { fn: \"Sasha\", ln: \"Kaun\", offSpeed: 4.12, team: 'CLE', star: false },\n    202389: { fn: \"Timofey\", ln: \"Mozgov\", offSpeed: 4.12, team: 'CLE', star: false },\n    202684: { fn: \"Tristan\", ln: \"Thompson\", offSpeed: 4.1, team: 'CLE', star: false },\n\n    201566: { fn: 'Russell', ln: 'Westbrook', offSpeed: 3.71, team: 'OKC', star: 'shooter' },\n    201627: { fn: 'Anthony', ln: 'Morrow', offSpeed: 3.80, team: 'OKC', star: false },\n    203079: { fn: 'Dion', ln: 'Waiters', offSpeed: 3.74, team: 'OKC', star: false },\n    2555: { fn: 'Nick', ln: 'Collison', offSpeed: 3.90, team: 'OKC', star: false },\n    202713: { fn: 'Kyle', ln: 'Singler', offSpeed: 4.21, team: 'OKC', star: false },\n    200779: { fn: 'Steve', ln: 'Novak', offSpeed: 3.87, team: 'OKC', star: false },\n    201586: { fn: 'Serge', ln: 'Ibaka', offSpeed: 3.67, team: 'OKC', star: false },\n    202683: { fn: 'Enes', ln: 'Kanter', offSpeed: 3.89, team: 'OKC', star: false },\n    203500: { fn: 'Steven', ln: 'Adams', offSpeed: 3.79, team: 'OKC', star: false },\n    201571: { fn: 'D.J.', ln: 'Augustin', offSpeed: 3.84, team: 'OKC', star: false },\n    203460: { fn: 'Andre', ln: 'Roberson', offSpeed: 4.36, team: 'OKC', star: false },\n    1626166: { fn: 'Cameron', ln: 'Payne', offSpeed: 4.11, team: 'OKC', star: false },\n    201142: { fn: 'Kevin', ln: 'Durant', offSpeed: 3.47, team: 'OKC', star: 'shooter' },\n\n    202362: { fn: 'Lance', ln: 'Stephenson', offSpeed: 3.98, team: 'LAC', star: false },\n    101108: { fn: 'Chris', ln: 'Paul', offSpeed: 3.67, team: 'LAC', star: 'star' },\n    200755: { fn: 'Redick', ln: 'JJ', offSpeed: 4.11, team: 'LAC', star: false },\n    2746: { fn: 'Josh', ln: 'Smith', offSpeed: 3.72, team: 'LAC', star: false },\n    201599: { fn: 'DeAndre', ln: 'Jordan', offSpeed: 3.68, team: 'LAC', star: false },\n    203143: { fn: 'Pablo', ln: 'Prigioni', offSpeed: 4.46, team: 'LAC', star: false },\n    2037: { fn: 'Jamal', ln: 'Crawford', offSpeed: 3.72, team: 'LAC', star: false },\n    201601: { fn: 'Luc', ln: 'Mbah a Moute', offSpeed: 4.08, team: 'LAC', star: false },\n    203085: { fn: 'Austin', ln: 'Rivers', offSpeed: 4.13, team: 'LAC', star: false },\n    201933: { fn: 'Blake', ln: 'Griffin', offSpeed: 3.56, team: 'LAC', star: false },\n    202325: { fn: 'Wesley', ln: 'Johnson', offSpeed: 4.06, team: 'LAC', star: false },\n    1718: { fn: 'Paul', ln: 'Pierce', offSpeed: 3.54, team: 'LAC', star: false },\n    202332: { fn: 'Cole', ln: 'Aldrich', offSpeed: 3.96, team: 'LAC', star: false },\n} as const\n\n\nexport const PLAYER_RANDOM_FACTOR = Object.entries(PLAYER_META)\n    .reduce((o, [pId, _]) => {\n        o[+pId as PlayerID] = Math.random() * 0.6\n        return o\n    }, {} as Record<PlayerID, number>)","export const GAZE_R = 20\n\n// lnSync threshold in ms, if you are not watching all the key players at least EXPLORE_MODE_THRESHOLD ms, the system will show you the next highlight\nexport const NEXT_BALL_HOLDER_TIME_RANGE = 1.8\nexport const LV_INTEREST_THRESHOLD = { off: 0.03, on: 0.6 }\n// // for lvSync\n// export const EXPLORE_MODE_THRESHOLD = 1500 // ms\n// // the highlight triggered by lvSync will exist for EXPLORE_STAY_THRESHOLD ms\nexport const EXPLORE_STAY_THRESHOLD = 1500\n// the min distance for an empty player, which means that if the distance between an offensor\n// and his closet defender is larger than EMPTY_SPACE_THRESHOLD, the system will think the offensor is an empty player\nexport const EMPTY_SPACE_THRESHOLD = 8\nexport const MAX_HIGHLIGHTED = 4 //{ S1: 2, S2: 3 }[LV_SYNC]\nexport const FOCUS = { min: 10, max: 630, mina: 0.2, maxa: 0.35 }","\nconst miniMapWidth = 360 * 1\nexport const miniMapSize: [number, number] = [miniMapWidth, miniMapWidth * 50 / 94]\nexport const COLORS = {\n    offense_inner_border: '#f5f5f5',\n    offense_bg_fill: '#f5f5f577',\n    offense_outer_border: 'rgba(220, 220, 220, 0.1)',\n    defense_bg_fill: `rgba(255, 255, 255, 0.15)`,\n    defense_fg_fill: `#f5f5f5`,\n    player_name: '#f5f5f5',\n    BG_MASK_ALPHA: 0.3,\n    FG_MASK_ALPHA: 0.2,\n    off_df_link: '255, 255, 255',\n    star_name: 'rgb(255, 243, 194)',\n    star_star: 'rgb(255, 243, 194)', // 'rgb(255,215,120)'\n} as const","export * from './players'\nexport * from './gaze'\nexport * from './style'\n\n// video players\nexport const VIDEO_ID_GROUPS = {\n    game2_unit0: [],\n    game1_unit0: [\n        // '0_,',\n        // '1_c,t',\n        // '2_c,l',\n        // '3_c,t',\n        '4_,',\n        '5_c,t',\n        '6_,',\n    ],\n    game1_unit1: [\n        '4_,',\n        '5_c,t',\n        '6_,',\n        '7_c,t',\n        '8_c,',\n        '9_c,t',\n        '10_,',\n        '11_c,t',\n        '12_,',\n        '13_c,t',\n        '14_c,',\n        '15_c,t',\n    ],\n    game1_unit2: [\n        '16_,',\n        '17_c,t',\n        '18_,l',\n        '19_c,t',\n        '20_,',\n        '21_c,t',\n        '22_,',\n        '23_c,t',\n        '24_,l',\n        '25_c,t',\n        '26_,l',\n        '27_,l',\n        '28_,l',\n        '30_,'\n    ],\n    game2_unit1: [\n        '0_,',\n        '1_c,t',\n        '2_,t',\n        '3_c,',\n        '4_c,t',\n        '5_c,',\n        '6_c,t',\n        '7_c,l',\n        '8_c,t',\n        '9_c,',\n        '10_c,t'\n    ],\n    game2_unit2: [\n        '11_,t',\n        '12_c,l',\n        '13_c,',\n        '14_c,t',\n        '15_c,',\n        '16_c,t',\n        '17_,l',\n        '18_c,t',\n        '19_,t',\n        '20_c,',\n        '21_c,t',\n        '22_c,l',\n        '23_c,t',\n        '24_,l',\n        '25_c,t',\n        '26_,',\n        '27_c,t',\n        '28_,',\n        '29_c,t',\n        '30_,t',\n        '31_c,',\n        '32_c,t',\n        '33_,t',\n        '34_c,',\n        '35_c,t',\n    ]\n} as const\n","import { VIDEO_ID_GROUPS } from \"@const\"\nimport { UnitID, GameID } from \"@types\"\n\nexport class Parameters {\n\n    // get VIDEO_FRAME_RATE() {\n    //     return this.GAME_ID === 'game1' ? 29.97 : 29.81\n    // }\n\n    get VIDEO_IDS() {\n        return VIDEO_ID_GROUPS[`${this.GAME_ID}_${this.UNIT_ID}`]\n    }\n\n    constructor(\n        public readonly GAME_ID: GameID = 'game1',\n        public readonly UNIT_ID: UnitID = 'unit0',\n        // public readonly MODE: 'AUG' | 'FULL' | 'RAW' = 'FULL',\n        // public readonly LV_FOCUS: boolean = MODE === 'FULL',\n        // public readonly LV_INTRE: boolean = MODE === 'FULL'\n    ) {\n        console.log(global.location.search)\n        console.debug(`%cParams:\n    GAME_ID: ${GAME_ID},\n    UNIT_ID: ${UNIT_ID},\n    `, 'background: #444; color: #bada55; padding: 2px; border-radius:2px')\n}\n// MODE: ${MODE},\n// LV_FOCUS: ${LV_FOCUS},\n// LV_INTRE: ${LV_INTRE}\n}\n\nfunction initParams() {\n    const params = new URLSearchParams(global.location.search);\n    let gameId: GameID = 'game1'\n    if(params.get('g') !== null) {\n        gameId = `game${params.get('g')}` as GameID\n    }\n    // validate\n    if(!['game1', 'game2'].includes(gameId)) {\n        alert('GameId must be game1 or game2')\n    }\n\n    let unitId: UnitID = 'unit0'\n    if(params.get('u') !== null) {\n        unitId = `unit${params.get('u')}` as UnitID\n    }\n    if(!['unit0', 'unit1', 'unit2'].includes(unitId)) {\n        alert('UnitId must be unit0, unit1, or unit2')\n    }\n\n    let mode: 'AUG' | 'FULL' | 'RAW' = 'FULL'\n    if(params.get('m') !== null) {\n        mode =  params.get('m')!.toUpperCase() as 'AUG' | 'FULL' | 'RAW'\n    }\n    if(!['AUG', 'FULL', 'RAW'].includes(mode)) {\n        alert('Mode must be RAW, AUG, or FULL')\n    }\n\n    let lvFocus: boolean = mode === 'FULL'\n    if(params.get('gf') !== null) {\n        lvFocus = params.get('gf') === 'true'\n    }\n    \n    let lvInt = mode === 'FULL'\n    if(params.get('gi') !== null) {\n        lvInt = params.get('gi') === 'true'\n    }\n\n    return new Parameters(gameId, unitId) //, mode, lvFocus, lvInt)\n}\n\nexport const params = initParams()","/**\n * Basic geometry data type\n */\nexport interface Point {\n    readonly x: number\n    readonly y: number\n}\nexport type Route = [Point, Point, Point, Point]\n\nexport interface BBox {\n    readonly x: number;\n    readonly y: number;\n    readonly w: number;\n    readonly h: number\n}\n\nexport enum Side {\n    MIDDLE = 'MIDDLE',\n    LEFT = 'LEFT',\n    RIGHT = 'RIGHT'\n}\n\nexport enum Direction {\n    N = 'NORTH',\n    S = 'SOUTH',\n    E = 'EAST',\n    W = 'WEST',\n    NE = 'NORTH_EAST',\n    NW = 'NORTH_WEST',\n    SE = 'SOUTH_EAST',\n    SW = 'SOUTH_WEST'\n}\n"],"sourceRoot":""}